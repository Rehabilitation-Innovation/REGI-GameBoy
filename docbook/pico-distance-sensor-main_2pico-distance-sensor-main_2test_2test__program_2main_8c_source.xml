<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source" xml:lang="en-US">
<title>main.c</title>
<indexterm><primary>lib/pico-distance-sensor-main/pico-distance-sensor-main/test/test_program/main.c</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00001"/>00001 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00024"/>00024 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00025"/>00025 <emphasis role="preprocessor">#include&#32;&lt;stdio.h&gt;</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00026"/>00026 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_pico_8h">pico.h</link>&quot;</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00027"/>00027 <emphasis role="preprocessor">#include&#32;&quot;pico/stdlib.h&quot;</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00028"/>00028 <emphasis role="preprocessor">#include&#32;&quot;sensor.pio.h&quot;</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00029"/>00029 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_pio_8h">hardware/pio.h</link>&quot;</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00030"/>00030 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00031"/><link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab9caf14a448f24e2cb8735c41e6efd40">00031</link> <emphasis role="preprocessor">#define&#32;SENSE_COMPLETE_IRQ&#32;&#32;&#32;0b0001</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00032"/>00032 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00033"/><link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">00033</link> <emphasis role="keyword">volatile</emphasis>&#32;uint32_t&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">pio_counter</link>&#32;=&#32;0;
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00034"/>00034 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00035"/><link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab9c1cf133f9da3ffb171e522c90dccbe">00035</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab9c1cf133f9da3ffb171e522c90dccbe">print_debug_info</link>()&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00036"/>00036 &#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;FSTAT:&#32;0x%08X\n&quot;</emphasis>,&#32;pio0_hw-&gt;fstat);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00037"/>00037 &#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;FDEBUG:&#32;0x%08X\n&quot;</emphasis>,&#32;pio0_hw-&gt;fdebug);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00038"/>00038 }
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00039"/>00039 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00040"/><link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab5736b949a4e3c634a25345994a89e08">00040</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab5736b949a4e3c634a25345994a89e08">sense_irq</link>()&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00041"/>00041 &#32;&#32;&#32;&#32;uint32_t&#32;irq&#32;=&#32;pio0_hw-&gt;irq;
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00042"/>00042 &#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;Working&#32;with&#32;irq:&#32;0x%08X\n&quot;</emphasis>,&#32;irq);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00043"/>00043 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(irq&#32;&amp;&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab9caf14a448f24e2cb8735c41e6efd40">SENSE_COMPLETE_IRQ</link>)&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00044"/>00044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;count&#32;=&#32;pio_sm_get_rx_fifo_level(<link linkend="_pio_8h_1a916d05e71da7f2173cd22b46bbfa0a11">pio0</link>,&#32;0);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00045"/>00045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;There&#32;are&#32;%d&#32;items&#32;in&#32;the&#32;rx&#32;fifo\n&quot;</emphasis>,&#32;count);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00046"/>00046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(count&#32;&gt;&#32;0)&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00047"/>00047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">pio_counter</link>&#32;=&#32;(<link linkend="_pio_8h_1a70a47a122f289106c36bcacc76add2bb">~pio_sm_get</link>(<link linkend="_pio_8h_1a916d05e71da7f2173cd22b46bbfa0a11">pio0</link>,&#32;0)&#32;*&#32;2);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00048"/>00048 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00049"/>00049 &#32;&#32;&#32;&#32;}
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00050"/>00050 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00051"/>00051 &#32;&#32;&#32;&#32;hw_clear_bits(&amp;pio0_hw-&gt;irq,&#32;irq);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00052"/>00052 }
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00053"/>00053 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00054"/><link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a5e011fdfdbd1a313f9a0ddf4e231064f">00054</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a5e011fdfdbd1a313f9a0ddf4e231064f">begin_sense</link>()&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00055"/>00055 &#32;&#32;&#32;&#32;pio_sm_put_blocking(<link linkend="_pio_8h_1a916d05e71da7f2173cd22b46bbfa0a11">pio0</link>,&#32;0,&#32;0xFFFFFFFF);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00056"/>00056 }
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00057"/>00057 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00058"/><link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ae66f6b31b5ad750f1fe042a706a4e3d4">00058</link> <emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ae66f6b31b5ad750f1fe042a706a4e3d4">main</link>()&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00059"/>00059 &#32;&#32;&#32;&#32;stdio_init_all();
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00060"/>00060 &#32;&#32;&#32;&#32;sleep_ms(5000);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00061"/>00061 &#32;&#32;&#32;&#32;puts(<emphasis role="stringliteral">&quot;Testing&#32;the&#32;HC-SR04&#32;distance&#32;sensor&#32;with&#32;PIO&quot;</emphasis>);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00062"/>00062 &#32;&#32;&#32;&#32;<link linkend="_pio_8h_1a05b1974aa3d59de9efe4ff87799ff3da">PIO</link>&#32;<link linkend="__dino_game_8cpp_1ac79a43604cef3e167780e935276174d0">pio</link>&#32;=&#32;<link linkend="_pio_8h_1a916d05e71da7f2173cd22b46bbfa0a11">pio0</link>;
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00063"/>00063 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;<link linkend="__dino_game_8cpp_1abeba240b99c2caa6556ccab58b8c8ebb">sm</link>&#32;=&#32;0;
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00064"/>00064 &#32;&#32;&#32;&#32;<link linkend="_pico_8h_1a4f5fce8c1ef282264f9214809524d836">uint</link>&#32;offset&#32;=&#32;<link linkend="_pio_8h_1a3571e3c7c6e645e92b8d438203a911b9">pio_add_program</link>(<link linkend="__dino_game_8cpp_1ac79a43604cef3e167780e935276174d0">pio</link>,&#32;&amp;distance_sensor_program);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00065"/>00065 &#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;Loaded&#32;program&#32;to&#32;pio&#32;offset&#32;0x%08X\n&quot;</emphasis>,&#32;offset);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00066"/>00066 &#32;&#32;&#32;&#32;distance_sensor_program_init(<link linkend="__dino_game_8cpp_1ac79a43604cef3e167780e935276174d0">pio</link>,&#32;<link linkend="__dino_game_8cpp_1abeba240b99c2caa6556ccab58b8c8ebb">sm</link>,&#32;offset,&#32;0,&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1ab5736b949a4e3c634a25345994a89e08">sense_irq</link>);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00067"/>00067 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00068"/>00068 &#32;&#32;&#32;&#32;<link linkend="_pico_8h_1a4f5fce8c1ef282264f9214809524d836">uint</link>&#32;count&#32;=&#32;0;
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00069"/>00069 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<emphasis role="keyword">true</emphasis>)&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00070"/>00070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;Sense&#32;count&#32;%d:&#32;\n&quot;</emphasis>,&#32;count++);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00071"/>00071 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a5e011fdfdbd1a313f9a0ddf4e231064f">begin_sense</link>();
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00072"/>00072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Wait&#32;for&#32;ISR&#32;to&#32;notify&#32;us&#32;that&#32;the&#32;sense&#32;is&#32;done.</emphasis>
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00073"/>00073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">pio_counter</link>&#32;==&#32;0)&#32;{
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00074"/>00074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sleep_us(100);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00075"/>00075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00076"/>00076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;Got&#32;counter&#32;value&#32;%d\n&quot;</emphasis>,&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">pio_counter</link>);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00077"/>00077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;printf(<emphasis role="stringliteral">&quot;Sensor&#32;distance&#32;%d\n&quot;</emphasis>,&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">pio_counter</link>&#32;/&#32;58);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00078"/>00078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_1a3ae8ed65af7a4257f7f7ba6dedae55ee">pio_counter</link>&#32;=&#32;0;
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00079"/>00079 
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00080"/>00080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sleep_ms(1000);
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00081"/>00081 &#32;&#32;&#32;&#32;}
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00082"/>00082 }
<anchor xml:id="_pico-distance-sensor-main_2pico-distance-sensor-main_2test_2test__program_2main_8c_source_1l00083"/>00083 
</programlisting></section>
