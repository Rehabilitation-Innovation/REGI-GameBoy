<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_ff_8h" xml:lang="en-US">
<title>lib/pico-vfs-REGI-Local/vendor/ff15/source/ff.h File Reference</title>
<indexterm><primary>lib/pico-vfs-REGI-Local/vendor/ff15/source/ff.h</primary></indexterm>
<programlisting linenumbering="unnumbered">#include &quot;ffconf.h&quot;<?linebreak?></programlisting><simplesect>
    <title>Classes    </title>
        <itemizedlist>
            <listitem><para>struct <link linkend="_struct_f_a_t_f_s">FATFS</link></para>
</listitem>
            <listitem><para>struct <link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link></para>
</listitem>
            <listitem><para>struct <link linkend="_struct_f_i_l">FIL</link></para>
</listitem>
            <listitem><para>struct <link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link></para>
</listitem>
            <listitem><para>struct <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link></para>
</listitem>
            <listitem><para>struct <link linkend="_struct_m_k_f_s___p_a_r_m">MKFS_PARM</link></para>
</listitem>
        </itemizedlist>
</simplesect>
<simplesect>
    <title>Macros    </title>
        <itemizedlist>
            <listitem><para>#define <link linkend="_ff_8h_1a67f86fd50a009422bed52a85b7a28a77">FF_DEFINED</link>&#160;&#160;&#160;80286	/* Revision ID */</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a3eb7cbd9d1d0548d54856f1cc8a2021f">FF_INTDEF</link>&#160;&#160;&#160;1</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1ae936e4c15227768f7da4e0951def89c8">_T</link>(<link linkend="__dino_game_8cpp_1aae8a40a17c0be29c1f06ca6b4f9e2235">x</link>)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a3232964568d17bb4a1af30f9db826ce2">_TEXT</link>(<link linkend="__dino_game_8cpp_1aae8a40a17c0be29c1f06ca6b4f9e2235">x</link>)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a970cdd8970a3a94967ad64cfc5d4c161">f_eof</link>(fp)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a25cbdabeed318802cf0e9db6671a33b7">f_error</link>(fp)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a5e1daca7ce13cdc277e42185f7f9124f">f_tell</link>(fp)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a26f33722c5bf1aa3cd6f0290a83eb2bc">f_size</link>(fp)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1ae4caf47dd5cbc123b61d35542481b1be">f_rewind</link>(fp)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a3f92b6c0c1648de678283ab6f1610161">f_rewinddir</link>(dp)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a58df56d084ad3dd9f8cd49b245a7a7ca">f_rmdir</link>(path)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1aa22c4b32404b35d0a0bd138fa63f2e75">f_unmount</link>(path)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>&#160;&#160;&#160;0x01</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>&#160;&#160;&#160;0x02</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a0c5dd686b10f84c2a2b3954957a5979a">FA_OPEN_EXISTING</link>&#160;&#160;&#160;0x00</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>&#160;&#160;&#160;0x04</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>&#160;&#160;&#160;0x08</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a17b01553029920ac0468912b4bcb16c7">FA_OPEN_ALWAYS</link>&#160;&#160;&#160;0x10</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a90f135b2ae90fba5080f6bd2b6c57b8a">FA_OPEN_APPEND</link>&#160;&#160;&#160;0x30</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1aee297a9011164cf485a4df2a72758b08">CREATE_LINKMAP</link>&#160;&#160;&#160;((<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>)0 - 1)</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a8bd205b7d09147e55169d3713f46e9ea">FM_FAT</link>&#160;&#160;&#160;0x01</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1aff61d3ed8f8c6ea5c25c3cb366320e08">FM_FAT32</link>&#160;&#160;&#160;0x02</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a9348c28116bc29e88195b23f6945f81d">FM_EXFAT</link>&#160;&#160;&#160;0x04</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>&#160;&#160;&#160;0x07</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>&#160;&#160;&#160;0x08</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>&#160;&#160;&#160;1</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>&#160;&#160;&#160;2</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>&#160;&#160;&#160;3</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#160;&#160;&#160;4</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>&#160;&#160;&#160;0x01	/* Read only */</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1aa90c4c921c1955fd407d8bbf17f1674e">AM_HID</link>&#160;&#160;&#160;0x02	/* Hidden */</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a1f25d5c17b5a3a6397b3398add8cdc15">AM_SYS</link>&#160;&#160;&#160;0x04	/* System */</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>&#160;&#160;&#160;0x10	/* Directory */</para>
</listitem>
            <listitem><para>#define <link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>&#160;&#160;&#160;0x20	/* Archive */</para>
</listitem>
        </itemizedlist>
</simplesect>
<simplesect>
    <title>Typedefs    </title>
        <itemizedlist>
            <listitem><para>typedef unsigned int <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link></para>
</listitem>
            <listitem><para>typedef unsigned char <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link></para>
</listitem>
            <listitem><para>typedef unsigned short <link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link></para>
</listitem>
            <listitem><para>typedef unsigned long <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link></para>
</listitem>
            <listitem><para>typedef <link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link> <link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link></para>
</listitem>
            <listitem><para>typedef <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> <link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link></para>
</listitem>
            <listitem><para>typedef <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> <link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link></para>
</listitem>
            <listitem><para>typedef char <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link></para>
</listitem>
        </itemizedlist>
</simplesect>
<simplesect>
    <title>Enumerations    </title>
        <itemizedlist>
            <listitem><para>enum <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> { <?linebreak?><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link> = 0
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45">FR_NOT_READY</link>
, <?linebreak?><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>
, <?linebreak?><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>
, <?linebreak?><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cafc56605c68aaffab4a428339a8bd600d">FR_NOT_ENABLED</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3f8ca7e51af8b129d14328de7243c5d4">FR_TIMEOUT</link>
, <?linebreak?><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca7db5afaaa2af591bd4a208b2967075d7">FR_LOCKED</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>
, <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3b89faeceab64db277d0fcdeaaa315d6">FR_INVALID_PARAMETER</link>
 }</para>
</listitem>
        </itemizedlist>
</simplesect>
<simplesect>
    <title>Functions    </title>
        <itemizedlist>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1aefdef7126128d99d0b3bd82c28e54d80">f_open</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> mode)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a53882db20ef4323dcfd1874d7733ffc3">f_close</link> (<link linkend="_struct_f_i_l">FIL</link> *fp)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, void *buff, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> btr, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> *br)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1ae6a4dfae8a9e308bdb2283a37ef680f2">f_write</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, const void *buff, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> btw, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> *bw)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a7c4bcf81d9122f0b5376852ec6a8c3eb">f_lseek</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, <link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link> ofs)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a691a27b40c348f7c84b42e911636f38a">f_truncate</link> (<link linkend="_struct_f_i_l">FIL</link> *fp)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1ad69c7246b122ba56a134939ee0eaf847">f_sync</link> (<link linkend="_struct_f_i_l">FIL</link> *fp)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a0d5b386636ec82d4c1e912d5902aa0e0">f_opendir</link> (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> *dp, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1aba2c2f47f12fd4875bd6a62fa58fa1a9">f_closedir</link> (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> *dp)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1ab8b2c70a95ca61f4f516c56fda7f82ab">f_readdir</link> (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> *dp, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> *fno)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a505edb263ef2c2a95e4f38f628b57ed3">f_findfirst</link> (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> *dp, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> *fno, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *<link linkend="__dino_game_8cpp_1a0d20517626e480f07ceee32bcff56db8">pattern</link>)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a23f97e2171ad7045eea5c1e21a9622a8">f_findnext</link> (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> *dp, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> *fno)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a4b4d38db58e89c526cfcf53200d719d0">f_mkdir</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a2858167fcd0bced48e9be434b3895efe">f_unlink</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1aa775b9b024acfeb3a66523cab497d142">f_rename</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path_old, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path_new)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1abe1f60daab5c7d11170c334fb832c798">f_stat</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> *fno)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a9ee7e560eec8d82755c636ae41e702cd">f_chmod</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> attr, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> mask)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1aafaa718d1a487e12a8f0087173dba0b9">f_utime</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, const <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> *fno)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a53c7e9a7fb3c279254cd2d0445667e2f">f_chdir</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a13e5933f851b436890361189f64261cd">f_chdrive</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1acb865a03dbac0031ac5cb8a031f7b71c">f_getcwd</link> (<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *buff, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> len)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a0ff39f75a87cbda9cd6ea65d83f16cec">f_getfree</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> *nclst, <link linkend="_struct_f_a_t_f_s">FATFS</link> **fatfs)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1ac4ff40a674bcbfe40d81b1e8e54befc6">f_getlabel</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *label, <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> *vsn)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1aa82bca64e28bc0d656a7999dd0eadec7">f_setlabel</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *label)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a6c0c4cd695704aa6d952c90be81d9849">f_forward</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>(*func)(const <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> *, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>), <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> btf, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> *bf)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a35ff90f5219df5cdb6c8f408b1b9e1a3">f_expand</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, <link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link> fsz, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> opt)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a16a934c2bbfa2160295810adc49d5509">f_mount</link> (<link linkend="_struct_f_a_t_f_s">FATFS</link> *fs, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> opt)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a983f0614033bd7cf587eb56d3054a91c">f_mkfs</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *path, const <link linkend="_struct_m_k_f_s___p_a_r_m">MKFS_PARM</link> *opt, void *work, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> len)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a70461190a46edc96bb7baef1ab4dbd4d">f_fdisk</link> (<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> pdrv, const <link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link> ptbl[], void *work)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> <link linkend="_ff_8h_1a529e8f17cae495f6536ff405622c996c">f_setcp</link> (<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link> cp)</para>
</listitem>
            <listitem><para>int <link linkend="_ff_8h_1ad1d73b8d01c2ef89eddf920b7fcc6beb">f_putc</link> (<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> c, <link linkend="_struct_f_i_l">FIL</link> *fp)</para>
</listitem>
            <listitem><para>int <link linkend="_ff_8h_1a699fc03ffa785ceab8812a7f204421f3">f_puts</link> (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *str, <link linkend="_struct_f_i_l">FIL</link> *cp)</para>
</listitem>
            <listitem><para>int <link linkend="_ff_8h_1a4ce26253177c167df849e76f69b5c66c">f_printf</link> (<link linkend="_struct_f_i_l">FIL</link> *fp, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *str,...)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * <link linkend="_ff_8h_1a4a47f14a554ff3a49fc122fe3e190f2f">f_gets</link> (<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> *buff, int len, <link linkend="_struct_f_i_l">FIL</link> *fp)</para>
</listitem>
            <listitem><para><link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> <link linkend="_ff_8h_1af58b536abfd30f77213f4ecaf2ac52f5">get_fattime</link> (void)</para>
</listitem>
        </itemizedlist>
</simplesect>
<section>
<title>Macro Definition Documentation</title>
<anchor xml:id="_ff_8h_1ae936e4c15227768f7da4e0951def89c8"/><section>
    <title>_T</title>
<indexterm><primary>_T</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>_T</secondary></indexterm>
<para><computeroutput>#define _T( <link linkend="__dino_game_8cpp_1aae8a40a17c0be29c1f06ca6b4f9e2235">x</link>)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered"><link linkend="__dino_game_8cpp_1aae8a40a17c0be29c1f06ca6b4f9e2235">x</link>
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00106">106</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a3232964568d17bb4a1af30f9db826ce2"/><section>
    <title>_TEXT</title>
<indexterm><primary>_TEXT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>_TEXT</secondary></indexterm>
<para><computeroutput>#define _TEXT( <link linkend="__dino_game_8cpp_1aae8a40a17c0be29c1f06ca6b4f9e2235">x</link>)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered"><link linkend="__dino_game_8cpp_1aae8a40a17c0be29c1f06ca6b4f9e2235">x</link>
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00107">107</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09"/><section>
    <title>AM_ARC</title>
<indexterm><primary>AM_ARC</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>AM_ARC</secondary></indexterm>
<para><computeroutput>#define AM_ARC&#160;&#160;&#160;0x20	/* Archive */</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00422">422</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3"/><section>
    <title>AM_DIR</title>
<indexterm><primary>AM_DIR</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>AM_DIR</secondary></indexterm>
<para><computeroutput>#define AM_DIR&#160;&#160;&#160;0x10	/* Directory */</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00421">421</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1aa90c4c921c1955fd407d8bbf17f1674e"/><section>
    <title>AM_HID</title>
<indexterm><primary>AM_HID</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>AM_HID</secondary></indexterm>
<para><computeroutput>#define AM_HID&#160;&#160;&#160;0x02	/* Hidden */</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00419">419</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e"/><section>
    <title>AM_RDO</title>
<indexterm><primary>AM_RDO</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>AM_RDO</secondary></indexterm>
<para><computeroutput>#define AM_RDO&#160;&#160;&#160;0x01	/* Read only */</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00418">418</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a1f25d5c17b5a3a6397b3398add8cdc15"/><section>
    <title>AM_SYS</title>
<indexterm><primary>AM_SYS</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>AM_SYS</secondary></indexterm>
<para><computeroutput>#define AM_SYS&#160;&#160;&#160;0x04	/* System */</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00420">420</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1aee297a9011164cf485a4df2a72758b08"/><section>
    <title>CREATE_LINKMAP</title>
<indexterm><primary>CREATE_LINKMAP</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>CREATE_LINKMAP</secondary></indexterm>
<para><computeroutput>#define CREATE_LINKMAP&#160;&#160;&#160;((<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>)0 - 1)</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00402">402</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a970cdd8970a3a94967ad64cfc5d4c161"/><section>
    <title>f_eof</title>
<indexterm><primary>f_eof</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_eof</secondary></indexterm>
<para><computeroutput>#define f_eof( fp)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered">((int)((fp)-&gt;fptr&#32;==&#32;(fp)-&gt;obj.objsize))
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00341">341</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a25cbdabeed318802cf0e9db6671a33b7"/><section>
    <title>f_error</title>
<indexterm><primary>f_error</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_error</secondary></indexterm>
<para><computeroutput>#define f_error( fp)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered">((fp)-&gt;err)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00342">342</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1ae4caf47dd5cbc123b61d35542481b1be"/><section>
    <title>f_rewind</title>
<indexterm><primary>f_rewind</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_rewind</secondary></indexterm>
<para><computeroutput>#define f_rewind( fp)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered"><link linkend="_ff_8c_1a7c4bcf81d9122f0b5376852ec6a8c3eb">f_lseek</link>((fp),&#32;0)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00345">345</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a3f92b6c0c1648de678283ab6f1610161"/><section>
    <title>f_rewinddir</title>
<indexterm><primary>f_rewinddir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_rewinddir</secondary></indexterm>
<para><computeroutput>#define f_rewinddir( dp)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered"><link linkend="_ff_8c_1ab8b2c70a95ca61f4f516c56fda7f82ab">f_readdir</link>((dp),&#32;0)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00346">346</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a58df56d084ad3dd9f8cd49b245a7a7ca"/><section>
    <title>f_rmdir</title>
<indexterm><primary>f_rmdir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_rmdir</secondary></indexterm>
<para><computeroutput>#define f_rmdir( path)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered"><link linkend="_ff_8c_1a2858167fcd0bced48e9be434b3895efe">f_unlink</link>(path)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00347">347</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a26f33722c5bf1aa3cd6f0290a83eb2bc"/><section>
    <title>f_size</title>
<indexterm><primary>f_size</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_size</secondary></indexterm>
<para><computeroutput>#define f_size( fp)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered">((fp)-&gt;obj.objsize)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00344">344</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a5e1daca7ce13cdc277e42185f7f9124f"/><section>
    <title>f_tell</title>
<indexterm><primary>f_tell</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_tell</secondary></indexterm>
<para><computeroutput>#define f_tell( fp)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered">((fp)-&gt;fptr)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00343">343</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1aa22c4b32404b35d0a0bd138fa63f2e75"/><section>
    <title>f_unmount</title>
<indexterm><primary>f_unmount</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_unmount</secondary></indexterm>
<para><computeroutput>#define f_unmount( path)</computeroutput></para><emphasis role="strong">Value:</emphasis><programlisting linenumbering="unnumbered"><link linkend="_ff_8c_1a16a934c2bbfa2160295810adc49d5509">f_mount</link>(0,&#32;path,&#32;0)
</programlisting><para>
Definition at line <link linkend="_ff_8h_source_1l00348">348</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1afba4546b131dea4b24727fa20a80e29f"/><section>
    <title>FA_CREATE_ALWAYS</title>
<indexterm><primary>FA_CREATE_ALWAYS</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_CREATE_ALWAYS</secondary></indexterm>
<para><computeroutput>#define FA_CREATE_ALWAYS&#160;&#160;&#160;0x08</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00397">397</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a417bb1babd1785fd181a806b5613eba3"/><section>
    <title>FA_CREATE_NEW</title>
<indexterm><primary>FA_CREATE_NEW</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_CREATE_NEW</secondary></indexterm>
<para><computeroutput>#define FA_CREATE_NEW&#160;&#160;&#160;0x04</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00396">396</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a17b01553029920ac0468912b4bcb16c7"/><section>
    <title>FA_OPEN_ALWAYS</title>
<indexterm><primary>FA_OPEN_ALWAYS</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_OPEN_ALWAYS</secondary></indexterm>
<para><computeroutput>#define FA_OPEN_ALWAYS&#160;&#160;&#160;0x10</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00398">398</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a90f135b2ae90fba5080f6bd2b6c57b8a"/><section>
    <title>FA_OPEN_APPEND</title>
<indexterm><primary>FA_OPEN_APPEND</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_OPEN_APPEND</secondary></indexterm>
<para><computeroutput>#define FA_OPEN_APPEND&#160;&#160;&#160;0x30</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00399">399</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a0c5dd686b10f84c2a2b3954957a5979a"/><section>
    <title>FA_OPEN_EXISTING</title>
<indexterm><primary>FA_OPEN_EXISTING</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_OPEN_EXISTING</secondary></indexterm>
<para><computeroutput>#define FA_OPEN_EXISTING&#160;&#160;&#160;0x00</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00395">395</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a1f4f3530ff03abbd979b072536e72290"/><section>
    <title>FA_READ</title>
<indexterm><primary>FA_READ</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_READ</secondary></indexterm>
<para><computeroutput>#define FA_READ&#160;&#160;&#160;0x01</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00393">393</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1afa366963220c89b882c0361794020c14"/><section>
    <title>FA_WRITE</title>
<indexterm><primary>FA_WRITE</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FA_WRITE</secondary></indexterm>
<para><computeroutput>#define FA_WRITE&#160;&#160;&#160;0x02</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00394">394</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a67f86fd50a009422bed52a85b7a28a77"/><section>
    <title>FF_DEFINED</title>
<indexterm><primary>FF_DEFINED</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FF_DEFINED</secondary></indexterm>
<para><computeroutput>#define FF_DEFINED&#160;&#160;&#160;80286	/* Revision ID */</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00023">23</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a3eb7cbd9d1d0548d54856f1cc8a2021f"/><section>
    <title>FF_INTDEF</title>
<indexterm><primary>FF_INTDEF</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FF_INTDEF</secondary></indexterm>
<para><computeroutput>#define FF_INTDEF&#160;&#160;&#160;1</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00057">57</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d"/><section>
    <title>FM_ANY</title>
<indexterm><primary>FM_ANY</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FM_ANY</secondary></indexterm>
<para><computeroutput>#define FM_ANY&#160;&#160;&#160;0x07</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00408">408</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a9348c28116bc29e88195b23f6945f81d"/><section>
    <title>FM_EXFAT</title>
<indexterm><primary>FM_EXFAT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FM_EXFAT</secondary></indexterm>
<para><computeroutput>#define FM_EXFAT&#160;&#160;&#160;0x04</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00407">407</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a8bd205b7d09147e55169d3713f46e9ea"/><section>
    <title>FM_FAT</title>
<indexterm><primary>FM_FAT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FM_FAT</secondary></indexterm>
<para><computeroutput>#define FM_FAT&#160;&#160;&#160;0x01</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00405">405</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1aff61d3ed8f8c6ea5c25c3cb366320e08"/><section>
    <title>FM_FAT32</title>
<indexterm><primary>FM_FAT32</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FM_FAT32</secondary></indexterm>
<para><computeroutput>#define FM_FAT32&#160;&#160;&#160;0x02</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00406">406</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5"/><section>
    <title>FM_SFD</title>
<indexterm><primary>FM_SFD</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FM_SFD</secondary></indexterm>
<para><computeroutput>#define FM_SFD&#160;&#160;&#160;0x08</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00409">409</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a50bfa912e87473bc54333523983f39f6"/><section>
    <title>FS_EXFAT</title>
<indexterm><primary>FS_EXFAT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FS_EXFAT</secondary></indexterm>
<para><computeroutput>#define FS_EXFAT&#160;&#160;&#160;4</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00415">415</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0"/><section>
    <title>FS_FAT12</title>
<indexterm><primary>FS_FAT12</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FS_FAT12</secondary></indexterm>
<para><computeroutput>#define FS_FAT12&#160;&#160;&#160;1</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00412">412</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9"/><section>
    <title>FS_FAT16</title>
<indexterm><primary>FS_FAT16</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FS_FAT16</secondary></indexterm>
<para><computeroutput>#define FS_FAT16&#160;&#160;&#160;2</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00413">413</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce"/><section>
    <title>FS_FAT32</title>
<indexterm><primary>FS_FAT32</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FS_FAT32</secondary></indexterm>
<para><computeroutput>#define FS_FAT32&#160;&#160;&#160;3</computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00414">414</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
</section>
<section>
<title>Typedef Documentation</title>
<anchor xml:id="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58"/><section>
    <title>BYTE</title>
<indexterm><primary>BYTE</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>BYTE</secondary></indexterm>
<para><computeroutput>typedef unsigned char <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00059">59</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1ad342ac907eb044443153a22f964bf0af"/><section>
    <title>DWORD</title>
<indexterm><primary>DWORD</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>DWORD</secondary></indexterm>
<para><computeroutput>typedef unsigned long <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00061">61</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2"/><section>
    <title>FSIZE_t</title>
<indexterm><primary>FSIZE_t</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FSIZE_t</secondary></indexterm>
<para><computeroutput>typedef <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> <link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00082">82</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a1f3c30a83148a28340f009d4e583f087"/><section>
    <title>LBA_t</title>
<indexterm><primary>LBA_t</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>LBA_t</secondary></indexterm>
<para><computeroutput>typedef <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> <link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00083">83</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546"/><section>
    <title>TCHAR</title>
<indexterm><primary>TCHAR</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>TCHAR</secondary></indexterm>
<para><computeroutput>typedef char <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00105">105</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec"/><section>
    <title>UINT</title>
<indexterm><primary>UINT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>UINT</secondary></indexterm>
<para><computeroutput>typedef unsigned int <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00058">58</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568"/><section>
    <title>WCHAR</title>
<indexterm><primary>WCHAR</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>WCHAR</secondary></indexterm>
<para><computeroutput>typedef <link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link> <link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00062">62</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
<anchor xml:id="_ff_8h_1a197942eefa7db30960ae396d68339b97"/><section>
    <title>WORD</title>
<indexterm><primary>WORD</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>WORD</secondary></indexterm>
<para><computeroutput>typedef unsigned short <link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link></computeroutput></para><para>
Definition at line <link linkend="_ff_8h_source_1l00060">60</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
</section>
</section>
<section>
<title>Enumeration Type Documentation</title>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c"/><section>
    <title>FRESULT</title>
<indexterm><primary>FRESULT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FRESULT</secondary></indexterm>
<para><computeroutput>enum <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link></computeroutput></para><informaltable frame="all">
<title>Enumerator</title>
    <tgroup cols="2" align="left" colsep="1" rowsep="1">
      <colspec colname='c1'/>
      <colspec colname='c2'/>
<tbody>
<row><entry><indexterm><primary>FR_OK</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_OK</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1"/>FR_OK</entry><entry></entry></row><row><entry><indexterm><primary>FR_DISK_ERR</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_DISK_ERR</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34"/>FR_DISK_ERR</entry><entry></entry></row><row><entry><indexterm><primary>FR_INT_ERR</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_INT_ERR</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76"/>FR_INT_ERR</entry><entry></entry></row><row><entry><indexterm><primary>FR_NOT_READY</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_NOT_READY</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45"/>FR_NOT_READY</entry><entry></entry></row><row><entry><indexterm><primary>FR_NO_FILE</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_NO_FILE</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c"/>FR_NO_FILE</entry><entry></entry></row><row><entry><indexterm><primary>FR_NO_PATH</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_NO_PATH</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532"/>FR_NO_PATH</entry><entry></entry></row><row><entry><indexterm><primary>FR_INVALID_NAME</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_INVALID_NAME</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45"/>FR_INVALID_NAME</entry><entry></entry></row><row><entry><indexterm><primary>FR_DENIED</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_DENIED</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d"/>FR_DENIED</entry><entry></entry></row><row><entry><indexterm><primary>FR_EXIST</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_EXIST</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450"/>FR_EXIST</entry><entry></entry></row><row><entry><indexterm><primary>FR_INVALID_OBJECT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_INVALID_OBJECT</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8"/>FR_INVALID_OBJECT</entry><entry></entry></row><row><entry><indexterm><primary>FR_WRITE_PROTECTED</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_WRITE_PROTECTED</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b"/>FR_WRITE_PROTECTED</entry><entry></entry></row><row><entry><indexterm><primary>FR_INVALID_DRIVE</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_INVALID_DRIVE</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65"/>FR_INVALID_DRIVE</entry><entry></entry></row><row><entry><indexterm><primary>FR_NOT_ENABLED</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_NOT_ENABLED</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cafc56605c68aaffab4a428339a8bd600d"/>FR_NOT_ENABLED</entry><entry></entry></row><row><entry><indexterm><primary>FR_NO_FILESYSTEM</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_NO_FILESYSTEM</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463"/>FR_NO_FILESYSTEM</entry><entry></entry></row><row><entry><indexterm><primary>FR_MKFS_ABORTED</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_MKFS_ABORTED</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca"/>FR_MKFS_ABORTED</entry><entry></entry></row><row><entry><indexterm><primary>FR_TIMEOUT</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_TIMEOUT</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3f8ca7e51af8b129d14328de7243c5d4"/>FR_TIMEOUT</entry><entry></entry></row><row><entry><indexterm><primary>FR_LOCKED</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_LOCKED</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca7db5afaaa2af591bd4a208b2967075d7"/>FR_LOCKED</entry><entry></entry></row><row><entry><indexterm><primary>FR_NOT_ENOUGH_CORE</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_NOT_ENOUGH_CORE</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c"/>FR_NOT_ENOUGH_CORE</entry><entry></entry></row><row><entry><indexterm><primary>FR_TOO_MANY_OPEN_FILES</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_TOO_MANY_OPEN_FILES</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9"/>FR_TOO_MANY_OPEN_FILES</entry><entry></entry></row><row><entry><indexterm><primary>FR_INVALID_PARAMETER</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>FR_INVALID_PARAMETER</secondary></indexterm>
<anchor xml:id="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3b89faeceab64db277d0fcdeaaa315d6"/>FR_INVALID_PARAMETER</entry><entry></entry></row>    </tbody>
    </tgroup>
</informaltable>
<para>
Definition at line <link linkend="_ff_8h_source_1l00274">274</link> of file <link linkend="_ff_8h_source">ff.h</link>.</para>
<programlisting linenumbering="unnumbered">00274 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
00275 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;=&#32;0,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(0)&#32;Succeeded&#32;*/</emphasis>
00276 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(1)&#32;A&#32;hard&#32;error&#32;occurred&#32;in&#32;the&#32;low&#32;level&#32;disk&#32;I/O&#32;layer&#32;*/</emphasis>
00277 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(2)&#32;Assertion&#32;failed&#32;*/</emphasis>
00278 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45">FR_NOT_READY</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(3)&#32;The&#32;physical&#32;drive&#32;cannot&#32;work&#32;*/</emphasis>
00279 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(4)&#32;Could&#32;not&#32;find&#32;the&#32;file&#32;*/</emphasis>
00280 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(5)&#32;Could&#32;not&#32;find&#32;the&#32;path&#32;*/</emphasis>
00281 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(6)&#32;The&#32;path&#32;name&#32;format&#32;is&#32;invalid&#32;*/</emphasis>
00282 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(7)&#32;Access&#32;denied&#32;due&#32;to&#32;prohibited&#32;access&#32;or&#32;directory&#32;full&#32;*/</emphasis>
00283 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(8)&#32;Access&#32;denied&#32;due&#32;to&#32;prohibited&#32;access&#32;*/</emphasis>
00284 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(9)&#32;The&#32;file/directory&#32;object&#32;is&#32;invalid&#32;*/</emphasis>
00285 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>,&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(10)&#32;The&#32;physical&#32;drive&#32;is&#32;write&#32;protected&#32;*/</emphasis>
00286 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(11)&#32;The&#32;logical&#32;drive&#32;number&#32;is&#32;invalid&#32;*/</emphasis>
00287 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cafc56605c68aaffab4a428339a8bd600d">FR_NOT_ENABLED</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(12)&#32;The&#32;volume&#32;has&#32;no&#32;work&#32;area&#32;*/</emphasis>
00288 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(13)&#32;There&#32;is&#32;no&#32;valid&#32;FAT&#32;volume&#32;*/</emphasis>
00289 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(14)&#32;The&#32;f_mkfs()&#32;aborted&#32;due&#32;to&#32;any&#32;problem&#32;*/</emphasis>
00290 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3f8ca7e51af8b129d14328de7243c5d4">FR_TIMEOUT</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(15)&#32;Could&#32;not&#32;get&#32;a&#32;grant&#32;to&#32;access&#32;the&#32;volume&#32;within&#32;defined&#32;period&#32;*/</emphasis>
00291 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca7db5afaaa2af591bd4a208b2967075d7">FR_LOCKED</link>,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(16)&#32;The&#32;operation&#32;is&#32;rejected&#32;according&#32;to&#32;the&#32;file&#32;sharing&#32;policy&#32;*/</emphasis>
00292 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>,&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(17)&#32;LFN&#32;working&#32;buffer&#32;could&#32;not&#32;be&#32;allocated&#32;*/</emphasis>
00293 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>,&#32;<emphasis role="comment">/*&#32;(18)&#32;Number&#32;of&#32;open&#32;files&#32;&gt;&#32;FF_FS_LOCK&#32;*/</emphasis>
00294 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3b89faeceab64db277d0fcdeaaa315d6">FR_INVALID_PARAMETER</link>&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(19)&#32;Given&#32;parameter&#32;is&#32;invalid&#32;*/</emphasis>
00295 }&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>;
</programlisting></section>
</section>
<section>
<title>Function Documentation</title>
<anchor xml:id="_ff_8h_1a53c7e9a7fb3c279254cd2d0445667e2f"/><section>
    <title>f_chdir()</title>
<indexterm><primary>f_chdir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_chdir</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_chdir (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04269">4269</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04272 {
04273 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;==&#32;2&#x240D;</emphasis>
04274 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
04275 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04276 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04277 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
04278 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04279 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
04280 
04281 
04282 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
04283 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
04284 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04285 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
04286 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
04287 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;path&#32;*/</emphasis>
04288 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;completed&#32;*/</emphasis>
04289 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;the&#32;start&#32;directory&#32;itself?&#32;*/</emphasis>
04290 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
04291 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04292 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
04293 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_scl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_scl;
04294 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_size&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_size;
04295 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_ofs&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_ofs;
04296 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04297 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04298 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04299 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;sub-directory&#32;*/</emphasis>
04300 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04301 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
04302 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;ld_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sub-directory&#32;cluster&#32;*/</emphasis>
04303 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_scl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;containing&#32;directory&#32;information&#32;*/</emphasis>
04304 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
04305 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_ofs&#32;=&#32;dj.blk_ofs;
04306 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04307 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04308 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
04309 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sub-directory&#32;cluster&#32;*/</emphasis>
04310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04311 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04312 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reached&#32;but&#32;a&#32;file&#32;*/</emphasis>
04313 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04314 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04315 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04316 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
04317 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;
04318 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Also&#32;current&#32;drive&#32;is&#32;changed&#32;if&#32;in&#32;Unix&#32;style&#32;volume&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
04319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>&#32;-&#32;1;&#32;i&#32;&amp;&amp;&#32;fs&#32;!=&#32;FatFs[i];&#32;i--)&#32;;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;current&#32;drive&#32;*/</emphasis>
04321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;CurrVol&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)i;
04322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04323 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04324 &#32;&#32;&#32;&#32;}
04325 
04326 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04327 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a13e5933f851b436890361189f64261cd"/><section>
    <title>f_chdrive()</title>
<indexterm><primary>f_chdrive</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_chdrive</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_chdrive (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04252">4252</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04255 {
04256 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
04257 
04258 
04259 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;number&#32;*/</emphasis>
04260 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(&amp;path);
04261 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
04262 &#32;&#32;&#32;&#32;CurrVol&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)vol;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;it&#32;as&#32;current&#32;volume&#32;*/</emphasis>
04263 
04264 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
04265 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a9ee7e560eec8d82755c636ae41e702cd"/><section>
    <title>f_chmod()</title>
<indexterm><primary>f_chmod</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_chmod</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_chmod (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> attr, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> mask)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a53882db20ef4323dcfd1874d7733ffc3"/><section>
    <title>f_close()</title>
<indexterm><primary>f_close</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_close</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_close (<link linkend="_struct_f_i_l">FIL</link> * fp)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04216">4216</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04219 {
04220 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04221 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04222 
04223 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
04224 &#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1ad69c7246b122ba56a134939ee0eaf847">f_sync</link>(fp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flush&#32;cached&#32;data&#32;*/</emphasis>
04225 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)
04226 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04227 &#32;&#32;&#32;&#32;{
04228 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Lock&#32;volume&#32;*/</emphasis>
04229 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04230 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
04231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dec_share(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decrement&#32;file&#32;open&#32;counter&#32;*/</emphasis>
04232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;file&#32;object&#32;*/</emphasis>
04233 <emphasis role="preprocessor">#else&#x240D;</emphasis>
04234 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;file&#32;object&#32;*/</emphasis>
04235 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04236 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT&#x240D;</emphasis>
04237 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;unlock_volume(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unlock&#32;volume&#32;*/</emphasis>
04238 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04239 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04240 &#32;&#32;&#32;&#32;}
04241 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
04242 }
</programlisting></section>
<anchor xml:id="_ff_8h_1aba2c2f47f12fd4875bd6a62fa58fa1a9"/><section>
    <title>f_closedir()</title>
<indexterm><primary>f_closedir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_closedir</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_closedir (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> * dp)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04663">4663</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04666 {
04667 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04668 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04669 
04670 
04671 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
04672 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04673 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
04674 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid)&#32;res&#32;=&#32;dec_share(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decrement&#32;sub-directory&#32;open&#32;counter&#32;*/</emphasis>
04675 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;directory&#32;object&#32;*/</emphasis>
04676 <emphasis role="preprocessor">#else&#x240D;</emphasis>
04677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;directory&#32;object&#32;*/</emphasis>
04678 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04679 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT&#x240D;</emphasis>
04680 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;unlock_volume(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unlock&#32;volume&#32;*/</emphasis>
04681 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04682 &#32;&#32;&#32;&#32;}
04683 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
04684 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a35ff90f5219df5cdb6c8f408b1b9e1a3"/><section>
    <title>f_expand()</title>
<indexterm><primary>f_expand</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_expand</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_expand (<link linkend="_struct_f_i_l">FIL</link> * fp, <link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link> fsz, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> opt)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a70461190a46edc96bb7baef1ab4dbd4d"/><section>
    <title>f_fdisk()</title>
<indexterm><primary>f_fdisk</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_fdisk</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_fdisk (<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> pdrv, const <link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link> ptbl[], void * work)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a505edb263ef2c2a95e4f38f628b57ed3"/><section>
    <title>f_findfirst()</title>
<indexterm><primary>f_findfirst</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_findfirst</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_findfirst (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> * dp, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> * fno, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * pattern)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a23f97e2171ad7045eea5c1e21a9622a8"/><section>
    <title>f_findnext()</title>
<indexterm><primary>f_findnext</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_findnext</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_findnext (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> * dp, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> * fno)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a6c0c4cd695704aa6d952c90be81d9849"/><section>
    <title>f_forward()</title>
<indexterm><primary>f_forward</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_forward</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_forward (<link linkend="_struct_f_i_l">FIL</link> * fp, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>(* func&#160;)(const <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> *, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>), <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> btf, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> * bf)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1acb865a03dbac0031ac5cb8a031f7b71c"/><section>
    <title>f_getcwd()</title>
<indexterm><primary>f_getcwd</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_getcwd</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_getcwd (<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * buff, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> len)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a0ff39f75a87cbda9cd6ea65d83f16cec"/><section>
    <title>f_getfree()</title>
<indexterm><primary>f_getfree</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_getfree</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_getfree (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> * nclst, <link linkend="_struct_f_a_t_f_s">FATFS</link> ** fatfs)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04816">4816</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04821 {
04822 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04823 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04824 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;nfree,&#32;clst,&#32;stat;
04825 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
04826 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
04827 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>&#32;obj;
04828 
04829 
04830 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
04831 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
04832 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04833 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*fatfs&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;ptr&#32;to&#32;the&#32;fs&#32;object&#32;*/</emphasis>
04834 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;free_clst&#32;is&#32;valid,&#32;return&#32;it&#32;without&#32;full&#32;FAT&#32;scan&#32;*/</emphasis>
04835 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;&lt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;{
04836 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*nclst&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>;
04837 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04838 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Scan&#32;FAT&#32;to&#32;obtain&#32;number&#32;of&#32;free&#32;clusters&#32;*/</emphasis>
04839 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nfree&#32;=&#32;0;
04840 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;FAT12:&#32;Scan&#32;bit&#32;field&#32;FAT&#32;entries&#32;*/</emphasis>
04841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;2;&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
04842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
04843 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;stat&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;obj,&#32;clst);
04844 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;==&#32;0xFFFFFFFF)&#32;{
04845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
04846 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04847 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;==&#32;1)&#32;{
04848 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
04849 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04850 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;==&#32;0)&#32;nfree++;
04851 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++clst&#32;&lt;&#32;fs-&gt;n_fatent);
04852 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04853 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04854 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;exFAT:&#32;Scan&#32;allocation&#32;bitmap&#32;*/</emphasis>
04855 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;bm;
04856 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;b;
04857 
04858 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
04859 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;fs-&gt;bitbase;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bitmap&#32;sector&#32;*/</emphasis>
04860 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;sector&#32;*/</emphasis>
04861 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Counts&#32;numbuer&#32;of&#32;bits&#32;with&#32;zero&#32;in&#32;the&#32;bitmap&#32;*/</emphasis>
04862 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;sector?&#32;*/</emphasis>
04863 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sect++);
04864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
04865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(b&#32;=&#32;8,&#32;bm&#32;=&#32;~fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i];&#32;b&#32;&amp;&amp;&#32;clst;&#32;b--,&#32;clst--)&#32;{
04867 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nfree&#32;+=&#32;bm&#32;&amp;&#32;1;
04868 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bm&#32;&gt;&gt;=&#32;1;
04869 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04870 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;(i&#32;+&#32;1)&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
04871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(clst);
04872 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04873 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT16/32:&#32;Scan&#32;WORD/DWORD&#32;FAT&#32;entries&#32;*/</emphasis>
04875 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;*/</emphasis>
04876 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top&#32;of&#32;the&#32;FAT&#32;*/</emphasis>
04877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;sector&#32;*/</emphasis>
04878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Counts&#32;numbuer&#32;of&#32;entries&#32;with&#32;zero&#32;in&#32;the&#32;FAT&#32;*/</emphasis>
04879 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;sector?&#32;*/</emphasis>
04880 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sect++);
04881 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
04882 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04883 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;{
04884 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;i)&#32;==&#32;0)&#32;nfree++;
04885 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;2;
04886 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04887 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;i)&#32;&amp;&#32;0x0FFFFFFF)&#32;==&#32;0)&#32;nfree++;
04888 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;4;
04889 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04890 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;%=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
04891 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(--clst);
04892 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04893 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04894 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;parameters&#32;if&#32;succeeded&#32;*/</emphasis>
04895 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*nclst&#32;=&#32;nfree;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;the&#32;free&#32;clusters&#32;*/</emphasis>
04896 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;=&#32;nfree;&#32;&#32;<emphasis role="comment">/*&#32;Now&#32;free_clst&#32;is&#32;valid&#32;*/</emphasis>
04897 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;|=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT32:&#32;FSInfo&#32;is&#32;to&#32;be&#32;updated&#32;*/</emphasis>
04898 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04899 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04900 &#32;&#32;&#32;&#32;}
04901 
04902 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04903 }
</programlisting></section>
<anchor xml:id="_ff_8h_1ac4ff40a674bcbfe40d81b1e8e54befc6"/><section>
    <title>f_getlabel()</title>
<indexterm><primary>f_getlabel</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_getlabel</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_getlabel (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * label, <link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> * vsn)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a4a47f14a554ff3a49fc122fe3e190f2f"/><section>
    <title>f_gets()</title>
<indexterm><primary>f_gets</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_gets</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * f_gets (<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * buff, int len, <link linkend="_struct_f_i_l">FIL</link> * fp)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a7c4bcf81d9122f0b5376852ec6a8c3eb"/><section>
    <title>f_lseek()</title>
<indexterm><primary>f_lseek</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_lseek</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_lseek (<link linkend="_struct_f_i_l">FIL</link> * fp, <link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link> ofs)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04433">4433</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04437 {
04438 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04439 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04440 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;bcs;
04441 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;nsect;
04442 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;ifptr;
04443 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK&#x240D;</emphasis>
04444 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl,&#32;pcl,&#32;ncl,&#32;tcl,&#32;tlen,&#32;ulen;
04445 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;*tbl;
04446 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;dsc;
04447 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04448 
04449 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
04450 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>;
04451 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#32;&amp;&amp;&#32;!FF_FS_READONLY&#x240D;</emphasis>
04452 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
04453 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_last_frag(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;last&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
04454 &#32;&#32;&#32;&#32;}
04455 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04456 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04457 
04458 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK&#x240D;</emphasis>
04459 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;cltbl)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fast&#32;seek&#32;*/</emphasis>
04460 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;==&#32;<link linkend="_ff_8h_1aee297a9011164cf485a4df2a72758b08">CREATE_LINKMAP</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;CLMT&#32;*/</emphasis>
04461 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tbl&#32;=&#32;fp-&gt;cltbl;
04462 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tlen&#32;=&#32;*tbl++;&#32;ulen&#32;=&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Given&#32;table&#32;size&#32;and&#32;required&#32;table&#32;size&#32;*/</emphasis>
04463 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Origin&#32;of&#32;the&#32;chain&#32;*/</emphasis>
04464 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;!=&#32;0)&#32;{
04465 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
04466 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;fragment&#32;*/</emphasis>
04467 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tcl&#32;=&#32;cl;&#32;ncl&#32;=&#32;0;&#32;ulen&#32;+=&#32;2;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top,&#32;length&#32;and&#32;used&#32;items&#32;*/</emphasis>
04468 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
04469 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pcl&#32;=&#32;cl;&#32;ncl++;
04470 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;cl);
04471 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;&lt;=&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04472 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04473 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(cl&#32;==&#32;pcl&#32;+&#32;1);
04474 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ulen&#32;&lt;=&#32;tlen)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;length&#32;and&#32;top&#32;of&#32;the&#32;fragment&#32;*/</emphasis>
04475 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tbl++&#32;=&#32;ncl;&#32;*tbl++&#32;=&#32;tcl;
04476 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04477 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(cl&#32;&lt;&#32;fs-&gt;n_fatent);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;end&#32;of&#32;chain&#32;*/</emphasis>
04478 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04479 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*fp-&gt;cltbl&#32;=&#32;ulen;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;items&#32;used&#32;*/</emphasis>
04480 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ulen&#32;&lt;=&#32;tlen)&#32;{
04481 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tbl&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;table&#32;*/</emphasis>
04482 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04483 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Given&#32;table&#32;size&#32;is&#32;smaller&#32;than&#32;required&#32;*/</emphasis>
04484 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04485 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fast&#32;seek&#32;*/</emphasis>
04486 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;ofs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;offset&#32;at&#32;the&#32;file&#32;size&#32;*/</emphasis>
04487 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;ofs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;pointer&#32;*/</emphasis>
04488 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;0)&#32;{
04489 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clmt_clust(fp,&#32;ofs&#32;-&#32;1);
04490 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dsc&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);
04491 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dsc&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dsc&#32;+=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((ofs&#32;-&#32;1)&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1);
04493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&amp;&#32;dsc&#32;!=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Refill&#32;sector&#32;cache&#32;if&#32;needed&#32;*/</emphasis>
04494 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
04495 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
04496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
04497 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04498 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04499 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04500 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;dsc,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Load&#32;current&#32;sector&#32;*/</emphasis>
04502 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;dsc;
04504 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04505 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04507 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04508 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04509 
04510 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Normal&#32;Seek&#32;*/</emphasis>
04511 &#32;&#32;&#32;&#32;{
04512 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04513 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#32;&amp;&amp;&#32;ofs&#32;&gt;=&#32;0x100000000)&#32;ofs&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;4&#32;GiB&#32;-&#32;1&#32;if&#32;at&#32;FATxx&#32;*/</emphasis>
04514 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04515 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&amp;&#32;(<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;||&#32;!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>)))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;In&#32;read-only&#32;mode,&#32;clip&#32;offset&#32;with&#32;the&#32;file&#32;size&#32;*/</emphasis>
04516 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;
04517 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04518 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ifptr&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
04519 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;nsect&#32;=&#32;0;
04520 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;0)&#32;{
04521 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcs&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;(byte)&#32;*/</emphasis>
04522 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ifptr&#32;&gt;&#32;0&#32;&amp;&amp;
04523 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(ofs&#32;-&#32;1)&#32;/&#32;bcs&#32;&gt;=&#32;(ifptr&#32;-&#32;1)&#32;/&#32;bcs)&#32;{&#32;<emphasis role="comment">/*&#32;When&#32;seek&#32;to&#32;same&#32;or&#32;following&#32;cluster,&#32;*/</emphasis>
04524 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;(ifptr&#32;-&#32;1)&#32;&amp;&#32;~(<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>)(bcs&#32;-&#32;1);&#32;&#32;&#32;<emphasis role="comment">/*&#32;start&#32;from&#32;the&#32;current&#32;cluster&#32;*/</emphasis>
04525 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;-=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
04526 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>;
04527 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;seek&#32;to&#32;back&#32;cluster,&#32;*/</emphasis>
04528 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;start&#32;from&#32;the&#32;first&#32;cluster&#32;*/</emphasis>
04529 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
04530 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;no&#32;cluster&#32;chain,&#32;create&#32;a&#32;new&#32;chain&#32;*/</emphasis>
04531 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;0);
04532 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04533 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04534 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;clst;
04535 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04536 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04537 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;
04538 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04539 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;!=&#32;0)&#32;{
04540 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(ofs&#32;&gt;&#32;bcs)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;following&#32;loop&#32;*/</emphasis>
04541 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;-=&#32;bcs;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;bcs;
04542 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
04543 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;in&#32;write&#32;mode&#32;or&#32;not&#32;*/</emphasis>
04544 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;FAT&#32;chain&#32;object&#32;needs&#32;correct&#32;objsize&#32;to&#32;generate&#32;FAT&#32;value&#32;*/</emphasis>
04545 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
04546 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
04547 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04548 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;chain&#32;with&#32;forceed&#32;stretch&#32;*/</emphasis>
04549 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;file&#32;size&#32;in&#32;case&#32;of&#32;disk&#32;full&#32;*/</emphasis>
04550 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
04551 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04552 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04553 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04554 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
04555 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;if&#32;not&#32;in&#32;write&#32;mode&#32;*/</emphasis>
04556 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04557 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04558 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;=&#32;1&#32;||&#32;clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04559 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;
04560 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04561 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;ofs;
04562 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;{
04563 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;=&#32;clst2sect(fs,&#32;clst);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;sector&#32;*/</emphasis>
04564 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nsect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04565 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;+=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
04566 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04567 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04568 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04569 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;change&#32;flag&#32;if&#32;the&#32;file&#32;size&#32;is&#32;extended&#32;*/</emphasis>
04570 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
04571 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
04572 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04573 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&amp;&#32;nsect&#32;!=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;if&#32;needed&#32;*/</emphasis>
04574 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
04575 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
04576 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
04577 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04578 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04579 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04580 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04581 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;nsect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;*/</emphasis>
04582 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04583 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;nsect;
04584 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04585 &#32;&#32;&#32;&#32;}
04586 
04587 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04588 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a4b4d38db58e89c526cfcf53200d719d0"/><section>
    <title>f_mkdir()</title>
<indexterm><primary>f_mkdir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_mkdir</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_mkdir (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l05056">5056</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">05059 {
05060 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
05061 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
05062 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
05063 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>&#32;sobj;
05064 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dcl,&#32;pcl,&#32;tm;
05065 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
05066 
05067 
05068 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
05069 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
05071 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
05072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
05073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Name&#32;collision?&#32;*/</emphasis>
05074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1af0d4b41a010f1a611bc6fb9e42357350">FF_FS_RPATH</link>&#32;&amp;&amp;&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Invalid&#32;name?&#32;*/</emphasis>
05075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
05076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;clear&#32;to&#32;create&#32;a&#32;new&#32;directory&#32;*/</emphasis>
05078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sobj.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;object&#32;id&#32;to&#32;create&#32;a&#32;new&#32;chain&#32;*/</emphasis>
05079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dcl&#32;=&#32;create_chain(&amp;sobj,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;a&#32;cluster&#32;for&#32;the&#32;new&#32;directory&#32;*/</emphasis>
05080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
05081 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dcl&#32;==&#32;0)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;space&#32;to&#32;allocate&#32;a&#32;new&#32;cluster?&#32;*/</emphasis>
05082 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dcl&#32;==&#32;1)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Any&#32;insanity?&#32;*/</emphasis>
05083 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dcl&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Disk&#32;error?&#32;*/</emphasis>
05084 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tm&#32;=&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();
05085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_clear(fs,&#32;dcl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clean&#32;up&#32;the&#32;new&#32;table&#32;*/</emphasis>
05087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;dot&#32;entries&#32;(FAT&#32;only)&#32;*/</emphasis>
05089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>,&#32;11);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;&quot;.&quot;&#32;entry&#32;*/</emphasis>
05090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;
05091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>;
05092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);
05093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;dcl);
05094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;&quot;..&quot;&#32;entry&#32;*/</emphasis>
05095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;+&#32;1]&#32;=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;&#32;pcl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
05096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>,&#32;pcl);
05097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
05098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;dj);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;the&#32;object&#32;to&#32;the&#32;parent&#32;directoy&#32;*/</emphasis>
05100 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05103 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
05104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
05105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>,&#32;tm);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Created&#32;time&#32;*/</emphasis>
05106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>,&#32;dcl);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;cluster&#32;*/</emphasis>
05107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;size&#32;needs&#32;to&#32;be&#32;valid&#32;*/</emphasis>
05108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a543e2a11cefac978a0108a7973416d56">XDIR_ValidFileSize</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
05109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;3;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;object&#32;flag&#32;*/</emphasis>
05110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;*/</emphasis>
05111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);
05112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
05113 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
05115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);&#32;<emphasis role="comment">/*&#32;Created&#32;time&#32;*/</emphasis>
05116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dcl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;cluster&#32;*/</emphasis>
05117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;*/</emphasis>
05118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
05119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05121 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
05122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
05124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;remove_chain(&amp;sobj,&#32;dcl,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Could&#32;not&#32;register,&#32;remove&#32;the&#32;allocated&#32;cluster&#32;*/</emphasis>
05125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
05128 &#32;&#32;&#32;&#32;}
05129 
05130 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
05131 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a983f0614033bd7cf587eb56d3054a91c"/><section>
    <title>f_mkfs()</title>
<indexterm><primary>f_mkfs</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_mkfs</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_mkfs (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, const <link linkend="_struct_m_k_f_s___p_a_r_m">MKFS_PARM</link> * opt, void * work, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> len)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l05882">5882</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">05888 {
05889 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;cst[]&#32;=&#32;{1,&#32;4,&#32;16,&#32;64,&#32;256,&#32;512,&#32;0};&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;boundary&#32;for&#32;FAT&#32;volume&#32;(4Ks&#32;unit)&#32;*/</emphasis>
05890 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;cst32[]&#32;=&#32;{1,&#32;2,&#32;4,&#32;8,&#32;16,&#32;32,&#32;0};&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;boundary&#32;for&#32;FAT32&#32;volume&#32;(128Ks&#32;unit)&#32;*/</emphasis>
05891 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_m_k_f_s___p_a_r_m">MKFS_PARM</link>&#32;defopt&#32;=&#32;{<link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>,&#32;0,&#32;0,&#32;0,&#32;0};&#32;&#32;&#32;<emphasis role="comment">/*&#32;Default&#32;parameter&#32;*/</emphasis>
05892 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;fsopt,&#32;fsty,&#32;sys,&#32;pdrv,&#32;ipart;
05893 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*buf;
05894 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*pte;
05895 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;size&#32;*/</emphasis>
05896 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sz_buf,&#32;sz_blk,&#32;n_clst,&#32;pau,&#32;nsect,&#32;n,&#32;vsn;
05897 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sz_vol,&#32;b_vol,&#32;b_fat,&#32;b_data;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;volume,&#32;Base&#32;LBA&#32;of&#32;volume,&#32;fat,&#32;data&#32;*/</emphasis>
05898 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect,&#32;lba[2];
05899 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sz_rsv,&#32;sz_fat,&#32;sz_dir,&#32;sz_au;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;reserved,&#32;fat,&#32;dir,&#32;data,&#32;cluster&#32;*/</emphasis>
05900 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n_fat,&#32;n_root,&#32;i;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Index,&#32;Number&#32;of&#32;FATs&#32;and&#32;Number&#32;of&#32;roor&#32;dir&#32;entries&#32;*/</emphasis>
05901 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
05902 &#32;&#32;&#32;&#32;<link linkend="_diskio_8h_1adba6790898ce4029c20a34b898ce73c1">DSTATUS</link>&#32;ds;
05903 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
05904 
05905 
05906 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;mounted&#32;drive&#32;and&#32;clear&#32;work&#32;area&#32;*/</emphasis>
05907 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(&amp;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;target&#32;logical&#32;drive&#32;*/</emphasis>
05908 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
05909 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(FatFs[vol])&#32;FatFs[vol]-&gt;fs_type&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;the&#32;fs&#32;object&#32;if&#32;mounted&#32;*/</emphasis>
05910 &#32;&#32;&#32;&#32;pdrv&#32;=&#32;<link linkend="_ff_8c_1a6577ed2f95527745bf4d27c53488b9a7">LD2PD</link>(vol);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Hosting&#32;physical&#32;drive&#32;*/</emphasis>
05911 &#32;&#32;&#32;&#32;ipart&#32;=&#32;<link linkend="_ff_8c_1aadc4a9aefaf2588bdd7565549f5d91e7">LD2PT</link>(vol);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Hosting&#32;partition&#32;(0:create&#32;as&#32;new,&#32;1..:existing&#32;partition)&#32;*/</emphasis>
05912 
05913 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;hosting&#32;physical&#32;drive&#32;*/</emphasis>
05914 &#32;&#32;&#32;&#32;ds&#32;=&#32;<link linkend="_fat_8c_1a09cdaa6f36fa409bdf002727bff98eb1">disk_initialize</link>(pdrv);
05915 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ds&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45">FR_NOT_READY</link>;
05916 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ds&#32;&amp;&#32;<link linkend="_diskio_8h_1a9ec6dc5f6620a33fabe388d3a111ca8c">STA_PROTECT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>;
05917 
05918 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;physical&#32;drive&#32;parameters&#32;(sz_drv,&#32;sz_blk&#32;and&#32;ss)&#32;*/</emphasis>
05919 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!opt)&#32;opt&#32;=&#32;&amp;defopt;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;default&#32;parameter&#32;if&#32;it&#32;is&#32;not&#32;given&#32;*/</emphasis>
05920 &#32;&#32;&#32;&#32;sz_blk&#32;=&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1af244e017c4cb2c821e5e819fff7db710">align</link>;
05921 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_blk&#32;==&#32;0)&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1aec3bb4dfe075d0ba2f3b07b300a95500">GET_BLOCK_SIZE</link>,&#32;&amp;sz_blk);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Block&#32;size&#32;from&#32;the&#32;paramter&#32;or&#32;lower&#32;layer&#32;*/</emphasis>
05922 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_blk&#32;==&#32;0&#32;||&#32;sz_blk&#32;&gt;&#32;0x8000&#32;||&#32;(sz_blk&#32;&amp;&#32;(sz_blk&#32;-&#32;1)))&#32;sz_blk&#32;=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;default&#32;if&#32;the&#32;block&#32;size&#32;is&#32;invalid&#32;*/</emphasis>
05923 <emphasis role="preprocessor">#if&#32;FF_MAX_SS&#32;!=&#32;FF_MIN_SS&#x240D;</emphasis>
05924 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1ac73b5cf2135cbd459d109b96c9aa346a">GET_SECTOR_SIZE</link>,&#32;&amp;ss)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
05925 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ss&#32;&gt;&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>&#32;||&#32;ss&#32;&lt;&#32;<link linkend="_ffconf_8h_1a5c25535bf118c111157fe72fff3cbea5">FF_MIN_SS</link>&#32;||&#32;(ss&#32;&amp;&#32;(ss&#32;-&#32;1)))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
05926 <emphasis role="preprocessor">#else&#x240D;</emphasis>
05927 &#32;&#32;&#32;&#32;ss&#32;=&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>;
05928 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05929 
05930 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Options&#32;for&#32;FAT&#32;sub-type&#32;and&#32;FAT&#32;parameters&#32;*/</emphasis>
05931 &#32;&#32;&#32;&#32;fsopt&#32;=&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a54cb609ecff9f1586f3628b00aeb8f23">fmt</link>&#32;&amp;&#32;(<link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>&#32;|&#32;<link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>);
05932 &#32;&#32;&#32;&#32;n_fat&#32;=&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a0ff8e4728bddfe0636c50367af399e25">n_fat</link>&#32;&gt;=&#32;1&#32;&amp;&amp;&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a0ff8e4728bddfe0636c50367af399e25">n_fat</link>&#32;&lt;=&#32;2)&#32;?&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a0ff8e4728bddfe0636c50367af399e25">n_fat</link>&#32;:&#32;1;
05933 &#32;&#32;&#32;&#32;n_root&#32;=&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;&gt;=&#32;1&#32;&amp;&amp;&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;&lt;=&#32;32768&#32;&amp;&amp;&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;%&#32;(ss&#32;/&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>))&#32;==&#32;0)&#32;?&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;:&#32;512;
05934 &#32;&#32;&#32;&#32;sz_au&#32;=&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;&lt;=&#32;0x1000000&#32;&amp;&amp;&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;&amp;&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;-&#32;1))&#32;==&#32;0)&#32;?&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;:&#32;0;
05935 &#32;&#32;&#32;&#32;sz_au&#32;/=&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Byte&#32;--&gt;&#32;Sector&#32;*/</emphasis>
05936 
05937 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;working&#32;buffer&#32;*/</emphasis>
05938 &#32;&#32;&#32;&#32;sz_buf&#32;=&#32;len&#32;/&#32;ss;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;working&#32;buffer&#32;[sector]&#32;*/</emphasis>
05939 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_buf&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;
05940 &#32;&#32;&#32;&#32;buf&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)work;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Working&#32;buffer&#32;*/</emphasis>
05941 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;3&#x240D;</emphasis>
05942 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!buf)&#32;buf&#32;=&#32;<link linkend="_ffsystem_8c_1ae63913186246b80cfce42dbab9e8bcab">ff_memalloc</link>(sz_buf&#32;*&#32;ss);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;heap&#32;memory&#32;for&#32;working&#32;buffer&#32;*/</emphasis>
05943 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05944 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!buf)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;
05945 
05946 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;where&#32;the&#32;volume&#32;to&#32;be&#32;located&#32;(b_vol,&#32;sz_vol)&#32;*/</emphasis>
05947 &#32;&#32;&#32;&#32;b_vol&#32;=&#32;sz_vol&#32;=&#32;0;
05948 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a6f07d18b72c37af9fb5deda0e8a13131">FF_MULTI_PARTITION</link>&#32;&amp;&amp;&#32;ipart&#32;!=&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;volume&#32;associated&#32;with&#32;any&#32;specific&#32;partition?&#32;*/</emphasis>
05949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;partition&#32;location&#32;from&#32;the&#32;existing&#32;partition&#32;table&#32;*/</emphasis>
05950 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;MBR&#32;*/</emphasis>
05951 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>)&#32;!=&#32;0xAA55)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;MBR&#32;is&#32;valid&#32;*/</emphasis>
05952 <emphasis role="preprocessor">#if&#32;FF_LBA64&#x240D;</emphasis>
05953 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(buf[<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;==&#32;0xEE)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;GPT&#32;protective&#32;MBR?&#32;*/</emphasis>
05954 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;n_ent,&#32;ofs;
05955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;QWORD&#32;pt_lba;
05956 
05957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;partition&#32;location&#32;from&#32;GPT&#32;*/</emphasis>
05958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;1,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;GPT&#32;header&#32;sector&#32;(next&#32;to&#32;MBR)&#32;*/</emphasis>
05959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!test_gpt_header(buf))&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;GPT&#32;header&#32;is&#32;valid&#32;*/</emphasis>
05960 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_ent&#32;=&#32;ld_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a950d43a4211a4bdcc19888bfc8fde5f9">GPTH_PtNum</link>);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;*/</emphasis>
05961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pt_lba&#32;=&#32;ld_qword(buf&#32;+&#32;<link linkend="_ff_8c_1acf59802a11562c5dc1f0d99ae5a89946">GPTH_PtOfs</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;sector&#32;*/</emphasis>
05962 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;i&#32;=&#32;0;
05963 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n_ent)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;MS&#32;Basic&#32;partition&#32;with&#32;order&#32;of&#32;ipart&#32;*/</emphasis>
05964 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;==&#32;0&#32;&amp;&amp;&#32;<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;pt_lba++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;PT&#32;sector&#32;*/</emphasis>
05965 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!memcmp(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a8e8517c1287b2d9c93d164bccc0133db">GPTE_PtGuid</link>,&#32;GUID_MS_Basic,&#32;16)&#32;&amp;&amp;&#32;++i&#32;==&#32;ipart)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;MS&#32;basic&#32;data&#32;partition?&#32;*/</emphasis>
05966 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;ld_qword(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a25029670f9bc74da6eae5001fe4acdb4">GPTE_FstLba</link>);
05967 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_vol&#32;=&#32;ld_qword(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a4f37e50e5eabcfb8353749dc8b8be4b4">GPTE_LstLba</link>)&#32;-&#32;b_vol&#32;+&#32;1;
05968 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
05969 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05970 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_ent--;&#32;ofs&#32;=&#32;(ofs&#32;+&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>)&#32;%&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
05971 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05972 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_ent&#32;==&#32;0)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partition&#32;not&#32;found&#32;*/</emphasis>
05973 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsopt&#32;|=&#32;0x80;&#32;&#32;<emphasis role="comment">/*&#32;Partitioning&#32;is&#32;in&#32;GPT&#32;*/</emphasis>
05974 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
05975 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05976 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;partition&#32;location&#32;from&#32;MBR&#32;partition&#32;table&#32;*/</emphasis>
05977 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte&#32;=&#32;buf&#32;+&#32;(<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;(ipart&#32;-&#32;1)&#32;*&#32;<link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">SZ_PTE</link>);
05978 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ipart&#32;&gt;&#32;4&#32;||&#32;pte[<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;==&#32;0)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;<emphasis role="comment">/*&#32;No&#32;partition?&#32;*/</emphasis>
05979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;ld_dword(pte&#32;+&#32;<link linkend="_ff_8c_1ae33f69bfe238a35fb3fd1949c4e087da">PTE_StLba</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;start&#32;sector&#32;*/</emphasis>
05980 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_vol&#32;=&#32;ld_dword(pte&#32;+&#32;<link linkend="_ff_8c_1a195f11dd0185a4edbe7064ebe40092bc">PTE_SizLba</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;size&#32;*/</emphasis>
05981 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05982 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;volume&#32;is&#32;associated&#32;with&#32;a&#32;physical&#32;drive&#32;*/</emphasis>
05983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1a570216006f6a8fc4e1698b1bbb2d1dde">GET_SECTOR_COUNT</link>,&#32;&amp;sz_vol)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
05984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;be&#32;partitioned?&#32;*/</emphasis>
05985 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;single-partition&#32;on&#32;the&#32;drive&#32;in&#32;this&#32;function&#32;*/</emphasis>
05986 <emphasis role="preprocessor">#if&#32;FF_LBA64&#x240D;</emphasis>
05987 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;<link linkend="_ffconf_8h_1a1f3a98483912d219d3688edfa5717949">FF_MIN_GPT</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Which&#32;partition&#32;type&#32;to&#32;create,&#32;MBR&#32;or&#32;GPT?&#32;*/</emphasis>
05988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsopt&#32;|=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partitioning&#32;is&#32;in&#32;GPT&#32;*/</emphasis>
05989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;<link linkend="_ff_8c_1a7f901110fcf3b8bc941e6086cc7ba860">GPT_ALIGN</link>&#32;/&#32;ss;&#32;sz_vol&#32;-=&#32;b_vol&#32;+&#32;<link linkend="_ff_8c_1a5ba0a17d3228d2ccda3859b6ed0c4fb8">GPT_ITEMS</link>&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;/&#32;ss&#32;+&#32;1;&#32;<emphasis role="comment">/*&#32;Estimated&#32;partition&#32;offset&#32;and&#32;size&#32;*/</emphasis>
05990 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
05991 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partitioning&#32;is&#32;in&#32;MBR&#32;*/</emphasis>
05993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;&#32;<link linkend="_ff_8c_1aa7655ed8fbdcfec3965be1d6f412d0f6">N_SEC_TRACK</link>)&#32;{
05994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;<link linkend="_ff_8c_1aa7655ed8fbdcfec3965be1d6f412d0f6">N_SEC_TRACK</link>;&#32;sz_vol&#32;-=&#32;b_vol;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Estimated&#32;partition&#32;offset&#32;and&#32;size&#32;*/</emphasis>
05995 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05998 &#32;&#32;&#32;&#32;}
05999 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;128)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;volume&#32;size&#32;is&#32;&gt;=128s&#32;*/</emphasis>
06000 
06001 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Now&#32;start&#32;to&#32;create&#32;an&#32;FAT&#32;volume&#32;at&#32;b_vol&#32;and&#32;sz_vol&#32;*/</emphasis>
06002 
06003 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pre-determine&#32;the&#32;FAT&#32;type&#32;*/</emphasis>
06004 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a9348c28116bc29e88195b23f6945f81d">FM_EXFAT</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;possible?&#32;*/</emphasis>
06005 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>)&#32;==&#32;<link linkend="_ff_8h_1a9348c28116bc29e88195b23f6945f81d">FM_EXFAT</link>&#32;||&#32;sz_vol&#32;&gt;=&#32;0x4000000&#32;||&#32;sz_au&#32;&gt;&#32;128)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;only,&#32;vol&#32;&gt;=&#32;64MS&#32;or&#32;sz_au&#32;&gt;&#32;128S&#32;?&#32;*/</emphasis>
06006 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
06007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06008 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06009 <emphasis role="preprocessor">#if&#32;FF_LBA64&#x240D;</emphasis>
06010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x100000000)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;<emphasis role="comment">/*&#32;Too&#32;large&#32;volume&#32;for&#32;FAT/FAT32&#32;*/</emphasis>
06011 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
06012 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;&gt;&#32;128)&#32;sz_au&#32;=&#32;128;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;AU&#32;for&#32;FAT/FAT32?&#32;*/</emphasis>
06013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1aff61d3ed8f8c6ea5c25c3cb366320e08">FM_FAT32</link>)&#32;{&#32;<emphasis role="comment">/*&#32;FAT32&#32;possible?&#32;*/</emphasis>
06014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a8bd205b7d09147e55169d3713f46e9ea">FM_FAT</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;no-FAT?&#32;*/</emphasis>
06015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
06016 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a8bd205b7d09147e55169d3713f46e9ea">FM_FAT</link>))&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3b89faeceab64db277d0fcdeaaa315d6">FR_INVALID_PARAMETER</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;no-FAT?&#32;*/</emphasis>
06019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>;
06020 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(0);
06021 
06022 &#32;&#32;&#32;&#32;vsn&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;+&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;generated&#32;from&#32;current&#32;time&#32;and&#32;partitiion&#32;size&#32;*/</emphasis>
06023 
06024 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
06025 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Create&#32;an&#32;exFAT&#32;volume&#32;*/</emphasis>
06026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;szb_bit,&#32;szb_case,&#32;sum,&#32;nbit,&#32;clu,&#32;clen[3];
06027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;ch,&#32;si;
06028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;j,&#32;st;
06029 
06030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;0x1000)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;small&#32;volume&#32;for&#32;exFAT?&#32;*/</emphasis>
06031 <emphasis role="preprocessor">#if&#32;FF_USE_TRIM&#x240D;</emphasis>
06032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lba[0]&#32;=&#32;b_vol;&#32;lba[1]&#32;=&#32;b_vol&#32;+&#32;sz_vol&#32;-&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Inform&#32;storage&#32;device&#32;that&#32;the&#32;volume&#32;area&#32;may&#32;be&#32;erased&#32;*/</emphasis>
06033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1af09fd84bea8d4e889e272471f44d60d6">CTRL_TRIM</link>,&#32;lba);
06034 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
06035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;FAT&#32;location,&#32;data&#32;location&#32;and&#32;number&#32;of&#32;clusters&#32;*/</emphasis>
06036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;AU&#32;auto-selection&#32;*/</emphasis>
06037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_au&#32;=&#32;8;
06038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x80000)&#32;sz_au&#32;=&#32;64;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&gt;=&#32;512Ks&#32;*/</emphasis>
06039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x4000000)&#32;sz_au&#32;=&#32;256;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&gt;=&#32;64Ms&#32;*/</emphasis>
06040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_fat&#32;=&#32;b_vol&#32;+&#32;32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;start&#32;at&#32;offset&#32;32&#32;*/</emphasis>
06042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((sz_vol&#32;/&#32;sz_au&#32;+&#32;2)&#32;*&#32;4&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FAT&#32;sectors&#32;*/</emphasis>
06043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_data&#32;=&#32;(b_fat&#32;+&#32;sz_fat&#32;+&#32;sz_blk&#32;-&#32;1)&#32;&amp;&#32;~((<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>)sz_blk&#32;-&#32;1);&#32;&#32;<emphasis role="comment">/*&#32;Align&#32;data&#32;area&#32;to&#32;the&#32;erase&#32;block&#32;boundary&#32;*/</emphasis>
06044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b_data&#32;-&#32;b_vol&#32;&gt;=&#32;sz_vol&#32;/&#32;2)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;small&#32;volume?&#32;*/</emphasis>
06045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((sz_vol&#32;-&#32;(b_data&#32;-&#32;b_vol))&#32;/&#32;sz_au);&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
06046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&lt;16)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;few&#32;clusters?&#32;*/</emphasis>
06047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1ad7bea1c4a86cb654807e6da0370cb694">MAX_EXFAT</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;clusters?&#32;*/</emphasis>
06048 
06049 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;szb_bit&#32;=&#32;(n_clst&#32;+&#32;7)&#32;/&#32;8;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;allocation&#32;bitmap&#32;*/</emphasis>
06050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clen[0]&#32;=&#32;(szb_bit&#32;+&#32;sz_au&#32;*&#32;ss&#32;-&#32;1)&#32;/&#32;(sz_au&#32;*&#32;ss);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;allocation&#32;bitmap&#32;clusters&#32;*/</emphasis>
06051 
06052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;compressed&#32;up-case&#32;table&#32;*/</emphasis>
06053 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_data&#32;+&#32;sz_au&#32;*&#32;clen[0];&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;sector&#32;*/</emphasis>
06054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;checksum&#32;to&#32;be&#32;stored&#32;in&#32;the&#32;82&#32;entry&#32;*/</emphasis>
06055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st&#32;=&#32;0;&#32;si&#32;=&#32;0;&#32;i&#32;=&#32;0;&#32;j&#32;=&#32;0;&#32;szb_case&#32;=&#32;0;
06056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
06057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(st)&#32;{
06058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;0:
06059 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(si);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;up-case&#32;char&#32;*/</emphasis>
06060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ch&#32;!=&#32;si)&#32;{
06061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;si++;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;up-case&#32;char&#32;if&#32;exist&#32;*/</emphasis>
06062 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;1;&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(si&#32;+&#32;j)&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(si&#32;+&#32;j)&#32;==&#32;<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>((<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(si&#32;+&#32;j));&#32;j++)&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;run&#32;length&#32;of&#32;no-case&#32;block&#32;*/</emphasis>
06064 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(j&#32;&gt;=&#32;128)&#32;{
06065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;0xFFFF;&#32;st&#32;=&#32;2;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;Compress&#32;the&#32;no-case&#32;block&#32;if&#32;run&#32;is&#32;&gt;=&#32;128&#32;chars&#32;*/</emphasis>
06066 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Do&#32;not&#32;compress&#32;short&#32;run&#32;*/</emphasis>
06068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FALLTHROUGH&#32;*/</emphasis>
06069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;1:
06070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;si++;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;the&#32;short&#32;run&#32;*/</emphasis>
06071 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(--j&#32;==&#32;0)&#32;st&#32;=&#32;0;
06072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
06073 
06074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:
06075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)j;&#32;si&#32;+=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)j;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;chars&#32;to&#32;skip&#32;*/</emphasis>
06076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st&#32;=&#32;0;
06077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;xsum32(buf[i&#32;+&#32;0]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)ch,&#32;sum);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;it&#32;into&#32;the&#32;write&#32;buffer&#32;*/</emphasis>
06079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;xsum32(buf[i&#32;+&#32;1]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(ch&#32;&gt;&gt;&#32;8),&#32;sum);
06080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;2;&#32;szb_case&#32;+=&#32;2;
06081 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;==&#32;0&#32;||&#32;i&#32;==&#32;sz_buf&#32;*&#32;ss)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;buffered&#32;data&#32;when&#32;buffer&#32;full&#32;or&#32;end&#32;of&#32;process&#32;*/</emphasis>
06082 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(i&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;
06083 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06084 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;i&#32;=&#32;0;
06085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(si);
06087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clen[1]&#32;=&#32;(szb_case&#32;+&#32;sz_au&#32;*&#32;ss&#32;-&#32;1)&#32;/&#32;(sz_au&#32;*&#32;ss);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;up-case&#32;table&#32;clusters&#32;*/</emphasis>
06088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clen[2]&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;dir&#32;clusters&#32;*/</emphasis>
06089 
06090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;allocation&#32;bitmap&#32;*/</emphasis>
06091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_data;&#32;nsect&#32;=&#32;(szb_bit&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;bitmap&#32;and&#32;number&#32;of&#32;bitmap&#32;sectors&#32;*/</emphasis>
06092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nbit&#32;=&#32;clen[0]&#32;+&#32;clen[1]&#32;+&#32;clen[2];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;in-use&#32;by&#32;system&#32;(bitmap,&#32;up-case&#32;and&#32;root-dir)&#32;*/</emphasis>
06093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
06094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;bitmap&#32;buffer&#32;*/</emphasis>
06095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;nbit&#32;!=&#32;0&#32;&amp;&amp;&#32;i&#32;/&#32;8&#32;&lt;&#32;sz_buf&#32;*&#32;ss;&#32;buf[i&#32;/&#32;8]&#32;|=&#32;1&#32;&lt;&lt;&#32;(i&#32;%&#32;8),&#32;i++,&#32;nbit--)&#32;;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;used&#32;clusters&#32;*/</emphasis>
06096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;the&#32;buffered&#32;data&#32;*/</emphasis>
06097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
06099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
06100 
06101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;FAT&#32;*/</emphasis>
06102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_fat;&#32;nsect&#32;=&#32;sz_fat;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;FAT&#32;and&#32;number&#32;of&#32;FAT&#32;sectors&#32;*/</emphasis>
06103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;j&#32;=&#32;nbit&#32;=&#32;clu&#32;=&#32;0;
06104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
06105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);&#32;i&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Clear&#32;work&#32;area&#32;and&#32;reset&#32;write&#32;offset&#32;*/</emphasis>
06106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clu&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Initialize&#32;FAT&#32;[0]&#32;and&#32;FAT[1]&#32;*/</emphasis>
06107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;i,&#32;0xFFFFFFF8);&#32;i&#32;+=&#32;4;&#32;clu++;
06108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;i,&#32;0xFFFFFFFF);&#32;i&#32;+=&#32;4;&#32;clu++;
06109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;chains&#32;of&#32;bitmap,&#32;up-case&#32;and&#32;root&#32;dir&#32;*/</emphasis>
06111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nbit&#32;!=&#32;0&#32;&amp;&amp;&#32;i&#32;&lt;&#32;sz_buf&#32;*&#32;ss)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;chain&#32;*/</emphasis>
06112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;i,&#32;(nbit&#32;&gt;&#32;1)&#32;?&#32;clu&#32;+&#32;1&#32;:&#32;0xFFFFFFFF);
06113 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;4;&#32;clu++;&#32;nbit--;
06114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nbit&#32;==&#32;0&#32;&amp;&amp;&#32;j&#32;&lt;&#32;3)&#32;nbit&#32;=&#32;clen[j++];&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;next&#32;chain&#32;length&#32;*/</emphasis>
06116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nbit&#32;!=&#32;0&#32;&amp;&amp;&#32;i&#32;&lt;&#32;sz_buf&#32;*&#32;ss);
06117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;the&#32;buffered&#32;data&#32;*/</emphasis>
06118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
06120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
06121 
06122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;root&#32;directory&#32;*/</emphasis>
06123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);
06124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;0&#32;+&#32;0]&#32;=&#32;<link linkend="_ff_8c_1a9c991beac4793083d6bd370735bcb9c6">ET_VLABEL</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label&#32;entry&#32;(no&#32;label)&#32;*/</emphasis>
06125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1&#32;+&#32;0]&#32;=&#32;<link linkend="_ff_8c_1ab9becfd202f51394d189dffe291a5959">ET_BITMAP</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bitmap&#32;entry&#32;*/</emphasis>
06126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1&#32;+&#32;20,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;cluster&#32;*/</emphasis>
06127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1&#32;+&#32;24,&#32;szb_bit);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;size&#32;*/</emphasis>
06128 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;0]&#32;=&#32;<link linkend="_ff_8c_1a25a8a4c5eb49dc0d306d0fa6011cd9af">ET_UPCASE</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Up-case&#32;table&#32;entry&#32;*/</emphasis>
06129 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;4,&#32;sum);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;sum&#32;*/</emphasis>
06130 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;20,&#32;2&#32;+&#32;clen[0]);&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;cluster&#32;*/</emphasis>
06131 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;24,&#32;szb_case);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;size&#32;*/</emphasis>
06132 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_data&#32;+&#32;sz_au&#32;*&#32;(clen[0]&#32;+&#32;clen[1]);&#32;nsect&#32;=&#32;sz_au;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;the&#32;root&#32;directory&#32;and&#32;number&#32;of&#32;sectors&#32;*/</emphasis>
06133 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;root&#32;directory&#32;sectors&#32;*/</emphasis>
06134 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;
06135 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06136 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);&#32;<emphasis role="comment">/*&#32;Rest&#32;of&#32;entries&#32;are&#32;filled&#32;with&#32;zero&#32;*/</emphasis>
06137 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
06138 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
06139 
06140 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;two&#32;set&#32;of&#32;the&#32;exFAT&#32;VBR&#32;blocks&#32;*/</emphasis>
06141 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_vol;
06142 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;0;&#32;n&#32;&lt;&#32;2;&#32;n++)&#32;{
06143 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Main&#32;record&#32;(+0)&#32;*/</emphasis>
06144 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
06145 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">BS_JmpBoot</link>,&#32;<emphasis role="stringliteral">&quot;\xEB\x76\x90&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;EXFAT&#32;&#32;&#32;&quot;</emphasis>,&#32;11);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;jump&#32;code&#32;(x86),&#32;OEM&#32;name&#32;*/</emphasis>
06146 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1ab09fe2e1cd6205eb848e5fd00374efd4">BPB_VolOfsEx</link>,&#32;b_vol);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;offset&#32;in&#32;the&#32;physical&#32;drive&#32;[sector]&#32;*/</emphasis>
06147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1ac0c21531f17f5690b31622fcf98d3581">BPB_TotSecEx</link>,&#32;sz_vol);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;[sector]&#32;*/</emphasis>
06148 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a12af2061024593ffc7a92daf1c2d3470">BPB_FatOfsEx</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(b_fat&#32;-&#32;b_vol));&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;offset&#32;[sector]&#32;*/</emphasis>
06149 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a54579961bdbed995bcb7e077fedff1f4">BPB_FatSzEx</link>,&#32;sz_fat);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
06150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ad3ab64cc288e66c0643af23094aa9645">BPB_DataOfsEx</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(b_data&#32;-&#32;b_vol));&#32;<emphasis role="comment">/*&#32;Data&#32;offset&#32;[sector]&#32;*/</emphasis>
06151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a5bb065cee85104cbb58390ea9dfa01d8">BPB_NumClusEx</link>,&#32;n_clst);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
06152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a8447a1c7d19cab308ab198e1de2e086f">BPB_RootClusEx</link>,&#32;2&#32;+&#32;clen[0]&#32;+&#32;clen[1]);&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;dir&#32;cluster&#32;#&#32;*/</emphasis>
06153 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a465d34bfcd2bf930e04ae1b379047199">BPB_VolIDEx</link>,&#32;vsn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;*/</emphasis>
06154 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a86f95a0a4b798a61967e086540e6ebd9">BPB_FSVerEx</link>,&#32;0x100);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;version&#32;(1.00)&#32;*/</emphasis>
06155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(buf[<link linkend="_ff_8c_1a3d35e000a1033bb913d3fbc3aa5c68af">BPB_BytsPerSecEx</link>]&#32;=&#32;0,&#32;i&#32;=&#32;ss;&#32;i&#32;&gt;&gt;=&#32;1;&#32;buf[<link linkend="_ff_8c_1a3d35e000a1033bb913d3fbc3aa5c68af">BPB_BytsPerSecEx</link>]++)&#32;;&#32;<emphasis role="comment">/*&#32;Log2&#32;of&#32;sector&#32;size&#32;[byte]&#32;*/</emphasis>
06156 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(buf[<link linkend="_ff_8c_1a64dfd457aa404e53c16d58a3d249adfe">BPB_SecPerClusEx</link>]&#32;=&#32;0,&#32;i&#32;=&#32;sz_au;&#32;i&#32;&gt;&gt;=&#32;1;&#32;buf[<link linkend="_ff_8c_1a64dfd457aa404e53c16d58a3d249adfe">BPB_SecPerClusEx</link>]++)&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Log2&#32;of&#32;cluster&#32;size&#32;[sector]&#32;*/</emphasis>
06157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a20cab50b62fe9cb5a99ce28cb54da60e">BPB_NumFATsEx</link>]&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;*/</emphasis>
06158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1ac926d7c74f368a033dc8240167df9bc0">BPB_DrvNumEx</link>]&#32;=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;(for&#32;int13)&#32;*/</emphasis>
06159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1adea4123eb450eb09933fac339b08eeee">BS_BootCodeEx</link>,&#32;0xFEEB);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;code&#32;(x86)&#32;*/</emphasis>
06160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Signature&#32;(placed&#32;here&#32;regardless&#32;of&#32;sector&#32;size)&#32;*/</emphasis>
06161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;sum&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VBR&#32;checksum&#32;*/</emphasis>
06162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;!=&#32;<link linkend="_ff_8c_1af7b37995f89d832a47898aa787ecfbc8">BPB_VolFlagEx</link>&#32;&amp;&amp;&#32;i&#32;!=&#32;<link linkend="_ff_8c_1af7b37995f89d832a47898aa787ecfbc8">BPB_VolFlagEx</link>&#32;+&#32;1&#32;&amp;&amp;&#32;i&#32;!=&#32;<link linkend="_ff_8c_1a935b5f7cb38489adf96f42775583025b">BPB_PercInUseEx</link>)&#32;sum&#32;=&#32;xsum32(buf[i],&#32;sum);
06163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extended&#32;bootstrap&#32;record&#32;(+1..+8)&#32;*/</emphasis>
06166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
06167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;ss&#32;-&#32;2,&#32;0xAA55);&#32;&#32;<emphasis role="comment">/*&#32;Signature&#32;(placed&#32;at&#32;end&#32;of&#32;sector)&#32;*/</emphasis>
06168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;1;&#32;j&#32;&lt;&#32;9;&#32;j++)&#32;{
06169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;sum&#32;=&#32;xsum32(buf[i++],&#32;sum))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;VBR&#32;checksum&#32;*/</emphasis>
06170 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;OEM/Reserved&#32;record&#32;(+9..+10)&#32;*/</emphasis>
06173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
06174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;j&#32;&lt;&#32;11;&#32;j++)&#32;{
06175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;sum&#32;=&#32;xsum32(buf[i++],&#32;sum))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;VBR&#32;checksum&#32;*/</emphasis>
06176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sum&#32;record&#32;(+11)&#32;*/</emphasis>
06179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;i&#32;+=&#32;4)&#32;st_dword(buf&#32;+&#32;i,&#32;sum);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;with&#32;checksum&#32;value&#32;*/</emphasis>
06180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06182 
06183 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
06184 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_EXFAT&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
06185 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;an&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
06186 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
06187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pau&#32;=&#32;sz_au;
06188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pre-determine&#32;number&#32;of&#32;clusters&#32;and&#32;FAT&#32;sub-type&#32;*/</emphasis>
06189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{&#32;<emphasis role="comment">/*&#32;FAT32&#32;volume&#32;*/</emphasis>
06190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pau&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;AU&#32;auto-selection&#32;*/</emphasis>
06191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;0x20000;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;unit&#32;of&#32;128KS&#32;*/</emphasis>
06192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;pau&#32;=&#32;1;&#32;cst32[i]&#32;&amp;&amp;&#32;cst32[i]&#32;&lt;=&#32;n;&#32;i++,&#32;pau&#32;&lt;&lt;=&#32;1)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;from&#32;table&#32;*/</emphasis>
06193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;pau;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
06195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;=&#32;(n_clst&#32;*&#32;4&#32;+&#32;8&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
06196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_rsv&#32;=&#32;32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;reserved&#32;sectors&#32;*/</emphasis>
06197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_dir&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;static&#32;directory&#32;*/</emphasis>
06198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&lt;=&#32;MAX_FAT16&#32;||&#32;n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a40e7471b7ae3620a0419aa4d8d6dc684">MAX_FAT32</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
06199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;volume&#32;*/</emphasis>
06200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pau&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;au&#32;auto-selection&#32;*/</emphasis>
06201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;0x1000;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;unit&#32;of&#32;4KS&#32;*/</emphasis>
06202 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;pau&#32;=&#32;1;&#32;cst[i]&#32;&amp;&amp;&#32;cst[i]&#32;&lt;=&#32;n;&#32;i++,&#32;pau&#32;&lt;&lt;=&#32;1)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;from&#32;table&#32;*/</emphasis>
06203 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06204 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;pau;
06205 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;{
06206 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;n_clst&#32;*&#32;2&#32;+&#32;4;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[byte]&#32;*/</emphasis>
06207 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
06208 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>;
06209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(n_clst&#32;*&#32;3&#32;+&#32;1)&#32;/&#32;2&#32;+&#32;3;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[byte]&#32;*/</emphasis>
06210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;=&#32;(n&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
06212 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_rsv&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;reserved&#32;sectors&#32;*/</emphasis>
06213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_dir&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)n_root&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;/&#32;ss;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;dir&#32;size&#32;[sector]&#32;*/</emphasis>
06214 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06215 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_fat&#32;=&#32;b_vol&#32;+&#32;sz_rsv;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;base&#32;*/</emphasis>
06216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_data&#32;=&#32;b_fat&#32;+&#32;sz_fat&#32;*&#32;n_fat&#32;+&#32;sz_dir;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Data&#32;base&#32;*/</emphasis>
06217 
06218 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Align&#32;data&#32;area&#32;to&#32;erase&#32;block&#32;boundary&#32;(for&#32;flash&#32;memory&#32;media)&#32;*/</emphasis>
06219 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(((b_data&#32;+&#32;sz_blk&#32;-&#32;1)&#32;&amp;&#32;~(sz_blk&#32;-&#32;1))&#32;-&#32;b_data);&#32;&#32;<emphasis role="comment">/*&#32;Sectors&#32;to&#32;next&#32;nearest&#32;from&#32;current&#32;data&#32;base&#32;*/</emphasis>
06220 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT32:&#32;Move&#32;FAT&#32;*/</emphasis>
06221 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_rsv&#32;+=&#32;n;&#32;b_fat&#32;+=&#32;n;
06222 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT:&#32;Expand&#32;FAT&#32;*/</emphasis>
06223 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;%&#32;n_fat)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;fractional&#32;error&#32;if&#32;needed&#32;*/</emphasis>
06224 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n--;&#32;sz_rsv++;&#32;b_fat++;
06225 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06226 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;+=&#32;n&#32;/&#32;n_fat;
06227 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06228 
06229 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;number&#32;of&#32;clusters&#32;and&#32;final&#32;check&#32;of&#32;validity&#32;of&#32;the&#32;FAT&#32;sub-type&#32;*/</emphasis>
06230 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;b_data&#32;+&#32;pau&#32;*&#32;16&#32;-&#32;b_vol)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;small&#32;volume?&#32;*/</emphasis>
06231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;-&#32;sz_rsv&#32;-&#32;sz_fat&#32;*&#32;n_fat&#32;-&#32;sz_dir)&#32;/&#32;pau;
06232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
06233 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&lt;=&#32;<link linkend="_ff_8c_1a259e5a1973d5209304482a5bcd89372f">MAX_FAT16</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;few&#32;clusters&#32;for&#32;FAT32?&#32;*/</emphasis>
06234 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(sz_au&#32;=&#32;pau&#32;/&#32;2)&#32;!=&#32;0)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
06235 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
06236 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06237 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06238 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;{
06239 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a259e5a1973d5209304482a5bcd89372f">MAX_FAT16</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;clusters&#32;for&#32;FAT16&#32;*/</emphasis>
06240 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(pau&#32;*&#32;2)&#32;&lt;=&#32;64)&#32;{
06241 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_au&#32;=&#32;pau&#32;*&#32;2;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
06242 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06243 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1aff61d3ed8f8c6ea5c25c3cb366320e08">FM_FAT32</link>))&#32;{
06244 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Switch&#32;type&#32;to&#32;FAT32&#32;and&#32;retry&#32;*/</emphasis>
06245 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06246 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(sz_au&#32;=&#32;pau&#32;*&#32;2)&#32;&lt;=&#32;128)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
06247 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
06248 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06249 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;&#32;(n_clst&#32;&lt;=&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Too&#32;few&#32;clusters&#32;for&#32;FAT16&#32;*/</emphasis>
06250 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(sz_au&#32;=&#32;pau&#32;*&#32;2)&#32;&lt;=&#32;128)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
06251 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
06252 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06253 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06254 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>&#32;&amp;&amp;&#32;n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;clusters&#32;for&#32;FAT12&#32;*/</emphasis>
06255 
06256 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Ok,&#32;it&#32;is&#32;the&#32;valid&#32;cluster&#32;configuration&#32;*/</emphasis>
06257 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
06258 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(1);
06259 
06260 <emphasis role="preprocessor">#if&#32;FF_USE_TRIM&#x240D;</emphasis>
06261 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lba[0]&#32;=&#32;b_vol;&#32;lba[1]&#32;=&#32;b_vol&#32;+&#32;sz_vol&#32;-&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Inform&#32;storage&#32;device&#32;that&#32;the&#32;volume&#32;area&#32;may&#32;be&#32;erased&#32;*/</emphasis>
06262 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1af09fd84bea8d4e889e272471f44d60d6">CTRL_TRIM</link>,&#32;lba);
06263 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
06264 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;FAT&#32;VBR&#32;*/</emphasis>
06265 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
06266 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">BS_JmpBoot</link>,&#32;<emphasis role="stringliteral">&quot;\xEB\xFE\x90&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;MSDOS5.0&quot;</emphasis>,&#32;11);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;jump&#32;code&#32;(x86),&#32;OEM&#32;name&#32;*/</emphasis>
06267 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a8551844b4eb4e15aecd8cc9aa3585fa2">BPB_BytsPerSec</link>,&#32;ss);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;size&#32;[byte]&#32;*/</emphasis>
06268 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1aab78e41c617a14b9540c0563d6b957fa">BPB_SecPerClus</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)pau;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;[sector]&#32;*/</emphasis>
06269 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1ab3ec444c8457c9bc98aa07e846f5c1b7">BPB_RsvdSecCnt</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)sz_rsv);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;reserved&#32;area&#32;*/</emphasis>
06270 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1af44a1e8c89ec5502595f23496d24cbf1">BPB_NumFATs</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)n_fat;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;*/</emphasis>
06271 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1aaa667f14c87c45dc128f2ab208e92f98">BPB_RootEntCnt</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)((fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;?&#32;0&#32;:&#32;n_root));&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;directory&#32;entries&#32;*/</emphasis>
06272 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;0x10000)&#32;{
06273 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a4eb540eecde0f2df26fa8c7969341d68">BPB_TotSec16</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)sz_vol);&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;16-bit&#32;LBA&#32;*/</emphasis>
06274 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
06275 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a7723a9f0da553e8879d60909d85ccb7b">BPB_TotSec32</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;32-bit&#32;LBA&#32;*/</emphasis>
06276 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06277 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a414e054c4b5ea3414ebefa3539e7e554">BPB_Media</link>]&#32;=&#32;0xF8;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Media&#32;descriptor&#32;byte&#32;*/</emphasis>
06278 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1ac71bb771432ea532bc47713a028ebd76">BPB_SecPerTrk</link>,&#32;63);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;per&#32;track&#32;(for&#32;int13)&#32;*/</emphasis>
06279 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a9c03603c3be34d4c5cc1b481b0bc6774">BPB_NumHeads</link>,&#32;255);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;heads&#32;(for&#32;int13)&#32;*/</emphasis>
06280 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a449d4ed5c4c8105daf29aad9488277f7">BPB_HiddSec</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)b_vol);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;offset&#32;in&#32;the&#32;physical&#32;drive&#32;[sector]&#32;*/</emphasis>
06281 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
06282 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1abaa3aafdcf5e83f8cb7e2bb373b13525">BS_VolID32</link>,&#32;vsn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;*/</emphasis>
06283 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a6e6340030dc29e7da2e9f92e472a763d">BPB_FATSz32</link>,&#32;sz_fat);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
06284 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a4c99b85429f73c8f6a0ac2bc7a1d81ea">BPB_RootClus32</link>,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;directory&#32;cluster&#32;#&#32;(2)&#32;*/</emphasis>
06285 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a86b761a0ed35d7f6e9774be44482ee5b">BPB_FSInfo32</link>,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;of&#32;FSINFO&#32;sector&#32;(VBR&#32;+&#32;1)&#32;*/</emphasis>
06286 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a6fceac966c2f2b277e8f472c5a7de0c7">BPB_BkBootSec32</link>,&#32;6);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;of&#32;backup&#32;VBR&#32;(VBR&#32;+&#32;6)&#32;*/</emphasis>
06287 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1aa670c7b495f5b347c442df67b188c58f">BS_DrvNum32</link>]&#32;=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;(for&#32;int13)&#32;*/</emphasis>
06288 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a59c4b2f802ab4bc9319e5bd840e615b8">BS_BootSig32</link>]&#32;=&#32;0x29;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extended&#32;boot&#32;signature&#32;*/</emphasis>
06289 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a8241a49bce313184a58617ba1ad9e84c">BS_VolLab32</link>,&#32;<emphasis role="stringliteral">&quot;NO&#32;NAME&#32;&#32;&#32;&#32;&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;FAT32&#32;&#32;&#32;&quot;</emphasis>,&#32;19);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label,&#32;FAT&#32;signature&#32;*/</emphasis>
06290 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
06291 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a383a71bda500a0fb5a37f4edd785acbf">BS_VolID</link>,&#32;vsn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;*/</emphasis>
06292 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a60a2f6efeb6a4c7cb2da1e5def6ca43b">BPB_FATSz16</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)sz_fat);&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
06293 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a0c51f7393341b839dfb241c2951f3ef4">BS_DrvNum</link>]&#32;=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;(for&#32;int13)&#32;*/</emphasis>
06294 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a85a92e790602efef4da3a2f141611ce8">BS_BootSig</link>]&#32;=&#32;0x29;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extended&#32;boot&#32;signature&#32;*/</emphasis>
06295 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a28498ba4b07ff90aaa9628e81fb89d32">BS_VolLab</link>,&#32;<emphasis role="stringliteral">&quot;NO&#32;NAME&#32;&#32;&#32;&#32;&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;FAT&#32;&#32;&#32;&#32;&#32;&quot;</emphasis>,&#32;19);&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label,&#32;FAT&#32;signature&#32;*/</emphasis>
06296 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06297 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Signature&#32;(offset&#32;is&#32;fixed&#32;here&#32;regardless&#32;of&#32;sector&#32;size)&#32;*/</emphasis>
06298 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;to&#32;the&#32;VBR&#32;sector&#32;*/</emphasis>
06299 
06300 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;FSINFO&#32;record&#32;if&#32;needed&#32;*/</emphasis>
06301 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
06302 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol&#32;+&#32;6,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;backup&#32;VBR&#32;(VBR&#32;+&#32;6)&#32;*/</emphasis>
06303 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
06304 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a318e58c1966aba52b90ab98dcb649883">FSI_LeadSig</link>,&#32;0x41615252);
06305 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a3bac0e6ff5907873030db1d0a7c4ebef">FSI_StrucSig</link>,&#32;0x61417272);
06306 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ab711e50459aba01b11c6b46a7cc1410b">FSI_Free_Count</link>,&#32;n_clst&#32;-&#32;1);&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;free&#32;clusters&#32;*/</emphasis>
06307 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a320700cedf300c9b418edf56e5e6b086">FSI_Nxt_Free</link>,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;allocated&#32;cluster#&#32;*/</emphasis>
06308 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);
06309 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol&#32;+&#32;7,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;backup&#32;FSINFO&#32;(VBR&#32;+&#32;7)&#32;*/</emphasis>
06310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol&#32;+&#32;1,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;original&#32;FSINFO&#32;(VBR&#32;+&#32;1)&#32;*/</emphasis>
06311 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06312 
06313 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;FAT&#32;area&#32;*/</emphasis>
06314 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);
06315 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_fat;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;start&#32;sector&#32;*/</emphasis>
06316 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;n_fat;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;FATs&#32;each&#32;*/</emphasis>
06317 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
06318 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;0,&#32;0xFFFFFFF8);&#32;&#32;<emphasis role="comment">/*&#32;FAT[0]&#32;*/</emphasis>
06319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;4,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;FAT[1]&#32;*/</emphasis>
06320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;8,&#32;0x0FFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;FAT[2]&#32;(root&#32;directory)&#32;*/</emphasis>
06321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
06322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;0,&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>)&#32;?&#32;0xFFFFF8&#32;:&#32;0xFFFFFFF8);&#32;&#32;<emphasis role="comment">/*&#32;FAT[0]&#32;and&#32;FAT[1]&#32;*/</emphasis>
06323 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06324 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;=&#32;sz_fat;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FAT&#32;sectors&#32;*/</emphasis>
06325 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;FAT&#32;sectors&#32;*/</emphasis>
06326 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;
06327 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06328 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);&#32;<emphasis role="comment">/*&#32;Rest&#32;of&#32;FAT&#32;all&#32;are&#32;cleared&#32;*/</emphasis>
06329 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
06330 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
06331 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06332 
06333 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;root&#32;directory&#32;(fill&#32;with&#32;zero)&#32;*/</emphasis>
06334 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;=&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;?&#32;pau&#32;:&#32;sz_dir;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;directory&#32;sectors&#32;*/</emphasis>
06335 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
06336 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;
06337 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06338 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
06339 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
06340 &#32;&#32;&#32;&#32;}
06341 
06342 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;FAT&#32;volume&#32;has&#32;been&#32;created&#32;here&#32;*/</emphasis>
06343 
06344 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;system&#32;ID&#32;in&#32;the&#32;MBR&#32;partition&#32;table&#32;*/</emphasis>
06345 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fsty&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
06346 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x07;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;*/</emphasis>
06347 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
06348 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x0C;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT32X&#32;*/</emphasis>
06349 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x10000)&#32;{
06350 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x06;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT12/16&#32;(large)&#32;*/</emphasis>
06351 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;{
06352 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x04;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT16&#32;*/</emphasis>
06353 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
06354 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x01;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT12&#32;*/</emphasis>
06355 &#32;&#32;&#32;&#32;}
06356 
06357 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;partition&#32;information&#32;*/</emphasis>
06358 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a6f07d18b72c37af9fb5deda0e8a13131">FF_MULTI_PARTITION</link>&#32;&amp;&amp;&#32;ipart&#32;!=&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Volume&#32;is&#32;in&#32;the&#32;existing&#32;partition&#32;*/</emphasis>
06359 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ab92e95c077afccc4d6f847cbf766e1cd">FF_LBA64</link>&#32;||&#32;!(fsopt&#32;&amp;&#32;0x80))&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;partition&#32;in&#32;MBR?&#32;*/</emphasis>
06360 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;system&#32;ID&#32;in&#32;the&#32;partition&#32;table&#32;*/</emphasis>
06361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;the&#32;MBR&#32;*/</emphasis>
06362 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;(ipart&#32;-&#32;1)&#32;*&#32;<link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">SZ_PTE</link>&#32;+&#32;<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;=&#32;sys;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;system&#32;ID&#32;*/</emphasis>
06363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;back&#32;to&#32;the&#32;MBR&#32;*/</emphasis>
06364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06365 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;as&#32;a&#32;new&#32;single&#32;partition&#32;*/</emphasis>
06366 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;partition&#32;table&#32;if&#32;not&#32;in&#32;SFD&#32;format&#32;*/</emphasis>
06367 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lba[0]&#32;=&#32;sz_vol;&#32;lba[1]&#32;=&#32;0;
06368 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;create_partition(pdrv,&#32;lba,&#32;sys,&#32;buf);
06369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(res);
06370 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
06371 &#32;&#32;&#32;&#32;}
06372 
06373 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1a1b3c492f9aec325f0655941b75256f3c">CTRL_SYNC</link>,&#32;0)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
06374 
06375 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
06376 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a16a934c2bbfa2160295810adc49d5509"/><section>
    <title>f_mount()</title>
<indexterm><primary>f_mount</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_mount</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_mount (<link linkend="_struct_f_a_t_f_s">FATFS</link> * fs, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> opt)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l03657">3657</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">03662 {
03663 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*cfs;
03664 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
03665 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
03666 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*rp&#32;=&#32;path;
03667 
03668 
03669 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;ID&#32;(logical&#32;drive&#32;number)&#32;*/</emphasis>
03670 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(&amp;rp);
03671 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
03672 &#32;&#32;&#32;&#32;cfs&#32;=&#32;FatFs[vol];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;filesystem&#32;object&#32;of&#32;the&#32;volume&#32;*/</emphasis>
03673 
03674 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cfs)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unregister&#32;current&#32;filesystem&#32;object&#32;if&#32;regsitered&#32;*/</emphasis>
03675 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;FatFs[vol]&#32;=&#32;0;
03676 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
03677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clear_share(cfs);
03678 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03679 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Discard&#32;mutex&#32;of&#32;the&#32;current&#32;volume&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
03680 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_delete(vol);
03681 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03682 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cfs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;filesystem&#32;object&#32;to&#32;be&#32;unregistered&#32;*/</emphasis>
03683 &#32;&#32;&#32;&#32;}
03684 
03685 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;new&#32;filesystem&#32;object&#32;*/</emphasis>
03686 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>&#32;=&#32;<link linkend="_ff_8c_1a6577ed2f95527745bf4d27c53488b9a7">LD2PD</link>(vol);&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;hosting&#32;physical&#32;drive&#32;*/</emphasis>
03687 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Create&#32;a&#32;volume&#32;mutex&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
03688 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaa678cb2c36f5e7d8157ae295f1fbb42">ldrv</link>&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)vol;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Owner&#32;volume&#32;ID&#32;*/</emphasis>
03689 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!ff_mutex_create(vol))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
03690 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
03691 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(SysLock&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;system&#32;mutex&#32;if&#32;needed&#32;*/</emphasis>
03692 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!ff_mutex_create(<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>))&#32;{
03693 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_delete(vol);
03694 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
03695 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03696 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SysLock&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;mutex&#32;is&#32;ready&#32;*/</emphasis>
03697 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03698 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03699 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03700 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;new&#32;filesystem&#32;object&#32;*/</emphasis>
03701 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;FatFs[vol]&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;new&#32;fs&#32;object&#32;*/</emphasis>
03702 &#32;&#32;&#32;&#32;}
03703 
03704 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(opt&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Do&#32;not&#32;mount&#32;now,&#32;it&#32;will&#32;be&#32;mounted&#32;in&#32;subsequent&#32;file&#32;functions&#32;*/</emphasis>
03705 
03706 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Force&#32;mounted&#32;the&#32;volume&#32;*/</emphasis>
03707 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
03708 }
</programlisting></section>
<anchor xml:id="_ff_8h_1aefdef7126128d99d0b3bd82c28e54d80"/><section>
    <title>f_open()</title>
<indexterm><primary>f_open</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_open</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_open (<link linkend="_struct_f_i_l">FIL</link> * fp, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, <link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link> mode)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l03717">3717</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">03722 {
03723 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
03724 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
03725 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
03726 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
03727 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl,&#32;bcs,&#32;clst,&#32;tm;
03728 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sc;
03729 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;ofs;
03730 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03731 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
03732 
03733 
03734 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!fp)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>;
03735 
03736 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;number&#32;*/</emphasis>
03737 &#32;&#32;&#32;&#32;mode&#32;&amp;=&#32;<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;?&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>&#32;:&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>&#32;|&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>&#32;|&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>&#32;|&#32;<link linkend="_ff_8h_1a17b01553029920ac0468912b4bcb16c7">FA_OPEN_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a90f135b2ae90fba5080f6bd2b6c57b8a">FA_OPEN_APPEND</link>;
03738 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;mode);
03739 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
03740 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
03741 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
03742 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
03743 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;</emphasis><emphasis role="comment">/*&#32;Read/Write&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
03744 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
03745 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Origin&#32;directory&#32;itself?&#32;*/</emphasis>
03746 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
03747 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03748 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
03749 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
03750 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;chk_share(&amp;dj,&#32;(mode&#32;&amp;&#32;~<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>)&#32;?&#32;1&#32;:&#32;0);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;file&#32;can&#32;be&#32;used&#32;*/</emphasis>
03751 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03752 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03753 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03754 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;or&#32;Open&#32;a&#32;file&#32;*/</emphasis>
03755 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mode&#32;&amp;&#32;(<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a17b01553029920ac0468912b4bcb16c7">FA_OPEN_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>))&#32;{
03756 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;file,&#32;create&#32;new&#32;*/</emphasis>
03757 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;There&#32;is&#32;no&#32;file&#32;to&#32;open,&#32;create&#32;a&#32;new&#32;entry&#32;*/</emphasis>
03758 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
03759 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;enq_share()&#32;?&#32;dir_register(&amp;dj)&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>;
03760 <emphasis role="preprocessor">#else&#x240D;</emphasis>
03761 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;dj);
03762 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03763 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03764 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;mode&#32;|=&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;is&#32;created&#32;*/</emphasis>
03765 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03766 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Any&#32;object&#32;with&#32;the&#32;same&#32;name&#32;is&#32;already&#32;existing&#32;*/</emphasis>
03767 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;(<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>&#32;|&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;overwrite&#32;it&#32;(R/O&#32;or&#32;DIR)&#32;*/</emphasis>
03768 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;
03769 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
03770 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mode&#32;&amp;&#32;<link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;create&#32;as&#32;new&#32;file&#32;*/</emphasis>
03771 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03772 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03773 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(mode&#32;&amp;&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncate&#32;the&#32;file&#32;if&#32;overwrite&#32;mode&#32;*/</emphasis>
03774 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
03775 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
03776 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;allocation&#32;info&#32;*/</emphasis>
03777 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
03778 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);
03779 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;directory&#32;entry&#32;block&#32;initial&#32;state&#32;*/</emphasis>
03780 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;dirbuf&#32;+&#32;2,&#32;0,&#32;30);&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;85&#32;entry&#32;except&#32;for&#32;NumSec&#32;*/</emphasis>
03781 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;dirbuf&#32;+&#32;38,&#32;0,&#32;26);&#32;<emphasis role="comment">/*&#32;Clear&#32;C0&#32;entry&#32;except&#32;for&#32;NumName&#32;and&#32;NameHash&#32;*/</emphasis>
03782 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;
03783 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a74046208323ac5e8b5214b05e1a43b87">XDIR_CrtTime</link>,&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>());
03784 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;1;
03785 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);
03786 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;cluster&#32;chain&#32;if&#32;exist&#32;*/</emphasis>
03787 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>,&#32;0);
03788 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;-&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reuse&#32;the&#32;cluster&#32;hole&#32;*/</emphasis>
03789 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03790 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
03791 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03792 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
03793 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;directory&#32;entry&#32;initial&#32;state&#32;*/</emphasis>
03794 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tm&#32;=&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;created&#32;time&#32;*/</emphasis>
03795 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1a47fb1881ea71d860db9b8280564cb4d5">DIR_CrtTime</link>,&#32;tm);
03796 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);
03797 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;cluster&#32;chain&#32;*/</emphasis>
03798 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reset&#32;attribute&#32;*/</emphasis>
03799 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reset&#32;file&#32;allocation&#32;info&#32;*/</emphasis>
03800 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>,&#32;0);
03801 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
03802 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;cluster&#32;chain&#32;if&#32;exist&#32;*/</emphasis>
03803 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>;
03804 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;cl,&#32;0);
03805 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
03806 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sc);
03807 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;cl&#32;-&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reuse&#32;the&#32;cluster&#32;hole&#32;*/</emphasis>
03808 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03809 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03810 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03811 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03812 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03813 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;an&#32;existing&#32;file&#32;*/</emphasis>
03814 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;object&#32;exsiting?&#32;*/</emphasis>
03815 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;open&#32;against&#32;a&#32;directory&#32;*/</emphasis>
03816 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
03817 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
03818 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((mode&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>)&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Write&#32;mode&#32;open&#32;against&#32;R/O&#32;file&#32;*/</emphasis>
03819 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;
03820 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03821 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03822 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03823 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03824 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
03825 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mode&#32;&amp;&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>)&#32;mode&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;change&#32;flag&#32;if&#32;created&#32;or&#32;overwritten&#32;*/</emphasis>
03826 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a19e61b116df8e6f2138243998e43f131">dir_sect</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
03827 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a5af9e9fb312b629220eaf684dd28c4a9">dir_ptr</link>&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>;
03828 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
03829 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid&#32;=&#32;inc_share(&amp;dj,&#32;(mode&#32;&amp;&#32;~<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>)&#32;?&#32;1&#32;:&#32;0);&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;file&#32;for&#32;this&#32;session&#32;*/</emphasis>
03830 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid&#32;==&#32;0)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
03831 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03833 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;R/O&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
03834 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
03835 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;origin&#32;directory&#32;itself?&#32;*/</emphasis>
03836 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
03837 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
03838 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;directory?&#32;*/</emphasis>
03839 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
03840 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03843 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03844 
03845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
03846 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
03847 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
03848 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.c_scl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;containing&#32;directory&#32;info&#32;*/</emphasis>
03849 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.c_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
03850 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.c_ofs&#32;=&#32;dj.blk_ofs;
03851 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);
03852 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
03853 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03854 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
03855 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;object&#32;allocation&#32;info&#32;*/</emphasis>
03856 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;ld_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>);
03857 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03858 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK&#x240D;</emphasis>
03859 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;cltbl&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Disable&#32;fast&#32;seek&#32;mode&#32;*/</emphasis>
03860 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03861 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Validate&#32;the&#32;file&#32;object&#32;*/</emphasis>
03862 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1afc765e01ff97bfd9645c42b0ba30397f">id</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a417095d7c20d56d417dc0998e0dd5a5c">id</link>;
03863 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;=&#32;mode;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;access&#32;mode&#32;*/</emphasis>
03864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;error&#32;flag&#32;*/</emphasis>
03865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;current&#32;data&#32;sector&#32;*/</emphasis>
03866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;pointer&#32;top&#32;of&#32;the&#32;file&#32;*/</emphasis>
03867 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
03868 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
03869 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;0,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>);&#32;<emphasis role="comment">/*&#32;Clear&#32;sector&#32;buffer&#32;*/</emphasis>
03870 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((mode&#32;&amp;&#32;<link linkend="_ff_8c_1ad4d0d6afc5e28678b87a1b75b6645f7d">FA_SEEKEND</link>)&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Seek&#32;to&#32;end&#32;of&#32;file&#32;if&#32;FA_OPEN_APPEND&#32;is&#32;specified&#32;*/</emphasis>
03872 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;to&#32;seek&#32;*/</emphasis>
03873 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcs&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;in&#32;byte&#32;*/</emphasis>
03874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;cluster&#32;chain&#32;*/</emphasis>
03875 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(ofs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;ofs&#32;&gt;&#32;bcs;&#32;ofs&#32;-=&#32;bcs)&#32;{
03876 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);
03877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;=&#32;1)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
03878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
03879 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03880 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;
03881 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;{&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;buffer&#32;if&#32;not&#32;on&#32;the&#32;sector&#32;boundary&#32;*/</emphasis>
03882 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sc&#32;=&#32;clst2sect(fs,&#32;clst);
03883 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sc&#32;==&#32;0)&#32;{
03884 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
03885 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
03886 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sc&#32;+&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
03887 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
03888 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
03889 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03890 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03891 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03892 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
03893 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dec_share(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid);&#32;<emphasis role="comment">/*&#32;Decrement&#32;file&#32;open&#32;counter&#32;if&#32;seek&#32;failed&#32;*/</emphasis>
03894 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03895 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03896 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03897 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03898 
03899 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
03900 &#32;&#32;&#32;&#32;}
03901 
03902 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;file&#32;object&#32;on&#32;error&#32;*/</emphasis>
03903 
03904 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
03905 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a0d5b386636ec82d4c1e912d5902aa0e0"/><section>
    <title>f_opendir()</title>
<indexterm><primary>f_opendir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_opendir</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_opendir (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> * dp, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04597">4597</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04601 {
04602 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04603 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04604 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
04605 
04606 
04607 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dp)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>;
04608 
04609 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
04610 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
04611 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04612 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
04613 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
04614 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(dp,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;path&#32;to&#32;the&#32;directory&#32;*/</emphasis>
04615 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;completed&#32;*/</emphasis>
04616 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;not&#32;the&#32;origin&#32;directory&#32;itself&#32;*/</emphasis>
04617 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;This&#32;object&#32;is&#32;a&#32;sub-directory&#32;*/</emphasis>
04618 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04619 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
04620 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_scl&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;<emphasis role="comment">/*&#32;Get&#32;containing&#32;directory&#32;inforamation&#32;*/</emphasis>
04621 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
04622 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_ofs&#32;=&#32;dp-&gt;blk_ofs;
04623 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>);&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;object&#32;allocation&#32;info&#32;*/</emphasis>
04624 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04625 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04626 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
04627 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_clust(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;<emphasis role="comment">/*&#32;Get&#32;object&#32;allocation&#32;info&#32;*/</emphasis>
04628 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04629 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;This&#32;object&#32;is&#32;a&#32;file&#32;*/</emphasis>
04630 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;
04631 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04632 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04633 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04634 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1afc765e01ff97bfd9645c42b0ba30397f">id</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a417095d7c20d56d417dc0998e0dd5a5c">id</link>;
04635 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Rewind&#32;directory&#32;*/</emphasis>
04636 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
04637 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04638 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;0)&#32;{
04639 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid&#32;=&#32;inc_share(dp,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;sub&#32;directory&#32;*/</emphasis>
04640 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>;
04641 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04642 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Root&#32;directory&#32;need&#32;not&#32;to&#32;be&#32;locked&#32;*/</emphasis>
04643 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04644 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04645 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04646 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04647 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04648 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
04649 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;
04650 &#32;&#32;&#32;&#32;}
04651 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;directory&#32;object&#32;if&#32;function&#32;failed&#32;*/</emphasis>
04652 
04653 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04654 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a4ce26253177c167df849e76f69b5c66c"/><section>
    <title>f_printf()</title>
<indexterm><primary>f_printf</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_printf</secondary></indexterm>
<para><computeroutput>int f_printf (<link linkend="_struct_f_i_l">FIL</link> * fp, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * str,  ...)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1ad1d73b8d01c2ef89eddf920b7fcc6beb"/><section>
    <title>f_putc()</title>
<indexterm><primary>f_putc</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_putc</secondary></indexterm>
<para><computeroutput>int f_putc (<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> c, <link linkend="_struct_f_i_l">FIL</link> * fp)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1a699fc03ffa785ceab8812a7f204421f3"/><section>
    <title>f_puts()</title>
<indexterm><primary>f_puts</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_puts</secondary></indexterm>
<para><computeroutput>int f_puts (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * str, <link linkend="_struct_f_i_l">FIL</link> * cp)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1ac4c3dcb6869ca252888eebabe39727b3"/><section>
    <title>f_read()</title>
<indexterm><primary>f_read</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_read</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_read (<link linkend="_struct_f_i_l">FIL</link> * fp, void * buff, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> btr, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> * br)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l03914">3914</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">03920 {
03921 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
03922 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
03923 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst;
03924 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
03925 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;remain;
03926 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;rcnt,&#32;cc,&#32;csect;
03927 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*rbuff&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)buff;
03928 
03929 
03930 &#32;&#32;&#32;&#32;*br&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;read&#32;byte&#32;counter&#32;*/</emphasis>
03931 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
03932 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;*/</emphasis>
03933 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
03934 &#32;&#32;&#32;&#32;remain&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;-&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
03935 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(btr&#32;&gt;&#32;remain)&#32;btr&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)remain;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncate&#32;btr&#32;by&#32;remaining&#32;bytes&#32;*/</emphasis>
03936 
03937 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;btr&#32;&gt;&#32;0;&#32;btr&#32;-=&#32;rcnt,&#32;*br&#32;+=&#32;rcnt,&#32;rbuff&#32;+=&#32;rcnt,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;rcnt)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;btr&#32;bytes&#32;read&#32;*/</emphasis>
03938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;sector&#32;boundary?&#32;*/</emphasis>
03939 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;csect&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1));&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;offset&#32;in&#32;the&#32;cluster&#32;*/</emphasis>
03940 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;cluster&#32;boundary?&#32;*/</emphasis>
03941 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;top&#32;of&#32;the&#32;file?&#32;*/</emphasis>
03942 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;from&#32;the&#32;origin&#32;*/</emphasis>
03943 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Middle&#32;or&#32;end&#32;of&#32;the&#32;file&#32;*/</emphasis>
03944 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK&#x240D;</emphasis>
03945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;cltbl)&#32;{
03946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;clmt_clust(fp,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;cluster#&#32;from&#32;the&#32;CLMT&#32;*/</emphasis>
03947 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
03948 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
03950 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
03951 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03952 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03953 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;&#32;2)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
03954 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
03955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;current&#32;cluster&#32;*/</emphasis>
03956 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;sector&#32;*/</emphasis>
03958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
03959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;csect;
03960 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;btr&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;remaining&#32;bytes&#32;&gt;=&#32;sector&#32;size,&#32;*/</emphasis>
03961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cc&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;maximum&#32;contiguous&#32;sectors&#32;directly&#32;*/</emphasis>
03962 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;+&#32;cc&#32;&gt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;cluster&#32;boundary&#32;*/</emphasis>
03963 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;csect;
03964 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03965 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;rbuff,&#32;sect,&#32;cc)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
03966 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;2&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Replace&#32;one&#32;of&#32;the&#32;read&#32;sectors&#32;with&#32;cached&#32;data&#32;if&#32;it&#32;contains&#32;a&#32;dirty&#32;sector&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
03967 <emphasis role="preprocessor">#if&#32;FF_FS_TINY&#x240D;</emphasis>
03968 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{
03969 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff&#32;+&#32;((fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
03970 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03971 <emphasis role="preprocessor">#else&#x240D;</emphasis>
03972 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{
03973 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff&#32;+&#32;((fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
03974 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03975 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03976 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03977 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;*&#32;cc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;transferred&#32;*/</emphasis>
03978 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
03979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03980 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
03981 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;!=&#32;sect)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;data&#32;sector&#32;if&#32;not&#32;in&#32;cache&#32;*/</emphasis>
03982 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#x240D;</emphasis>
03983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
03984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
03985 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
03986 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03987 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;sect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;*/</emphasis>
03989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03990 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
03991 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sect;
03992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
03993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;remains&#32;in&#32;the&#32;sector&#32;*/</emphasis>
03994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rcnt&#32;&gt;&#32;btr)&#32;rcnt&#32;=&#32;btr;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;it&#32;by&#32;btr&#32;if&#32;needed&#32;*/</emphasis>
03995 <emphasis role="preprocessor">#if&#32;FF_FS_TINY&#x240D;</emphasis>
03996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Move&#32;sector&#32;window&#32;*/</emphasis>
03997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;rcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extract&#32;partial&#32;sector&#32;*/</emphasis>
03998 <emphasis role="preprocessor">#else&#x240D;</emphasis>
03999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;rcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extract&#32;partial&#32;sector&#32;*/</emphasis>
04000 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04001 &#32;&#32;&#32;&#32;}
04002 
04003 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
04004 }
</programlisting></section>
<anchor xml:id="_ff_8h_1ab8b2c70a95ca61f4f516c56fda7f82ab"/><section>
    <title>f_readdir()</title>
<indexterm><primary>f_readdir</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_readdir</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_readdir (<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link> * dp, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> * fno)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04693">4693</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04697 {
04698 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04699 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04700 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
04701 
04702 
04703 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;directory&#32;object&#32;*/</emphasis>
04704 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04705 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!fno)&#32;{
04706 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Rewind&#32;the&#32;directory&#32;object&#32;*/</emphasis>
04707 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04708 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
04709 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">DIR_READ_FILE</link>(dp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;an&#32;item&#32;*/</emphasis>
04710 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Ignore&#32;end&#32;of&#32;directory&#32;*/</emphasis>
04711 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;valid&#32;entry&#32;is&#32;found&#32;*/</emphasis>
04712 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;get_fileinfo(dp,&#32;fno);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;object&#32;information&#32;*/</emphasis>
04713 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Increment&#32;index&#32;for&#32;next&#32;*/</emphasis>
04714 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Ignore&#32;end&#32;of&#32;directory&#32;now&#32;*/</emphasis>
04715 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04716 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
04717 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04718 &#32;&#32;&#32;&#32;}
04719 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04720 }
</programlisting></section>
<anchor xml:id="_ff_8h_1aa775b9b024acfeb3a66523cab497d142"/><section>
    <title>f_rename()</title>
<indexterm><primary>f_rename</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_rename</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_rename (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path_old, const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path_new)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l05140">5140</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">05144 {
05145 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
05146 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
05147 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;djo,&#32;djn;
05148 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;buf[<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;?&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;:&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>],&#32;*dir;
05149 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
05150 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
05151 
05152 
05153 &#32;&#32;&#32;&#32;get_ldnumber(&amp;path_new);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;the&#32;drive&#32;number&#32;of&#32;new&#32;name&#32;off&#32;*/</emphasis>
05154 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path_old,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;of&#32;the&#32;old&#32;object&#32;*/</emphasis>
05155 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05156 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
05157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
05158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;djo,&#32;path_old);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;old&#32;object&#32;*/</emphasis>
05159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;(<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>&#32;|&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)))&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;name&#32;*/</emphasis>
05160 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
05161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;chk_share(&amp;djo,&#32;2);
05163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05164 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;to&#32;be&#32;renamed&#32;is&#32;found&#32;*/</emphasis>
05166 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
05167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;At&#32;exFAT&#32;volume&#32;*/</emphasis>
05168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;nf,&#32;nn;
05169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;nh;
05170 
05171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf,&#32;fs-&gt;dirbuf,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;85+C0&#32;entry&#32;of&#32;old&#32;object&#32;*/</emphasis>
05172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(&amp;djn,&#32;&amp;djo,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;djo);
05173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;djn,&#32;path_new);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;sure&#32;if&#32;new&#32;object&#32;name&#32;is&#32;not&#32;in&#32;use&#32;*/</emphasis>
05174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;new&#32;name&#32;already&#32;in&#32;use&#32;by&#32;any&#32;other&#32;object?&#32;*/</emphasis>
05175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;(djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;&amp;&amp;&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;
05176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;valid&#32;path&#32;and&#32;no&#32;name&#32;collision&#32;*/</emphasis>
05178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;djn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;the&#32;new&#32;entry&#32;*/</emphasis>
05179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nf&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>];&#32;nn&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>];
05181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nh&#32;=&#32;ld_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">XDIR_NameHash</link>);
05182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;dirbuf,&#32;buf,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;85+C0&#32;entry&#32;*/</emphasis>
05183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>]&#32;=&#32;nf;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>]&#32;=&#32;nn;
05184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">XDIR_NameHash</link>,&#32;nh);
05185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;if&#32;it&#32;is&#32;a&#32;file&#32;*/</emphasis>
05186 <emphasis role="comment">/*&#32;Start&#32;of&#32;critical&#32;section&#32;where&#32;an&#32;interruption&#32;can&#32;cause&#32;a&#32;cross-link&#32;*/</emphasis>
05187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;djn);
05188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
05191 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;At&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
05193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf,&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;directory&#32;entry&#32;of&#32;the&#32;object&#32;*/</emphasis>
05194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(&amp;djn,&#32;&amp;djo,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;(<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>));&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Duplicate&#32;the&#32;directory&#32;object&#32;*/</emphasis>
05195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;djn,&#32;path_new);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;sure&#32;if&#32;new&#32;object&#32;name&#32;is&#32;not&#32;in&#32;use&#32;*/</emphasis>
05196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;new&#32;name&#32;already&#32;in&#32;use&#32;by&#32;any&#32;other&#32;object?&#32;*/</emphasis>
05197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;(djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;&amp;&amp;&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;
05198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;valid&#32;path&#32;and&#32;no&#32;name&#32;collision&#32;*/</emphasis>
05200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;djn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;the&#32;new&#32;entry&#32;*/</emphasis>
05201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05202 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir&#32;=&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Copy&#32;directory&#32;entry&#32;of&#32;the&#32;object&#32;except&#32;name&#32;*/</emphasis>
05203 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dir&#32;+&#32;13,&#32;buf&#32;+&#32;13,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;-&#32;13);
05204 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;buf[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>];
05205 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;if&#32;it&#32;is&#32;a&#32;file&#32;*/</emphasis>
05206 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
05207 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;&amp;&amp;&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Update&#32;..&#32;entry&#32;in&#32;the&#32;sub-directory&#32;if&#32;needed&#32;*/</emphasis>
05208 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;ld_clust(fs,&#32;dir));
05209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;{
05210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
05211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
05212 <emphasis role="comment">/*&#32;Start&#32;of&#32;critical&#32;section&#32;where&#32;an&#32;interruption&#32;can&#32;cause&#32;a&#32;cross-link&#32;*/</emphasis>
05213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sect);
05214 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1;&#32;<emphasis role="comment">/*&#32;Ptr&#32;to&#32;..&#32;entry&#32;*/</emphasis>
05215 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;dir[1]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;{
05216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;dir,&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>);
05217 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
05218 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05219 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05220 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05221 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05222 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05223 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05224 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05225 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_remove(&amp;djo);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;old&#32;entry&#32;*/</emphasis>
05226 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05227 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
05228 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05229 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05230 <emphasis role="comment">/*&#32;End&#32;of&#32;the&#32;critical&#32;section&#32;*/</emphasis>
05231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
05233 &#32;&#32;&#32;&#32;}
05234 
05235 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
05236 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a529e8f17cae495f6536ff405622c996c"/><section>
    <title>f_setcp()</title>
<indexterm><primary>f_setcp</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_setcp</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_setcp (<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link> cp)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1aa82bca64e28bc0d656a7999dd0eadec7"/><section>
    <title>f_setlabel()</title>
<indexterm><primary>f_setlabel</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_setlabel</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_setlabel (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * label)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1abe1f60daab5c7d11170c334fb832c798"/><section>
    <title>f_stat()</title>
<indexterm><primary>f_stat</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_stat</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_stat (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> * fno)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04781">4781</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04785 {
04786 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04787 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
04788 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
04789 
04790 
04791 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
04792 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;0);
04793 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04794 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>);
04795 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
04796 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;completed&#32;*/</emphasis>
04797 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;origin&#32;directory&#32;*/</emphasis>
04798 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
04799 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Found&#32;an&#32;object&#32;*/</emphasis>
04800 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fno)&#32;get_fileinfo(&amp;dj,&#32;fno);
04801 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04802 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04803 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
04804 &#32;&#32;&#32;&#32;}
04805 
04806 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;res);
04807 }
</programlisting></section>
<anchor xml:id="_ff_8h_1ad69c7246b122ba56a134939ee0eaf847"/><section>
    <title>f_sync()</title>
<indexterm><primary>f_sync</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_sync</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_sync (<link linkend="_struct_f_i_l">FIL</link> * fp)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04135">4135</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04138 {
04139 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04140 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04141 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;tm;
04142 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*dir;
04143 
04144 
04145 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
04146 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;any&#32;change&#32;to&#32;the&#32;file?&#32;*/</emphasis>
04148 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
04149 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;cached&#32;data&#32;if&#32;needed&#32;*/</emphasis>
04150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04153 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04154 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
04155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tm&#32;=&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Modified&#32;time&#32;*/</emphasis>
04156 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
04158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_first_frag(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;first&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
04159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_last_frag(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;last&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
04161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
04164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
04165 
04166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
04167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;load_obj_xdir(&amp;dj,&#32;&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);&#32;<emphasis role="comment">/*&#32;Load&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
04168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;to&#32;indicate&#32;that&#32;the&#32;file&#32;has&#32;been&#32;changed&#32;*/</emphasis>
04170 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;|&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;allocation&#32;information&#32;*/</emphasis>
04171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;start&#32;cluster&#32;*/</emphasis>
04172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;size&#32;*/</emphasis>
04173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a543e2a11cefac978a0108a7973416d56">XDIR_ValidFileSize</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);&#32;<emphasis role="comment">/*&#32;(FatFs&#32;does&#32;not&#32;support&#32;Valid&#32;File&#32;Size&#32;feature)&#32;*/</emphasis>
04174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>,&#32;tm);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;modified&#32;time&#32;*/</emphasis>
04175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a0f63c605687d0ed66c633ba6a10c01e5">XDIR_ModTime10</link>]&#32;=&#32;0;
04176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1af0a826e3f3902172e3ebd5a3132a0153">XDIR_AccTime</link>,&#32;0);
04177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;it&#32;to&#32;the&#32;directory&#32;*/</emphasis>
04178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
04180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
04181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
04184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04186 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
04188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a19e61b116df8e6f2138243998e43f131">dir_sect</link>);
04189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a5af9e9fb312b629220eaf684dd28c4a9">dir_ptr</link>;
04191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;to&#32;indicate&#32;that&#32;the&#32;file&#32;has&#32;been&#32;changed&#32;*/</emphasis>
04192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;dir,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;allocation&#32;information&#32;&#32;*/</emphasis>
04193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dir&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;size&#32;*/</emphasis>
04194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dir&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;modified&#32;time&#32;*/</emphasis>
04195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dir&#32;+&#32;<link linkend="_ff_8c_1afa0625d73f4683df24345f51e7a43da3">DIR_LstAccDate</link>,&#32;0);
04196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
04197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;it&#32;to&#32;the&#32;directory&#32;*/</emphasis>
04198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
04199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04202 &#32;&#32;&#32;&#32;}
04203 
04204 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04205 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a691a27b40c348f7c84b42e911636f38a"/><section>
    <title>f_truncate()</title>
<indexterm><primary>f_truncate</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_truncate</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_truncate (<link linkend="_struct_f_i_l">FIL</link> * fp)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04912">4912</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04915 {
04916 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04917 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04918 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ncl;
04919 
04920 
04921 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
04922 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04923 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
04924 
04925 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&lt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Process&#32;when&#32;fptr&#32;is&#32;not&#32;on&#32;the&#32;eof&#32;*/</emphasis>
04926 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;set&#32;file&#32;size&#32;to&#32;zero,&#32;remove&#32;entire&#32;cluster&#32;chain&#32;*/</emphasis>
04927 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>,&#32;0);
04928 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;0;
04929 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;truncate&#32;a&#32;part&#32;of&#32;the&#32;file,&#32;remove&#32;remaining&#32;clusters&#32;*/</emphasis>
04930 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);
04931 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
04932 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
04933 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;1)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
04934 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;ncl&#32;&lt;&#32;fs-&gt;n_fatent)&#32;{
04935 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;ncl,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);
04936 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04937 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;size&#32;to&#32;current&#32;read/write&#32;point&#32;*/</emphasis>
04939 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
04940 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY&#x240D;</emphasis>
04941 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>))&#32;{
04942 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;{
04943 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
04944 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04947 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04948 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;res);
04950 &#32;&#32;&#32;&#32;}
04951 
04952 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
04953 }
</programlisting></section>
<anchor xml:id="_ff_8h_1a2858167fcd0bced48e9be434b3895efe"/><section>
    <title>f_unlink()</title>
<indexterm><primary>f_unlink</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_unlink</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_unlink (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04962">4962</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04965 {
04966 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04967 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04968 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj,&#32;sdj;
04969 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dclst&#32;=&#32;0;
04970 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04971 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>&#32;obj;
04972 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04973 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
04974 
04975 
04976 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
04977 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);
04978 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
04980 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
04981 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
04982 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1af0d4b41a010f1a611bc6fb9e42357350">FF_FS_RPATH</link>&#32;&amp;&amp;&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>))&#32;{
04983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;remove&#32;dot&#32;entry&#32;*/</emphasis>
04984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04985 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#x240D;</emphasis>
04986 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;chk_share(&amp;dj,&#32;2);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;it&#32;is&#32;an&#32;open&#32;object&#32;*/</emphasis>
04987 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;object&#32;is&#32;accessible&#32;*/</emphasis>
04989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{
04990 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;remove&#32;the&#32;origin&#32;directory&#32;*/</emphasis>
04991 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
04992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>)&#32;{
04993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;remove&#32;R/O&#32;object&#32;*/</emphasis>
04994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04995 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
04997 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
04998 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
04999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
05000 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;obj);
05001 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dclst&#32;=&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
05002 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
05003 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05004 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
05005 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dclst&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);
05006 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;sub-directory?&#32;*/</emphasis>
05008 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0&#x240D;</emphasis>
05009 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dclst&#32;==&#32;fs-&gt;cdir)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;the&#32;current&#32;directory?&#32;*/</emphasis>
05010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;
05011 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
05012 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
05014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;the&#32;sub-directory&#32;*/</emphasis>
05015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;dclst;
05016 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
05017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
05018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;
05019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
05020 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05021 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(&amp;sdj,&#32;0);
05023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">DIR_READ_FILE</link>(&amp;sdj);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;directory&#32;is&#32;empty&#32;*/</emphasis>
05025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;empty?&#32;*/</emphasis>
05026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Empty?&#32;*/</emphasis>
05027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
05032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_remove(&amp;dj);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
05033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;dclst&#32;!=&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;cluster&#32;chain&#32;if&#32;exist&#32;*/</emphasis>
05034 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#x240D;</emphasis>
05035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;obj,&#32;dclst,&#32;0);
05036 <emphasis role="preprocessor">#else&#x240D;</emphasis>
05037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;dclst,&#32;0);
05038 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
05039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;sync_fs(fs);
05041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
05043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
05044 &#32;&#32;&#32;&#32;}
05045 
05046 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
05047 }
</programlisting></section>
<anchor xml:id="_ff_8h_1aafaa718d1a487e12a8f0087173dba0b9"/><section>
    <title>f_utime()</title>
<indexterm><primary>f_utime</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_utime</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_utime (const <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link> * path, const <link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link> * fno)</computeroutput></para></section>
<anchor xml:id="_ff_8h_1ae6a4dfae8a9e308bdb2283a37ef680f2"/><section>
    <title>f_write()</title>
<indexterm><primary>f_write</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>f_write</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link> f_write (<link linkend="_struct_f_i_l">FIL</link> * fp, const void * buff, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> btw, <link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link> * bw)</computeroutput></para><para>
Definition at line <link linkend="_ff_8c_source_1l04014">4014</link> of file <link linkend="_ff_8c_source">ff.c</link>.</para>
<programlisting linenumbering="unnumbered">04020 {
04021 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
04022 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
04023 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst;
04024 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
04025 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;wcnt,&#32;cc,&#32;csect;
04026 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*wbuff&#32;=&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)buff;
04027 
04028 
04029 &#32;&#32;&#32;&#32;*bw&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;write&#32;byte&#32;counter&#32;*/</emphasis>
04030 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
04031 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;*/</emphasis>
04032 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
04033 
04034 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;fptr&#32;wrap-around&#32;(file&#32;size&#32;cannot&#32;reach&#32;4&#32;GiB&#32;at&#32;FAT&#32;volume)&#32;*/</emphasis>
04035 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+&#32;btw)&#32;&lt;&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>)&#32;{
04036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;btw&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(0xFFFFFFFF&#32;-&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>);
04037 &#32;&#32;&#32;&#32;}
04038 
04039 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;btw&#32;&gt;&#32;0;&#32;btw&#32;-=&#32;wcnt,&#32;*bw&#32;+=&#32;wcnt,&#32;wbuff&#32;+=&#32;wcnt,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;wcnt,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;?&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;:&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;all&#32;data&#32;written&#32;*/</emphasis>
04040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;sector&#32;boundary?&#32;*/</emphasis>
04041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;csect&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;offset&#32;in&#32;the&#32;cluster&#32;*/</emphasis>
04042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;cluster&#32;boundary?&#32;*/</emphasis>
04043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;top&#32;of&#32;the&#32;file?&#32;*/</emphasis>
04044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;from&#32;the&#32;origin&#32;*/</emphasis>
04045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;no&#32;cluster&#32;is&#32;allocated,&#32;*/</emphasis>
04046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;0);&#32;&#32;&#32;<emphasis role="comment">/*&#32;create&#32;a&#32;new&#32;cluster&#32;chain&#32;*/</emphasis>
04047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04048 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;middle&#32;or&#32;end&#32;of&#32;the&#32;file&#32;*/</emphasis>
04049 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK&#x240D;</emphasis>
04050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;cltbl)&#32;{
04051 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;clmt_clust(fp,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;cluster#&#32;from&#32;the&#32;CLMT&#32;*/</emphasis>
04052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
04053 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
04055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;or&#32;stretch&#32;cluster&#32;chain&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
04056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Could&#32;not&#32;allocate&#32;a&#32;new&#32;cluster&#32;(disk&#32;full)&#32;*/</emphasis>
04059 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;current&#32;cluster&#32;*/</emphasis>
04062 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;==&#32;0)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;clst;&#32;<emphasis role="comment">/*&#32;Set&#32;start&#32;cluster&#32;if&#32;the&#32;first&#32;write&#32;*/</emphasis>
04063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04064 <emphasis role="preprocessor">#if&#32;FF_FS_TINY&#x240D;</emphasis>
04065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;==&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;&amp;&amp;&#32;sync_window(fs)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;sector&#32;cache&#32;*/</emphasis>
04066 <emphasis role="preprocessor">#else&#x240D;</emphasis>
04067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;sector&#32;cache&#32;*/</emphasis>
04068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04071 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;sector&#32;*/</emphasis>
04073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
04074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;csect;
04075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;btw&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;remaining&#32;bytes&#32;&gt;=&#32;sector&#32;size,&#32;*/</emphasis>
04076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cc&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;maximum&#32;contiguous&#32;sectors&#32;directly&#32;*/</emphasis>
04077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;+&#32;cc&#32;&gt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;cluster&#32;boundary&#32;*/</emphasis>
04078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;csect;
04079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;wbuff,&#32;sect,&#32;cc)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04081 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;2&#x240D;</emphasis>
04082 <emphasis role="preprocessor">#if&#32;FF_FS_TINY&#x240D;</emphasis>
04083 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Refill&#32;sector&#32;cache&#32;if&#32;it&#32;gets&#32;invalidated&#32;by&#32;the&#32;direct&#32;write&#32;*/</emphasis>
04084 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;wbuff&#32;+&#32;((fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
04085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;0;
04086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04087 <emphasis role="preprocessor">#else&#x240D;</emphasis>
04088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{&#32;<emphasis role="comment">/*&#32;Refill&#32;sector&#32;cache&#32;if&#32;it&#32;gets&#32;invalidated&#32;by&#32;the&#32;direct&#32;write&#32;*/</emphasis>
04089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;wbuff&#32;+&#32;((fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
04090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04092 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04093 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;*&#32;cc;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;transferred&#32;*/</emphasis>
04095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
04096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04097 <emphasis role="preprocessor">#if&#32;FF_FS_TINY&#x240D;</emphasis>
04098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Avoid&#32;silly&#32;cache&#32;filling&#32;on&#32;the&#32;growing&#32;edge&#32;*/</emphasis>
04099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sync_window(fs)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04100 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;=&#32;sect;
04101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04102 <emphasis role="preprocessor">#else&#x240D;</emphasis>
04103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;!=&#32;sect&#32;&amp;&amp;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;with&#32;file&#32;data&#32;*/</emphasis>
04104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&lt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&amp;
04105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;sect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;{
04106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
04107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04108 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sect;
04110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
04111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;remains&#32;in&#32;the&#32;sector&#32;*/</emphasis>
04112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wcnt&#32;&gt;&#32;btw)&#32;wcnt&#32;=&#32;btw;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;it&#32;by&#32;btw&#32;if&#32;needed&#32;*/</emphasis>
04113 <emphasis role="preprocessor">#if&#32;FF_FS_TINY&#x240D;</emphasis>
04114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Move&#32;sector&#32;window&#32;*/</emphasis>
04115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;wbuff,&#32;wcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fit&#32;data&#32;to&#32;the&#32;sector&#32;*/</emphasis>
04116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
04117 <emphasis role="preprocessor">#else&#x240D;</emphasis>
04118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;wbuff,&#32;wcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fit&#32;data&#32;to&#32;the&#32;sector&#32;*/</emphasis>
04119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
04120 <emphasis role="preprocessor">#endif&#x240D;</emphasis>
04121 &#32;&#32;&#32;&#32;}
04122 
04123 &#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;change&#32;flag&#32;*/</emphasis>
04124 
04125 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
04126 }
</programlisting></section>
<anchor xml:id="_ff_8h_1af58b536abfd30f77213f4ecaf2ac52f5"/><section>
    <title>get_fattime()</title>
<indexterm><primary>get_fattime</primary><secondary>ff.h</secondary></indexterm>
<indexterm><primary>ff.h</primary><secondary>get_fattime</secondary></indexterm>
<para><computeroutput><link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link> get_fattime (void )</computeroutput></para><para>
Definition at line <link linkend="_fat_8c_source_1l00182">182</link> of file <link linkend="_fat_8c_source">fat.c</link>.</para>
<programlisting linenumbering="unnumbered">00182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
00183 &#32;&#32;&#32;&#32;time_t&#32;rawtime;
00184 &#32;&#32;&#32;&#32;time(&amp;rawtime);
00185 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>tm&#32;*ptm&#32;=&#32;localtime(&amp;rawtime);
00186 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ptm-&gt;tm_year&#32;-&#32;80)&#32;&lt;&lt;&#32;25
00187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;|&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ptm-&gt;tm_mon&#32;+&#32;1)&#32;&lt;&lt;&#32;21
00188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;|&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ptm-&gt;tm_mday)&#32;&lt;&lt;&#32;16
00189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;|&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ptm-&gt;tm_hour)&#32;&lt;&lt;&#32;11
00190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;|&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ptm-&gt;tm_min)&#32;&lt;&lt;&#32;5
00191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;|&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ptm-&gt;tm_sec&#32;/&#32;2);
00192 }
</programlisting></section>
</section>
</section>
