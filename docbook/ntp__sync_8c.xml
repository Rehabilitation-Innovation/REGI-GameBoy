<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_ntp__sync_8c" xml:lang="en-US">
<title>lib/pico-vfs-REGI-Local/examples/elastic_mqtt_client/ntp_sync.c File Reference</title>
<indexterm><primary>lib/pico-vfs-REGI-Local/examples/elastic_mqtt_client/ntp_sync.c</primary></indexterm>
<programlisting linenumbering="unnumbered">#include &lt;hardware/rtc.h&gt;<?linebreak?>#include &lt;lwip/apps/sntp.h&gt;<?linebreak?>#include &lt;pico/cyw43_arch.h&gt;<?linebreak?>#include &lt;pico/stdlib.h&gt;<?linebreak?>#include &lt;stdint.h&gt;<?linebreak?></programlisting><simplesect>
    <title>Macros    </title>
        <itemizedlist>
            <listitem><para>#define <link linkend="_ntp__sync_8c_1a751e3f85cd240e89d390d18996089cd0">NTP_SERVER</link>&#160;&#160;&#160;&quot;pool.ntp.org&quot;</para>
</listitem>
        </itemizedlist>
</simplesect>
<simplesect>
    <title>Functions    </title>
        <itemizedlist>
            <listitem><para>bool <link linkend="_ntp__sync_8c_1afe77477eb61cb1a9294020c022edabc5">ntp_sync</link> ()</para>
</listitem>
            <listitem><para>void <link linkend="_ntp__sync_8c_1a46f1c418d0f05268d7a0ebc8ce25d07c">set_system_time</link> (uint32_t sec)</para>
</listitem>
            <listitem><para>const char * <link linkend="_ntp__sync_8c_1a5fabcd416198038418e923db9259b7ff">get_timestamp</link> ()</para>
</listitem>
        </itemizedlist>
</simplesect>
<section>
<title>Macro Definition Documentation</title>
<anchor xml:id="_ntp__sync_8c_1a751e3f85cd240e89d390d18996089cd0"/><section>
    <title>NTP_SERVER</title>
<indexterm><primary>NTP_SERVER</primary><secondary>ntp_sync.c</secondary></indexterm>
<indexterm><primary>ntp_sync.c</primary><secondary>NTP_SERVER</secondary></indexterm>
<para><computeroutput>#define NTP_SERVER&#160;&#160;&#160;&quot;pool.ntp.org&quot;</computeroutput></para><para>
Definition at line <link linkend="_ntp__sync_8c_source_1l00012">12</link> of file <link linkend="_ntp__sync_8c_source">ntp_sync.c</link>.</para>
</section>
</section>
<section>
<title>Function Documentation</title>
<anchor xml:id="_ntp__sync_8c_1a5fabcd416198038418e923db9259b7ff"/><section>
    <title>get_timestamp()</title>
<indexterm><primary>get_timestamp</primary><secondary>ntp_sync.c</secondary></indexterm>
<indexterm><primary>ntp_sync.c</primary><secondary>get_timestamp</secondary></indexterm>
<para><computeroutput>const char * get_timestamp (void )</computeroutput></para><para>
Definition at line <link linkend="_ntp__sync_8c_source_1l00046">46</link> of file <link linkend="_ntp__sync_8c_source">ntp_sync.c</link>.</para>
<programlisting linenumbering="unnumbered">00046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
00047 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;buffer[30];
00048 &#32;&#32;&#32;&#32;time_t&#32;now&#32;=&#32;time(NULL);
00049 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>tm&#32;*<link linkend="__dino_game_8cpp_1a87accd1af8e0aff4b818d891374f7cec">t</link>&#32;=&#32;gmtime(&amp;now);
00050 &#32;&#32;&#32;&#32;strftime(buffer,&#32;<emphasis role="keyword">sizeof</emphasis>(buffer),&#32;<emphasis role="stringliteral">&quot;%Y-%m-%d&#32;%H:%M:%S&quot;</emphasis>,&#32;<link linkend="__dino_game_8cpp_1a87accd1af8e0aff4b818d891374f7cec">t</link>);
00051 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;buffer;
00052 }
</programlisting></section>
<anchor xml:id="_ntp__sync_8c_1afe77477eb61cb1a9294020c022edabc5"/><section>
    <title>ntp_sync()</title>
<indexterm><primary>ntp_sync</primary><secondary>ntp_sync.c</secondary></indexterm>
<indexterm><primary>ntp_sync.c</primary><secondary>ntp_sync</secondary></indexterm>
<para><computeroutput>bool ntp_sync (void )</computeroutput></para><para>
Definition at line <link linkend="_ntp__sync_8c_source_1l00014">14</link> of file <link linkend="_ntp__sync_8c_source">ntp_sync.c</link>.</para>
<programlisting linenumbering="unnumbered">00014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
00015 &#32;&#32;&#32;&#32;sntp_setoperatingmode(SNTP_OPMODE_POLL);
00016 &#32;&#32;&#32;&#32;sntp_setservername(0,&#32;<link linkend="_ntp__sync_8c_1a751e3f85cd240e89d390d18996089cd0">NTP_SERVER</link>);
00017 &#32;&#32;&#32;&#32;sntp_init();
00018 
00019 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(<emphasis role="keywordtype">int</emphasis>&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;20;&#32;i++)&#32;{
00020 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sntp_getreachability(0))&#32;{
00021 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keyword">true</emphasis>;
00022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
00023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sleep_ms(1000);
00024 &#32;&#32;&#32;&#32;}
00025 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<emphasis role="keyword">false</emphasis>;
00026 }
</programlisting></section>
<anchor xml:id="_ntp__sync_8c_1a46f1c418d0f05268d7a0ebc8ce25d07c"/><section>
    <title>set_system_time()</title>
<indexterm><primary>set_system_time</primary><secondary>ntp_sync.c</secondary></indexterm>
<indexterm><primary>ntp_sync.c</primary><secondary>set_system_time</secondary></indexterm>
<para><computeroutput>void set_system_time (uint32_t sec)</computeroutput></para><para>
Definition at line <link linkend="_ntp__sync_8c_source_1l00028">28</link> of file <link linkend="_ntp__sync_8c_source">ntp_sync.c</link>.</para>
<programlisting linenumbering="unnumbered">00028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
00029 &#32;&#32;&#32;&#32;time_t&#32;epoch&#32;=&#32;sec;
00030 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>tm&#32;*time&#32;=&#32;gmtime(&amp;epoch);
00031 &#32;&#32;&#32;&#32;datetime_t&#32;dt&#32;=&#32;{
00032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.year&#32;=&#32;(int16_t)&#32;(1900&#32;+&#32;time-&gt;tm_year),
00033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.month&#32;=&#32;(int8_t)&#32;(time-&gt;tm_mon&#32;+&#32;1),
00034 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.day&#32;=&#32;(int8_t)&#32;time-&gt;tm_mday,
00035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.hour&#32;=&#32;(int8_t)&#32;time-&gt;tm_hour,
00036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.min&#32;=&#32;(int8_t)&#32;time-&gt;tm_min,
00037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.sec&#32;=&#32;(int8_t)&#32;time-&gt;tm_sec,
00038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.dotw&#32;=&#32;(int8_t)&#32;time-&gt;tm_wday,
00039 &#32;&#32;&#32;&#32;};
00040 
00041 &#32;&#32;&#32;&#32;rtc_set_datetime(&amp;dt);
00042 &#32;&#32;&#32;&#32;<emphasis role="keyword">struct&#32;</emphasis>timeval&#32;tv&#32;=&#32;{.tv_sec&#32;=&#32;mktime(time)};
00043 &#32;&#32;&#32;&#32;settimeofday(&amp;tv,&#32;NULL);
00044 }
</programlisting></section>
</section>
</section>
