<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_ff_8c_source" xml:lang="en-US">
<title>ff.c</title>
<indexterm><primary>lib/pico-vfs-REGI-Local/vendor/ff15/source/ff.c</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_ff_8c_source_1l00001"/>00001 <emphasis role="comment">/*----------------------------------------------------------------------------/</emphasis>
<anchor xml:id="_ff_8c_source_1l00002"/>00002 <emphasis role="comment">/&#32;&#32;FatFs&#32;-&#32;Generic&#32;FAT&#32;Filesystem&#32;Module&#32;&#32;R0.15&#32;w/patch1&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;/</emphasis>
<anchor xml:id="_ff_8c_source_1l00003"/>00003 <emphasis role="comment">/-----------------------------------------------------------------------------/</emphasis>
<anchor xml:id="_ff_8c_source_1l00004"/>00004 <emphasis role="comment">/</emphasis>
<anchor xml:id="_ff_8c_source_1l00005"/>00005 <emphasis role="comment">/&#32;Copyright&#32;(C)&#32;2022,&#32;ChaN,&#32;all&#32;right&#32;reserved.</emphasis>
<anchor xml:id="_ff_8c_source_1l00006"/>00006 <emphasis role="comment">/</emphasis>
<anchor xml:id="_ff_8c_source_1l00007"/>00007 <emphasis role="comment">/&#32;FatFs&#32;module&#32;is&#32;an&#32;open&#32;source&#32;software.&#32;Redistribution&#32;and&#32;use&#32;of&#32;FatFs&#32;in</emphasis>
<anchor xml:id="_ff_8c_source_1l00008"/>00008 <emphasis role="comment">/&#32;source&#32;and&#32;binary&#32;forms,&#32;with&#32;or&#32;without&#32;modification,&#32;are&#32;permitted&#32;provided</emphasis>
<anchor xml:id="_ff_8c_source_1l00009"/>00009 <emphasis role="comment">/&#32;that&#32;the&#32;following&#32;condition&#32;is&#32;met:</emphasis>
<anchor xml:id="_ff_8c_source_1l00010"/>00010 <emphasis role="comment">/</emphasis>
<anchor xml:id="_ff_8c_source_1l00011"/>00011 <emphasis role="comment">/&#32;1.&#32;Redistributions&#32;of&#32;source&#32;code&#32;must&#32;retain&#32;the&#32;above&#32;copyright&#32;notice,</emphasis>
<anchor xml:id="_ff_8c_source_1l00012"/>00012 <emphasis role="comment">/&#32;&#32;&#32;&#32;this&#32;condition&#32;and&#32;the&#32;following&#32;disclaimer.</emphasis>
<anchor xml:id="_ff_8c_source_1l00013"/>00013 <emphasis role="comment">/</emphasis>
<anchor xml:id="_ff_8c_source_1l00014"/>00014 <emphasis role="comment">/&#32;This&#32;software&#32;is&#32;provided&#32;by&#32;the&#32;copyright&#32;holder&#32;and&#32;contributors&#32;&quot;AS&#32;IS&quot;</emphasis>
<anchor xml:id="_ff_8c_source_1l00015"/>00015 <emphasis role="comment">/&#32;and&#32;any&#32;warranties&#32;related&#32;to&#32;this&#32;software&#32;are&#32;DISCLAIMED.</emphasis>
<anchor xml:id="_ff_8c_source_1l00016"/>00016 <emphasis role="comment">/&#32;The&#32;copyright&#32;owner&#32;or&#32;contributors&#32;be&#32;NOT&#32;LIABLE&#32;for&#32;any&#32;damages&#32;caused</emphasis>
<anchor xml:id="_ff_8c_source_1l00017"/>00017 <emphasis role="comment">/&#32;by&#32;use&#32;of&#32;this&#32;software.</emphasis>
<anchor xml:id="_ff_8c_source_1l00018"/>00018 <emphasis role="comment">/</emphasis>
<anchor xml:id="_ff_8c_source_1l00019"/>00019 <emphasis role="comment">/----------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00020"/>00020 
<anchor xml:id="_ff_8c_source_1l00021"/>00021 
<anchor xml:id="_ff_8c_source_1l00022"/>00022 <emphasis role="preprocessor">#include&#32;&lt;string.h&gt;</emphasis>
<anchor xml:id="_ff_8c_source_1l00023"/>00023 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_ff_8h">ff.h</link>&quot;</emphasis>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Declarations&#32;of&#32;FatFs&#32;API&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00024"/>00024 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_diskio_8h">diskio.h</link>&quot;</emphasis>&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Declarations&#32;of&#32;device&#32;I/O&#32;functions&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00025"/>00025 
<anchor xml:id="_ff_8c_source_1l00026"/>00026 
<anchor xml:id="_ff_8c_source_1l00027"/>00027 <emphasis role="comment">/*--------------------------------------------------------------------------</emphasis>
<anchor xml:id="_ff_8c_source_1l00028"/>00028 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l00029"/>00029 <emphasis role="comment">&#32;&#32;&#32;Module&#32;Private&#32;Definitions</emphasis>
<anchor xml:id="_ff_8c_source_1l00030"/>00030 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l00031"/>00031 <emphasis role="comment">---------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00032"/>00032 
<anchor xml:id="_ff_8c_source_1l00033"/>00033 <emphasis role="preprocessor">#if&#32;FF_DEFINED&#32;!=&#32;80286&#32;</emphasis><emphasis role="comment">/*&#32;Revision&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00034"/>00034 <emphasis role="preprocessor">#error&#32;Wrong&#32;include&#32;file&#32;(ff.h).</emphasis>
<anchor xml:id="_ff_8c_source_1l00035"/>00035 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00036"/>00036 
<anchor xml:id="_ff_8c_source_1l00037"/>00037 
<anchor xml:id="_ff_8c_source_1l00038"/>00038 <emphasis role="comment">/*&#32;Limits&#32;and&#32;boundaries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00039"/><link linkend="_ff_8c_1a556a1452c85d74c908fe071754ce4a71">00039</link> <emphasis role="preprocessor">#define&#32;MAX_DIR&#32;&#32;&#32;&#32;&#32;0x200000&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Max&#32;size&#32;of&#32;FAT&#32;directory&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00040"/><link linkend="_ff_8c_1aeac7903cb4fde8e45722fca3244257e7">00040</link> <emphasis role="preprocessor">#define&#32;MAX_DIR_EX&#32;&#32;0x10000000&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Max&#32;size&#32;of&#32;exFAT&#32;directory&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00041"/><link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">00041</link> <emphasis role="preprocessor">#define&#32;MAX_FAT12&#32;&#32;&#32;0xFF5&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Max&#32;FAT12&#32;clusters&#32;(differs&#32;from&#32;specs,&#32;but&#32;right&#32;for&#32;real&#32;DOS/Windows&#32;behavior)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00042"/><link linkend="_ff_8c_1a259e5a1973d5209304482a5bcd89372f">00042</link> <emphasis role="preprocessor">#define&#32;MAX_FAT16&#32;&#32;&#32;0xFFF5&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Max&#32;FAT16&#32;clusters&#32;(differs&#32;from&#32;specs,&#32;but&#32;right&#32;for&#32;real&#32;DOS/Windows&#32;behavior)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00043"/><link linkend="_ff_8c_1a40e7471b7ae3620a0419aa4d8d6dc684">00043</link> <emphasis role="preprocessor">#define&#32;MAX_FAT32&#32;&#32;&#32;0x0FFFFFF5&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Max&#32;FAT32&#32;clusters&#32;(not&#32;specified,&#32;practical&#32;limit)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00044"/><link linkend="_ff_8c_1ad7bea1c4a86cb654807e6da0370cb694">00044</link> <emphasis role="preprocessor">#define&#32;MAX_EXFAT&#32;&#32;&#32;0x7FFFFFFD&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Max&#32;exFAT&#32;clusters&#32;(differs&#32;from&#32;specs,&#32;implementation&#32;limit)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00045"/>00045 
<anchor xml:id="_ff_8c_source_1l00046"/>00046 
<anchor xml:id="_ff_8c_source_1l00047"/>00047 <emphasis role="comment">/*&#32;Character&#32;code&#32;support&#32;macros&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00048"/><link linkend="_ff_8c_1a89b2514198590e139dd064c5d534f302">00048</link> <emphasis role="preprocessor">#define&#32;IsUpper(c)&#32;&#32;&#32;&#32;&#32;&#32;((c)&#32;&gt;=&#32;&apos;A&apos;&#32;&amp;&amp;&#32;(c)&#32;&lt;=&#32;&apos;Z&apos;)</emphasis>
<anchor xml:id="_ff_8c_source_1l00049"/><link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">00049</link> <emphasis role="preprocessor">#define&#32;IsLower(c)&#32;&#32;&#32;&#32;&#32;&#32;((c)&#32;&gt;=&#32;&apos;a&apos;&#32;&amp;&amp;&#32;(c)&#32;&lt;=&#32;&apos;z&apos;)</emphasis>
<anchor xml:id="_ff_8c_source_1l00050"/><link linkend="_ff_8c_1a65dee564f69f2ec27f25b67a348018b9">00050</link> <emphasis role="preprocessor">#define&#32;IsDigit(c)&#32;&#32;&#32;&#32;&#32;&#32;((c)&#32;&gt;=&#32;&apos;0&apos;&#32;&amp;&amp;&#32;(c)&#32;&lt;=&#32;&apos;9&apos;)</emphasis>
<anchor xml:id="_ff_8c_source_1l00051"/><link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">00051</link> <emphasis role="preprocessor">#define&#32;IsSeparator(c)&#32;&#32;((c)&#32;==&#32;&apos;/&apos;&#32;||&#32;(c)&#32;==&#32;&apos;\\&apos;)</emphasis>
<anchor xml:id="_ff_8c_source_1l00052"/><link linkend="_ff_8c_1a4f1355f5f96b054e17ef5883ab29863e">00052</link> <emphasis role="preprocessor">#define&#32;IsTerminator(c)&#32;((UINT)(c)&#32;&lt;&#32;(FF_USE_LFN&#32;?&#32;&apos;&#32;&apos;&#32;:&#32;&apos;!&apos;))</emphasis>
<anchor xml:id="_ff_8c_source_1l00053"/><link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">00053</link> <emphasis role="preprocessor">#define&#32;IsSurrogate(c)&#32;&#32;((c)&#32;&gt;=&#32;0xD800&#32;&amp;&amp;&#32;(c)&#32;&lt;=&#32;0xDFFF)</emphasis>
<anchor xml:id="_ff_8c_source_1l00054"/><link linkend="_ff_8c_1ad148073d4a74bdff0f86f2b18284b569">00054</link> <emphasis role="preprocessor">#define&#32;IsSurrogateH(c)&#32;((c)&#32;&gt;=&#32;0xD800&#32;&amp;&amp;&#32;(c)&#32;&lt;=&#32;0xDBFF)</emphasis>
<anchor xml:id="_ff_8c_source_1l00055"/><link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">00055</link> <emphasis role="preprocessor">#define&#32;IsSurrogateL(c)&#32;((c)&#32;&gt;=&#32;0xDC00&#32;&amp;&amp;&#32;(c)&#32;&lt;=&#32;0xDFFF)</emphasis>
<anchor xml:id="_ff_8c_source_1l00056"/>00056 
<anchor xml:id="_ff_8c_source_1l00057"/>00057 
<anchor xml:id="_ff_8c_source_1l00058"/>00058 <emphasis role="comment">/*&#32;Additional&#32;file&#32;access&#32;control&#32;and&#32;file&#32;status&#32;flags&#32;for&#32;internal&#32;use&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00059"/><link linkend="_ff_8c_1ad4d0d6afc5e28678b87a1b75b6645f7d">00059</link> <emphasis role="preprocessor">#define&#32;FA_SEEKEND&#32;&#32;0x20&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Seek&#32;to&#32;end&#32;of&#32;the&#32;file&#32;on&#32;file&#32;open&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00060"/><link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">00060</link> <emphasis role="preprocessor">#define&#32;FA_MODIFIED&#32;0x40&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;File&#32;has&#32;been&#32;modified&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00061"/><link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">00061</link> <emphasis role="preprocessor">#define&#32;FA_DIRTY&#32;&#32;&#32;&#32;0x80&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FIL.buf[]&#32;needs&#32;to&#32;be&#32;written-back&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00062"/>00062 
<anchor xml:id="_ff_8c_source_1l00063"/>00063 
<anchor xml:id="_ff_8c_source_1l00064"/>00064 <emphasis role="comment">/*&#32;Additional&#32;file&#32;attribute&#32;bits&#32;for&#32;internal&#32;use&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00065"/><link linkend="_ff_8c_1a5cfae62dabae0a54809e43b36685ce7c">00065</link> <emphasis role="preprocessor">#define&#32;AM_VOL&#32;&#32;&#32;&#32;&#32;&#32;0x08&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;label&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00066"/><link linkend="_ff_8c_1a91161ef62e0e85ba3c2876d3d339473d">00066</link> <emphasis role="preprocessor">#define&#32;AM_LFN&#32;&#32;&#32;&#32;&#32;&#32;0x0F&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;entry&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00067"/><link linkend="_ff_8c_1aefa78fd6b130faaca4e115602869b57c">00067</link> <emphasis role="preprocessor">#define&#32;AM_MASK&#32;&#32;&#32;&#32;&#32;0x3F&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Mask&#32;of&#32;defined&#32;bits&#32;in&#32;FAT&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00068"/><link linkend="_ff_8c_1a97c7440ecac113384e04b26a5518a895">00068</link> <emphasis role="preprocessor">#define&#32;AM_MASKX&#32;&#32;&#32;&#32;0x37&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Mask&#32;of&#32;defined&#32;bits&#32;in&#32;exFAT&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00069"/>00069 
<anchor xml:id="_ff_8c_source_1l00070"/>00070 
<anchor xml:id="_ff_8c_source_1l00071"/>00071 <emphasis role="comment">/*&#32;Name&#32;status&#32;flags&#32;in&#32;fn[11]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00072"/><link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">00072</link> <emphasis role="preprocessor">#define&#32;NSFLAG&#32;&#32;&#32;&#32;&#32;&#32;11&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Index&#32;of&#32;the&#32;name&#32;status&#32;byte&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00073"/><link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">00073</link> <emphasis role="preprocessor">#define&#32;NS_LOSS&#32;&#32;&#32;&#32;&#32;0x01&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Out&#32;of&#32;8.3&#32;format&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00074"/><link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">00074</link> <emphasis role="preprocessor">#define&#32;NS_LFN&#32;&#32;&#32;&#32;&#32;&#32;0x02&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Force&#32;to&#32;create&#32;LFN&#32;entry&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00075"/><link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">00075</link> <emphasis role="preprocessor">#define&#32;NS_LAST&#32;&#32;&#32;&#32;&#32;0x04&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Last&#32;segment&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00076"/><link linkend="_ff_8c_1a4a0e89b504dece19e2e4b02c83782ca2">00076</link> <emphasis role="preprocessor">#define&#32;NS_BODY&#32;&#32;&#32;&#32;&#32;0x08&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Lower&#32;case&#32;flag&#32;(body)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00077"/><link linkend="_ff_8c_1a3b7fad0942e816fdb84d869c1f7a613e">00077</link> <emphasis role="preprocessor">#define&#32;NS_EXT&#32;&#32;&#32;&#32;&#32;&#32;0x10&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Lower&#32;case&#32;flag&#32;(ext)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00078"/><link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">00078</link> <emphasis role="preprocessor">#define&#32;NS_DOT&#32;&#32;&#32;&#32;&#32;&#32;0x20&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Dot&#32;entry&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00079"/><link linkend="_ff_8c_1a4355b699eba89ff8a3615ef62128caff">00079</link> <emphasis role="preprocessor">#define&#32;NS_NOLFN&#32;&#32;&#32;&#32;0x40&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Do&#32;not&#32;find&#32;LFN&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00080"/><link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">00080</link> <emphasis role="preprocessor">#define&#32;NS_NONAME&#32;&#32;&#32;0x80&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Not&#32;followed&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00081"/>00081 
<anchor xml:id="_ff_8c_source_1l00082"/>00082 
<anchor xml:id="_ff_8c_source_1l00083"/>00083 <emphasis role="comment">/*&#32;exFAT&#32;directory&#32;entry&#32;types&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00084"/><link linkend="_ff_8c_1ab9becfd202f51394d189dffe291a5959">00084</link> <emphasis role="preprocessor">#define&#32;ET_BITMAP&#32;&#32;&#32;0x81&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Allocation&#32;bitmap&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00085"/><link linkend="_ff_8c_1a25a8a4c5eb49dc0d306d0fa6011cd9af">00085</link> <emphasis role="preprocessor">#define&#32;ET_UPCASE&#32;&#32;&#32;0x82&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Up-case&#32;table&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00086"/><link linkend="_ff_8c_1a9c991beac4793083d6bd370735bcb9c6">00086</link> <emphasis role="preprocessor">#define&#32;ET_VLABEL&#32;&#32;&#32;0x83&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;label&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00087"/><link linkend="_ff_8c_1a4b213905cd7d1c590f56a8244abc3479">00087</link> <emphasis role="preprocessor">#define&#32;ET_FILEDIR&#32;&#32;0x85&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;File&#32;and&#32;directory&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00088"/><link linkend="_ff_8c_1a1166d46cb68eb191dd4991829aab3cf9">00088</link> <emphasis role="preprocessor">#define&#32;ET_STREAM&#32;&#32;&#32;0xC0&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Stream&#32;extension&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00089"/><link linkend="_ff_8c_1a7e5707cf4bb01cc3b0c7e438cd4c601c">00089</link> <emphasis role="preprocessor">#define&#32;ET_FILENAME&#32;0xC1&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Name&#32;extension&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00090"/>00090 
<anchor xml:id="_ff_8c_source_1l00091"/>00091 
<anchor xml:id="_ff_8c_source_1l00092"/>00092 <emphasis role="comment">/*&#32;FatFs&#32;refers&#32;the&#32;FAT&#32;structure&#32;as&#32;simple&#32;byte&#32;array&#32;instead&#32;of&#32;structure&#32;member</emphasis>
<anchor xml:id="_ff_8c_source_1l00093"/>00093 <emphasis role="comment">/&#32;because&#32;the&#32;C&#32;structure&#32;is&#32;not&#32;binary&#32;compatible&#32;between&#32;different&#32;platforms&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00094"/>00094 
<anchor xml:id="_ff_8c_source_1l00095"/><link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">00095</link> <emphasis role="preprocessor">#define&#32;BS_JmpBoot&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;x86&#32;jump&#32;instruction&#32;(3-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00096"/><link linkend="_ff_8c_1a02a76ada191ec2dc5f8af60ff3576da7">00096</link> <emphasis role="preprocessor">#define&#32;BS_OEMName&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;3&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;OEM&#32;name&#32;(8-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00097"/><link linkend="_ff_8c_1a8551844b4eb4e15aecd8cc9aa3585fa2">00097</link> <emphasis role="preprocessor">#define&#32;BPB_BytsPerSec&#32;&#32;&#32;&#32;&#32;&#32;11&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Sector&#32;size&#32;[byte]&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00098"/><link linkend="_ff_8c_1aab78e41c617a14b9540c0563d6b957fa">00098</link> <emphasis role="preprocessor">#define&#32;BPB_SecPerClus&#32;&#32;&#32;&#32;&#32;&#32;13&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Cluster&#32;size&#32;[sector]&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00099"/><link linkend="_ff_8c_1ab3ec444c8457c9bc98aa07e846f5c1b7">00099</link> <emphasis role="preprocessor">#define&#32;BPB_RsvdSecCnt&#32;&#32;&#32;&#32;&#32;&#32;14&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Size&#32;of&#32;reserved&#32;area&#32;[sector]&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00100"/><link linkend="_ff_8c_1af44a1e8c89ec5502595f23496d24cbf1">00100</link> <emphasis role="preprocessor">#define&#32;BPB_NumFATs&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;16&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00101"/><link linkend="_ff_8c_1aaa667f14c87c45dc128f2ab208e92f98">00101</link> <emphasis role="preprocessor">#define&#32;BPB_RootEntCnt&#32;&#32;&#32;&#32;&#32;&#32;17&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Size&#32;of&#32;root&#32;directory&#32;area&#32;for&#32;FAT&#32;[entry]&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00102"/><link linkend="_ff_8c_1a4eb540eecde0f2df26fa8c7969341d68">00102</link> <emphasis role="preprocessor">#define&#32;BPB_TotSec16&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;19&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;size&#32;(16-bit)&#32;[sector]&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00103"/><link linkend="_ff_8c_1a414e054c4b5ea3414ebefa3539e7e554">00103</link> <emphasis role="preprocessor">#define&#32;BPB_Media&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;21&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Media&#32;descriptor&#32;byte&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00104"/><link linkend="_ff_8c_1a60a2f6efeb6a4c7cb2da1e5def6ca43b">00104</link> <emphasis role="preprocessor">#define&#32;BPB_FATSz16&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;22&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT&#32;size&#32;(16-bit)&#32;[sector]&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00105"/><link linkend="_ff_8c_1ac71bb771432ea532bc47713a028ebd76">00105</link> <emphasis role="preprocessor">#define&#32;BPB_SecPerTrk&#32;&#32;&#32;&#32;&#32;&#32;&#32;24&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;per&#32;track&#32;for&#32;int13h&#32;[sector]&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00106"/><link linkend="_ff_8c_1a9c03603c3be34d4c5cc1b481b0bc6774">00106</link> <emphasis role="preprocessor">#define&#32;BPB_NumHeads&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;26&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Number&#32;of&#32;heads&#32;for&#32;int13h&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00107"/><link linkend="_ff_8c_1a449d4ed5c4c8105daf29aad9488277f7">00107</link> <emphasis role="preprocessor">#define&#32;BPB_HiddSec&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;28&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;offset&#32;from&#32;top&#32;of&#32;the&#32;drive&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00108"/><link linkend="_ff_8c_1a7723a9f0da553e8879d60909d85ccb7b">00108</link> <emphasis role="preprocessor">#define&#32;BPB_TotSec32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;32&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;size&#32;(32-bit)&#32;[sector]&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00109"/><link linkend="_ff_8c_1a0c51f7393341b839dfb241c2951f3ef4">00109</link> <emphasis role="preprocessor">#define&#32;BS_DrvNum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;36&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Physical&#32;drive&#32;number&#32;for&#32;int13h&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00110"/><link linkend="_ff_8c_1a97d9de2942e551e182747f3ed01ab5b4">00110</link> <emphasis role="preprocessor">#define&#32;BS_NTres&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;37&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;WindowsNT&#32;error&#32;flag&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00111"/><link linkend="_ff_8c_1a85a92e790602efef4da3a2f141611ce8">00111</link> <emphasis role="preprocessor">#define&#32;BS_BootSig&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;38&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Extended&#32;boot&#32;signature&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00112"/><link linkend="_ff_8c_1a383a71bda500a0fb5a37f4edd785acbf">00112</link> <emphasis role="preprocessor">#define&#32;BS_VolID&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;39&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;serial&#32;number&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00113"/><link linkend="_ff_8c_1a28498ba4b07ff90aaa9628e81fb89d32">00113</link> <emphasis role="preprocessor">#define&#32;BS_VolLab&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;43&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Volume&#32;label&#32;string&#32;(8-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00114"/><link linkend="_ff_8c_1a2264848692d36c1b2499c9b6a10acf75">00114</link> <emphasis role="preprocessor">#define&#32;BS_FilSysType&#32;&#32;&#32;&#32;&#32;&#32;&#32;54&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Filesystem&#32;type&#32;string&#32;(8-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00115"/><link linkend="_ff_8c_1a42b6c0366bbc0ad92da5b4997c052b9a">00115</link> <emphasis role="preprocessor">#define&#32;BS_BootCode&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;62&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Boot&#32;code&#32;(448-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00116"/><link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">00116</link> <emphasis role="preprocessor">#define&#32;BS_55AA&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;510&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Signature&#32;word&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00117"/>00117 
<anchor xml:id="_ff_8c_source_1l00118"/><link linkend="_ff_8c_1a6e6340030dc29e7da2e9f92e472a763d">00118</link> <emphasis role="preprocessor">#define&#32;BPB_FATSz32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;36&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;FAT&#32;size&#32;[sector]&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00119"/><link linkend="_ff_8c_1a25b233cdbcc8c78db0a791be2623d988">00119</link> <emphasis role="preprocessor">#define&#32;BPB_ExtFlags32&#32;&#32;&#32;&#32;&#32;&#32;40&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Extended&#32;flags&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00120"/><link linkend="_ff_8c_1aed6c1d79c193debd85f7dc9afd05eb22">00120</link> <emphasis role="preprocessor">#define&#32;BPB_FSVer32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;42&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Filesystem&#32;version&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00121"/><link linkend="_ff_8c_1a4c99b85429f73c8f6a0ac2bc7a1d81ea">00121</link> <emphasis role="preprocessor">#define&#32;BPB_RootClus32&#32;&#32;&#32;&#32;&#32;&#32;44&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Root&#32;directory&#32;cluster&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00122"/><link linkend="_ff_8c_1a86b761a0ed35d7f6e9774be44482ee5b">00122</link> <emphasis role="preprocessor">#define&#32;BPB_FSInfo32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;48&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Offset&#32;of&#32;FSINFO&#32;sector&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00123"/><link linkend="_ff_8c_1a6fceac966c2f2b277e8f472c5a7de0c7">00123</link> <emphasis role="preprocessor">#define&#32;BPB_BkBootSec32&#32;&#32;&#32;&#32;&#32;50&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Offset&#32;of&#32;backup&#32;boot&#32;sector&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00124"/><link linkend="_ff_8c_1aa670c7b495f5b347c442df67b188c58f">00124</link> <emphasis role="preprocessor">#define&#32;BS_DrvNum32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;64&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Physical&#32;drive&#32;number&#32;for&#32;int13h&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00125"/><link linkend="_ff_8c_1a0970c574d425c190a0d6fc6d40bcd9df">00125</link> <emphasis role="preprocessor">#define&#32;BS_NTres32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;65&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Error&#32;flag&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00126"/><link linkend="_ff_8c_1a59c4b2f802ab4bc9319e5bd840e615b8">00126</link> <emphasis role="preprocessor">#define&#32;BS_BootSig32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;66&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Extended&#32;boot&#32;signature&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00127"/><link linkend="_ff_8c_1abaa3aafdcf5e83f8cb7e2bb373b13525">00127</link> <emphasis role="preprocessor">#define&#32;BS_VolID32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;67&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Volume&#32;serial&#32;number&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00128"/><link linkend="_ff_8c_1a8241a49bce313184a58617ba1ad9e84c">00128</link> <emphasis role="preprocessor">#define&#32;BS_VolLab32&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;71&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Volume&#32;label&#32;string&#32;(8-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00129"/><link linkend="_ff_8c_1a8d8786452966cd0ce579f2575a54a348">00129</link> <emphasis role="preprocessor">#define&#32;BS_FilSysType32&#32;&#32;&#32;&#32;&#32;82&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Filesystem&#32;type&#32;string&#32;(8-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00130"/><link linkend="_ff_8c_1a6df4d5ea8d94280f9dc935cd6995761d">00130</link> <emphasis role="preprocessor">#define&#32;BS_BootCode32&#32;&#32;&#32;&#32;&#32;&#32;&#32;90&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32:&#32;Boot&#32;code&#32;(420-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00131"/>00131 
<anchor xml:id="_ff_8c_source_1l00132"/><link linkend="_ff_8c_1a8b262d23932b103fc341cf6b631539bd">00132</link> <emphasis role="preprocessor">#define&#32;BPB_ZeroedEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;11&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;MBZ&#32;field&#32;(53-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00133"/><link linkend="_ff_8c_1ab09fe2e1cd6205eb848e5fd00374efd4">00133</link> <emphasis role="preprocessor">#define&#32;BPB_VolOfsEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;64&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Volume&#32;offset&#32;from&#32;top&#32;of&#32;the&#32;drive&#32;[sector]&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00134"/><link linkend="_ff_8c_1ac0c21531f17f5690b31622fcf98d3581">00134</link> <emphasis role="preprocessor">#define&#32;BPB_TotSecEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;72&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Volume&#32;size&#32;[sector]&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00135"/><link linkend="_ff_8c_1a12af2061024593ffc7a92daf1c2d3470">00135</link> <emphasis role="preprocessor">#define&#32;BPB_FatOfsEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;80&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;FAT&#32;offset&#32;from&#32;top&#32;of&#32;the&#32;volume&#32;[sector]&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00136"/><link linkend="_ff_8c_1a54579961bdbed995bcb7e077fedff1f4">00136</link> <emphasis role="preprocessor">#define&#32;BPB_FatSzEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;84&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;FAT&#32;size&#32;[sector]&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00137"/><link linkend="_ff_8c_1ad3ab64cc288e66c0643af23094aa9645">00137</link> <emphasis role="preprocessor">#define&#32;BPB_DataOfsEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;88&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Data&#32;offset&#32;from&#32;top&#32;of&#32;the&#32;volume&#32;[sector]&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00138"/><link linkend="_ff_8c_1a5bb065cee85104cbb58390ea9dfa01d8">00138</link> <emphasis role="preprocessor">#define&#32;BPB_NumClusEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;92&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Number&#32;of&#32;clusters&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00139"/><link linkend="_ff_8c_1a8447a1c7d19cab308ab198e1de2e086f">00139</link> <emphasis role="preprocessor">#define&#32;BPB_RootClusEx&#32;&#32;&#32;&#32;&#32;&#32;96&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Root&#32;directory&#32;start&#32;cluster&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00140"/><link linkend="_ff_8c_1a465d34bfcd2bf930e04ae1b379047199">00140</link> <emphasis role="preprocessor">#define&#32;BPB_VolIDEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;100&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Volume&#32;serial&#32;number&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00141"/><link linkend="_ff_8c_1a86f95a0a4b798a61967e086540e6ebd9">00141</link> <emphasis role="preprocessor">#define&#32;BPB_FSVerEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;104&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Filesystem&#32;version&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00142"/><link linkend="_ff_8c_1af7b37995f89d832a47898aa787ecfbc8">00142</link> <emphasis role="preprocessor">#define&#32;BPB_VolFlagEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;106&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Volume&#32;flags&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00143"/><link linkend="_ff_8c_1a3d35e000a1033bb913d3fbc3aa5c68af">00143</link> <emphasis role="preprocessor">#define&#32;BPB_BytsPerSecEx&#32;&#32;&#32;&#32;108&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Log2&#32;of&#32;sector&#32;size&#32;in&#32;unit&#32;of&#32;byte&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00144"/><link linkend="_ff_8c_1a64dfd457aa404e53c16d58a3d249adfe">00144</link> <emphasis role="preprocessor">#define&#32;BPB_SecPerClusEx&#32;&#32;&#32;&#32;109&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Log2&#32;of&#32;cluster&#32;size&#32;in&#32;unit&#32;of&#32;sector&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00145"/><link linkend="_ff_8c_1a20cab50b62fe9cb5a99ce28cb54da60e">00145</link> <emphasis role="preprocessor">#define&#32;BPB_NumFATsEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;110&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Number&#32;of&#32;FATs&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00146"/><link linkend="_ff_8c_1ac926d7c74f368a033dc8240167df9bc0">00146</link> <emphasis role="preprocessor">#define&#32;BPB_DrvNumEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;111&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Physical&#32;drive&#32;number&#32;for&#32;int13h&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00147"/><link linkend="_ff_8c_1a935b5f7cb38489adf96f42775583025b">00147</link> <emphasis role="preprocessor">#define&#32;BPB_PercInUseEx&#32;&#32;&#32;&#32;&#32;112&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Percent&#32;in&#32;use&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00148"/><link linkend="_ff_8c_1a1f1f5c2e566e3d7d226e4b2a7b70ee2d">00148</link> <emphasis role="preprocessor">#define&#32;BPB_RsvdEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;113&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Reserved&#32;(7-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00149"/><link linkend="_ff_8c_1adea4123eb450eb09933fac339b08eeee">00149</link> <emphasis role="preprocessor">#define&#32;BS_BootCodeEx&#32;&#32;&#32;&#32;&#32;&#32;&#32;120&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Boot&#32;code&#32;(390-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00150"/>00150 
<anchor xml:id="_ff_8c_source_1l00151"/><link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">00151</link> <emphasis role="preprocessor">#define&#32;DIR_Name&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Short&#32;file&#32;name&#32;(11-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00152"/><link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">00152</link> <emphasis role="preprocessor">#define&#32;DIR_Attr&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;11&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Attribute&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00153"/><link linkend="_ff_8c_1a87ee1f701c2ab941862e3ce00c1c1e9d">00153</link> <emphasis role="preprocessor">#define&#32;DIR_NTres&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;12&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Lower&#32;case&#32;flag&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00154"/><link linkend="_ff_8c_1af8ddb351ddcaaac5d52923ad442fd8cb">00154</link> <emphasis role="preprocessor">#define&#32;DIR_CrtTime10&#32;&#32;&#32;&#32;&#32;&#32;&#32;13&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Created&#32;time&#32;sub-second&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00155"/><link linkend="_ff_8c_1a47fb1881ea71d860db9b8280564cb4d5">00155</link> <emphasis role="preprocessor">#define&#32;DIR_CrtTime&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;14&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Created&#32;time&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00156"/><link linkend="_ff_8c_1afa0625d73f4683df24345f51e7a43da3">00156</link> <emphasis role="preprocessor">#define&#32;DIR_LstAccDate&#32;&#32;&#32;&#32;&#32;&#32;18&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Last&#32;accessed&#32;date&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00157"/><link linkend="_ff_8c_1a0bc29c3f09e1e9c40c414f7d50d7905c">00157</link> <emphasis role="preprocessor">#define&#32;DIR_FstClusHI&#32;&#32;&#32;&#32;&#32;&#32;&#32;20&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Higher&#32;16-bit&#32;of&#32;first&#32;cluster&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00158"/><link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">00158</link> <emphasis role="preprocessor">#define&#32;DIR_ModTime&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;22&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Modified&#32;time&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00159"/><link linkend="_ff_8c_1aebe0e913bff75a89d38dbcb04baf5dff">00159</link> <emphasis role="preprocessor">#define&#32;DIR_FstClusLO&#32;&#32;&#32;&#32;&#32;&#32;&#32;26&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Lower&#32;16-bit&#32;of&#32;first&#32;cluster&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00160"/><link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">00160</link> <emphasis role="preprocessor">#define&#32;DIR_FileSize&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;28&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;File&#32;size&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00161"/><link linkend="_ff_8c_1a6c97d545619e6586b02b5d4f39f7be25">00161</link> <emphasis role="preprocessor">#define&#32;LDIR_Ord&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN:&#32;LFN&#32;order&#32;and&#32;LLE&#32;flag&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00162"/><link linkend="_ff_8c_1a28dcd75633b49e40b42a31f0cf5f5929">00162</link> <emphasis role="preprocessor">#define&#32;LDIR_Attr&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;11&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN:&#32;LFN&#32;attribute&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00163"/><link linkend="_ff_8c_1acb98a052a9be81564b56854df35480a0">00163</link> <emphasis role="preprocessor">#define&#32;LDIR_Type&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;12&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN:&#32;Entry&#32;type&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00164"/><link linkend="_ff_8c_1ade1d529763d2d097a6d1410956c8a84f">00164</link> <emphasis role="preprocessor">#define&#32;LDIR_Chksum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;13&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN:&#32;Checksum&#32;of&#32;the&#32;SFN&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00165"/><link linkend="_ff_8c_1ad73024151eff6baea94e680f7928969d">00165</link> <emphasis role="preprocessor">#define&#32;LDIR_FstClusLO&#32;&#32;&#32;&#32;&#32;&#32;26&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN:&#32;MBZ&#32;field&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00166"/><link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">00166</link> <emphasis role="preprocessor">#define&#32;XDIR_Type&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Type&#32;of&#32;exFAT&#32;directory&#32;entry&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00167"/><link linkend="_ff_8c_1aac6d45371e0269e7b10c5a08f2f4b422">00167</link> <emphasis role="preprocessor">#define&#32;XDIR_NumLabel&#32;&#32;&#32;&#32;&#32;&#32;&#32;1&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Number&#32;of&#32;volume&#32;label&#32;characters&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00168"/><link linkend="_ff_8c_1ac154e61682dfed7bb071b0926db1efac">00168</link> <emphasis role="preprocessor">#define&#32;XDIR_Label&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;2&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Volume&#32;label&#32;(11-WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00169"/><link linkend="_ff_8c_1a966901795f1a82003139433a0ba318dd">00169</link> <emphasis role="preprocessor">#define&#32;XDIR_CaseSum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;4&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Sum&#32;of&#32;case&#32;conversion&#32;table&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00170"/><link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">00170</link> <emphasis role="preprocessor">#define&#32;XDIR_NumSec&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;1&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Number&#32;of&#32;secondary&#32;entries&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00171"/><link linkend="_ff_8c_1a784a27bba3d35dddeb57d7fa99670b2a">00171</link> <emphasis role="preprocessor">#define&#32;XDIR_SetSum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;2&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Sum&#32;of&#32;the&#32;set&#32;of&#32;directory&#32;entries&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00172"/><link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">00172</link> <emphasis role="preprocessor">#define&#32;XDIR_Attr&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;4&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;File&#32;attribute&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00173"/><link linkend="_ff_8c_1a74046208323ac5e8b5214b05e1a43b87">00173</link> <emphasis role="preprocessor">#define&#32;XDIR_CrtTime&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;8&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Created&#32;time&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00174"/><link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">00174</link> <emphasis role="preprocessor">#define&#32;XDIR_ModTime&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;12&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Modified&#32;time&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00175"/><link linkend="_ff_8c_1af0a826e3f3902172e3ebd5a3132a0153">00175</link> <emphasis role="preprocessor">#define&#32;XDIR_AccTime&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;16&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Last&#32;accessed&#32;time&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00176"/><link linkend="_ff_8c_1a15318ffa52c4e35fdce00a64ab3ccbf9">00176</link> <emphasis role="preprocessor">#define&#32;XDIR_CrtTime10&#32;&#32;&#32;&#32;&#32;&#32;20&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Created&#32;time&#32;subsecond&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00177"/><link linkend="_ff_8c_1a0f63c605687d0ed66c633ba6a10c01e5">00177</link> <emphasis role="preprocessor">#define&#32;XDIR_ModTime10&#32;&#32;&#32;&#32;&#32;&#32;21&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Modified&#32;time&#32;subsecond&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00178"/><link linkend="_ff_8c_1a2358527d5a3665a4ffb363e014ee421b">00178</link> <emphasis role="preprocessor">#define&#32;XDIR_CrtTZ&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;22&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Created&#32;timezone&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00179"/><link linkend="_ff_8c_1abe933d1753a1f0c30a94131e02f23ab5">00179</link> <emphasis role="preprocessor">#define&#32;XDIR_ModTZ&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;23&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Modified&#32;timezone&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00180"/><link linkend="_ff_8c_1ab12e9f890b539722562824d569969959">00180</link> <emphasis role="preprocessor">#define&#32;XDIR_AccTZ&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;24&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Last&#32;accessed&#32;timezone&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00181"/><link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">00181</link> <emphasis role="preprocessor">#define&#32;XDIR_GenFlags&#32;&#32;&#32;&#32;&#32;&#32;&#32;33&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;General&#32;secondary&#32;flags&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00182"/><link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">00182</link> <emphasis role="preprocessor">#define&#32;XDIR_NumName&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;35&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Number&#32;of&#32;file&#32;name&#32;characters&#32;(BYTE)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00183"/><link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">00183</link> <emphasis role="preprocessor">#define&#32;XDIR_NameHash&#32;&#32;&#32;&#32;&#32;&#32;&#32;36&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Hash&#32;of&#32;file&#32;name&#32;(WORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00184"/><link linkend="_ff_8c_1a543e2a11cefac978a0108a7973416d56">00184</link> <emphasis role="preprocessor">#define&#32;XDIR_ValidFileSize&#32;&#32;40&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Valid&#32;file&#32;size&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00185"/><link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">00185</link> <emphasis role="preprocessor">#define&#32;XDIR_FstClus&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;52&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;First&#32;cluster&#32;of&#32;the&#32;file&#32;data&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00186"/><link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">00186</link> <emphasis role="preprocessor">#define&#32;XDIR_FileSize&#32;&#32;&#32;&#32;&#32;&#32;&#32;56&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;File/Directory&#32;size&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00187"/>00187 
<anchor xml:id="_ff_8c_source_1l00188"/><link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">00188</link> <emphasis role="preprocessor">#define&#32;SZDIRE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;32&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Size&#32;of&#32;a&#32;directory&#32;entry&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00189"/><link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">00189</link> <emphasis role="preprocessor">#define&#32;DDEM&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE5&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Deleted&#32;directory&#32;entry&#32;mark&#32;set&#32;to&#32;DIR_Name[0]&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00190"/><link linkend="_ff_8c_1a24b6bc427cbd37fbe76e087f7f188abb">00190</link> <emphasis role="preprocessor">#define&#32;RDDEM&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x05&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Replacement&#32;of&#32;the&#32;character&#32;collides&#32;with&#32;DDEM&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00191"/><link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">00191</link> <emphasis role="preprocessor">#define&#32;LLEF&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x40&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Last&#32;long&#32;entry&#32;flag&#32;in&#32;LDIR_Ord&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00192"/>00192 
<anchor xml:id="_ff_8c_source_1l00193"/><link linkend="_ff_8c_1a318e58c1966aba52b90ab98dcb649883">00193</link> <emphasis role="preprocessor">#define&#32;FSI_LeadSig&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32&#32;FSI:&#32;Leading&#32;signature&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00194"/><link linkend="_ff_8c_1a3bac0e6ff5907873030db1d0a7c4ebef">00194</link> <emphasis role="preprocessor">#define&#32;FSI_StrucSig&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;484&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32&#32;FSI:&#32;Structure&#32;signature&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00195"/><link linkend="_ff_8c_1ab711e50459aba01b11c6b46a7cc1410b">00195</link> <emphasis role="preprocessor">#define&#32;FSI_Free_Count&#32;&#32;&#32;&#32;&#32;&#32;488&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32&#32;FSI:&#32;Number&#32;of&#32;free&#32;clusters&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00196"/><link linkend="_ff_8c_1a320700cedf300c9b418edf56e5e6b086">00196</link> <emphasis role="preprocessor">#define&#32;FSI_Nxt_Free&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;492&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FAT32&#32;FSI:&#32;Last&#32;allocated&#32;cluster&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00197"/>00197 
<anchor xml:id="_ff_8c_source_1l00198"/><link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">00198</link> <emphasis role="preprocessor">#define&#32;MBR_Table&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;446&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR:&#32;Offset&#32;of&#32;partition&#32;table&#32;in&#32;the&#32;MBR&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00199"/><link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">00199</link> <emphasis role="preprocessor">#define&#32;SZ_PTE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;16&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR:&#32;Size&#32;of&#32;a&#32;partition&#32;table&#32;entry&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00200"/><link linkend="_ff_8c_1a74c1bb03f929236b18eb9c4a3df26a8c">00200</link> <emphasis role="preprocessor">#define&#32;PTE_Boot&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;Boot&#32;indicator&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00201"/><link linkend="_ff_8c_1a72ec8d9f48ea97de79e5878dfa593ca3">00201</link> <emphasis role="preprocessor">#define&#32;PTE_StHead&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;1&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;Start&#32;head&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00202"/><link linkend="_ff_8c_1a3fd894243a30fe6253a78fb9221eb5f4">00202</link> <emphasis role="preprocessor">#define&#32;PTE_StSec&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;2&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;Start&#32;sector&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00203"/><link linkend="_ff_8c_1a973d54c6ad9ae5c0b40e1832db4976f9">00203</link> <emphasis role="preprocessor">#define&#32;PTE_StCyl&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;3&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;Start&#32;cylinder&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00204"/><link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">00204</link> <emphasis role="preprocessor">#define&#32;PTE_System&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;4&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;System&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00205"/><link linkend="_ff_8c_1a151137a5b01c29730bbf4ee63c773d12">00205</link> <emphasis role="preprocessor">#define&#32;PTE_EdHead&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;5&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;End&#32;head&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00206"/><link linkend="_ff_8c_1aa3b0eae83b150116114dfa582a297ee9">00206</link> <emphasis role="preprocessor">#define&#32;PTE_EdSec&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;6&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;End&#32;sector&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00207"/><link linkend="_ff_8c_1a0f96bb9d52c3a5bbd489b59772463cab">00207</link> <emphasis role="preprocessor">#define&#32;PTE_EdCyl&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;7&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;End&#32;cylinder&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00208"/><link linkend="_ff_8c_1ae33f69bfe238a35fb3fd1949c4e087da">00208</link> <emphasis role="preprocessor">#define&#32;PTE_StLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;8&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;Start&#32;in&#32;LBA&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00209"/><link linkend="_ff_8c_1a195f11dd0185a4edbe7064ebe40092bc">00209</link> <emphasis role="preprocessor">#define&#32;PTE_SizLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;12&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;MBR&#32;PTE:&#32;Size&#32;in&#32;LBA&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00210"/>00210 
<anchor xml:id="_ff_8c_source_1l00211"/><link linkend="_ff_8c_1afff5a1b885cf62ef3382022e6f2bf5c2">00211</link> <emphasis role="preprocessor">#define&#32;GPTH_Sign&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Signature&#32;(8-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00212"/><link linkend="_ff_8c_1a2da96e2de03ca769426591b23fecdde9">00212</link> <emphasis role="preprocessor">#define&#32;GPTH_Rev&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;8&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Revision&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00213"/><link linkend="_ff_8c_1a58237ab846855bf2b4a0ab750493e8a3">00213</link> <emphasis role="preprocessor">#define&#32;GPTH_Size&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;12&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Header&#32;size&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00214"/><link linkend="_ff_8c_1ac1a4c52079edc7bf25dddc7bf02e1882">00214</link> <emphasis role="preprocessor">#define&#32;GPTH_Bcc&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;16&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Header&#32;BCC&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00215"/><link linkend="_ff_8c_1a985c526784a91120bec12f33f3169408">00215</link> <emphasis role="preprocessor">#define&#32;GPTH_CurLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;24&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;This&#32;header&#32;LBA&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00216"/><link linkend="_ff_8c_1ad65d7cc56b164352a9f487a69e3a1281">00216</link> <emphasis role="preprocessor">#define&#32;GPTH_BakLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;32&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Another&#32;header&#32;LBA&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00217"/><link linkend="_ff_8c_1a14df7c4b0d469d423e2c1b5f4f0ea02d">00217</link> <emphasis role="preprocessor">#define&#32;GPTH_FstLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;40&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;First&#32;LBA&#32;for&#32;partition&#32;data&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00218"/><link linkend="_ff_8c_1adaa930215faa1e6f51430b080130f9e5">00218</link> <emphasis role="preprocessor">#define&#32;GPTH_LstLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;48&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Last&#32;LBA&#32;for&#32;partition&#32;data&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00219"/><link linkend="_ff_8c_1a32df4a198d3dc8acebd987be74c304ee">00219</link> <emphasis role="preprocessor">#define&#32;GPTH_DskGuid&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;56&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Disk&#32;GUID&#32;(16-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00220"/><link linkend="_ff_8c_1acf59802a11562c5dc1f0d99ae5a89946">00220</link> <emphasis role="preprocessor">#define&#32;GPTH_PtOfs&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;72&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Partition&#32;table&#32;LBA&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00221"/><link linkend="_ff_8c_1a950d43a4211a4bdcc19888bfc8fde5f9">00221</link> <emphasis role="preprocessor">#define&#32;GPTH_PtNum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;80&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Number&#32;of&#32;table&#32;entries&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00222"/><link linkend="_ff_8c_1a16b1364aca6d6fc7991516ee883606ff">00222</link> <emphasis role="preprocessor">#define&#32;GPTH_PteSize&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;84&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Size&#32;of&#32;table&#32;entry&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00223"/><link linkend="_ff_8c_1a94ea6178d6f9e74b6b8eb4bb68eb4470">00223</link> <emphasis role="preprocessor">#define&#32;GPTH_PtBcc&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;88&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;HDR:&#32;Partition&#32;table&#32;BCC&#32;(DWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00224"/><link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">00224</link> <emphasis role="preprocessor">#define&#32;SZ_GPTE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;128&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;Size&#32;of&#32;partition&#32;table&#32;entry&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00225"/><link linkend="_ff_8c_1a8e8517c1287b2d9c93d164bccc0133db">00225</link> <emphasis role="preprocessor">#define&#32;GPTE_PtGuid&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;Partition&#32;type&#32;GUID&#32;(16-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00226"/><link linkend="_ff_8c_1a0b89556f11a98b5c3d893d92d7d32334">00226</link> <emphasis role="preprocessor">#define&#32;GPTE_UpGuid&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;16&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;Partition&#32;unique&#32;GUID&#32;(16-byte)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00227"/><link linkend="_ff_8c_1a25029670f9bc74da6eae5001fe4acdb4">00227</link> <emphasis role="preprocessor">#define&#32;GPTE_FstLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;32&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;First&#32;LBA&#32;of&#32;partition&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00228"/><link linkend="_ff_8c_1a4f37e50e5eabcfb8353749dc8b8be4b4">00228</link> <emphasis role="preprocessor">#define&#32;GPTE_LstLba&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;40&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;Last&#32;LBA&#32;of&#32;partition&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00229"/><link linkend="_ff_8c_1ab27c352b8f3ec3f23ad2715630d8ebcd">00229</link> <emphasis role="preprocessor">#define&#32;GPTE_Flags&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;48&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;Partition&#32;flags&#32;(QWORD)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00230"/><link linkend="_ff_8c_1a327bcf9a8000b94be389d8e22f1e3c5e">00230</link> <emphasis role="preprocessor">#define&#32;GPTE_Name&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;56&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;GPT&#32;PTE:&#32;Partition&#32;name&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00231"/>00231 
<anchor xml:id="_ff_8c_source_1l00232"/>00232 
<anchor xml:id="_ff_8c_source_1l00233"/>00233 <emphasis role="comment">/*&#32;Post&#32;process&#32;on&#32;fatal&#32;error&#32;in&#32;the&#32;file&#32;operations&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00234"/><link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">00234</link> <emphasis role="preprocessor">#define&#32;ABORT(fs,&#32;res)&#32;&#32;&#32;&#32;&#32;&#32;{&#32;fp-&gt;err&#32;=&#32;(BYTE)(res);&#32;LEAVE_FF(fs,&#32;res);&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00235"/>00235 
<anchor xml:id="_ff_8c_source_1l00236"/>00236 
<anchor xml:id="_ff_8c_source_1l00237"/>00237 <emphasis role="comment">/*&#32;Re-entrancy&#32;related&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00238"/>00238 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l00239"/>00239 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l00240"/>00240 <emphasis role="preprocessor">#error&#32;Static&#32;LFN&#32;work&#32;area&#32;cannot&#32;be&#32;used&#32;in&#32;thread-safe&#32;configuration</emphasis>
<anchor xml:id="_ff_8c_source_1l00241"/>00241 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00242"/>00242 <emphasis role="preprocessor">#define&#32;LEAVE_FF(fs,&#32;res)&#32;&#32;&#32;{&#32;unlock_volume(fs,&#32;res);&#32;return&#32;res;&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00243"/>00243 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00244"/><link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">00244</link> <emphasis role="preprocessor">#define&#32;LEAVE_FF(fs,&#32;res)&#32;&#32;&#32;return&#32;res</emphasis>
<anchor xml:id="_ff_8c_source_1l00245"/>00245 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00246"/>00246 
<anchor xml:id="_ff_8c_source_1l00247"/>00247 
<anchor xml:id="_ff_8c_source_1l00248"/>00248 <emphasis role="comment">/*&#32;Definitions&#32;of&#32;logical&#32;drive&#32;-&#32;physical&#32;location&#32;conversion&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00249"/>00249 <emphasis role="preprocessor">#if&#32;FF_MULTI_PARTITION</emphasis>
<anchor xml:id="_ff_8c_source_1l00250"/>00250 <emphasis role="preprocessor">#define&#32;LD2PD(vol)&#32;VolToPart[vol].pd&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Get&#32;physical&#32;drive&#32;number&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00251"/>00251 <emphasis role="preprocessor">#define&#32;LD2PT(vol)&#32;VolToPart[vol].pt&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Get&#32;partition&#32;number&#32;(0:auto&#32;search,&#32;1..:forced&#32;partition&#32;number)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00252"/>00252 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00253"/><link linkend="_ff_8c_1a6577ed2f95527745bf4d27c53488b9a7">00253</link> <emphasis role="preprocessor">#define&#32;LD2PD(vol)&#32;(BYTE)(vol)&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Each&#32;logical&#32;drive&#32;is&#32;associated&#32;with&#32;the&#32;same&#32;physical&#32;drive&#32;number&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00254"/><link linkend="_ff_8c_1aadc4a9aefaf2588bdd7565549f5d91e7">00254</link> <emphasis role="preprocessor">#define&#32;LD2PT(vol)&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Auto&#32;partition&#32;search&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00255"/>00255 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00256"/>00256 
<anchor xml:id="_ff_8c_source_1l00257"/>00257 
<anchor xml:id="_ff_8c_source_1l00258"/>00258 <emphasis role="comment">/*&#32;Definitions&#32;of&#32;sector&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00259"/>00259 <emphasis role="preprocessor">#if&#32;(FF_MAX_SS&#32;&lt;&#32;FF_MIN_SS)&#32;||&#32;(FF_MAX_SS&#32;!=&#32;512&#32;&amp;&amp;&#32;FF_MAX_SS&#32;!=&#32;1024&#32;&amp;&amp;&#32;FF_MAX_SS&#32;!=&#32;2048&#32;&amp;&amp;&#32;FF_MAX_SS&#32;!=&#32;4096)&#32;||&#32;(FF_MIN_SS&#32;!=&#32;512&#32;&amp;&amp;&#32;FF_MIN_SS&#32;!=&#32;1024&#32;&amp;&amp;&#32;FF_MIN_SS&#32;!=&#32;2048&#32;&amp;&amp;&#32;FF_MIN_SS&#32;!=&#32;4096)</emphasis>
<anchor xml:id="_ff_8c_source_1l00260"/>00260 <emphasis role="preprocessor">#error&#32;Wrong&#32;sector&#32;size&#32;configuration</emphasis>
<anchor xml:id="_ff_8c_source_1l00261"/>00261 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00262"/>00262 <emphasis role="preprocessor">#if&#32;FF_MAX_SS&#32;==&#32;FF_MIN_SS</emphasis>
<anchor xml:id="_ff_8c_source_1l00263"/>00263 <emphasis role="preprocessor">#define&#32;SS(fs)&#32;&#32;((UINT)FF_MAX_SS)&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Fixed&#32;sector&#32;size&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00264"/>00264 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00265"/><link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">00265</link> <emphasis role="preprocessor">#define&#32;SS(fs)&#32;&#32;((fs)-&gt;ssize)&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Variable&#32;sector&#32;size&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00266"/>00266 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00267"/>00267 
<anchor xml:id="_ff_8c_source_1l00268"/>00268 
<anchor xml:id="_ff_8c_source_1l00269"/>00269 <emphasis role="comment">/*&#32;Timestamp&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00270"/>00270 <emphasis role="preprocessor">#if&#32;FF_FS_NORTC&#32;==&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l00271"/>00271 <emphasis role="preprocessor">#if&#32;FF_NORTC_YEAR&#32;&lt;&#32;1980&#32;||&#32;FF_NORTC_YEAR&#32;&gt;&#32;2107&#32;||&#32;FF_NORTC_MON&#32;&lt;&#32;1&#32;||&#32;FF_NORTC_MON&#32;&gt;&#32;12&#32;||&#32;FF_NORTC_MDAY&#32;&lt;&#32;1&#32;||&#32;FF_NORTC_MDAY&#32;&gt;&#32;31</emphasis>
<anchor xml:id="_ff_8c_source_1l00272"/>00272 <emphasis role="preprocessor">#error&#32;Invalid&#32;FF_FS_NORTC&#32;settings</emphasis>
<anchor xml:id="_ff_8c_source_1l00273"/>00273 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00274"/>00274 <emphasis role="preprocessor">#define&#32;GET_FATTIME()&#32;&#32;&#32;((DWORD)(FF_NORTC_YEAR&#32;-&#32;1980)&#32;&lt;&lt;&#32;25&#32;|&#32;(DWORD)FF_NORTC_MON&#32;&lt;&lt;&#32;21&#32;|&#32;(DWORD)FF_NORTC_MDAY&#32;&lt;&lt;&#32;16)</emphasis>
<anchor xml:id="_ff_8c_source_1l00275"/>00275 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00276"/><link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">00276</link> <emphasis role="preprocessor">#define&#32;GET_FATTIME()&#32;&#32;&#32;get_fattime()</emphasis>
<anchor xml:id="_ff_8c_source_1l00277"/>00277 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00278"/>00278 
<anchor xml:id="_ff_8c_source_1l00279"/>00279 
<anchor xml:id="_ff_8c_source_1l00280"/>00280 <emphasis role="comment">/*&#32;File&#32;lock&#32;controls&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00281"/>00281 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l00282"/>00282 <emphasis role="preprocessor">#if&#32;FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l00283"/>00283 <emphasis role="preprocessor">#error&#32;FF_FS_LOCK&#32;must&#32;be&#32;0&#32;at&#32;read-only&#32;configuration</emphasis>
<anchor xml:id="_ff_8c_source_1l00284"/>00284 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00285"/>00285 <emphasis role="keyword">typedef</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>{
<anchor xml:id="_ff_8c_source_1l00286"/>00286 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;ID&#32;1,&#32;volume&#32;(NULL:blank&#32;entry)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00287"/>00287 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clu;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;ID&#32;2,&#32;containing&#32;directory&#32;(0:root)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00288"/>00288 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ofs;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;ID&#32;3,&#32;offset&#32;in&#32;the&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00289"/>00289 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;ctr;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;open&#32;counter,&#32;0:none,&#32;0x01..0xFF:read&#32;mode&#32;open&#32;count,&#32;0x100:write&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00290"/>00290 }&#32;FILESEM;
<anchor xml:id="_ff_8c_source_1l00291"/>00291 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00292"/>00292 
<anchor xml:id="_ff_8c_source_1l00293"/>00293 
<anchor xml:id="_ff_8c_source_1l00294"/>00294 <emphasis role="comment">/*&#32;SBCS&#32;up-case&#32;tables&#32;(\x80-\xFF)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00295"/><link linkend="_ff_8c_1a2079f038e00e8b606f9393c90d504741">00295</link> <emphasis role="preprocessor">#define&#32;TBL_CT437&#32;&#32;{0x80,0x9A,0x45,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00296"/>00296 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00297"/>00297 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00298"/>00298 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00299"/>00299 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00300"/>00300 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00301"/>00301 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00302"/>00302 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00303"/><link linkend="_ff_8c_1a3e366ee91d633beb55efd063e6b418f5">00303</link> <emphasis role="preprocessor">#define&#32;TBL_CT720&#32;&#32;{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00304"/>00304 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00305"/>00305 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xA0,0xA1,0xA2,0xA3,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00306"/>00306 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00307"/>00307 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00308"/>00308 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00309"/>00309 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00310"/>00310 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00311"/><link linkend="_ff_8c_1a3a91f6a3f799a268afbe851044c0b383">00311</link> <emphasis role="preprocessor">#define&#32;TBL_CT737&#32;&#32;{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00312"/>00312 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0x93,0x94,0x95,0x96,0x97,0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00313"/>00313 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,0x90,0x91,0xAA,0x92,0x93,0x94,0x95,0x96,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00314"/>00314 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00315"/>00315 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00316"/>00316 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00317"/>00317 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x97,0xEA,0xEB,0xEC,0xE4,0xED,0xEE,0xEF,0xF5,0xF0,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00318"/>00318 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00319"/><link linkend="_ff_8c_1a12704299ef30f60f1185542bfa97ca91">00319</link> <emphasis role="preprocessor">#define&#32;TBL_CT771&#32;&#32;{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00320"/>00320 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00321"/>00321 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00322"/>00322 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00323"/>00323 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00324"/>00324 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDC,0xDE,0xDE,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00325"/>00325 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00326"/>00326 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00327"/><link linkend="_ff_8c_1a7cc0395eded166e3d8348ab67ec139c4">00327</link> <emphasis role="preprocessor">#define&#32;TBL_CT775&#32;&#32;{0x80,0x9A,0x91,0xA0,0x8E,0x95,0x8F,0x80,0xAD,0xED,0x8A,0x8A,0xA1,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00328"/>00328 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0xE2,0x99,0x95,0x96,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00329"/>00329 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xA0,0xA1,0xE0,0xA3,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00330"/>00330 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00331"/>00331 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00332"/>00332 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xA5,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00333"/>00333 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE3,0xE8,0xE8,0xEA,0xEA,0xEE,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00334"/>00334 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00335"/><link linkend="_ff_8c_1abb70cf43279200ee2b62d3fd27e6afb8">00335</link> <emphasis role="preprocessor">#define&#32;TBL_CT850&#32;&#32;{0x43,0x55,0x45,0x41,0x41,0x41,0x41,0x43,0x45,0x45,0x45,0x49,0x49,0x49,0x41,0x41,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00336"/>00336 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x45,0x92,0x92,0x4F,0x4F,0x4F,0x55,0x55,0x59,0x4F,0x55,0x4F,0x9C,0x4F,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00337"/>00337 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00338"/>00338 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0x41,0x41,0x41,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00339"/>00339 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0x41,0x41,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00340"/>00340 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD1,0xD1,0x45,0x45,0x45,0x49,0x49,0x49,0x49,0xD9,0xDA,0xDB,0xDC,0xDD,0x49,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00341"/>00341 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x4F,0xE1,0x4F,0x4F,0x4F,0x4F,0xE6,0xE8,0xE8,0x55,0x55,0x55,0x59,0x59,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00342"/>00342 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00343"/><link linkend="_ff_8c_1adc1a9e1b27f3771422ac64db338dd8d2">00343</link> <emphasis role="preprocessor">#define&#32;TBL_CT852&#32;&#32;{0x80,0x9A,0x90,0xB6,0x8E,0xDE,0x8F,0x80,0x9D,0xD3,0x8A,0x8A,0xD7,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00344"/>00344 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x91,0xE2,0x99,0x95,0x95,0x97,0x97,0x99,0x9A,0x9B,0x9B,0x9D,0x9E,0xAC,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00345"/>00345 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB5,0xD6,0xE0,0xE9,0xA4,0xA4,0xA6,0xA6,0xA8,0xA8,0xAA,0x8D,0xAC,0xB8,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00346"/>00346 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBD,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00347"/>00347 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC6,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00348"/>00348 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD1,0xD1,0xD2,0xD3,0xD2,0xD5,0xD6,0xD7,0xB7,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00349"/>00349 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE3,0xD5,0xE6,0xE6,0xE8,0xE9,0xE8,0xEB,0xED,0xED,0xDD,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00350"/>00350 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xEB,0xFC,0xFC,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00351"/><link linkend="_ff_8c_1a17a8a35ea37f5599dbb79713985a343f">00351</link> <emphasis role="preprocessor">#define&#32;TBL_CT855&#32;&#32;{0x81,0x81,0x83,0x83,0x85,0x85,0x87,0x87,0x89,0x89,0x8B,0x8B,0x8D,0x8D,0x8F,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00352"/>00352 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x91,0x91,0x93,0x93,0x95,0x95,0x97,0x97,0x99,0x99,0x9B,0x9B,0x9D,0x9D,0x9F,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00353"/>00353 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xA1,0xA1,0xA3,0xA3,0xA5,0xA5,0xA7,0xA7,0xA9,0xA9,0xAB,0xAB,0xAD,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00354"/>00354 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB6,0xB6,0xB8,0xB8,0xB9,0xBA,0xBB,0xBC,0xBE,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00355"/>00355 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00356"/>00356 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD1,0xD1,0xD3,0xD3,0xD5,0xD5,0xD7,0xD7,0xDD,0xD9,0xDA,0xDB,0xDC,0xDD,0xE0,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00357"/>00357 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE2,0xE2,0xE4,0xE4,0xE6,0xE6,0xE8,0xE8,0xEA,0xEA,0xEC,0xEC,0xEE,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00358"/>00358 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF8,0xFA,0xFA,0xFC,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00359"/><link linkend="_ff_8c_1ac6b3e7939a5a3d45ac6f1d7d15f24822">00359</link> <emphasis role="preprocessor">#define&#32;TBL_CT857&#32;&#32;{0x80,0x9A,0x90,0xB6,0x8E,0xB7,0x8F,0x80,0xD2,0xD3,0xD4,0xD8,0xD7,0x49,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00360"/>00360 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0xE2,0x99,0xE3,0xEA,0xEB,0x98,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9E,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00361"/>00361 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB5,0xD6,0xE0,0xE9,0xA5,0xA5,0xA6,0xA6,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00362"/>00362 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00363"/>00363 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC7,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00364"/>00364 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0x49,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00365"/>00365 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE5,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xDE,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00366"/>00366 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00367"/><link linkend="_ff_8c_1aea035c03068190b9bf80e824b2cfda93">00367</link> <emphasis role="preprocessor">#define&#32;TBL_CT860&#32;&#32;{0x80,0x9A,0x90,0x8F,0x8E,0x91,0x86,0x80,0x89,0x89,0x92,0x8B,0x8C,0x98,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00368"/>00368 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x8C,0x99,0xA9,0x96,0x9D,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00369"/>00369 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x86,0x8B,0x9F,0x96,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00370"/>00370 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00371"/>00371 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00372"/>00372 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00373"/>00373 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00374"/>00374 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00375"/><link linkend="_ff_8c_1afdbdf45ddc573889990eb30bf70a59b6">00375</link> <emphasis role="preprocessor">#define&#32;TBL_CT861&#32;&#32;{0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x8B,0x8B,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00376"/>00376 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0x4F,0x99,0x8D,0x55,0x97,0x97,0x99,0x9A,0x9D,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00377"/>00377 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xA4,0xA5,0xA6,0xA7,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00378"/>00378 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00379"/>00379 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00380"/>00380 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00381"/>00381 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00382"/>00382 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00383"/><link linkend="_ff_8c_1a7e2ecbf1aa017e0fbcc0233469ad1c86">00383</link> <emphasis role="preprocessor">#define&#32;TBL_CT862&#32;&#32;{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00384"/>00384 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00385"/>00385 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00386"/>00386 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00387"/>00387 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00388"/>00388 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00389"/>00389 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00390"/>00390 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00391"/><link linkend="_ff_8c_1ae7986d8f1be641fa513a553ca6ca9d83">00391</link> <emphasis role="preprocessor">#define&#32;TBL_CT863&#32;&#32;{0x43,0x55,0x45,0x41,0x41,0x41,0x86,0x43,0x45,0x45,0x45,0x49,0x49,0x8D,0x41,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00392"/>00392 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x45,0x45,0x45,0x4F,0x45,0x49,0x55,0x55,0x98,0x4F,0x55,0x9B,0x9C,0x55,0x55,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00393"/>00393 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xA0,0xA1,0x4F,0x55,0xA4,0xA5,0xA6,0xA7,0x49,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00394"/>00394 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00395"/>00395 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00396"/>00396 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00397"/>00397 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00398"/>00398 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00399"/><link linkend="_ff_8c_1a5b7151d4a75d72a82f254ab56adceac5">00399</link> <emphasis role="preprocessor">#define&#32;TBL_CT864&#32;&#32;{0x80,0x9A,0x45,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00400"/>00400 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00401"/>00401 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00402"/>00402 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00403"/>00403 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00404"/>00404 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00405"/>00405 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00406"/>00406 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00407"/><link linkend="_ff_8c_1a90580e1098c6ec520b05ae406bbfe7cf">00407</link> <emphasis role="preprocessor">#define&#32;TBL_CT865&#32;&#32;{0x80,0x9A,0x90,0x41,0x8E,0x41,0x8F,0x80,0x45,0x45,0x45,0x49,0x49,0x49,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00408"/>00408 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x92,0x92,0x4F,0x99,0x4F,0x55,0x55,0x59,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00409"/>00409 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x41,0x49,0x4F,0x55,0xA5,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00410"/>00410 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00411"/>00411 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00412"/>00412 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00413"/>00413 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xE0,0xE1,0xE2,0xE3,0xE4,0xE5,0xE6,0xE7,0xE8,0xE9,0xEA,0xEB,0xEC,0xED,0xEE,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00414"/>00414 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xF2,0xF3,0xF4,0xF5,0xF6,0xF7,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00415"/><link linkend="_ff_8c_1a613653d9cce7972729bf5f1a39c7db3c">00415</link> <emphasis role="preprocessor">#define&#32;TBL_CT866&#32;&#32;{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00416"/>00416 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00417"/>00417 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00418"/>00418 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00419"/>00419 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00420"/>00420 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xD6,0xD7,0xD8,0xD9,0xDA,0xDB,0xDC,0xDD,0xDE,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00421"/>00421 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x9B,0x9C,0x9D,0x9E,0x9F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00422"/>00422 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF0,0xF2,0xF2,0xF4,0xF4,0xF6,0xF6,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00423"/><link linkend="_ff_8c_1aa0c4b6d1b444aa99c051639e397ce2b9">00423</link> <emphasis role="preprocessor">#define&#32;TBL_CT869&#32;&#32;{0x80,0x81,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8A,0x8B,0x8C,0x8D,0x8E,0x8F,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00424"/>00424 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x90,0x91,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9A,0x86,0x9C,0x8D,0x8F,0x90,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00425"/>00425 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0x91,0x90,0x92,0x95,0xA4,0xA5,0xA6,0xA7,0xA8,0xA9,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00426"/>00426 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xB0,0xB1,0xB2,0xB3,0xB4,0xB5,0xB6,0xB7,0xB8,0xB9,0xBA,0xBB,0xBC,0xBD,0xBE,0xBF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00427"/>00427 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xC0,0xC1,0xC2,0xC3,0xC4,0xC5,0xC6,0xC7,0xC8,0xC9,0xCA,0xCB,0xCC,0xCD,0xCE,0xCF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00428"/>00428 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xD0,0xD1,0xD2,0xD3,0xD4,0xD5,0xA4,0xA5,0xA6,0xD9,0xDA,0xDB,0xDC,0xA7,0xA8,0xDF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00429"/>00429 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xA9,0xAA,0xAC,0xAD,0xB5,0xB6,0xB7,0xB8,0xBD,0xBE,0xC6,0xC7,0xCF,0xCF,0xD0,0xEF,&#32;\</emphasis>
<anchor xml:id="_ff_8c_source_1l00430"/>00430 <emphasis role="preprocessor">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;0xF0,0xF1,0xD1,0xD2,0xD3,0xF5,0xD4,0xF7,0xF8,0xF9,0xD5,0x96,0x95,0x98,0xFE,0xFF}</emphasis>
<anchor xml:id="_ff_8c_source_1l00431"/>00431 
<anchor xml:id="_ff_8c_source_1l00432"/>00432 
<anchor xml:id="_ff_8c_source_1l00433"/>00433 <emphasis role="comment">/*&#32;DBCS&#32;code&#32;range&#32;|-----&#32;1st&#32;byte&#32;-----|&#32;&#32;|-----------&#32;2nd&#32;byte&#32;-----------|&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00434"/>00434 <emphasis role="comment">/*&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&lt;------&gt;&#32;&#32;&#32;&#32;&lt;------&gt;&#32;&#32;&#32;&#32;&lt;------&gt;&#32;&#32;&#32;&#32;&lt;------&gt;&#32;&#32;&#32;&#32;&lt;------&gt;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00435"/><link linkend="_ff_8c_1aaf2f449c3ebf5ca12827b9eeb5134290">00435</link> <emphasis role="preprocessor">#define&#32;TBL_DC932&#32;{0x81,&#32;0x9F,&#32;0xE0,&#32;0xFC,&#32;0x40,&#32;0x7E,&#32;0x80,&#32;0xFC,&#32;0x00,&#32;0x00}</emphasis>
<anchor xml:id="_ff_8c_source_1l00436"/><link linkend="_ff_8c_1a1e9d0d464e35a432767eaf26e3d0d0f6">00436</link> <emphasis role="preprocessor">#define&#32;TBL_DC936&#32;{0x81,&#32;0xFE,&#32;0x00,&#32;0x00,&#32;0x40,&#32;0x7E,&#32;0x80,&#32;0xFE,&#32;0x00,&#32;0x00}</emphasis>
<anchor xml:id="_ff_8c_source_1l00437"/><link linkend="_ff_8c_1ac48368e0a312bdeaabb949f132758ed0">00437</link> <emphasis role="preprocessor">#define&#32;TBL_DC949&#32;{0x81,&#32;0xFE,&#32;0x00,&#32;0x00,&#32;0x41,&#32;0x5A,&#32;0x61,&#32;0x7A,&#32;0x81,&#32;0xFE}</emphasis>
<anchor xml:id="_ff_8c_source_1l00438"/><link linkend="_ff_8c_1aebba82563d7b04297527becfbae117df">00438</link> <emphasis role="preprocessor">#define&#32;TBL_DC950&#32;{0x81,&#32;0xFE,&#32;0x00,&#32;0x00,&#32;0x40,&#32;0x7E,&#32;0xA1,&#32;0xFE,&#32;0x00,&#32;0x00}</emphasis>
<anchor xml:id="_ff_8c_source_1l00439"/>00439 
<anchor xml:id="_ff_8c_source_1l00440"/>00440 
<anchor xml:id="_ff_8c_source_1l00441"/>00441 <emphasis role="comment">/*&#32;Macros&#32;for&#32;table&#32;definitions&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00442"/><link linkend="_ff_8c_1afd69eeee2e2b9f8359018dfe8d163fd4">00442</link> <emphasis role="preprocessor">#define&#32;MERGE_2STR(a,&#32;b)&#32;a&#32;##&#32;b</emphasis>
<anchor xml:id="_ff_8c_source_1l00443"/><link linkend="_ff_8c_1ac4c5cba43a7d51edd75c267e6046756f">00443</link> <emphasis role="preprocessor">#define&#32;MKCVTBL(hd,&#32;cp)&#32;MERGE_2STR(hd,&#32;cp)</emphasis>
<anchor xml:id="_ff_8c_source_1l00444"/>00444 
<anchor xml:id="_ff_8c_source_1l00445"/>00445 
<anchor xml:id="_ff_8c_source_1l00446"/>00446 
<anchor xml:id="_ff_8c_source_1l00447"/>00447 
<anchor xml:id="_ff_8c_source_1l00448"/>00448 <emphasis role="comment">/*--------------------------------------------------------------------------</emphasis>
<anchor xml:id="_ff_8c_source_1l00449"/>00449 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l00450"/>00450 <emphasis role="comment">&#32;&#32;&#32;Module&#32;Private&#32;Work&#32;Area</emphasis>
<anchor xml:id="_ff_8c_source_1l00451"/>00451 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l00452"/>00452 <emphasis role="comment">---------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00453"/>00453 <emphasis role="comment">/*&#32;Remark:&#32;Variables&#32;defined&#32;here&#32;without&#32;initial&#32;value&#32;shall&#32;be&#32;guaranteed</emphasis>
<anchor xml:id="_ff_8c_source_1l00454"/>00454 <emphasis role="comment">/&#32;&#32;zero/null&#32;at&#32;start-up.&#32;If&#32;not,&#32;the&#32;linker&#32;option&#32;or&#32;start-up&#32;routine&#32;is</emphasis>
<anchor xml:id="_ff_8c_source_1l00455"/>00455 <emphasis role="comment">/&#32;&#32;not&#32;compliance&#32;with&#32;C&#32;standard.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00456"/>00456 
<anchor xml:id="_ff_8c_source_1l00457"/>00457 <emphasis role="comment">/*--------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00458"/>00458 <emphasis role="comment">/*&#32;File/Volume&#32;controls&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00459"/>00459 <emphasis role="comment">/*--------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00460"/>00460 
<anchor xml:id="_ff_8c_source_1l00461"/>00461 <emphasis role="preprocessor">#if&#32;FF_VOLUMES&#32;&lt;&#32;1&#32;||&#32;FF_VOLUMES&#32;&gt;&#32;10</emphasis>
<anchor xml:id="_ff_8c_source_1l00462"/>00462 <emphasis role="preprocessor">#error&#32;Wrong&#32;FF_VOLUMES&#32;setting</emphasis>
<anchor xml:id="_ff_8c_source_1l00463"/>00463 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00464"/>00464 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*FatFs[<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>];&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;filesystem&#32;objects&#32;(logical&#32;drives)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00465"/>00465 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;Fsid;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;mount&#32;ID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00466"/>00466 
<anchor xml:id="_ff_8c_source_1l00467"/>00467 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l00468"/>00468 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;CurrVol;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;drive&#32;set&#32;by&#32;f_chdrive()&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00469"/>00469 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00470"/>00470 
<anchor xml:id="_ff_8c_source_1l00471"/>00471 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l00472"/>00472 <emphasis role="keyword">static</emphasis>&#32;FILESEM&#32;Files[<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>];&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;object&#32;lock&#32;semaphores&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00473"/>00473 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l00474"/>00474 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;SysLock;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;lock&#32;flag&#32;(0:no&#32;mutex,&#32;1:unlocked,&#32;2:locked)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00475"/>00475 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00476"/>00476 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00477"/>00477 
<anchor xml:id="_ff_8c_source_1l00478"/>00478 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID</emphasis>
<anchor xml:id="_ff_8c_source_1l00479"/>00479 <emphasis role="preprocessor">#ifdef&#32;FF_VOLUME_STRS</emphasis>
<anchor xml:id="_ff_8c_source_1l00480"/>00480 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*<emphasis role="keyword">const</emphasis>&#32;VolumeStr[<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>]&#32;=&#32;{<link linkend="_ffconf_8h_1adf45484c0fd7a2ffe8b56f83019317d0">FF_VOLUME_STRS</link>};&#32;&#32;<emphasis role="comment">/*&#32;Pre-defined&#32;volume&#32;ID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00481"/>00481 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00482"/>00482 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00483"/>00483 
<anchor xml:id="_ff_8c_source_1l00484"/>00484 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l00485"/>00485 <emphasis role="preprocessor">#if&#32;FF_MIN_GPT&#32;&gt;&#32;0x100000000</emphasis>
<anchor xml:id="_ff_8c_source_1l00486"/>00486 <emphasis role="preprocessor">#error&#32;Wrong&#32;FF_MIN_GPT&#32;setting</emphasis>
<anchor xml:id="_ff_8c_source_1l00487"/>00487 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00488"/>00488 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;GUID_MS_Basic[16]&#32;=&#32;{0xA2,0xA0,0xD0,0xEB,0xE5,0xB9,0x33,0x44,0x87,0xC0,0x68,0xB6,0xB7,0x26,0x99,0xC7};
<anchor xml:id="_ff_8c_source_1l00489"/>00489 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00490"/>00490 
<anchor xml:id="_ff_8c_source_1l00491"/>00491 
<anchor xml:id="_ff_8c_source_1l00492"/>00492 
<anchor xml:id="_ff_8c_source_1l00493"/>00493 <emphasis role="comment">/*--------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00494"/>00494 <emphasis role="comment">/*&#32;LFN/Directory&#32;working&#32;buffer&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00495"/>00495 <emphasis role="comment">/*--------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00496"/>00496 
<anchor xml:id="_ff_8c_source_1l00497"/>00497 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;0&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Non-LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00498"/>00498 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00499"/>00499 <emphasis role="preprocessor">#error&#32;LFN&#32;must&#32;be&#32;enabled&#32;when&#32;enable&#32;exFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00500"/>00500 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00501"/>00501 <emphasis role="preprocessor">#define&#32;DEF_NAMBUF</emphasis>
<anchor xml:id="_ff_8c_source_1l00502"/>00502 <emphasis role="preprocessor">#define&#32;INIT_NAMBUF(fs)</emphasis>
<anchor xml:id="_ff_8c_source_1l00503"/>00503 <emphasis role="preprocessor">#define&#32;FREE_NAMBUF()</emphasis>
<anchor xml:id="_ff_8c_source_1l00504"/>00504 <emphasis role="preprocessor">#define&#32;LEAVE_MKFS(res)&#32;return&#32;res</emphasis>
<anchor xml:id="_ff_8c_source_1l00505"/>00505 
<anchor xml:id="_ff_8c_source_1l00506"/>00506 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configurations&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00507"/>00507 <emphasis role="preprocessor">#if&#32;FF_MAX_LFN&#32;&lt;&#32;12&#32;||&#32;FF_MAX_LFN&#32;&gt;&#32;255</emphasis>
<anchor xml:id="_ff_8c_source_1l00508"/>00508 <emphasis role="preprocessor">#error&#32;Wrong&#32;setting&#32;of&#32;FF_MAX_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l00509"/>00509 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00510"/>00510 <emphasis role="preprocessor">#if&#32;FF_LFN_BUF&#32;&lt;&#32;FF_SFN_BUF&#32;||&#32;FF_SFN_BUF&#32;&lt;&#32;12</emphasis>
<anchor xml:id="_ff_8c_source_1l00511"/>00511 <emphasis role="preprocessor">#error&#32;Wrong&#32;setting&#32;of&#32;FF_LFN_BUF&#32;or&#32;FF_SFN_BUF</emphasis>
<anchor xml:id="_ff_8c_source_1l00512"/>00512 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00513"/>00513 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;&lt;&#32;0&#32;||&#32;FF_LFN_UNICODE&#32;&gt;&#32;3</emphasis>
<anchor xml:id="_ff_8c_source_1l00514"/>00514 <emphasis role="preprocessor">#error&#32;Wrong&#32;setting&#32;of&#32;FF_LFN_UNICODE</emphasis>
<anchor xml:id="_ff_8c_source_1l00515"/>00515 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00516"/>00516 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;LfnOfs[]&#32;=&#32;{1,3,5,7,9,14,16,18,20,22,24,28,30};&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT:&#32;Offset&#32;of&#32;LFN&#32;characters&#32;in&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00517"/><link linkend="_ff_8c_1a01c7bbfbe635cd0d0ab3e59a3f44dc64">00517</link> <emphasis role="preprocessor">#define&#32;MAXDIRB(nc)&#32;((nc&#32;+&#32;44U)&#32;/&#32;15&#32;*&#32;SZDIRE)&#32;&#32;</emphasis><emphasis role="comment">/*&#32;exFAT:&#32;Size&#32;of&#32;directory&#32;entry&#32;block&#32;scratchpad&#32;buffer&#32;needed&#32;for&#32;the&#32;name&#32;length&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00518"/>00518 
<anchor xml:id="_ff_8c_source_1l00519"/>00519 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;1&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;enabled&#32;with&#32;static&#32;working&#32;buffer&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00520"/>00520 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00521"/>00521 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;DirBuf[<link linkend="_ff_8c_1a01c7bbfbe635cd0d0ab3e59a3f44dc64">MAXDIRB</link>(<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>)];&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;entry&#32;block&#32;scratchpad&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00522"/>00522 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00523"/>00523 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;LfnBuf[<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>&#32;+&#32;1];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00524"/>00524 <emphasis role="preprocessor">#define&#32;DEF_NAMBUF</emphasis>
<anchor xml:id="_ff_8c_source_1l00525"/>00525 <emphasis role="preprocessor">#define&#32;INIT_NAMBUF(fs)</emphasis>
<anchor xml:id="_ff_8c_source_1l00526"/>00526 <emphasis role="preprocessor">#define&#32;FREE_NAMBUF()</emphasis>
<anchor xml:id="_ff_8c_source_1l00527"/>00527 <emphasis role="preprocessor">#define&#32;LEAVE_MKFS(res)&#32;return&#32;res</emphasis>
<anchor xml:id="_ff_8c_source_1l00528"/>00528 
<anchor xml:id="_ff_8c_source_1l00529"/>00529 <emphasis role="preprocessor">#elif&#32;FF_USE_LFN&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;enabled&#32;with&#32;dynamic&#32;working&#32;buffer&#32;on&#32;the&#32;stack&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00530"/>00530 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00531"/>00531 <emphasis role="preprocessor">#define&#32;DEF_NAMBUF&#32;&#32;&#32;&#32;&#32;&#32;WCHAR&#32;lbuf[FF_MAX_LFN+1];&#32;BYTE&#32;dbuf[MAXDIRB(FF_MAX_LFN)];&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;working&#32;buffer&#32;and&#32;directory&#32;entry&#32;block&#32;scratchpad&#32;buffer&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00532"/>00532 <emphasis role="preprocessor">#define&#32;INIT_NAMBUF(fs)&#32;{&#32;(fs)-&gt;lfnbuf&#32;=&#32;lbuf;&#32;(fs)-&gt;dirbuf&#32;=&#32;dbuf;&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00533"/>00533 <emphasis role="preprocessor">#define&#32;FREE_NAMBUF()</emphasis>
<anchor xml:id="_ff_8c_source_1l00534"/>00534 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00535"/>00535 <emphasis role="preprocessor">#define&#32;DEF_NAMBUF&#32;&#32;&#32;&#32;&#32;&#32;WCHAR&#32;lbuf[FF_MAX_LFN+1];&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00536"/>00536 <emphasis role="preprocessor">#define&#32;INIT_NAMBUF(fs)&#32;{&#32;(fs)-&gt;lfnbuf&#32;=&#32;lbuf;&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00537"/>00537 <emphasis role="preprocessor">#define&#32;FREE_NAMBUF()</emphasis>
<anchor xml:id="_ff_8c_source_1l00538"/>00538 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00539"/>00539 <emphasis role="preprocessor">#define&#32;LEAVE_MKFS(res)&#32;return&#32;res</emphasis>
<anchor xml:id="_ff_8c_source_1l00540"/>00540 
<anchor xml:id="_ff_8c_source_1l00541"/>00541 <emphasis role="preprocessor">#elif&#32;FF_USE_LFN&#32;==&#32;3&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;enabled&#32;with&#32;dynamic&#32;working&#32;buffer&#32;on&#32;the&#32;heap&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00542"/>00542 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00543"/><link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">00543</link> <emphasis role="preprocessor">#define&#32;DEF_NAMBUF&#32;&#32;&#32;&#32;&#32;&#32;WCHAR&#32;*lfn;&#32;</emphasis><emphasis role="comment">/*&#32;Pointer&#32;to&#32;LFN&#32;working&#32;buffer&#32;and&#32;directory&#32;entry&#32;block&#32;scratchpad&#32;buffer&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00544"/><link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">00544</link> <emphasis role="preprocessor">#define&#32;INIT_NAMBUF(fs)&#32;{&#32;lfn&#32;=&#32;ff_memalloc((FF_MAX_LFN+1)*2&#32;+&#32;MAXDIRB(FF_MAX_LFN));&#32;if&#32;(!lfn)&#32;LEAVE_FF(fs,&#32;FR_NOT_ENOUGH_CORE);&#32;(fs)-&gt;lfnbuf&#32;=&#32;lfn;&#32;(fs)-&gt;dirbuf&#32;=&#32;(BYTE*)(lfn+FF_MAX_LFN+1);&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00545"/><link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">00545</link> <emphasis role="preprocessor">#define&#32;FREE_NAMBUF()&#32;&#32;&#32;ff_memfree(lfn)</emphasis>
<anchor xml:id="_ff_8c_source_1l00546"/>00546 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00547"/>00547 <emphasis role="preprocessor">#define&#32;DEF_NAMBUF&#32;&#32;&#32;&#32;&#32;&#32;WCHAR&#32;*lfn;&#32;</emphasis><emphasis role="comment">/*&#32;Pointer&#32;to&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00548"/>00548 <emphasis role="preprocessor">#define&#32;INIT_NAMBUF(fs)&#32;{&#32;lfn&#32;=&#32;ff_memalloc((FF_MAX_LFN+1)*2);&#32;if&#32;(!lfn)&#32;LEAVE_FF(fs,&#32;FR_NOT_ENOUGH_CORE);&#32;(fs)-&gt;lfnbuf&#32;=&#32;lfn;&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00549"/>00549 <emphasis role="preprocessor">#define&#32;FREE_NAMBUF()&#32;&#32;&#32;ff_memfree(lfn)</emphasis>
<anchor xml:id="_ff_8c_source_1l00550"/>00550 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00551"/><link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">00551</link> <emphasis role="preprocessor">#define&#32;LEAVE_MKFS(res)&#32;{&#32;if&#32;(!work)&#32;ff_memfree(buf);&#32;return&#32;res;&#32;}</emphasis>
<anchor xml:id="_ff_8c_source_1l00552"/><link linkend="_ff_8c_1aaa791eb9a3f067c6a24c70626bddcc66">00552</link> <emphasis role="preprocessor">#define&#32;MAX_MALLOC&#32;&#32;0x8000&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Must&#32;be&#32;&gt;=FF_MAX_SS&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00553"/>00553 
<anchor xml:id="_ff_8c_source_1l00554"/>00554 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00555"/>00555 <emphasis role="preprocessor">#error&#32;Wrong&#32;setting&#32;of&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l00556"/>00556 
<anchor xml:id="_ff_8c_source_1l00557"/>00557 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;==&#32;1&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00558"/>00558 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;==&#32;0&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00559"/>00559 
<anchor xml:id="_ff_8c_source_1l00560"/>00560 
<anchor xml:id="_ff_8c_source_1l00561"/>00561 
<anchor xml:id="_ff_8c_source_1l00562"/>00562 <emphasis role="comment">/*--------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00563"/>00563 <emphasis role="comment">/*&#32;Code&#32;conversion&#32;tables&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00564"/>00564 <emphasis role="comment">/*--------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00565"/>00565 
<anchor xml:id="_ff_8c_source_1l00566"/>00566 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Run-time&#32;code&#32;page&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00567"/>00567 <emphasis role="preprocessor">#define&#32;CODEPAGE&#32;CodePage</emphasis>
<anchor xml:id="_ff_8c_source_1l00568"/>00568 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;CodePage;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;code&#32;page&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00569"/>00569 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ExCvt;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Ptr&#32;to&#32;SBCS&#32;up-case&#32;table&#32;Ct???[]&#32;(null:not&#32;used)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00570"/>00570 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;DbcTbl;&#32;&#32;<emphasis role="comment">/*&#32;Ptr&#32;to&#32;DBCS&#32;code&#32;range&#32;table&#32;Dc???[]&#32;(null:not&#32;used)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00571"/>00571 
<anchor xml:id="_ff_8c_source_1l00572"/>00572 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct437[]&#32;=&#32;<link linkend="_ff_8c_1a2079f038e00e8b606f9393c90d504741">TBL_CT437</link>;
<anchor xml:id="_ff_8c_source_1l00573"/>00573 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct720[]&#32;=&#32;<link linkend="_ff_8c_1a3e366ee91d633beb55efd063e6b418f5">TBL_CT720</link>;
<anchor xml:id="_ff_8c_source_1l00574"/>00574 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct737[]&#32;=&#32;<link linkend="_ff_8c_1a3a91f6a3f799a268afbe851044c0b383">TBL_CT737</link>;
<anchor xml:id="_ff_8c_source_1l00575"/>00575 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct771[]&#32;=&#32;<link linkend="_ff_8c_1a12704299ef30f60f1185542bfa97ca91">TBL_CT771</link>;
<anchor xml:id="_ff_8c_source_1l00576"/>00576 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct775[]&#32;=&#32;<link linkend="_ff_8c_1a7cc0395eded166e3d8348ab67ec139c4">TBL_CT775</link>;
<anchor xml:id="_ff_8c_source_1l00577"/>00577 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct850[]&#32;=&#32;<link linkend="_ff_8c_1abb70cf43279200ee2b62d3fd27e6afb8">TBL_CT850</link>;
<anchor xml:id="_ff_8c_source_1l00578"/>00578 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct852[]&#32;=&#32;<link linkend="_ff_8c_1adc1a9e1b27f3771422ac64db338dd8d2">TBL_CT852</link>;
<anchor xml:id="_ff_8c_source_1l00579"/>00579 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct855[]&#32;=&#32;<link linkend="_ff_8c_1a17a8a35ea37f5599dbb79713985a343f">TBL_CT855</link>;
<anchor xml:id="_ff_8c_source_1l00580"/>00580 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct857[]&#32;=&#32;<link linkend="_ff_8c_1ac6b3e7939a5a3d45ac6f1d7d15f24822">TBL_CT857</link>;
<anchor xml:id="_ff_8c_source_1l00581"/>00581 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct860[]&#32;=&#32;<link linkend="_ff_8c_1aea035c03068190b9bf80e824b2cfda93">TBL_CT860</link>;
<anchor xml:id="_ff_8c_source_1l00582"/>00582 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct861[]&#32;=&#32;<link linkend="_ff_8c_1afdbdf45ddc573889990eb30bf70a59b6">TBL_CT861</link>;
<anchor xml:id="_ff_8c_source_1l00583"/>00583 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct862[]&#32;=&#32;<link linkend="_ff_8c_1a7e2ecbf1aa017e0fbcc0233469ad1c86">TBL_CT862</link>;
<anchor xml:id="_ff_8c_source_1l00584"/>00584 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct863[]&#32;=&#32;<link linkend="_ff_8c_1ae7986d8f1be641fa513a553ca6ca9d83">TBL_CT863</link>;
<anchor xml:id="_ff_8c_source_1l00585"/>00585 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct864[]&#32;=&#32;<link linkend="_ff_8c_1a5b7151d4a75d72a82f254ab56adceac5">TBL_CT864</link>;
<anchor xml:id="_ff_8c_source_1l00586"/>00586 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct865[]&#32;=&#32;<link linkend="_ff_8c_1a90580e1098c6ec520b05ae406bbfe7cf">TBL_CT865</link>;
<anchor xml:id="_ff_8c_source_1l00587"/>00587 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct866[]&#32;=&#32;<link linkend="_ff_8c_1a613653d9cce7972729bf5f1a39c7db3c">TBL_CT866</link>;
<anchor xml:id="_ff_8c_source_1l00588"/>00588 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Ct869[]&#32;=&#32;<link linkend="_ff_8c_1aa0c4b6d1b444aa99c051639e397ce2b9">TBL_CT869</link>;
<anchor xml:id="_ff_8c_source_1l00589"/>00589 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Dc932[]&#32;=&#32;<link linkend="_ff_8c_1aaf2f449c3ebf5ca12827b9eeb5134290">TBL_DC932</link>;
<anchor xml:id="_ff_8c_source_1l00590"/>00590 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Dc936[]&#32;=&#32;<link linkend="_ff_8c_1a1e9d0d464e35a432767eaf26e3d0d0f6">TBL_DC936</link>;
<anchor xml:id="_ff_8c_source_1l00591"/>00591 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Dc949[]&#32;=&#32;<link linkend="_ff_8c_1ac48368e0a312bdeaabb949f132758ed0">TBL_DC949</link>;
<anchor xml:id="_ff_8c_source_1l00592"/>00592 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;Dc950[]&#32;=&#32;<link linkend="_ff_8c_1aebba82563d7b04297527becfbae117df">TBL_DC950</link>;
<anchor xml:id="_ff_8c_source_1l00593"/>00593 
<anchor xml:id="_ff_8c_source_1l00594"/>00594 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&lt;&#32;900&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Static&#32;code&#32;page&#32;configuration&#32;(SBCS)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00595"/>00595 <emphasis role="preprocessor">#define&#32;CODEPAGE&#32;FF_CODE_PAGE</emphasis>
<anchor xml:id="_ff_8c_source_1l00596"/>00596 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;ExCvt[]&#32;=&#32;<link linkend="_ff_8c_1ac4c5cba43a7d51edd75c267e6046756f">MKCVTBL</link>(TBL_CT,&#32;<link linkend="_ffconf_8h_1a56bf522419025961acdfaf6388f40402">FF_CODE_PAGE</link>);
<anchor xml:id="_ff_8c_source_1l00597"/>00597 
<anchor xml:id="_ff_8c_source_1l00598"/>00598 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Static&#32;code&#32;page&#32;configuration&#32;(DBCS)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00599"/><link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">00599</link> <emphasis role="preprocessor">#define&#32;CODEPAGE&#32;FF_CODE_PAGE</emphasis>
<anchor xml:id="_ff_8c_source_1l00600"/>00600 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;DbcTbl[]&#32;=&#32;<link linkend="_ff_8c_1ac4c5cba43a7d51edd75c267e6046756f">MKCVTBL</link>(TBL_DC,&#32;<link linkend="_ffconf_8h_1a56bf522419025961acdfaf6388f40402">FF_CODE_PAGE</link>);
<anchor xml:id="_ff_8c_source_1l00601"/>00601 
<anchor xml:id="_ff_8c_source_1l00602"/>00602 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00603"/>00603 
<anchor xml:id="_ff_8c_source_1l00604"/>00604 
<anchor xml:id="_ff_8c_source_1l00605"/>00605 
<anchor xml:id="_ff_8c_source_1l00606"/>00606 
<anchor xml:id="_ff_8c_source_1l00607"/>00607 <emphasis role="comment">/*--------------------------------------------------------------------------</emphasis>
<anchor xml:id="_ff_8c_source_1l00608"/>00608 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l00609"/>00609 <emphasis role="comment">&#32;&#32;&#32;Module&#32;Private&#32;Functions</emphasis>
<anchor xml:id="_ff_8c_source_1l00610"/>00610 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l00611"/>00611 <emphasis role="comment">---------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00612"/>00612 
<anchor xml:id="_ff_8c_source_1l00613"/>00613 
<anchor xml:id="_ff_8c_source_1l00614"/>00614 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00615"/>00615 <emphasis role="comment">/*&#32;Load/Store&#32;multi-byte&#32;word&#32;in&#32;the&#32;FAT&#32;structure&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00616"/>00616 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00617"/>00617 
<anchor xml:id="_ff_8c_source_1l00618"/>00618 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;ld_word&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ptr)&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;&#32;Load&#32;a&#32;2-byte&#32;little-endian&#32;word&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00619"/>00619 {
<anchor xml:id="_ff_8c_source_1l00620"/>00620 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00621"/>00621 
<anchor xml:id="_ff_8c_source_1l00622"/>00622 &#32;&#32;&#32;&#32;rv&#32;=&#32;ptr[1];
<anchor xml:id="_ff_8c_source_1l00623"/>00623 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[0];
<anchor xml:id="_ff_8c_source_1l00624"/>00624 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00625"/>00625 }
<anchor xml:id="_ff_8c_source_1l00626"/>00626 
<anchor xml:id="_ff_8c_source_1l00627"/>00627 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ld_dword&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ptr)&#32;<emphasis role="comment">/*&#32;Load&#32;a&#32;4-byte&#32;little-endian&#32;word&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00628"/>00628 {
<anchor xml:id="_ff_8c_source_1l00629"/>00629 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00630"/>00630 
<anchor xml:id="_ff_8c_source_1l00631"/>00631 &#32;&#32;&#32;&#32;rv&#32;=&#32;ptr[3];
<anchor xml:id="_ff_8c_source_1l00632"/>00632 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[2];
<anchor xml:id="_ff_8c_source_1l00633"/>00633 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[1];
<anchor xml:id="_ff_8c_source_1l00634"/>00634 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[0];
<anchor xml:id="_ff_8c_source_1l00635"/>00635 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00636"/>00636 }
<anchor xml:id="_ff_8c_source_1l00637"/>00637 
<anchor xml:id="_ff_8c_source_1l00638"/>00638 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00639"/>00639 <emphasis role="keyword">static</emphasis>&#32;QWORD&#32;ld_qword&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ptr)&#32;<emphasis role="comment">/*&#32;Load&#32;an&#32;8-byte&#32;little-endian&#32;word&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00640"/>00640 {
<anchor xml:id="_ff_8c_source_1l00641"/>00641 &#32;&#32;&#32;&#32;QWORD&#32;rv;
<anchor xml:id="_ff_8c_source_1l00642"/>00642 
<anchor xml:id="_ff_8c_source_1l00643"/>00643 &#32;&#32;&#32;&#32;rv&#32;=&#32;ptr[7];
<anchor xml:id="_ff_8c_source_1l00644"/>00644 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[6];
<anchor xml:id="_ff_8c_source_1l00645"/>00645 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[5];
<anchor xml:id="_ff_8c_source_1l00646"/>00646 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[4];
<anchor xml:id="_ff_8c_source_1l00647"/>00647 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[3];
<anchor xml:id="_ff_8c_source_1l00648"/>00648 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[2];
<anchor xml:id="_ff_8c_source_1l00649"/>00649 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[1];
<anchor xml:id="_ff_8c_source_1l00650"/>00650 &#32;&#32;&#32;&#32;rv&#32;=&#32;rv&#32;&lt;&lt;&#32;8&#32;|&#32;ptr[0];
<anchor xml:id="_ff_8c_source_1l00651"/>00651 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00652"/>00652 }
<anchor xml:id="_ff_8c_source_1l00653"/>00653 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00654"/>00654 
<anchor xml:id="_ff_8c_source_1l00655"/>00655 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l00656"/>00656 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;st_word&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ptr,&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;val)&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;a&#32;2-byte&#32;word&#32;in&#32;little-endian&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00657"/>00657 {
<anchor xml:id="_ff_8c_source_1l00658"/>00658 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00659"/>00659 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;
<anchor xml:id="_ff_8c_source_1l00660"/>00660 }
<anchor xml:id="_ff_8c_source_1l00661"/>00661 
<anchor xml:id="_ff_8c_source_1l00662"/>00662 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;st_dword&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ptr,&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;val)&#32;<emphasis role="comment">/*&#32;Store&#32;a&#32;4-byte&#32;word&#32;in&#32;little-endian&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00663"/>00663 {
<anchor xml:id="_ff_8c_source_1l00664"/>00664 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00665"/>00665 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00666"/>00666 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00667"/>00667 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;
<anchor xml:id="_ff_8c_source_1l00668"/>00668 }
<anchor xml:id="_ff_8c_source_1l00669"/>00669 
<anchor xml:id="_ff_8c_source_1l00670"/>00670 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l00671"/>00671 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;st_qword&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;ptr,&#32;QWORD&#32;val)&#32;<emphasis role="comment">/*&#32;Store&#32;an&#32;8-byte&#32;word&#32;in&#32;little-endian&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00672"/>00672 {
<anchor xml:id="_ff_8c_source_1l00673"/>00673 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00674"/>00674 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00675"/>00675 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00676"/>00676 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00677"/>00677 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00678"/>00678 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00679"/>00679 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;val&#32;&gt;&gt;=&#32;8;
<anchor xml:id="_ff_8c_source_1l00680"/>00680 &#32;&#32;&#32;&#32;*ptr++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;
<anchor xml:id="_ff_8c_source_1l00681"/>00681 }
<anchor xml:id="_ff_8c_source_1l00682"/>00682 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00683"/>00683 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00684"/>00684 
<anchor xml:id="_ff_8c_source_1l00685"/>00685 
<anchor xml:id="_ff_8c_source_1l00686"/>00686 
<anchor xml:id="_ff_8c_source_1l00687"/>00687 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00688"/>00688 <emphasis role="comment">/*&#32;String&#32;functions&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00689"/>00689 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00690"/>00690 
<anchor xml:id="_ff_8c_source_1l00691"/>00691 <emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;byte&#32;is&#32;DBC&#32;1st&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00692"/>00692 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;dbc_1st&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;c)
<anchor xml:id="_ff_8c_source_1l00693"/>00693 {
<anchor xml:id="_ff_8c_source_1l00694"/>00694 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Variable&#32;code&#32;page&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00695"/>00695 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(DbcTbl&#32;&amp;&amp;&#32;c&#32;&gt;=&#32;DbcTbl[0])&#32;{
<anchor xml:id="_ff_8c_source_1l00696"/>00696 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&lt;=&#32;DbcTbl[1])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;1st&#32;byte&#32;range&#32;1&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00697"/>00697 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[2]&#32;&amp;&amp;&#32;c&#32;&lt;=&#32;DbcTbl[3])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;<emphasis role="comment">/*&#32;1st&#32;byte&#32;range&#32;2&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00698"/>00698 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00699"/>00699 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&gt;=&#32;900&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;DBCS&#32;fixed&#32;code&#32;page&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00700"/>00700 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[0])&#32;{
<anchor xml:id="_ff_8c_source_1l00701"/>00701 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&lt;=&#32;DbcTbl[1])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00702"/>00702 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[2]&#32;&amp;&amp;&#32;c&#32;&lt;=&#32;DbcTbl[3])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00703"/>00703 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00704"/>00704 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;SBCS&#32;fixed&#32;code&#32;page&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00705"/>00705 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Always&#32;false&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00706"/>00706 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00707"/>00707 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_ff_8c_source_1l00708"/>00708 }
<anchor xml:id="_ff_8c_source_1l00709"/>00709 
<anchor xml:id="_ff_8c_source_1l00710"/>00710 
<anchor xml:id="_ff_8c_source_1l00711"/>00711 <emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;byte&#32;is&#32;DBC&#32;2nd&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00712"/>00712 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;dbc_2nd&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;c)
<anchor xml:id="_ff_8c_source_1l00713"/>00713 {
<anchor xml:id="_ff_8c_source_1l00714"/>00714 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Variable&#32;code&#32;page&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00715"/>00715 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(DbcTbl&#32;&amp;&amp;&#32;c&#32;&gt;=&#32;DbcTbl[4])&#32;{
<anchor xml:id="_ff_8c_source_1l00716"/>00716 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&lt;=&#32;DbcTbl[5])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;2nd&#32;byte&#32;range&#32;1&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00717"/>00717 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[6]&#32;&amp;&amp;&#32;c&#32;&lt;=&#32;DbcTbl[7])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;<emphasis role="comment">/*&#32;2nd&#32;byte&#32;range&#32;2&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00718"/>00718 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[8]&#32;&amp;&amp;&#32;c&#32;&lt;=&#32;DbcTbl[9])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;<emphasis role="comment">/*&#32;2nd&#32;byte&#32;range&#32;3&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00719"/>00719 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00720"/>00720 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&gt;=&#32;900&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;DBCS&#32;fixed&#32;code&#32;page&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00721"/>00721 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[4])&#32;{
<anchor xml:id="_ff_8c_source_1l00722"/>00722 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&lt;=&#32;DbcTbl[5])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00723"/>00723 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[6]&#32;&amp;&amp;&#32;c&#32;&lt;=&#32;DbcTbl[7])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00724"/>00724 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;DbcTbl[8]&#32;&amp;&amp;&#32;c&#32;&lt;=&#32;DbcTbl[9])&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00725"/>00725 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00726"/>00726 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;SBCS&#32;fixed&#32;code&#32;page&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00727"/>00727 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Always&#32;false&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00728"/>00728 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00729"/>00729 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_ff_8c_source_1l00730"/>00730 }
<anchor xml:id="_ff_8c_source_1l00731"/>00731 
<anchor xml:id="_ff_8c_source_1l00732"/>00732 
<anchor xml:id="_ff_8c_source_1l00733"/>00733 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l00734"/>00734 
<anchor xml:id="_ff_8c_source_1l00735"/>00735 <emphasis role="comment">/*&#32;Get&#32;a&#32;Unicode&#32;code&#32;point&#32;from&#32;the&#32;TCHAR&#32;string&#32;in&#32;defined&#32;API&#32;encodeing&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00736"/>00736 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;tchar2uni&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;a&#32;character&#32;in&#32;UTF-16&#32;encoding&#32;(&gt;=0x10000&#32;on&#32;surrogate&#32;pair,&#32;0xFFFFFFFF&#32;on&#32;decode&#32;error)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00737"/>00737 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>**&#32;str&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;TCHAR&#32;string&#32;in&#32;configured&#32;encoding&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00738"/>00738 )
<anchor xml:id="_ff_8c_source_1l00739"/>00739 {
<anchor xml:id="_ff_8c_source_1l00740"/>00740 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;uc;
<anchor xml:id="_ff_8c_source_1l00741"/>00741 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*p&#32;=&#32;*str;
<anchor xml:id="_ff_8c_source_1l00742"/>00742 
<anchor xml:id="_ff_8c_source_1l00743"/>00743 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;==&#32;1&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-16&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00744"/>00744 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l00745"/>00745 
<anchor xml:id="_ff_8c_source_1l00746"/>00746 &#32;&#32;&#32;&#32;uc&#32;=&#32;*p++;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;unit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00747"/>00747 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(uc))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00748"/>00748 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;*p++;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;low&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00749"/>00749 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ff_8c_1ad148073d4a74bdff0f86f2b18284b569">IsSurrogateH</link>(uc)&#32;||&#32;!<link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">IsSurrogateL</link>(wc))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00750"/>00750 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;=&#32;uc&#32;&lt;&lt;&#32;16&#32;|&#32;wc;
<anchor xml:id="_ff_8c_source_1l00751"/>00751 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00752"/>00752 
<anchor xml:id="_ff_8c_source_1l00753"/>00753 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-8&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00754"/>00754 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;b;
<anchor xml:id="_ff_8c_source_1l00755"/>00755 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;nf;
<anchor xml:id="_ff_8c_source_1l00756"/>00756 
<anchor xml:id="_ff_8c_source_1l00757"/>00757 &#32;&#32;&#32;&#32;uc&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*p++;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;encoding&#32;unit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00758"/>00758 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;&amp;&#32;0x80)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Multiple&#32;byte&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00759"/>00759 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;((uc&#32;&amp;&#32;0xE0)&#32;==&#32;0xC0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;2-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00760"/>00760 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;&amp;=&#32;0x1F;&#32;nf&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l00761"/>00761 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;((uc&#32;&amp;&#32;0xF0)&#32;==&#32;0xE0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;3-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00762"/>00762 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;&amp;=&#32;0x0F;&#32;nf&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l00763"/>00763 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;((uc&#32;&amp;&#32;0xF8)&#32;==&#32;0xF0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;4-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00764"/>00764 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;&amp;=&#32;0x07;&#32;nf&#32;=&#32;3;
<anchor xml:id="_ff_8c_source_1l00765"/>00765 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00766"/>00766 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;
<anchor xml:id="_ff_8c_source_1l00767"/>00767 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00768"/>00768 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;trailing&#32;bytes&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00769"/>00769 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*p++;
<anchor xml:id="_ff_8c_source_1l00770"/>00770 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((b&#32;&amp;&#32;0xC0)&#32;!=&#32;0x80)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00771"/>00771 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;=&#32;uc&#32;&lt;&lt;&#32;6&#32;|&#32;(b&#32;&amp;&#32;0x3F);
<anchor xml:id="_ff_8c_source_1l00772"/>00772 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(--nf&#32;!=&#32;0);
<anchor xml:id="_ff_8c_source_1l00773"/>00773 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;&lt;&#32;0x80&#32;||&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(uc)&#32;||&#32;uc&#32;&gt;=&#32;0x110000)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00774"/>00774 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;&gt;=&#32;0x010000)&#32;uc&#32;=&#32;0xD800DC00&#32;|&#32;((uc&#32;-&#32;0x10000)&#32;&lt;&lt;&#32;6&#32;&amp;&#32;0x3FF0000)&#32;|&#32;(uc&#32;&amp;&#32;0x3FF);&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;surrogate&#32;pair&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00775"/>00775 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00776"/>00776 
<anchor xml:id="_ff_8c_source_1l00777"/>00777 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;3&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-32&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00778"/>00778 &#32;&#32;&#32;&#32;uc&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)*p++;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;unit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00779"/>00779 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;&gt;=&#32;0x110000&#32;||&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(uc))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00780"/>00780 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;&gt;=&#32;0x010000)&#32;uc&#32;=&#32;0xD800DC00&#32;|&#32;((uc&#32;-&#32;0x10000)&#32;&lt;&lt;&#32;6&#32;&amp;&#32;0x3FF0000)&#32;|&#32;(uc&#32;&amp;&#32;0x3FF);&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;surrogate&#32;pair&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00781"/>00781 
<anchor xml:id="_ff_8c_source_1l00782"/>00782 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00783"/>00783 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;b;
<anchor xml:id="_ff_8c_source_1l00784"/>00784 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l00785"/>00785 
<anchor xml:id="_ff_8c_source_1l00786"/>00786 &#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*p++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00787"/>00787 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;DBC&#32;1st&#32;byte?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00788"/>00788 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*p++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;2nd&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00789"/>00789 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dbc_2nd(b))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;&#32;<emphasis role="comment">/*&#32;Invalid&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00790"/>00790 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(wc&#32;&lt;&lt;&#32;8)&#32;+&#32;b;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;DBC&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00791"/>00791 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00792"/>00792 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l00793"/>00793 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a52f09f31c84747cc135c90282509961a">ff_oem2uni</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;<emphasis role="comment">/*&#32;ANSI/OEM&#32;==&gt;&#32;Unicode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00794"/>00794 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;&#32;<emphasis role="comment">/*&#32;Invalid&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00795"/>00795 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00796"/>00796 &#32;&#32;&#32;&#32;uc&#32;=&#32;wc;
<anchor xml:id="_ff_8c_source_1l00797"/>00797 
<anchor xml:id="_ff_8c_source_1l00798"/>00798 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00799"/>00799 &#32;&#32;&#32;&#32;*str&#32;=&#32;p;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;read&#32;pointer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00800"/>00800 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;uc;
<anchor xml:id="_ff_8c_source_1l00801"/>00801 }
<anchor xml:id="_ff_8c_source_1l00802"/>00802 
<anchor xml:id="_ff_8c_source_1l00803"/>00803 
<anchor xml:id="_ff_8c_source_1l00804"/>00804 <emphasis role="comment">/*&#32;Store&#32;a&#32;Unicode&#32;char&#32;in&#32;defined&#32;API&#32;encoding&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00805"/>00805 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;put_utf&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;number&#32;of&#32;encoding&#32;units&#32;written&#32;(0:buffer&#32;overflow&#32;or&#32;wrong&#32;encoding)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00806"/>00806 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;chr,&#32;&#32;<emphasis role="comment">/*&#32;UTF-16&#32;encoded&#32;character&#32;(Surrogate&#32;pair&#32;if&#32;&gt;=0x10000)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00807"/>00807 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;buf,&#32;<emphasis role="comment">/*&#32;Output&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00808"/>00808 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;szb&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;the&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00809"/>00809 )
<anchor xml:id="_ff_8c_source_1l00810"/>00810 {
<anchor xml:id="_ff_8c_source_1l00811"/>00811 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;==&#32;1&#32;</emphasis><emphasis role="comment">/*&#32;UTF-16&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00812"/>00812 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;hs,&#32;wc;
<anchor xml:id="_ff_8c_source_1l00813"/>00813 
<anchor xml:id="_ff_8c_source_1l00814"/>00814 &#32;&#32;&#32;&#32;hs&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(chr&#32;&gt;&gt;&#32;16);
<anchor xml:id="_ff_8c_source_1l00815"/>00815 &#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)chr;
<anchor xml:id="_ff_8c_source_1l00816"/>00816 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;==&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Single&#32;encoding&#32;unit?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00817"/>00817 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;1&#32;||&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(wc))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow&#32;or&#32;wrong&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00818"/>00818 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf&#32;=&#32;wc;
<anchor xml:id="_ff_8c_source_1l00819"/>00819 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00820"/>00820 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00821"/>00821 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;2&#32;||&#32;!<link linkend="_ff_8c_1ad148073d4a74bdff0f86f2b18284b569">IsSurrogateH</link>(hs)&#32;||&#32;!<link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">IsSurrogateL</link>(wc))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow&#32;or&#32;wrong&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00822"/>00822 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;hs;
<anchor xml:id="_ff_8c_source_1l00823"/>00823 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;wc;
<anchor xml:id="_ff_8c_source_1l00824"/>00824 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;2;
<anchor xml:id="_ff_8c_source_1l00825"/>00825 
<anchor xml:id="_ff_8c_source_1l00826"/>00826 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-8&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00827"/>00827 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;hc;
<anchor xml:id="_ff_8c_source_1l00828"/>00828 
<anchor xml:id="_ff_8c_source_1l00829"/>00829 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chr&#32;&lt;&#32;0x80)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Single&#32;byte&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00830"/>00830 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00831"/>00831 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)chr;
<anchor xml:id="_ff_8c_source_1l00832"/>00832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00833"/>00833 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00834"/>00834 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chr&#32;&lt;&#32;0x800)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;2-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00835"/>00835 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00836"/>00836 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xC0&#32;|&#32;(chr&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x1F));
<anchor xml:id="_ff_8c_source_1l00837"/>00837 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(chr&#32;&gt;&gt;&#32;0&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l00838"/>00838 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;2;
<anchor xml:id="_ff_8c_source_1l00839"/>00839 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00840"/>00840 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chr&#32;&lt;&#32;0x10000)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;3-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00841"/>00841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;3&#32;||&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(chr))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow&#32;or&#32;wrong&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00842"/>00842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xE0&#32;|&#32;(chr&#32;&gt;&gt;&#32;12&#32;&amp;&#32;0x0F));
<anchor xml:id="_ff_8c_source_1l00843"/>00843 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(chr&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l00844"/>00844 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(chr&#32;&gt;&gt;&#32;0&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l00845"/>00845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;3;
<anchor xml:id="_ff_8c_source_1l00846"/>00846 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00847"/>00847 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;4-byte&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00848"/>00848 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;4)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00849"/>00849 &#32;&#32;&#32;&#32;hc&#32;=&#32;((chr&#32;&amp;&#32;0xFFFF0000)&#32;-&#32;0xD8000000)&#32;&gt;&gt;&#32;6;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;high&#32;10&#32;bits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00850"/>00850 &#32;&#32;&#32;&#32;chr&#32;=&#32;(chr&#32;&amp;&#32;0xFFFF)&#32;-&#32;0xDC00;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;low&#32;10&#32;bits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00851"/>00851 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hc&#32;&gt;=&#32;0x100000&#32;||&#32;chr&#32;&gt;=&#32;0x400)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00852"/>00852 &#32;&#32;&#32;&#32;chr&#32;=&#32;(hc&#32;|&#32;chr)&#32;+&#32;0x10000;
<anchor xml:id="_ff_8c_source_1l00853"/>00853 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xF0&#32;|&#32;(chr&#32;&gt;&gt;&#32;18&#32;&amp;&#32;0x07));
<anchor xml:id="_ff_8c_source_1l00854"/>00854 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(chr&#32;&gt;&gt;&#32;12&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l00855"/>00855 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(chr&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l00856"/>00856 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(chr&#32;&gt;&gt;&#32;0&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l00857"/>00857 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;4;
<anchor xml:id="_ff_8c_source_1l00858"/>00858 
<anchor xml:id="_ff_8c_source_1l00859"/>00859 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;3&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-32&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00860"/>00860 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;hc;
<anchor xml:id="_ff_8c_source_1l00861"/>00861 
<anchor xml:id="_ff_8c_source_1l00862"/>00862 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00863"/>00863 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chr&#32;&gt;=&#32;0x10000)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Out&#32;of&#32;BMP?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00864"/>00864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hc&#32;=&#32;((chr&#32;&amp;&#32;0xFFFF0000)&#32;-&#32;0xD8000000)&#32;&gt;&gt;&#32;6;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;high&#32;10&#32;bits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00865"/>00865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;chr&#32;=&#32;(chr&#32;&amp;&#32;0xFFFF)&#32;-&#32;0xDC00;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;low&#32;10&#32;bits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00866"/>00866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hc&#32;&gt;=&#32;0x100000&#32;||&#32;chr&#32;&gt;=&#32;0x400)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00867"/>00867 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;chr&#32;=&#32;(hc&#32;|&#32;chr)&#32;+&#32;0x10000;
<anchor xml:id="_ff_8c_source_1l00868"/>00868 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00869"/>00869 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)chr;
<anchor xml:id="_ff_8c_source_1l00870"/>00870 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00871"/>00871 
<anchor xml:id="_ff_8c_source_1l00872"/>00872 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00873"/>00873 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l00874"/>00874 
<anchor xml:id="_ff_8c_source_1l00875"/>00875 &#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(chr,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);
<anchor xml:id="_ff_8c_source_1l00876"/>00876 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&gt;=&#32;0x100)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;this&#32;a&#32;DBC?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00877"/>00877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&lt;&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_ff_8c_source_1l00878"/>00878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(char)(wc&#32;&gt;&gt;&#32;8);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;DBC&#32;1st&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00879"/>00879 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)wc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;DBC&#32;2nd&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00880"/>00880 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;2;
<anchor xml:id="_ff_8c_source_1l00881"/>00881 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00882"/>00882 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0&#32;||&#32;szb&#32;&lt;&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;char&#32;or&#32;buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00883"/>00883 &#32;&#32;&#32;&#32;*buf++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)wc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00884"/>00884 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l00885"/>00885 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00886"/>00886 }
<anchor xml:id="_ff_8c_source_1l00887"/>00887 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l00888"/>00888 
<anchor xml:id="_ff_8c_source_1l00889"/>00889 
<anchor xml:id="_ff_8c_source_1l00890"/>00890 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l00891"/>00891 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00892"/>00892 <emphasis role="comment">/*&#32;Request/Release&#32;grant&#32;to&#32;access&#32;the&#32;volume&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00893"/>00893 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00894"/>00894 
<anchor xml:id="_ff_8c_source_1l00895"/>00895 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;lock_volume&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;1:Ok,&#32;0:timeout&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00896"/>00896 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;to&#32;lock&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00897"/>00897 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;syslock&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;lock&#32;required&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00898"/>00898 )
<anchor xml:id="_ff_8c_source_1l00899"/>00899 {
<anchor xml:id="_ff_8c_source_1l00900"/>00900 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00901"/>00901 
<anchor xml:id="_ff_8c_source_1l00902"/>00902 
<anchor xml:id="_ff_8c_source_1l00903"/>00903 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l00904"/>00904 &#32;&#32;&#32;&#32;rv&#32;=&#32;ff_mutex_take(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaa678cb2c36f5e7d8157ae295f1fbb42">ldrv</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00905"/>00905 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rv&#32;&amp;&amp;&#32;syslock)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;lock&#32;reqiered?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00906"/>00906 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rv&#32;=&#32;ff_mutex_take(<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>);&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;system&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00907"/>00907 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rv)&#32;{
<anchor xml:id="_ff_8c_source_1l00908"/>00908 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SysLock&#32;=&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;lock&#32;succeeded&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00909"/>00909 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l00910"/>00910 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_give(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaa678cb2c36f5e7d8157ae295f1fbb42">ldrv</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Failed&#32;system&#32;lock&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00911"/>00911 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00912"/>00912 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00913"/>00913 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l00914"/>00914 &#32;&#32;&#32;&#32;rv&#32;=&#32;syslock&#32;?&#32;ff_mutex_take(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaa678cb2c36f5e7d8157ae295f1fbb42">ldrv</link>)&#32;:&#32;ff_mutex_take(fs-&gt;ldrv);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;volume&#32;(this&#32;is&#32;to&#32;prevent&#32;compiler&#32;warning)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00915"/>00915 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00916"/>00916 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l00917"/>00917 }
<anchor xml:id="_ff_8c_source_1l00918"/>00918 
<anchor xml:id="_ff_8c_source_1l00919"/>00919 
<anchor xml:id="_ff_8c_source_1l00920"/>00920 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;unlock_volume&#32;(
<anchor xml:id="_ff_8c_source_1l00921"/>00921 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00922"/>00922 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Result&#32;code&#32;to&#32;be&#32;returned&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00923"/>00923 )
<anchor xml:id="_ff_8c_source_1l00924"/>00924 {
<anchor xml:id="_ff_8c_source_1l00925"/>00925 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs&#32;&amp;&amp;&#32;res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cafc56605c68aaffab4a428339a8bd600d">FR_NOT_ENABLED</link>&#32;&amp;&amp;&#32;res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>&#32;&amp;&amp;&#32;res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3f8ca7e51af8b129d14328de7243c5d4">FR_TIMEOUT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l00926"/>00926 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l00927"/>00927 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(SysLock&#32;==&#32;2)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;system&#32;locked?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00928"/>00928 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SysLock&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l00929"/>00929 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_give(<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>);
<anchor xml:id="_ff_8c_source_1l00930"/>00930 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00931"/>00931 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00932"/>00932 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_give(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaa678cb2c36f5e7d8157ae295f1fbb42">ldrv</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unlock&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00933"/>00933 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00934"/>00934 }
<anchor xml:id="_ff_8c_source_1l00935"/>00935 
<anchor xml:id="_ff_8c_source_1l00936"/>00936 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l00937"/>00937 
<anchor xml:id="_ff_8c_source_1l00938"/>00938 
<anchor xml:id="_ff_8c_source_1l00939"/>00939 
<anchor xml:id="_ff_8c_source_1l00940"/>00940 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l00941"/>00941 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00942"/>00942 <emphasis role="comment">/*&#32;File&#32;shareing&#32;control&#32;functions&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00943"/>00943 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00944"/>00944 
<anchor xml:id="_ff_8c_source_1l00945"/>00945 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;chk_share&#32;(&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;file&#32;can&#32;be&#32;accessed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00946"/>00946 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;object&#32;pointing&#32;the&#32;file&#32;to&#32;be&#32;checked&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00947"/>00947 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;acc&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Desired&#32;access&#32;type&#32;(0:Read&#32;mode&#32;open,&#32;1:Write&#32;mode&#32;open,&#32;2:Delete&#32;or&#32;rename)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00948"/>00948 )
<anchor xml:id="_ff_8c_source_1l00949"/>00949 {
<anchor xml:id="_ff_8c_source_1l00950"/>00950 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;be;
<anchor xml:id="_ff_8c_source_1l00951"/>00951 
<anchor xml:id="_ff_8c_source_1l00952"/>00952 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Search&#32;open&#32;object&#32;table&#32;for&#32;the&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00953"/>00953 &#32;&#32;&#32;&#32;be&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l00954"/>00954 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>;&#32;i++)&#32;{
<anchor xml:id="_ff_8c_source_1l00955"/>00955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(Files[i].fs)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Existing&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00956"/>00956 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(Files[i].fs&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;&amp;&amp;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;object&#32;matches&#32;with&#32;an&#32;open&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00957"/>00957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].clu&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;&amp;&amp;
<anchor xml:id="_ff_8c_source_1l00958"/>00958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].ofs&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l00959"/>00959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Blank&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00960"/>00960 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;be&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l00961"/>00961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00962"/>00962 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00963"/>00963 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;The&#32;object&#32;has&#32;not&#32;been&#32;opened&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00964"/>00964 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(!be&#32;&amp;&amp;&#32;acc&#32;!=&#32;2)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;a&#32;blank&#32;entry&#32;for&#32;new&#32;object?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00965"/>00965 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00966"/>00966 
<anchor xml:id="_ff_8c_source_1l00967"/>00967 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;object&#32;was&#32;opened.&#32;Reject&#32;any&#32;open&#32;against&#32;writing&#32;file&#32;and&#32;all&#32;write&#32;mode&#32;open&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00968"/>00968 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(acc&#32;!=&#32;0&#32;||&#32;Files[i].ctr&#32;==&#32;0x100)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca7db5afaaa2af591bd4a208b2967075d7">FR_LOCKED</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l00969"/>00969 }
<anchor xml:id="_ff_8c_source_1l00970"/>00970 
<anchor xml:id="_ff_8c_source_1l00971"/>00971 
<anchor xml:id="_ff_8c_source_1l00972"/>00972 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;enq_share&#32;(<emphasis role="keywordtype">void</emphasis>)&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;an&#32;entry&#32;is&#32;available&#32;for&#32;a&#32;new&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00973"/>00973 {
<anchor xml:id="_ff_8c_source_1l00974"/>00974 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l00975"/>00975 
<anchor xml:id="_ff_8c_source_1l00976"/>00976 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>&#32;&amp;&amp;&#32;Files[i].fs;&#32;i++)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;free&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00977"/>00977 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(i&#32;==&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>)&#32;?&#32;0&#32;:&#32;1;
<anchor xml:id="_ff_8c_source_1l00978"/>00978 }
<anchor xml:id="_ff_8c_source_1l00979"/>00979 
<anchor xml:id="_ff_8c_source_1l00980"/>00980 
<anchor xml:id="_ff_8c_source_1l00981"/>00981 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;inc_share&#32;(&#32;<emphasis role="comment">/*&#32;Increment&#32;object&#32;open&#32;counter&#32;and&#32;returns&#32;its&#32;index&#32;(0:Internal&#32;error)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00982"/>00982 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;object&#32;pointing&#32;the&#32;file&#32;to&#32;register&#32;or&#32;increment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00983"/>00983 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;acc&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Desired&#32;access&#32;(0:Read,&#32;1:Write,&#32;2:Delete/Rename)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00984"/>00984 )
<anchor xml:id="_ff_8c_source_1l00985"/>00985 {
<anchor xml:id="_ff_8c_source_1l00986"/>00986 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l00987"/>00987 
<anchor xml:id="_ff_8c_source_1l00988"/>00988 
<anchor xml:id="_ff_8c_source_1l00989"/>00989 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>;&#32;i++)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;the&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00990"/>00990 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(Files[i].fs&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>
<anchor xml:id="_ff_8c_source_1l00991"/>00991 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;Files[i].clu&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>
<anchor xml:id="_ff_8c_source_1l00992"/>00992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;Files[i].ofs&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l00993"/>00993 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l00994"/>00994 
<anchor xml:id="_ff_8c_source_1l00995"/>00995 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;opened.&#32;Register&#32;it&#32;as&#32;new.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00996"/>00996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>&#32;&amp;&amp;&#32;Files[i].fs;&#32;i++)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;free&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00997"/>00997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;free&#32;entry&#32;to&#32;register&#32;(int&#32;err)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l00998"/>00998 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l00999"/>00999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].clu&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
<anchor xml:id="_ff_8c_source_1l01000"/>01000 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].ofs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>;
<anchor xml:id="_ff_8c_source_1l01001"/>01001 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].ctr&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01002"/>01002 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01003"/>01003 
<anchor xml:id="_ff_8c_source_1l01004"/>01004 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(acc&#32;&gt;=&#32;1&#32;&amp;&amp;&#32;Files[i].ctr)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;<emphasis role="comment">/*&#32;Access&#32;violation&#32;(int&#32;err)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01005"/>01005 
<anchor xml:id="_ff_8c_source_1l01006"/>01006 &#32;&#32;&#32;&#32;Files[i].ctr&#32;=&#32;acc&#32;?&#32;0x100&#32;:&#32;Files[i].ctr&#32;+&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;semaphore&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01007"/>01007 
<anchor xml:id="_ff_8c_source_1l01008"/>01008 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;i&#32;+&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Index&#32;number&#32;origin&#32;from&#32;1&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01009"/>01009 }
<anchor xml:id="_ff_8c_source_1l01010"/>01010 
<anchor xml:id="_ff_8c_source_1l01011"/>01011 
<anchor xml:id="_ff_8c_source_1l01012"/>01012 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dec_share&#32;(&#32;&#32;<emphasis role="comment">/*&#32;Decrement&#32;object&#32;open&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01013"/>01013 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Semaphore&#32;index&#32;(1..)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01014"/>01014 )
<anchor xml:id="_ff_8c_source_1l01015"/>01015 {
<anchor xml:id="_ff_8c_source_1l01016"/>01016 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n;
<anchor xml:id="_ff_8c_source_1l01017"/>01017 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l01018"/>01018 
<anchor xml:id="_ff_8c_source_1l01019"/>01019 
<anchor xml:id="_ff_8c_source_1l01020"/>01020 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(--i&#32;&lt;&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Index&#32;number&#32;origin&#32;from&#32;0&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01021"/>01021 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;Files[i].ctr;
<anchor xml:id="_ff_8c_source_1l01022"/>01022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;0x100)&#32;n&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;write&#32;mode&#32;open,&#32;delete&#32;the&#32;object&#32;semaphore&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01023"/>01023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&gt;&#32;0)&#32;n--;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decrement&#32;read&#32;mode&#32;open&#32;count&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01024"/>01024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].ctr&#32;=&#32;n;
<anchor xml:id="_ff_8c_source_1l01025"/>01025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Delete&#32;the&#32;object&#32;semaphore&#32;if&#32;open&#32;count&#32;becomes&#32;zero&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01026"/>01026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Files[i].fs&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Free&#32;the&#32;entry&#32;&lt;&lt;&lt;If&#32;this&#32;memory&#32;write&#32;operation&#32;is&#32;not&#32;in&#32;atomic,&#32;FF_FS_REENTRANT&#32;==&#32;1&#32;and&#32;FF_VOLUMES&#32;&gt;&#32;1,&#32;there&#32;is&#32;a&#32;potential&#32;error&#32;in&#32;this&#32;process&#32;&gt;&gt;&gt;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01027"/>01027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01028"/>01028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01029"/>01029 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01030"/>01030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;index&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01031"/>01031 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01032"/>01032 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01033"/>01033 }
<anchor xml:id="_ff_8c_source_1l01034"/>01034 
<anchor xml:id="_ff_8c_source_1l01035"/>01035 
<anchor xml:id="_ff_8c_source_1l01036"/>01036 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;clear_share&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;all&#32;lock&#32;entries&#32;of&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01037"/>01037 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs
<anchor xml:id="_ff_8c_source_1l01038"/>01038 )
<anchor xml:id="_ff_8c_source_1l01039"/>01039 {
<anchor xml:id="_ff_8c_source_1l01040"/>01040 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l01041"/>01041 
<anchor xml:id="_ff_8c_source_1l01042"/>01042 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;<link linkend="_ffconf_8h_1ab76cc3251ebd18a5c33f9f18656317f3">FF_FS_LOCK</link>;&#32;i++)&#32;{
<anchor xml:id="_ff_8c_source_1l01043"/>01043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(Files[i].fs&#32;==&#32;fs)&#32;Files[i].fs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01044"/>01044 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01045"/>01045 }
<anchor xml:id="_ff_8c_source_1l01046"/>01046 
<anchor xml:id="_ff_8c_source_1l01047"/>01047 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_LOCK&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01048"/>01048 
<anchor xml:id="_ff_8c_source_1l01049"/>01049 
<anchor xml:id="_ff_8c_source_1l01050"/>01050 
<anchor xml:id="_ff_8c_source_1l01051"/>01051 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01052"/>01052 <emphasis role="comment">/*&#32;Move/Flush&#32;disk&#32;access&#32;window&#32;in&#32;the&#32;filesystem&#32;object&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01053"/>01053 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01054"/>01054 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01055"/>01055 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;sync_window&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;FR_OK&#32;or&#32;FR_DISK_ERR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01056"/>01056 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01057"/>01057 )
<anchor xml:id="_ff_8c_source_1l01058"/>01058 {
<anchor xml:id="_ff_8c_source_1l01059"/>01059 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01060"/>01060 
<anchor xml:id="_ff_8c_source_1l01061"/>01061 
<anchor xml:id="_ff_8c_source_1l01062"/>01062 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;disk&#32;access&#32;window&#32;dirty?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01063"/>01063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>,&#32;1)&#32;==&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;back&#32;into&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01064"/>01064 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;window&#32;dirty&#32;flag&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01065"/>01065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;&lt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a53e9560659f14e66f306c2c444198bf3">fsize</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;in&#32;the&#32;1st&#32;FAT?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01066"/>01066 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>&#32;==&#32;2)&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;+&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a53e9560659f14e66f306c2c444198bf3">fsize</link>,&#32;1);&#32;<emphasis role="comment">/*&#32;Reflect&#32;it&#32;to&#32;2nd&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01067"/>01067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01068"/>01068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01069"/>01069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01070"/>01070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01071"/>01071 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01072"/>01072 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01073"/>01073 }
<anchor xml:id="_ff_8c_source_1l01074"/>01074 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01075"/>01075 
<anchor xml:id="_ff_8c_source_1l01076"/>01076 
<anchor xml:id="_ff_8c_source_1l01077"/>01077 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;move_window&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;FR_OK&#32;or&#32;FR_DISK_ERR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01078"/>01078 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01079"/>01079 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;LBA&#32;to&#32;make&#32;appearance&#32;in&#32;the&#32;fs-&gt;win[]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01080"/>01080 )
<anchor xml:id="_ff_8c_source_1l01081"/>01081 {
<anchor xml:id="_ff_8c_source_1l01082"/>01082 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01083"/>01083 
<anchor xml:id="_ff_8c_source_1l01084"/>01084 
<anchor xml:id="_ff_8c_source_1l01085"/>01085 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;!=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Window&#32;offset&#32;changed?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01086"/>01086 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01087"/>01087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_window(fs);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flush&#32;the&#32;window&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01088"/>01088 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01089"/>01089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;window&#32;with&#32;new&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01090"/>01090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;sect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01091"/>01091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;(<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>)0&#32;-&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;window&#32;if&#32;read&#32;data&#32;is&#32;not&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01092"/>01092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01093"/>01093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01094"/>01094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;=&#32;sect;
<anchor xml:id="_ff_8c_source_1l01095"/>01095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01096"/>01096 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01097"/>01097 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01098"/>01098 }
<anchor xml:id="_ff_8c_source_1l01099"/>01099 
<anchor xml:id="_ff_8c_source_1l01100"/>01100 
<anchor xml:id="_ff_8c_source_1l01101"/>01101 
<anchor xml:id="_ff_8c_source_1l01102"/>01102 
<anchor xml:id="_ff_8c_source_1l01103"/>01103 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01104"/>01104 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01105"/>01105 <emphasis role="comment">/*&#32;Synchronize&#32;filesystem&#32;and&#32;data&#32;on&#32;the&#32;storage&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01106"/>01106 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01107"/>01107 
<anchor xml:id="_ff_8c_source_1l01108"/>01108 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;sync_fs&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;FR_OK&#32;or&#32;FR_DISK_ERR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01109"/>01109 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01110"/>01110 )
<anchor xml:id="_ff_8c_source_1l01111"/>01111 {
<anchor xml:id="_ff_8c_source_1l01112"/>01112 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l01113"/>01113 
<anchor xml:id="_ff_8c_source_1l01114"/>01114 
<anchor xml:id="_ff_8c_source_1l01115"/>01115 &#32;&#32;&#32;&#32;res&#32;=&#32;sync_window(fs);
<anchor xml:id="_ff_8c_source_1l01116"/>01116 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01117"/>01117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;==&#32;1)&#32;{&#32;<emphasis role="comment">/*&#32;FAT32:&#32;Update&#32;FSInfo&#32;sector&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01118"/>01118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;FSInfo&#32;structure&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01119"/>01119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;0,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>);
<anchor xml:id="_ff_8c_source_1l01120"/>01120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01121"/>01121 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a318e58c1966aba52b90ab98dcb649883">FSI_LeadSig</link>,&#32;0x41615252);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Leading&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01122"/>01122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a3bac0e6ff5907873030db1d0a7c4ebef">FSI_StrucSig</link>,&#32;0x61417272);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Structure&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01123"/>01123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ab711e50459aba01b11c6b46a7cc1410b">FSI_Free_Count</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>);&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;free&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01124"/>01124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a320700cedf300c9b418edf56e5e6b086">FSI_Nxt_Free</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;allocated&#32;culuster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01125"/>01125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a89358c0e7b2293254c9481dcd2984d30">volbase</link>&#32;+&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;into&#32;the&#32;FSInfo&#32;sector&#32;(Next&#32;to&#32;VBR)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01126"/>01126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>,&#32;1);
<anchor xml:id="_ff_8c_source_1l01127"/>01127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01128"/>01128 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01129"/>01129 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;sure&#32;that&#32;no&#32;pending&#32;write&#32;process&#32;in&#32;the&#32;lower&#32;layer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01130"/>01130 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;<link linkend="_diskio_8h_1a1b3c492f9aec325f0655941b75256f3c">CTRL_SYNC</link>,&#32;0)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01131"/>01131 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01132"/>01132 
<anchor xml:id="_ff_8c_source_1l01133"/>01133 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01134"/>01134 }
<anchor xml:id="_ff_8c_source_1l01135"/>01135 
<anchor xml:id="_ff_8c_source_1l01136"/>01136 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01137"/>01137 
<anchor xml:id="_ff_8c_source_1l01138"/>01138 
<anchor xml:id="_ff_8c_source_1l01139"/>01139 
<anchor xml:id="_ff_8c_source_1l01140"/>01140 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01141"/>01141 <emphasis role="comment">/*&#32;Get&#32;physical&#32;sector&#32;number&#32;from&#32;cluster&#32;number&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01142"/>01142 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01143"/>01143 
<anchor xml:id="_ff_8c_source_1l01144"/>01144 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;clst2sect&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;!=0:Sector&#32;number,&#32;0:Failed&#32;(invalid&#32;cluster#)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01145"/>01145 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01146"/>01146 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster#&#32;to&#32;be&#32;converted&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01147"/>01147 )
<anchor xml:id="_ff_8c_source_1l01148"/>01148 {
<anchor xml:id="_ff_8c_source_1l01149"/>01149 &#32;&#32;&#32;&#32;clst&#32;-=&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;number&#32;is&#32;origin&#32;from&#32;2&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01150"/>01150 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;invalid&#32;cluster&#32;number?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01151"/>01151 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a4ce7c10569f45fae1c709c9ee41f69cb">database</link>&#32;+&#32;(<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;clst;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;sector&#32;number&#32;of&#32;the&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01152"/>01152 }
<anchor xml:id="_ff_8c_source_1l01153"/>01153 
<anchor xml:id="_ff_8c_source_1l01154"/>01154 
<anchor xml:id="_ff_8c_source_1l01155"/>01155 
<anchor xml:id="_ff_8c_source_1l01156"/>01156 
<anchor xml:id="_ff_8c_source_1l01157"/>01157 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01158"/>01158 <emphasis role="comment">/*&#32;FAT&#32;access&#32;-&#32;Read&#32;value&#32;of&#32;an&#32;FAT&#32;entry&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01159"/>01159 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01160"/>01160 
<anchor xml:id="_ff_8c_source_1l01161"/>01161 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>&#32;(&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;0xFFFFFFFF:Disk&#32;error,&#32;1:Internal&#32;error,&#32;2..0x7FFFFFFF:Cluster&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01162"/>01162 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Corresponding&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01163"/>01163 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;number&#32;to&#32;get&#32;the&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01164"/>01164 )
<anchor xml:id="_ff_8c_source_1l01165"/>01165 {
<anchor xml:id="_ff_8c_source_1l01166"/>01166 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;wc,&#32;bc;
<anchor xml:id="_ff_8c_source_1l01167"/>01167 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;val;
<anchor xml:id="_ff_8c_source_1l01168"/>01168 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01169"/>01169 
<anchor xml:id="_ff_8c_source_1l01170"/>01170 
<anchor xml:id="_ff_8c_source_1l01171"/>01171 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;&#32;2&#32;||&#32;clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;in&#32;valid&#32;range&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01172"/>01172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Internal&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01173"/>01173 
<anchor xml:id="_ff_8c_source_1l01174"/>01174 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01175"/>01175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Default&#32;value&#32;falls&#32;on&#32;disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01176"/>01176 
<anchor xml:id="_ff_8c_source_1l01177"/>01177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01178"/>01178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>&#32;:
<anchor xml:id="_ff_8c_source_1l01179"/>01179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bc&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)clst;&#32;bc&#32;+=&#32;bc&#32;/&#32;2;
<anchor xml:id="_ff_8c_source_1l01180"/>01180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(bc&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01181"/>01181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[bc++&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;1st&#32;byte&#32;of&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01182"/>01182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(bc&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01183"/>01183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;|=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[bc&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)]&#32;&lt;&lt;&#32;8;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Merge&#32;2nd&#32;byte&#32;of&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01184"/>01184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;(clst&#32;&amp;&#32;1)&#32;?&#32;(wc&#32;&gt;&gt;&#32;4)&#32;:&#32;(wc&#32;&amp;&#32;0xFFF);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;bit&#32;position&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01185"/>01185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01186"/>01186 
<anchor xml:id="_ff_8c_source_1l01187"/>01187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>&#32;:
<anchor xml:id="_ff_8c_source_1l01188"/>01188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(clst&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;2)))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01189"/>01189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;clst&#32;*&#32;2&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Simple&#32;WORD&#32;array&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01190"/>01190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01191"/>01191 
<anchor xml:id="_ff_8c_source_1l01192"/>01192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>&#32;:
<anchor xml:id="_ff_8c_source_1l01193"/>01193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(clst&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;4)))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01194"/>01194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;clst&#32;*&#32;4&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;0x0FFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Simple&#32;DWORD&#32;array&#32;but&#32;mask&#32;out&#32;upper&#32;4&#32;bits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01195"/>01195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01196"/>01196 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01197"/>01197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#32;:
<anchor xml:id="_ff_8c_source_1l01198"/>01198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;!=&#32;0&#32;&amp;&amp;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;0)&#32;||&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;except&#32;root&#32;dir&#32;must&#32;have&#32;valid&#32;data&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01199"/>01199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cofs&#32;=&#32;clst&#32;-&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;from&#32;start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01200"/>01200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clen&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>)((obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;-&#32;1)&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;/&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>);&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;-&#32;1&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01201"/>01201 
<anchor xml:id="_ff_8c_source_1l01202"/>01202 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;2&#32;&amp;&amp;&#32;cofs&#32;&lt;=&#32;clen)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;contiguous&#32;chain?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01203"/>01203 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;(cofs&#32;==&#32;clen)&#32;?&#32;0x7FFFFFFF&#32;:&#32;clst&#32;+&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;data&#32;on&#32;the&#32;FAT,&#32;generate&#32;the&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01204"/>01204 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01205"/>01205 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01206"/>01206 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;3&#32;&amp;&amp;&#32;cofs&#32;&lt;&#32;obj-&gt;n_cont)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;in&#32;the&#32;1st&#32;fragment?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01207"/>01207 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;clst&#32;+&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Generate&#32;the&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01208"/>01208 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01209"/>01209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01210"/>01210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;!=&#32;2)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;value&#32;from&#32;FAT&#32;if&#32;FAT&#32;chain&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01211"/>01211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;n_frag&#32;!=&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;on&#32;the&#32;growing&#32;edge?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01212"/>01212 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;0x7FFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Generate&#32;EOC&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01213"/>01213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01214"/>01214 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(clst&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;4)))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01215"/>01215 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;clst&#32;*&#32;4&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;0x7FFFFFFF;
<anchor xml:id="_ff_8c_source_1l01216"/>01216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01217"/>01217 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01218"/>01218 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01219"/>01219 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01220"/>01220 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Internal&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01221"/>01221 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01222"/>01222 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01223"/>01223 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:
<anchor xml:id="_ff_8c_source_1l01224"/>01224 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Internal&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01225"/>01225 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01226"/>01226 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01227"/>01227 
<anchor xml:id="_ff_8c_source_1l01228"/>01228 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;val;
<anchor xml:id="_ff_8c_source_1l01229"/>01229 }
<anchor xml:id="_ff_8c_source_1l01230"/>01230 
<anchor xml:id="_ff_8c_source_1l01231"/>01231 
<anchor xml:id="_ff_8c_source_1l01232"/>01232 
<anchor xml:id="_ff_8c_source_1l01233"/>01233 
<anchor xml:id="_ff_8c_source_1l01234"/>01234 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01235"/>01235 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01236"/>01236 <emphasis role="comment">/*&#32;FAT&#32;access&#32;-&#32;Change&#32;value&#32;of&#32;an&#32;FAT&#32;entry&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01237"/>01237 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01238"/>01238 
<anchor xml:id="_ff_8c_source_1l01239"/>01239 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):succeeded,&#32;!=0:error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01240"/>01240 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Corresponding&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01241"/>01241 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;index&#32;number&#32;(cluster&#32;number)&#32;to&#32;be&#32;changed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01242"/>01242 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;val&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;value&#32;to&#32;be&#32;set&#32;to&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01243"/>01243 )
<anchor xml:id="_ff_8c_source_1l01244"/>01244 {
<anchor xml:id="_ff_8c_source_1l01245"/>01245 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;bc;
<anchor xml:id="_ff_8c_source_1l01246"/>01246 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*p;
<anchor xml:id="_ff_8c_source_1l01247"/>01247 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01248"/>01248 
<anchor xml:id="_ff_8c_source_1l01249"/>01249 
<anchor xml:id="_ff_8c_source_1l01250"/>01250 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&gt;=&#32;2&#32;&amp;&amp;&#32;clst&#32;&lt;&#32;fs-&gt;n_fatent)&#32;{&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;in&#32;valid&#32;range&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01251"/>01251 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01252"/>01252 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>:
<anchor xml:id="_ff_8c_source_1l01253"/>01253 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bc&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)clst;&#32;bc&#32;+=&#32;bc&#32;/&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;bc:&#32;byte&#32;offset&#32;of&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01254"/>01254 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(bc&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)));
<anchor xml:id="_ff_8c_source_1l01255"/>01255 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01256"/>01256 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;p&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;bc++&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
<anchor xml:id="_ff_8c_source_1l01257"/>01257 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p&#32;=&#32;(clst&#32;&amp;&#32;1)&#32;?&#32;((*p&#32;&amp;&#32;0x0F)&#32;|&#32;((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val&#32;&lt;&lt;&#32;4))&#32;:&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)val;&#32;<emphasis role="comment">/*&#32;Update&#32;1st&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01258"/>01258 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01259"/>01259 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(bc&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)));
<anchor xml:id="_ff_8c_source_1l01260"/>01260 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01261"/>01261 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;p&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;bc&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
<anchor xml:id="_ff_8c_source_1l01262"/>01262 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p&#32;=&#32;(clst&#32;&amp;&#32;1)&#32;?&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(val&#32;&gt;&gt;&#32;4)&#32;:&#32;((*p&#32;&amp;&#32;0xF0)&#32;|&#32;((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(val&#32;&gt;&gt;&#32;8)&#32;&amp;&#32;0x0F));&#32;<emphasis role="comment">/*&#32;Update&#32;2nd&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01263"/>01263 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01264"/>01264 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01265"/>01265 
<anchor xml:id="_ff_8c_source_1l01266"/>01266 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>:
<anchor xml:id="_ff_8c_source_1l01267"/>01267 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(clst&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;2)));
<anchor xml:id="_ff_8c_source_1l01268"/>01268 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01269"/>01269 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;clst&#32;*&#32;2&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)val);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Simple&#32;WORD&#32;array&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01270"/>01270 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01271"/>01271 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01272"/>01272 
<anchor xml:id="_ff_8c_source_1l01273"/>01273 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>:
<anchor xml:id="_ff_8c_source_1l01274"/>01274 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01275"/>01275 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>:
<anchor xml:id="_ff_8c_source_1l01276"/>01276 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01277"/>01277 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;(clst&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;4)));
<anchor xml:id="_ff_8c_source_1l01278"/>01278 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01279"/>01279 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01280"/>01280 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;(val&#32;&amp;&#32;0x0FFFFFFF)&#32;|&#32;(ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;clst&#32;*&#32;4&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;0xF0000000);
<anchor xml:id="_ff_8c_source_1l01281"/>01281 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01282"/>01282 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;clst&#32;*&#32;4&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;val);
<anchor xml:id="_ff_8c_source_1l01283"/>01283 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01284"/>01284 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01285"/>01285 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01286"/>01286 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01287"/>01287 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01288"/>01288 }
<anchor xml:id="_ff_8c_source_1l01289"/>01289 
<anchor xml:id="_ff_8c_source_1l01290"/>01290 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01291"/>01291 
<anchor xml:id="_ff_8c_source_1l01292"/>01292 
<anchor xml:id="_ff_8c_source_1l01293"/>01293 
<anchor xml:id="_ff_8c_source_1l01294"/>01294 
<anchor xml:id="_ff_8c_source_1l01295"/>01295 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#32;&amp;&amp;&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01296"/>01296 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01297"/>01297 <emphasis role="comment">/*&#32;exFAT:&#32;Accessing&#32;FAT&#32;and&#32;Allocation&#32;Bitmap&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01298"/>01298 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01299"/>01299 
<anchor xml:id="_ff_8c_source_1l01300"/>01300 <emphasis role="comment">/*--------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01301"/>01301 <emphasis role="comment">/*&#32;Find&#32;a&#32;contiguous&#32;free&#32;cluster&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01302"/>01302 <emphasis role="comment">/*--------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01303"/>01303 
<anchor xml:id="_ff_8c_source_1l01304"/>01304 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;find_bitmap&#32;(&#32;&#32;<emphasis role="comment">/*&#32;0:Not&#32;found,&#32;2..:Cluster&#32;block&#32;found,&#32;0xFFFFFFFF:Disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01305"/>01305 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01306"/>01306 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;<emphasis role="comment">/*&#32;Cluster&#32;number&#32;to&#32;scan&#32;from&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01307"/>01307 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ncl&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;contiguous&#32;clusters&#32;to&#32;find&#32;(1..)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01308"/>01308 )
<anchor xml:id="_ff_8c_source_1l01309"/>01309 {
<anchor xml:id="_ff_8c_source_1l01310"/>01310 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;bm,&#32;bv;
<anchor xml:id="_ff_8c_source_1l01311"/>01311 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l01312"/>01312 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;val,&#32;scl,&#32;ctr;
<anchor xml:id="_ff_8c_source_1l01313"/>01313 
<anchor xml:id="_ff_8c_source_1l01314"/>01314 
<anchor xml:id="_ff_8c_source_1l01315"/>01315 &#32;&#32;&#32;&#32;clst&#32;-=&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;first&#32;bit&#32;in&#32;the&#32;bitmap&#32;corresponds&#32;to&#32;cluster&#32;#2&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01316"/>01316 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;clst&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01317"/>01317 &#32;&#32;&#32;&#32;scl&#32;=&#32;val&#32;=&#32;clst;&#32;ctr&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01318"/>01318 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l01319"/>01319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;bitbase&#32;+&#32;val&#32;/&#32;8&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;
<anchor xml:id="_ff_8c_source_1l01320"/>01320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;val&#32;/&#32;8&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;bm&#32;=&#32;1&#32;&lt;&lt;&#32;(val&#32;%&#32;8);
<anchor xml:id="_ff_8c_source_1l01321"/>01321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01322"/>01322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01323"/>01323 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bv&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i]&#32;&amp;&#32;bm;&#32;bm&#32;&lt;&lt;=&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;bit&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01324"/>01324 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(++val&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;cluster&#32;(with&#32;wrap-around)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01325"/>01325 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;0;&#32;bm&#32;=&#32;0;&#32;i&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
<anchor xml:id="_ff_8c_source_1l01326"/>01326 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01327"/>01327 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(bv&#32;==&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;free&#32;cluster?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01328"/>01328 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(++ctr&#32;==&#32;ncl)&#32;<emphasis role="keywordflow">return</emphasis>&#32;scl&#32;+&#32;2;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;run&#32;length&#32;is&#32;sufficient&#32;for&#32;required&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01329"/>01329 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01330"/>01330 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;val;&#32;ctr&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Encountered&#32;a&#32;cluster&#32;in-use,&#32;restart&#32;to&#32;scan&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01331"/>01331 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01332"/>01332 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(val&#32;==&#32;clst)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;All&#32;cluster&#32;scanned?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01333"/>01333 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(bm&#32;!=&#32;0);
<anchor xml:id="_ff_8c_source_1l01334"/>01334 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bm&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01335"/>01335 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++i&#32;&lt;&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l01336"/>01336 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01337"/>01337 }
<anchor xml:id="_ff_8c_source_1l01338"/>01338 
<anchor xml:id="_ff_8c_source_1l01339"/>01339 
<anchor xml:id="_ff_8c_source_1l01340"/>01340 <emphasis role="comment">/*----------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01341"/>01341 <emphasis role="comment">/*&#32;Set/Clear&#32;a&#32;block&#32;of&#32;allocation&#32;bitmap&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01342"/>01342 <emphasis role="comment">/*----------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01343"/>01343 
<anchor xml:id="_ff_8c_source_1l01344"/>01344 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;change_bitmap&#32;(
<anchor xml:id="_ff_8c_source_1l01345"/>01345 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01346"/>01346 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;<emphasis role="comment">/*&#32;Cluster&#32;number&#32;to&#32;change&#32;from&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01347"/>01347 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ncl,&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;to&#32;be&#32;changed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01348"/>01348 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;bv&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;bit&#32;value&#32;to&#32;be&#32;set&#32;(0&#32;or&#32;1)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01349"/>01349 )
<anchor xml:id="_ff_8c_source_1l01350"/>01350 {
<anchor xml:id="_ff_8c_source_1l01351"/>01351 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;bm;
<anchor xml:id="_ff_8c_source_1l01352"/>01352 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l01353"/>01353 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l01354"/>01354 
<anchor xml:id="_ff_8c_source_1l01355"/>01355 
<anchor xml:id="_ff_8c_source_1l01356"/>01356 &#32;&#32;&#32;&#32;clst&#32;-=&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;first&#32;bit&#32;corresponds&#32;to&#32;cluster&#32;#2&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01357"/>01357 &#32;&#32;&#32;&#32;sect&#32;=&#32;fs-&gt;bitbase&#32;+&#32;clst&#32;/&#32;8&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;<emphasis role="comment">/*&#32;Sector&#32;address&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01358"/>01358 &#32;&#32;&#32;&#32;i&#32;=&#32;clst&#32;/&#32;8&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Byte&#32;offset&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01359"/>01359 &#32;&#32;&#32;&#32;bm&#32;=&#32;1&#32;&lt;&lt;&#32;(clst&#32;%&#32;8);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bit&#32;mask&#32;in&#32;the&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01360"/>01360 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l01361"/>01361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;sect++)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01362"/>01362 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01363"/>01363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01364"/>01364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(bv&#32;==&#32;(<emphasis role="keywordtype">int</emphasis>)((fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i]&#32;&amp;&#32;bm)&#32;!=&#32;0))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;bit&#32;expected&#32;value?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01365"/>01365 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i]&#32;^=&#32;bm;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flip&#32;the&#32;bit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01366"/>01366 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01367"/>01367 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(--ncl&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;All&#32;bits&#32;processed?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01368"/>01368 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(bm&#32;&lt;&lt;=&#32;1);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;bit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01369"/>01369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bm&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01370"/>01370 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++i&#32;&lt;&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01371"/>01371 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01372"/>01372 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01373"/>01373 }
<anchor xml:id="_ff_8c_source_1l01374"/>01374 
<anchor xml:id="_ff_8c_source_1l01375"/>01375 
<anchor xml:id="_ff_8c_source_1l01376"/>01376 <emphasis role="comment">/*---------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01377"/>01377 <emphasis role="comment">/*&#32;Fill&#32;the&#32;first&#32;fragment&#32;of&#32;the&#32;FAT&#32;chain&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01378"/>01378 <emphasis role="comment">/*---------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01379"/>01379 
<anchor xml:id="_ff_8c_source_1l01380"/>01380 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;fill_first_frag&#32;(
<anchor xml:id="_ff_8c_source_1l01381"/>01381 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;corresponding&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01382"/>01382 )
<anchor xml:id="_ff_8c_source_1l01383"/>01383 {
<anchor xml:id="_ff_8c_source_1l01384"/>01384 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l01385"/>01385 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl,&#32;n;
<anchor xml:id="_ff_8c_source_1l01386"/>01386 
<anchor xml:id="_ff_8c_source_1l01387"/>01387 
<anchor xml:id="_ff_8c_source_1l01388"/>01388 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;3)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Has&#32;the&#32;object&#32;been&#32;changed&#32;&apos;fragmented&apos;&#32;in&#32;this&#32;session?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01389"/>01389 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(cl&#32;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>,&#32;n&#32;=&#32;obj-&gt;n_cont;&#32;n;&#32;cl++,&#32;n--)&#32;{&#32;<emphasis role="comment">/*&#32;Create&#32;cluster&#32;chain&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01390"/>01390 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;cl,&#32;cl&#32;+&#32;1);
<anchor xml:id="_ff_8c_source_1l01391"/>01391 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01392"/>01392 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01393"/>01393 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;status&#32;&apos;FAT&#32;chain&#32;is&#32;valid&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01394"/>01394 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01395"/>01395 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01396"/>01396 }
<anchor xml:id="_ff_8c_source_1l01397"/>01397 
<anchor xml:id="_ff_8c_source_1l01398"/>01398 
<anchor xml:id="_ff_8c_source_1l01399"/>01399 <emphasis role="comment">/*---------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01400"/>01400 <emphasis role="comment">/*&#32;Fill&#32;the&#32;last&#32;fragment&#32;of&#32;the&#32;FAT&#32;chain&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01401"/>01401 <emphasis role="comment">/*---------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01402"/>01402 
<anchor xml:id="_ff_8c_source_1l01403"/>01403 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;fill_last_frag&#32;(
<anchor xml:id="_ff_8c_source_1l01404"/>01404 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;corresponding&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01405"/>01405 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;lcl,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;cluster&#32;of&#32;the&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01406"/>01406 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;term&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Value&#32;to&#32;set&#32;the&#32;last&#32;FAT&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01407"/>01407 )
<anchor xml:id="_ff_8c_source_1l01408"/>01408 {
<anchor xml:id="_ff_8c_source_1l01409"/>01409 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l01410"/>01410 
<anchor xml:id="_ff_8c_source_1l01411"/>01411 
<anchor xml:id="_ff_8c_source_1l01412"/>01412 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(obj-&gt;n_frag&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;the&#32;chain&#32;of&#32;last&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01413"/>01413 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;lcl&#32;-&#32;obj-&gt;n_frag&#32;+&#32;1,&#32;(obj-&gt;n_frag&#32;&gt;&#32;1)&#32;?&#32;lcl&#32;-&#32;obj-&gt;n_frag&#32;+&#32;2&#32;:&#32;term);
<anchor xml:id="_ff_8c_source_1l01414"/>01414 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01415"/>01415 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;n_frag--;
<anchor xml:id="_ff_8c_source_1l01416"/>01416 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01417"/>01417 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01418"/>01418 }
<anchor xml:id="_ff_8c_source_1l01419"/>01419 
<anchor xml:id="_ff_8c_source_1l01420"/>01420 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_EXFAT&#32;&amp;&amp;&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01421"/>01421 
<anchor xml:id="_ff_8c_source_1l01422"/>01422 
<anchor xml:id="_ff_8c_source_1l01423"/>01423 
<anchor xml:id="_ff_8c_source_1l01424"/>01424 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01425"/>01425 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01426"/>01426 <emphasis role="comment">/*&#32;FAT&#32;handling&#32;-&#32;Remove&#32;a&#32;cluster&#32;chain&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01427"/>01427 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01428"/>01428 
<anchor xml:id="_ff_8c_source_1l01429"/>01429 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;remove_chain&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):succeeded,&#32;!=0:error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01430"/>01430 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Corresponding&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01431"/>01431 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;to&#32;remove&#32;a&#32;chain&#32;from&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01432"/>01432 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;pclst&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Previous&#32;cluster&#32;of&#32;clst&#32;(0&#32;if&#32;entire&#32;chain)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01433"/>01433 )
<anchor xml:id="_ff_8c_source_1l01434"/>01434 {
<anchor xml:id="_ff_8c_source_1l01435"/>01435 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01436"/>01436 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;nxt;
<anchor xml:id="_ff_8c_source_1l01437"/>01437 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01438"/>01438 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#32;||&#32;FF_USE_TRIM</emphasis>
<anchor xml:id="_ff_8c_source_1l01439"/>01439 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;scl&#32;=&#32;clst,&#32;ecl&#32;=&#32;clst;
<anchor xml:id="_ff_8c_source_1l01440"/>01440 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01441"/>01441 <emphasis role="preprocessor">#if&#32;FF_USE_TRIM</emphasis>
<anchor xml:id="_ff_8c_source_1l01442"/>01442 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;rt[2];
<anchor xml:id="_ff_8c_source_1l01443"/>01443 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01444"/>01444 
<anchor xml:id="_ff_8c_source_1l01445"/>01445 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;&#32;2&#32;||&#32;clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;in&#32;valid&#32;range&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01446"/>01446 
<anchor xml:id="_ff_8c_source_1l01447"/>01447 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;previous&#32;cluster&#32;&apos;EOC&apos;&#32;on&#32;the&#32;FAT&#32;if&#32;it&#32;exists&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01448"/>01448 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pclst&#32;!=&#32;0&#32;&amp;&amp;&#32;(!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#32;||&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;!=&#32;2))&#32;{
<anchor xml:id="_ff_8c_source_1l01449"/>01449 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(fs,&#32;pclst,&#32;0xFFFFFFFF);
<anchor xml:id="_ff_8c_source_1l01450"/>01450 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01451"/>01451 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01452"/>01452 
<anchor xml:id="_ff_8c_source_1l01453"/>01453 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01454"/>01454 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01455"/>01455 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nxt&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(obj,&#32;clst);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;cluster&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01456"/>01456 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Empty&#32;cluster?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01457"/>01457 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt&#32;==&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Internal&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01458"/>01458 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;<emphasis role="comment">/*&#32;Disk&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01459"/>01459 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01460"/>01460 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(fs,&#32;clst,&#32;0);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;cluster&#32;&apos;free&apos;&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01461"/>01461 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01462"/>01462 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01463"/>01463 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;&lt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;{&#32;<emphasis role="comment">/*&#32;Update&#32;FSINFO&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01464"/>01464 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>++;
<anchor xml:id="_ff_8c_source_1l01465"/>01465 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;|=&#32;1;
<anchor xml:id="_ff_8c_source_1l01466"/>01466 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01467"/>01467 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#32;||&#32;FF_USE_TRIM</emphasis>
<anchor xml:id="_ff_8c_source_1l01468"/>01468 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ecl&#32;+&#32;1&#32;==&#32;nxt)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;next&#32;cluster&#32;contiguous?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01469"/>01469 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ecl&#32;=&#32;nxt;
<anchor xml:id="_ff_8c_source_1l01470"/>01470 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;contiguous&#32;cluster&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01471"/>01471 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01472"/>01472 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01473"/>01473 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;change_bitmap(fs,&#32;scl,&#32;ecl&#32;-&#32;scl&#32;+&#32;1,&#32;0);&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;cluster&#32;block&#32;&apos;free&apos;&#32;on&#32;the&#32;bitmap&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01474"/>01474 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01475"/>01475 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01476"/>01476 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01477"/>01477 <emphasis role="preprocessor">#if&#32;FF_USE_TRIM</emphasis>
<anchor xml:id="_ff_8c_source_1l01478"/>01478 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rt[0]&#32;=&#32;clst2sect(fs,&#32;scl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;data&#32;area&#32;to&#32;be&#32;freed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01479"/>01479 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rt[1]&#32;=&#32;clst2sect(fs,&#32;ecl)&#32;+&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;data&#32;area&#32;to&#32;be&#32;freed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01480"/>01480 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;<link linkend="_diskio_8h_1af09fd84bea8d4e889e272471f44d60d6">CTRL_TRIM</link>,&#32;rt);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Inform&#32;storage&#32;device&#32;that&#32;the&#32;data&#32;in&#32;the&#32;block&#32;may&#32;be&#32;erased&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01481"/>01481 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01482"/>01482 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;ecl&#32;=&#32;nxt;
<anchor xml:id="_ff_8c_source_1l01483"/>01483 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01484"/>01484 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01485"/>01485 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;nxt;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01486"/>01486 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(clst&#32;&lt;&#32;fs-&gt;n_fatent);&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;while&#32;not&#32;the&#32;last&#32;link&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01487"/>01487 
<anchor xml:id="_ff_8c_source_1l01488"/>01488 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01489"/>01489 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Some&#32;post&#32;processes&#32;for&#32;chain&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01490"/>01490 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01491"/>01491 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pclst&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Has&#32;the&#32;entire&#32;chain&#32;been&#32;removed?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01492"/>01492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;the&#32;chain&#32;status&#32;&apos;initial&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01493"/>01493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01494"/>01494 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;fragmented&#32;chain&#32;from&#32;the&#32;beginning&#32;of&#32;this&#32;session?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01495"/>01495 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;chain&#32;to&#32;check&#32;if&#32;it&#32;gets&#32;contiguous&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01496"/>01496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(clst&#32;!=&#32;pclst)&#32;{
<anchor xml:id="_ff_8c_source_1l01497"/>01497 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nxt&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(obj,&#32;clst);
<anchor xml:id="_ff_8c_source_1l01498"/>01498 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt&#32;&lt;&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01499"/>01499 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01500"/>01500 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt&#32;!=&#32;clst&#32;+&#32;1)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;Not&#32;contiguous?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01501"/>01501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst++;
<anchor xml:id="_ff_8c_source_1l01502"/>01502 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01503"/>01503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;pclst)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Has&#32;the&#32;chain&#32;got&#32;contiguous&#32;again?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01504"/>01504 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;the&#32;chain&#32;status&#32;&apos;contiguous&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01505"/>01505 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01506"/>01506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01507"/>01507 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;3&#32;&amp;&amp;&#32;pclst&#32;&gt;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;&amp;&amp;&#32;pclst&#32;&lt;=&#32;obj-&gt;sclust&#32;+&#32;obj-&gt;n_cont)&#32;{&#32;<emphasis role="comment">/*&#32;Was&#32;the&#32;chain&#32;fragmented&#32;in&#32;this&#32;session&#32;and&#32;got&#32;contiguous&#32;again?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01508"/>01508 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;the&#32;chain&#32;status&#32;&apos;contiguous&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01509"/>01509 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01510"/>01510 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01511"/>01511 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01512"/>01512 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01513"/>01513 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01514"/>01514 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01515"/>01515 }
<anchor xml:id="_ff_8c_source_1l01516"/>01516 
<anchor xml:id="_ff_8c_source_1l01517"/>01517 
<anchor xml:id="_ff_8c_source_1l01518"/>01518 
<anchor xml:id="_ff_8c_source_1l01519"/>01519 
<anchor xml:id="_ff_8c_source_1l01520"/>01520 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01521"/>01521 <emphasis role="comment">/*&#32;FAT&#32;handling&#32;-&#32;Stretch&#32;a&#32;chain&#32;or&#32;Create&#32;a&#32;new&#32;chain&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01522"/>01522 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01523"/>01523 
<anchor xml:id="_ff_8c_source_1l01524"/>01524 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;create_chain&#32;(&#32;<emphasis role="comment">/*&#32;0:No&#32;free&#32;cluster,&#32;1:Internal&#32;error,&#32;0xFFFFFFFF:Disk&#32;error,&#32;&gt;=2:New&#32;cluster#&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01525"/>01525 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Corresponding&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01526"/>01526 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster#&#32;to&#32;stretch,&#32;0:Create&#32;a&#32;new&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01527"/>01527 )
<anchor xml:id="_ff_8c_source_1l01528"/>01528 {
<anchor xml:id="_ff_8c_source_1l01529"/>01529 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cs,&#32;ncl,&#32;scl;
<anchor xml:id="_ff_8c_source_1l01530"/>01530 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l01531"/>01531 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01532"/>01532 
<anchor xml:id="_ff_8c_source_1l01533"/>01533 
<anchor xml:id="_ff_8c_source_1l01534"/>01534 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;new&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01535"/>01535 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Suggested&#32;cluster&#32;to&#32;start&#32;to&#32;find&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01536"/>01536 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(scl&#32;==&#32;0&#32;||&#32;scl&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;scl&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01537"/>01537 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01538"/>01538 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Stretch&#32;a&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01539"/>01539 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cs&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(obj,&#32;clst);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;the&#32;cluster&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01540"/>01540 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;&lt;&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;insanity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01541"/>01541 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;cs;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01542"/>01542 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;&lt;&#32;fs-&gt;n_fatent)&#32;<emphasis role="keywordflow">return</emphasis>&#32;cs;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;already&#32;followed&#32;by&#32;next&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01543"/>01543 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;to&#32;start&#32;to&#32;find&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01544"/>01544 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01545"/>01545 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;free&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01546"/>01546 
<anchor xml:id="_ff_8c_source_1l01547"/>01547 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01548"/>01548 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01549"/>01549 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;find_bitmap(fs,&#32;scl,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;free&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01550"/>01550 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;0&#32;||&#32;ncl&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;ncl;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;free&#32;cluster&#32;or&#32;hard&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01551"/>01551 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;change_bitmap(fs,&#32;ncl,&#32;1,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;cluster&#32;&apos;in&#32;use&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01552"/>01552 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l01553"/>01553 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0xFFFFFFFF;
<anchor xml:id="_ff_8c_source_1l01554"/>01554 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;new&#32;chain?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01555"/>01555 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;status&#32;&apos;contiguous&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01556"/>01556 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;stretched&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01557"/>01557 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;==&#32;2&#32;&amp;&amp;&#32;ncl&#32;!=&#32;scl&#32;+&#32;1)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;chain&#32;got&#32;fragmented?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01558"/>01558 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;n_cont&#32;=&#32;scl&#32;-&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;size&#32;of&#32;the&#32;contiguous&#32;part&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01559"/>01559 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;3;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;status&#32;&apos;just&#32;fragmented&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01560"/>01560 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01561"/>01561 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01562"/>01562 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;!=&#32;2)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;file&#32;non-contiguous?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01563"/>01563 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;clst&#32;+&#32;1)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;cluster&#32;next&#32;to&#32;previous&#32;one?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01564"/>01564 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj-&gt;n_frag&#32;=&#32;obj-&gt;n_frag&#32;?&#32;obj-&gt;n_frag&#32;+&#32;1&#32;:&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Increment&#32;size&#32;of&#32;last&#32;framgent&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01565"/>01565 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01566"/>01566 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj-&gt;n_frag&#32;==&#32;0)&#32;obj-&gt;n_frag&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01567"/>01567 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_last_frag(obj,&#32;clst,&#32;ncl);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;last&#32;fragment&#32;on&#32;the&#32;FAT&#32;and&#32;link&#32;it&#32;to&#32;new&#32;one&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01568"/>01568 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;obj-&gt;n_frag&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l01569"/>01569 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01570"/>01570 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01571"/>01571 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l01572"/>01572 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01573"/>01573 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01574"/>01574 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01575"/>01575 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(scl&#32;==&#32;clst)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Stretching&#32;an&#32;existing&#32;chain?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01576"/>01576 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;scl&#32;+&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;if&#32;next&#32;cluster&#32;is&#32;free&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01577"/>01577 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;ncl&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l01578"/>01578 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cs&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(obj,&#32;ncl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;next&#32;cluster&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01579"/>01579 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;==&#32;1&#32;||&#32;cs&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;cs;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01580"/>01580 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;free?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01581"/>01581 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cs&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;at&#32;suggested&#32;cluster&#32;if&#32;it&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01582"/>01582 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;&gt;=&#32;2&#32;&amp;&amp;&#32;cs&#32;&lt;&#32;fs-&gt;n_fatent)&#32;scl&#32;=&#32;cs;
<anchor xml:id="_ff_8c_source_1l01583"/>01583 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01584"/>01584 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01585"/>01585 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01586"/>01586 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;The&#32;new&#32;cluster&#32;cannot&#32;be&#32;contiguous&#32;and&#32;find&#32;another&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01587"/>01587 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;scl;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01588"/>01588 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l01589"/>01589 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01590"/>01590 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;wrap-around&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01591"/>01591 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l01592"/>01592 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;&gt;&#32;scl)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;free&#32;cluster&#32;found?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01593"/>01593 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01594"/>01594 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cs&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(obj,&#32;ncl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;cluster&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01595"/>01595 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Found&#32;a&#32;free&#32;cluster?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01596"/>01596 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cs&#32;==&#32;1&#32;||&#32;cs&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;cs;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01597"/>01597 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;scl)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;free&#32;cluster&#32;found?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01598"/>01598 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01599"/>01599 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01600"/>01600 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(fs,&#32;ncl,&#32;0xFFFFFFFF);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;new&#32;cluster&#32;&apos;EOC&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01601"/>01601 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;clst&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l01602"/>01602 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(fs,&#32;clst,&#32;ncl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Link&#32;it&#32;from&#32;the&#32;previous&#32;one&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01603"/>01603 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01604"/>01604 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01605"/>01605 
<anchor xml:id="_ff_8c_source_1l01606"/>01606 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;FSINFO&#32;if&#32;function&#32;succeeded.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01607"/>01607 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;ncl;
<anchor xml:id="_ff_8c_source_1l01608"/>01608 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;&lt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>--;
<anchor xml:id="_ff_8c_source_1l01609"/>01609 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;|=&#32;1;
<anchor xml:id="_ff_8c_source_1l01610"/>01610 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01611"/>01611 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>)&#32;?&#32;0xFFFFFFFF&#32;:&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Failed.&#32;Generate&#32;error&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01612"/>01612 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01613"/>01613 
<anchor xml:id="_ff_8c_source_1l01614"/>01614 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;ncl;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;new&#32;cluster&#32;number&#32;or&#32;error&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01615"/>01615 }
<anchor xml:id="_ff_8c_source_1l01616"/>01616 
<anchor xml:id="_ff_8c_source_1l01617"/>01617 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01618"/>01618 
<anchor xml:id="_ff_8c_source_1l01619"/>01619 
<anchor xml:id="_ff_8c_source_1l01620"/>01620 
<anchor xml:id="_ff_8c_source_1l01621"/>01621 
<anchor xml:id="_ff_8c_source_1l01622"/>01622 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK</emphasis>
<anchor xml:id="_ff_8c_source_1l01623"/>01623 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01624"/>01624 <emphasis role="comment">/*&#32;FAT&#32;handling&#32;-&#32;Convert&#32;offset&#32;into&#32;cluster&#32;with&#32;link&#32;map&#32;table&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01625"/>01625 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01626"/>01626 
<anchor xml:id="_ff_8c_source_1l01627"/>01627 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clmt_clust&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;&lt;2:Error,&#32;&gt;=2:Cluster&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01628"/>01628 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01629"/>01629 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;ofs&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;offset&#32;to&#32;be&#32;converted&#32;to&#32;cluster#&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01630"/>01630 )
<anchor xml:id="_ff_8c_source_1l01631"/>01631 {
<anchor xml:id="_ff_8c_source_1l01632"/>01632 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl,&#32;ncl;
<anchor xml:id="_ff_8c_source_1l01633"/>01633 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;*tbl;
<anchor xml:id="_ff_8c_source_1l01634"/>01634 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01635"/>01635 
<anchor xml:id="_ff_8c_source_1l01636"/>01636 
<anchor xml:id="_ff_8c_source_1l01637"/>01637 &#32;&#32;&#32;&#32;tbl&#32;=&#32;fp-&gt;cltbl&#32;+&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top&#32;of&#32;CLMT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01638"/>01638 &#32;&#32;&#32;&#32;cl&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>);&#32;<emphasis role="comment">/*&#32;Cluster&#32;order&#32;from&#32;top&#32;of&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01639"/>01639 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l01640"/>01640 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;*tbl++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;cluters&#32;in&#32;the&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01641"/>01641 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;table?&#32;(error)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01642"/>01642 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;&lt;&#32;ncl)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;In&#32;this&#32;fragment?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01643"/>01643 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;-=&#32;ncl;&#32;tbl++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01644"/>01644 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01645"/>01645 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;cl&#32;+&#32;*tbl;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;the&#32;cluster&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01646"/>01646 }
<anchor xml:id="_ff_8c_source_1l01647"/>01647 
<anchor xml:id="_ff_8c_source_1l01648"/>01648 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_FASTSEEK&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01649"/>01649 
<anchor xml:id="_ff_8c_source_1l01650"/>01650 
<anchor xml:id="_ff_8c_source_1l01651"/>01651 
<anchor xml:id="_ff_8c_source_1l01652"/>01652 
<anchor xml:id="_ff_8c_source_1l01653"/>01653 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01654"/>01654 <emphasis role="comment">/*&#32;Directory&#32;handling&#32;-&#32;Fill&#32;a&#32;cluster&#32;with&#32;zeros&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01655"/>01655 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01656"/>01656 
<anchor xml:id="_ff_8c_source_1l01657"/>01657 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01658"/>01658 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_clear&#32;(&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;FR_OK&#32;or&#32;FR_DISK_ERR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01659"/>01659 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01660"/>01660 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;table&#32;to&#32;clear&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01661"/>01661 )
<anchor xml:id="_ff_8c_source_1l01662"/>01662 {
<anchor xml:id="_ff_8c_source_1l01663"/>01663 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l01664"/>01664 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n,&#32;szb;
<anchor xml:id="_ff_8c_source_1l01665"/>01665 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*ibuf;
<anchor xml:id="_ff_8c_source_1l01666"/>01666 
<anchor xml:id="_ff_8c_source_1l01667"/>01667 
<anchor xml:id="_ff_8c_source_1l01668"/>01668 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sync_window(fs)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flush&#32;disk&#32;access&#32;window&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01669"/>01669 &#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;clst);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top&#32;of&#32;the&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01670"/>01670 &#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;=&#32;sect;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;window&#32;to&#32;top&#32;of&#32;the&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01671"/>01671 &#32;&#32;&#32;&#32;memset(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;0,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>);&#32;<emphasis role="comment">/*&#32;Clear&#32;window&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01672"/>01672 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;3&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Quick&#32;table&#32;clear&#32;by&#32;using&#32;multi-secter&#32;write&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01673"/>01673 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;a&#32;temporary&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01674"/>01674 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(szb&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&gt;=&#32;<link linkend="_ff_8c_1aaa791eb9a3f067c6a24c70626bddcc66">MAX_MALLOC</link>)&#32;?&#32;<link linkend="_ff_8c_1aaa791eb9a3f067c6a24c70626bddcc66">MAX_MALLOC</link>&#32;:&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;ibuf&#32;=&#32;0;&#32;szb&#32;&gt;&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&amp;&#32;(ibuf&#32;=&#32;<link linkend="_ffsystem_8c_1ae63913186246b80cfce42dbab9e8bcab">ff_memalloc</link>(szb))&#32;==&#32;0;&#32;szb&#32;/=&#32;2)&#32;;
<anchor xml:id="_ff_8c_source_1l01675"/>01675 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(szb&#32;&gt;&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;allocated?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01676"/>01676 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(ibuf,&#32;0,&#32;szb);
<anchor xml:id="_ff_8c_source_1l01677"/>01677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;szb&#32;/=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bytes&#32;-&gt;&#32;Sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01678"/>01678 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;0;&#32;n&#32;&lt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;&amp;&amp;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;ibuf,&#32;sect&#32;+&#32;n,&#32;szb)&#32;==&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>;&#32;n&#32;+=&#32;szb)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;the&#32;cluster&#32;with&#32;0&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01679"/>01679 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ffsystem_8c_1ab85fd090c8b8b17846ccc1e8cda16a9b">ff_memfree</link>(ibuf);
<anchor xml:id="_ff_8c_source_1l01680"/>01680 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l01681"/>01681 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01682"/>01682 &#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l01683"/>01683 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ibuf&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>;&#32;szb&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;window&#32;buffer&#32;(many&#32;single-sector&#32;writes&#32;may&#32;take&#32;a&#32;time)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01684"/>01684 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;0;&#32;n&#32;&lt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;&amp;&amp;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;ibuf,&#32;sect&#32;+&#32;n,&#32;szb)&#32;==&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>;&#32;n&#32;+=&#32;szb)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;the&#32;cluster&#32;with&#32;0&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01685"/>01685 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01686"/>01686 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(n&#32;==&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01687"/>01687 }
<anchor xml:id="_ff_8c_source_1l01688"/>01688 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01689"/>01689 
<anchor xml:id="_ff_8c_source_1l01690"/>01690 
<anchor xml:id="_ff_8c_source_1l01691"/>01691 
<anchor xml:id="_ff_8c_source_1l01692"/>01692 
<anchor xml:id="_ff_8c_source_1l01693"/>01693 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01694"/>01694 <emphasis role="comment">/*&#32;Directory&#32;handling&#32;-&#32;Set&#32;directory&#32;index&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01695"/>01695 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01696"/>01696 
<anchor xml:id="_ff_8c_source_1l01697"/>01697 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_sdi&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):succeeded,&#32;!=0:error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01698"/>01698 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01699"/>01699 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ofs&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;of&#32;directory&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01700"/>01700 )
<anchor xml:id="_ff_8c_source_1l01701"/>01701 {
<anchor xml:id="_ff_8c_source_1l01702"/>01702 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;csz,&#32;clst;
<anchor xml:id="_ff_8c_source_1l01703"/>01703 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01704"/>01704 
<anchor xml:id="_ff_8c_source_1l01705"/>01705 
<anchor xml:id="_ff_8c_source_1l01706"/>01706 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;?&#32;<link linkend="_ff_8c_1aeac7903cb4fde8e45722fca3244257e7">MAX_DIR_EX</link>&#32;:&#32;<link linkend="_ff_8c_1a556a1452c85d74c908fe071754ce4a71">MAX_DIR</link>)&#32;||&#32;ofs&#32;%&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;range&#32;of&#32;offset&#32;and&#32;alignment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01707"/>01707 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01708"/>01708 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01709"/>01709 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;=&#32;ofs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;current&#32;offset&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01710"/>01710 &#32;&#32;&#32;&#32;clst&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;cluster&#32;(0:root)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01711"/>01711 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;&gt;=&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Replace&#32;cluster#&#32;0&#32;with&#32;root&#32;cluster#&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01712"/>01712 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1afc8c3d5d8408b70379f23382c6e28168">dirbase</link>;
<anchor xml:id="_ff_8c_source_1l01713"/>01713 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;exFAT:&#32;Root&#32;dir&#32;has&#32;an&#32;FAT&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01714"/>01714 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01715"/>01715 
<anchor xml:id="_ff_8c_source_1l01716"/>01716 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Static&#32;table&#32;(root-directory&#32;on&#32;the&#32;FAT&#32;volume)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01717"/>01717 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;/&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;index&#32;out&#32;of&#32;range?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01718"/>01718 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1afc8c3d5d8408b70379f23382c6e28168">dirbase</link>;
<anchor xml:id="_ff_8c_source_1l01719"/>01719 
<anchor xml:id="_ff_8c_source_1l01720"/>01720 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Dynamic&#32;table&#32;(sub-directory&#32;or&#32;root-directory&#32;on&#32;the&#32;FAT32/exFAT&#32;volume)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01721"/>01721 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;csz&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bytes&#32;per&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01722"/>01722 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(ofs&#32;&gt;=&#32;csz)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01723"/>01723 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;clst);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;next&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01724"/>01724 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="comment">/*&#32;Disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01725"/>01725 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;&#32;2&#32;||&#32;clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reached&#32;to&#32;end&#32;of&#32;table&#32;or&#32;internal&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01726"/>01726 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;-=&#32;csz;
<anchor xml:id="_ff_8c_source_1l01727"/>01727 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01728"/>01728 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;clst2sect(fs,&#32;clst);
<anchor xml:id="_ff_8c_source_1l01729"/>01729 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01730"/>01730 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a219d74c6cc62ca86743f35b4dee1bb7e">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;cluster#&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01731"/>01731 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l01732"/>01732 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;+=&#32;ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector#&#32;of&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01733"/>01733 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;(ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;entry&#32;in&#32;the&#32;win[]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01734"/>01734 
<anchor xml:id="_ff_8c_source_1l01735"/>01735 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01736"/>01736 }
<anchor xml:id="_ff_8c_source_1l01737"/>01737 
<anchor xml:id="_ff_8c_source_1l01738"/>01738 
<anchor xml:id="_ff_8c_source_1l01739"/>01739 
<anchor xml:id="_ff_8c_source_1l01740"/>01740 
<anchor xml:id="_ff_8c_source_1l01741"/>01741 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01742"/>01742 <emphasis role="comment">/*&#32;Directory&#32;handling&#32;-&#32;Move&#32;directory&#32;table&#32;index&#32;next&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01743"/>01743 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01744"/>01744 
<anchor xml:id="_ff_8c_source_1l01745"/>01745 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_next&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):succeeded,&#32;FR_NO_FILE:End&#32;of&#32;table,&#32;FR_DENIED:Could&#32;not&#32;stretch&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01746"/>01746 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01747"/>01747 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;stretch&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;0:&#32;Do&#32;not&#32;stretch&#32;table,&#32;1:&#32;Stretch&#32;table&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01748"/>01748 )
<anchor xml:id="_ff_8c_source_1l01749"/>01749 {
<anchor xml:id="_ff_8c_source_1l01750"/>01750 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ofs,&#32;clst;
<anchor xml:id="_ff_8c_source_1l01751"/>01751 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01752"/>01752 
<anchor xml:id="_ff_8c_source_1l01753"/>01753 
<anchor xml:id="_ff_8c_source_1l01754"/>01754 &#32;&#32;&#32;&#32;ofs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01755"/>01755 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;?&#32;<link linkend="_ff_8c_1aeac7903cb4fde8e45722fca3244257e7">MAX_DIR_EX</link>&#32;:&#32;<link linkend="_ff_8c_1a556a1452c85d74c908fe071754ce4a71">MAX_DIR</link>))&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Disable&#32;it&#32;if&#32;the&#32;offset&#32;reached&#32;the&#32;max&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01756"/>01756 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Report&#32;EOT&#32;if&#32;it&#32;has&#32;been&#32;disabled&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01757"/>01757 
<anchor xml:id="_ff_8c_source_1l01758"/>01758 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;changed?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01759"/>01759 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01760"/>01760 
<anchor xml:id="_ff_8c_source_1l01761"/>01761 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a219d74c6cc62ca86743f35b4dee1bb7e">clust</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Static&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01762"/>01762 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;/&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Report&#32;EOT&#32;if&#32;it&#32;reached&#32;end&#32;of&#32;static&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01763"/>01763 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;0;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
<anchor xml:id="_ff_8c_source_1l01764"/>01764 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01765"/>01765 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01766"/>01766 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Dynamic&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01767"/>01767 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1))&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;changed?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01768"/>01768 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a219d74c6cc62ca86743f35b4dee1bb7e">clust</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;next&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01769"/>01769 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;=&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Internal&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01770"/>01770 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="comment">/*&#32;Disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01771"/>01771 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;reached&#32;end&#32;of&#32;dynamic&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01772"/>01772 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01773"/>01773 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!stretch)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;no&#32;stretch,&#32;report&#32;EOT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01774"/>01774 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;0;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
<anchor xml:id="_ff_8c_source_1l01775"/>01775 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01776"/>01776 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a219d74c6cc62ca86743f35b4dee1bb7e">clust</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;a&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01777"/>01777 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;free&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01778"/>01778 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Internal&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01779"/>01779 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="comment">/*&#32;Disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01780"/>01780 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dir_clear(fs,&#32;clst)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clean&#32;up&#32;the&#32;stretched&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01781"/>01781 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;|=&#32;4;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT:&#32;The&#32;directory&#32;has&#32;been&#32;stretched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01782"/>01782 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l01783"/>01783 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!stretch)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(this&#32;line&#32;is&#32;to&#32;suppress&#32;compiler&#32;warning)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01784"/>01784 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;0;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Report&#32;EOT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01785"/>01785 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01786"/>01786 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01787"/>01787 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a219d74c6cc62ca86743f35b4dee1bb7e">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;data&#32;for&#32;new&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01788"/>01788 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;clst2sect(fs,&#32;clst);
<anchor xml:id="_ff_8c_source_1l01789"/>01789 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01790"/>01790 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01791"/>01791 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01792"/>01792 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;=&#32;ofs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01793"/>01793 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;entry&#32;in&#32;the&#32;win[]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01794"/>01794 
<anchor xml:id="_ff_8c_source_1l01795"/>01795 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l01796"/>01796 }
<anchor xml:id="_ff_8c_source_1l01797"/>01797 
<anchor xml:id="_ff_8c_source_1l01798"/>01798 
<anchor xml:id="_ff_8c_source_1l01799"/>01799 
<anchor xml:id="_ff_8c_source_1l01800"/>01800 
<anchor xml:id="_ff_8c_source_1l01801"/>01801 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01802"/>01802 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01803"/>01803 <emphasis role="comment">/*&#32;Directory&#32;handling&#32;-&#32;Reserve&#32;a&#32;block&#32;of&#32;directory&#32;entries&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01804"/>01804 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01805"/>01805 
<anchor xml:id="_ff_8c_source_1l01806"/>01806 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_alloc&#32;(&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):succeeded,&#32;!=0:error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01807"/>01807 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01808"/>01808 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n_ent&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;contiguous&#32;entries&#32;to&#32;allocate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01809"/>01809 )
<anchor xml:id="_ff_8c_source_1l01810"/>01810 {
<anchor xml:id="_ff_8c_source_1l01811"/>01811 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l01812"/>01812 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n;
<anchor xml:id="_ff_8c_source_1l01813"/>01813 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l01814"/>01814 
<anchor xml:id="_ff_8c_source_1l01815"/>01815 
<anchor xml:id="_ff_8c_source_1l01816"/>01816 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);
<anchor xml:id="_ff_8c_source_1l01817"/>01817 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01818"/>01818 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01819"/>01819 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01820"/>01820 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l01821"/>01821 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l01822"/>01822 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01823"/>01823 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;?&#32;(<emphasis role="keywordtype">int</emphasis>)((dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;&amp;&#32;0x80)&#32;==&#32;0)&#32;:&#32;(<emphasis role="keywordtype">int</emphasis>)(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>&#32;||&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;==&#32;0))&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;entry&#32;free?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01824"/>01824 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l01825"/>01825 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>&#32;||&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;==&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;entry&#32;free?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01826"/>01826 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01827"/>01827 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(++n&#32;==&#32;n_ent)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;a&#32;block&#32;of&#32;contiguous&#32;free&#32;entries&#32;found?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01828"/>01828 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01829"/>01829 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;a&#32;free&#32;entry,&#32;restart&#32;to&#32;search&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01830"/>01830 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01831"/>01831 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;1);&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;with&#32;table&#32;stretch&#32;enabled&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01832"/>01832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l01833"/>01833 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01834"/>01834 
<anchor xml:id="_ff_8c_source_1l01835"/>01835 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;<emphasis role="comment">/*&#32;No&#32;directory&#32;entry&#32;to&#32;allocate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01836"/>01836 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l01837"/>01837 }
<anchor xml:id="_ff_8c_source_1l01838"/>01838 
<anchor xml:id="_ff_8c_source_1l01839"/>01839 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01840"/>01840 
<anchor xml:id="_ff_8c_source_1l01841"/>01841 
<anchor xml:id="_ff_8c_source_1l01842"/>01842 
<anchor xml:id="_ff_8c_source_1l01843"/>01843 
<anchor xml:id="_ff_8c_source_1l01844"/>01844 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01845"/>01845 <emphasis role="comment">/*&#32;FAT:&#32;Directory&#32;handling&#32;-&#32;Load/Store&#32;start&#32;cluster&#32;number&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01846"/>01846 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01847"/>01847 
<anchor xml:id="_ff_8c_source_1l01848"/>01848 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ld_clust&#32;(&#32;<emphasis role="comment">/*&#32;Returns&#32;the&#32;top&#32;cluster&#32;value&#32;of&#32;the&#32;SFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01849"/>01849 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;fs&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01850"/>01850 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;key&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01851"/>01851 )
<anchor xml:id="_ff_8c_source_1l01852"/>01852 {
<anchor xml:id="_ff_8c_source_1l01853"/>01853 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl;
<anchor xml:id="_ff_8c_source_1l01854"/>01854 
<anchor xml:id="_ff_8c_source_1l01855"/>01855 &#32;&#32;&#32;&#32;cl&#32;=&#32;ld_word(dir&#32;+&#32;<link linkend="_ff_8c_1aebe0e913bff75a89d38dbcb04baf5dff">DIR_FstClusLO</link>);
<anchor xml:id="_ff_8c_source_1l01856"/>01856 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01857"/>01857 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;|=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)ld_word(dir&#32;+&#32;<link linkend="_ff_8c_1a0bc29c3f09e1e9c40c414f7d50d7905c">DIR_FstClusHI</link>)&#32;&lt;&lt;&#32;16;
<anchor xml:id="_ff_8c_source_1l01858"/>01858 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01859"/>01859 
<anchor xml:id="_ff_8c_source_1l01860"/>01860 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;cl;
<anchor xml:id="_ff_8c_source_1l01861"/>01861 }
<anchor xml:id="_ff_8c_source_1l01862"/>01862 
<anchor xml:id="_ff_8c_source_1l01863"/>01863 
<anchor xml:id="_ff_8c_source_1l01864"/>01864 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01865"/>01865 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;st_clust&#32;(
<anchor xml:id="_ff_8c_source_1l01866"/>01866 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;fs&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01867"/>01867 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;key&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01868"/>01868 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Value&#32;to&#32;be&#32;set&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01869"/>01869 )
<anchor xml:id="_ff_8c_source_1l01870"/>01870 {
<anchor xml:id="_ff_8c_source_1l01871"/>01871 &#32;&#32;&#32;&#32;st_word(dir&#32;+&#32;<link linkend="_ff_8c_1aebe0e913bff75a89d38dbcb04baf5dff">DIR_FstClusLO</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)cl);
<anchor xml:id="_ff_8c_source_1l01872"/>01872 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l01873"/>01873 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dir&#32;+&#32;<link linkend="_ff_8c_1a0bc29c3f09e1e9c40c414f7d50d7905c">DIR_FstClusHI</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)(cl&#32;&gt;&gt;&#32;16));
<anchor xml:id="_ff_8c_source_1l01874"/>01874 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01875"/>01875 }
<anchor xml:id="_ff_8c_source_1l01876"/>01876 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01877"/>01877 
<anchor xml:id="_ff_8c_source_1l01878"/>01878 
<anchor xml:id="_ff_8c_source_1l01879"/>01879 
<anchor xml:id="_ff_8c_source_1l01880"/>01880 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l01881"/>01881 <emphasis role="comment">/*--------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01882"/>01882 <emphasis role="comment">/*&#32;FAT-LFN:&#32;Compare&#32;a&#32;part&#32;of&#32;file&#32;name&#32;with&#32;an&#32;LFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01883"/>01883 <emphasis role="comment">/*--------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01884"/>01884 
<anchor xml:id="_ff_8c_source_1l01885"/>01885 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;cmp_lfn&#32;(&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;1:matched,&#32;0:not&#32;matched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01886"/>01886 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>*&#32;lfnbuf,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;LFN&#32;working&#32;buffer&#32;to&#32;be&#32;compared&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01887"/>01887 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;entry&#32;containing&#32;the&#32;part&#32;of&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01888"/>01888 )
<anchor xml:id="_ff_8c_source_1l01889"/>01889 {
<anchor xml:id="_ff_8c_source_1l01890"/>01890 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;s;
<anchor xml:id="_ff_8c_source_1l01891"/>01891 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc,&#32;uc;
<anchor xml:id="_ff_8c_source_1l01892"/>01892 
<anchor xml:id="_ff_8c_source_1l01893"/>01893 
<anchor xml:id="_ff_8c_source_1l01894"/>01894 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(dir&#32;+&#32;<link linkend="_ff_8c_1ad73024151eff6baea94e680f7928969d">LDIR_FstClusLO</link>)&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;LDIR_FstClusLO&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01895"/>01895 
<anchor xml:id="_ff_8c_source_1l01896"/>01896 &#32;&#32;&#32;&#32;i&#32;=&#32;((dir[<link linkend="_ff_8c_1a6c97d545619e6586b02b5d4f39f7be25">LDIR_Ord</link>]&#32;&amp;&#32;0x3F)&#32;-&#32;1)&#32;*&#32;13;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;LFN&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01897"/>01897 
<anchor xml:id="_ff_8c_source_1l01898"/>01898 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(wc&#32;=&#32;1,&#32;s&#32;=&#32;0;&#32;s&#32;&lt;&#32;13;&#32;s++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Process&#32;all&#32;characters&#32;in&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01899"/>01899 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;=&#32;ld_word(dir&#32;+&#32;LfnOfs[s]);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pick&#32;an&#32;LFN&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01900"/>01900 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l01901"/>01901 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>&#32;+&#32;1&#32;||&#32;<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(uc)&#32;!=&#32;<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(lfnbuf[i++]))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Compare&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01902"/>01902 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;matched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01903"/>01903 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01904"/>01904 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;uc;
<anchor xml:id="_ff_8c_source_1l01905"/>01905 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01906"/>01906 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;!=&#32;0xFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;filler&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01907"/>01907 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01908"/>01908 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01909"/>01909 
<anchor xml:id="_ff_8c_source_1l01910"/>01910 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((dir[<link linkend="_ff_8c_1a6c97d545619e6586b02b5d4f39f7be25">LDIR_Ord</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>)&#32;&amp;&amp;&#32;wc&#32;&amp;&amp;&#32;lfnbuf[i])&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;segment&#32;matched&#32;but&#32;different&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01911"/>01911 
<anchor xml:id="_ff_8c_source_1l01912"/>01912 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;part&#32;of&#32;LFN&#32;matched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01913"/>01913 }
<anchor xml:id="_ff_8c_source_1l01914"/>01914 
<anchor xml:id="_ff_8c_source_1l01915"/>01915 
<anchor xml:id="_ff_8c_source_1l01916"/>01916 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;||&#32;FF_FS_RPATH&#32;&gt;=&#32;2&#32;||&#32;FF_USE_LABEL&#32;||&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l01917"/>01917 <emphasis role="comment">/*-----------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01918"/>01918 <emphasis role="comment">/*&#32;FAT-LFN:&#32;Pick&#32;a&#32;part&#32;of&#32;file&#32;name&#32;from&#32;an&#32;LFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01919"/>01919 <emphasis role="comment">/*-----------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01920"/>01920 
<anchor xml:id="_ff_8c_source_1l01921"/>01921 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;pick_lfn&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;1:succeeded,&#32;0:buffer&#32;overflow&#32;or&#32;invalid&#32;LFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01922"/>01922 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>*&#32;lfnbuf,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01923"/>01923 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;LFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01924"/>01924 )
<anchor xml:id="_ff_8c_source_1l01925"/>01925 {
<anchor xml:id="_ff_8c_source_1l01926"/>01926 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;s;
<anchor xml:id="_ff_8c_source_1l01927"/>01927 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc,&#32;uc;
<anchor xml:id="_ff_8c_source_1l01928"/>01928 
<anchor xml:id="_ff_8c_source_1l01929"/>01929 
<anchor xml:id="_ff_8c_source_1l01930"/>01930 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(dir&#32;+&#32;<link linkend="_ff_8c_1ad73024151eff6baea94e680f7928969d">LDIR_FstClusLO</link>)&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;LDIR_FstClusLO&#32;is&#32;0&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01931"/>01931 
<anchor xml:id="_ff_8c_source_1l01932"/>01932 &#32;&#32;&#32;&#32;i&#32;=&#32;((dir[<link linkend="_ff_8c_1a6c97d545619e6586b02b5d4f39f7be25">LDIR_Ord</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">~LLEF</link>)&#32;-&#32;1)&#32;*&#32;13;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;LFN&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01933"/>01933 
<anchor xml:id="_ff_8c_source_1l01934"/>01934 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(wc&#32;=&#32;1,&#32;s&#32;=&#32;0;&#32;s&#32;&lt;&#32;13;&#32;s++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Process&#32;all&#32;characters&#32;in&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01935"/>01935 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;=&#32;ld_word(dir&#32;+&#32;LfnOfs[s]);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pick&#32;an&#32;LFN&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01936"/>01936 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l01937"/>01937 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>&#32;+&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01938"/>01938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lfnbuf[i++]&#32;=&#32;wc&#32;=&#32;uc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01939"/>01939 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01940"/>01940 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;!=&#32;0xFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;filler&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01941"/>01941 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01942"/>01942 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01943"/>01943 
<anchor xml:id="_ff_8c_source_1l01944"/>01944 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dir[<link linkend="_ff_8c_1a6c97d545619e6586b02b5d4f39f7be25">LDIR_Ord</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>&#32;&amp;&amp;&#32;wc&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;terminator&#32;if&#32;it&#32;is&#32;the&#32;last&#32;LFN&#32;part&#32;and&#32;not&#32;terminated&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01945"/>01945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>&#32;+&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01946"/>01946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lfnbuf[i]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01947"/>01947 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l01948"/>01948 
<anchor xml:id="_ff_8c_source_1l01949"/>01949 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;part&#32;of&#32;LFN&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01950"/>01950 }
<anchor xml:id="_ff_8c_source_1l01951"/>01951 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l01952"/>01952 
<anchor xml:id="_ff_8c_source_1l01953"/>01953 
<anchor xml:id="_ff_8c_source_1l01954"/>01954 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01955"/>01955 <emphasis role="comment">/*-----------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01956"/>01956 <emphasis role="comment">/*&#32;FAT-LFN:&#32;Create&#32;an&#32;entry&#32;of&#32;LFN&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01957"/>01957 <emphasis role="comment">/*-----------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01958"/>01958 
<anchor xml:id="_ff_8c_source_1l01959"/>01959 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;put_lfn&#32;(
<anchor xml:id="_ff_8c_source_1l01960"/>01960 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>*&#32;lfn,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01961"/>01961 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;LFN&#32;entry&#32;to&#32;be&#32;created&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01962"/>01962 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;ord,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LFN&#32;order&#32;(1-20)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01963"/>01963 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;sum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Checksum&#32;of&#32;the&#32;corresponding&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01964"/>01964 )
<anchor xml:id="_ff_8c_source_1l01965"/>01965 {
<anchor xml:id="_ff_8c_source_1l01966"/>01966 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;s;
<anchor xml:id="_ff_8c_source_1l01967"/>01967 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l01968"/>01968 
<anchor xml:id="_ff_8c_source_1l01969"/>01969 
<anchor xml:id="_ff_8c_source_1l01970"/>01970 &#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1ade1d529763d2d097a6d1410956c8a84f">LDIR_Chksum</link>]&#32;=&#32;sum;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;checksum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01971"/>01971 &#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1a28dcd75633b49e40b42a31f0cf5f5929">LDIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8c_1a91161ef62e0e85ba3c2876d3d339473d">AM_LFN</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;attribute.&#32;LFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01972"/>01972 &#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1acb98a052a9be81564b56854df35480a0">LDIR_Type</link>]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01973"/>01973 &#32;&#32;&#32;&#32;st_word(dir&#32;+&#32;<link linkend="_ff_8c_1ad73024151eff6baea94e680f7928969d">LDIR_FstClusLO</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l01974"/>01974 
<anchor xml:id="_ff_8c_source_1l01975"/>01975 &#32;&#32;&#32;&#32;i&#32;=&#32;(ord&#32;-&#32;1)&#32;*&#32;13;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;offset&#32;in&#32;the&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01976"/>01976 &#32;&#32;&#32;&#32;s&#32;=&#32;wc&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l01977"/>01977 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l01978"/>01978 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;!=&#32;0xFFFF)&#32;wc&#32;=&#32;lfn[i++];&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;effective&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01979"/>01979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dir&#32;+&#32;LfnOfs[s],&#32;wc);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01980"/>01980 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0)&#32;wc&#32;=&#32;0xFFFF;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Padding&#32;characters&#32;for&#32;following&#32;items&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01981"/>01981 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++s&#32;&lt;&#32;13);
<anchor xml:id="_ff_8c_source_1l01982"/>01982 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0xFFFF&#32;||&#32;!lfn[i])&#32;ord&#32;|=&#32;<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;LFN&#32;part&#32;is&#32;the&#32;start&#32;of&#32;LFN&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01983"/>01983 &#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1a6c97d545619e6586b02b5d4f39f7be25">LDIR_Ord</link>]&#32;=&#32;ord;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;the&#32;LFN&#32;order&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01984"/>01984 }
<anchor xml:id="_ff_8c_source_1l01985"/>01985 
<anchor xml:id="_ff_8c_source_1l01986"/>01986 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01987"/>01987 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l01988"/>01988 
<anchor xml:id="_ff_8c_source_1l01989"/>01989 
<anchor xml:id="_ff_8c_source_1l01990"/>01990 
<anchor xml:id="_ff_8c_source_1l01991"/>01991 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l01992"/>01992 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01993"/>01993 <emphasis role="comment">/*&#32;FAT-LFN:&#32;Create&#32;a&#32;Numbered&#32;SFN&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01994"/>01994 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01995"/>01995 
<anchor xml:id="_ff_8c_source_1l01996"/>01996 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;gen_numname&#32;(
<anchor xml:id="_ff_8c_source_1l01997"/>01997 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dst,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;buffer&#32;to&#32;store&#32;numbered&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01998"/>01998 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;src,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;SFN&#32;in&#32;directory&#32;form&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l01999"/>01999 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>*&#32;lfn,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02000"/>02000 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;seq&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sequence&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02001"/>02001 )
<anchor xml:id="_ff_8c_source_1l02002"/>02002 {
<anchor xml:id="_ff_8c_source_1l02003"/>02003 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;ns[8],&#32;c;
<anchor xml:id="_ff_8c_source_1l02004"/>02004 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;j;
<anchor xml:id="_ff_8c_source_1l02005"/>02005 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l02006"/>02006 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sreg;
<anchor xml:id="_ff_8c_source_1l02007"/>02007 
<anchor xml:id="_ff_8c_source_1l02008"/>02008 
<anchor xml:id="_ff_8c_source_1l02009"/>02009 &#32;&#32;&#32;&#32;memcpy(dst,&#32;src,&#32;11);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Prepare&#32;the&#32;SFN&#32;to&#32;be&#32;modified&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02010"/>02010 
<anchor xml:id="_ff_8c_source_1l02011"/>02011 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(seq&#32;&gt;&#32;5)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;In&#32;case&#32;of&#32;many&#32;collisions,&#32;generate&#32;a&#32;hash&#32;number&#32;instead&#32;of&#32;sequential&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02012"/>02012 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sreg&#32;=&#32;seq;
<anchor xml:id="_ff_8c_source_1l02013"/>02013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(*lfn)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;CRC&#32;as&#32;hash&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02014"/>02014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;*lfn++;
<anchor xml:id="_ff_8c_source_1l02015"/>02015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;16;&#32;i++)&#32;{
<anchor xml:id="_ff_8c_source_1l02016"/>02016 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sreg&#32;=&#32;(sreg&#32;&lt;&lt;&#32;1)&#32;+&#32;(wc&#32;&amp;&#32;1);
<anchor xml:id="_ff_8c_source_1l02017"/>02017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;&gt;&gt;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02018"/>02018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sreg&#32;&amp;&#32;0x10000)&#32;sreg&#32;^=&#32;0x11021;
<anchor xml:id="_ff_8c_source_1l02019"/>02019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02020"/>02020 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02021"/>02021 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;seq&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)sreg;
<anchor xml:id="_ff_8c_source_1l02022"/>02022 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02023"/>02023 
<anchor xml:id="_ff_8c_source_1l02024"/>02024 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;suffix&#32;(~&#32;+&#32;hexadecimal)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02025"/>02025 &#32;&#32;&#32;&#32;i&#32;=&#32;7;
<anchor xml:id="_ff_8c_source_1l02026"/>02026 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02027"/>02027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)((seq&#32;%&#32;16)&#32;+&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>);&#32;seq&#32;/=&#32;16;
<anchor xml:id="_ff_8c_source_1l02028"/>02028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;&#32;<emphasis role="charliteral">&apos;9&apos;</emphasis>)&#32;c&#32;+=&#32;7;
<anchor xml:id="_ff_8c_source_1l02029"/>02029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ns[i--]&#32;=&#32;c;
<anchor xml:id="_ff_8c_source_1l02030"/>02030 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(i&#32;&amp;&amp;&#32;seq);
<anchor xml:id="_ff_8c_source_1l02031"/>02031 &#32;&#32;&#32;&#32;ns[i]&#32;=&#32;<emphasis role="charliteral">&apos;~&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l02032"/>02032 
<anchor xml:id="_ff_8c_source_1l02033"/>02033 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Append&#32;the&#32;suffix&#32;to&#32;the&#32;SFN&#32;body&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02034"/>02034 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;0;&#32;j&#32;&lt;&#32;i&#32;&amp;&amp;&#32;dst[j]&#32;!=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>;&#32;j++)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;the&#32;offset&#32;to&#32;append&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02035"/>02035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st(dst[j]))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;To&#32;avoid&#32;DBC&#32;break&#32;up&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02036"/>02036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(j&#32;==&#32;i&#32;-&#32;1)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02037"/>02037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;j++;
<anchor xml:id="_ff_8c_source_1l02038"/>02038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02039"/>02039 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02040"/>02040 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Append&#32;the&#32;suffix&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02041"/>02041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dst[j++]&#32;=&#32;(i&#32;&lt;&#32;8)&#32;?&#32;ns[i++]&#32;:&#32;<emphasis role="stringliteral">&apos;&#32;&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l02042"/>02042 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(j&#32;&lt;&#32;8);
<anchor xml:id="_ff_8c_source_1l02043"/>02043 }
<anchor xml:id="_ff_8c_source_1l02044"/>02044 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;&amp;&amp;&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02045"/>02045 
<anchor xml:id="_ff_8c_source_1l02046"/>02046 
<anchor xml:id="_ff_8c_source_1l02047"/>02047 
<anchor xml:id="_ff_8c_source_1l02048"/>02048 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l02049"/>02049 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02050"/>02050 <emphasis role="comment">/*&#32;FAT-LFN:&#32;Calculate&#32;checksum&#32;of&#32;an&#32;SFN&#32;entry&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02051"/>02051 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02052"/>02052 
<anchor xml:id="_ff_8c_source_1l02053"/>02053 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;sum_sfn&#32;(
<anchor xml:id="_ff_8c_source_1l02054"/>02054 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;SFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02055"/>02055 )
<anchor xml:id="_ff_8c_source_1l02056"/>02056 {
<anchor xml:id="_ff_8c_source_1l02057"/>02057 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;sum&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02058"/>02058 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n&#32;=&#32;11;
<anchor xml:id="_ff_8c_source_1l02059"/>02059 
<anchor xml:id="_ff_8c_source_1l02060"/>02060 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02061"/>02061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;(sum&#32;&gt;&gt;&#32;1)&#32;+&#32;(sum&#32;&lt;&lt;&#32;7)&#32;+&#32;*dir++;
<anchor xml:id="_ff_8c_source_1l02062"/>02062 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(--n);
<anchor xml:id="_ff_8c_source_1l02063"/>02063 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;sum;
<anchor xml:id="_ff_8c_source_1l02064"/>02064 }
<anchor xml:id="_ff_8c_source_1l02065"/>02065 
<anchor xml:id="_ff_8c_source_1l02066"/>02066 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02067"/>02067 
<anchor xml:id="_ff_8c_source_1l02068"/>02068 
<anchor xml:id="_ff_8c_source_1l02069"/>02069 
<anchor xml:id="_ff_8c_source_1l02070"/>02070 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l02071"/>02071 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02072"/>02072 <emphasis role="comment">/*&#32;exFAT:&#32;Checksum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02073"/>02073 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02074"/>02074 
<anchor xml:id="_ff_8c_source_1l02075"/>02075 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;xdir_sum&#32;(&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;checksum&#32;of&#32;the&#32;directoly&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02076"/>02076 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dir&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;entry&#32;block&#32;to&#32;be&#32;calculated&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02077"/>02077 )
<anchor xml:id="_ff_8c_source_1l02078"/>02078 {
<anchor xml:id="_ff_8c_source_1l02079"/>02079 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;szblk;
<anchor xml:id="_ff_8c_source_1l02080"/>02080 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;sum;
<anchor xml:id="_ff_8c_source_1l02081"/>02081 
<anchor xml:id="_ff_8c_source_1l02082"/>02082 
<anchor xml:id="_ff_8c_source_1l02083"/>02083 &#32;&#32;&#32;&#32;szblk&#32;=&#32;(dir[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>]&#32;+&#32;1)&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;of&#32;the&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02084"/>02084 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;sum&#32;=&#32;0;&#32;i&#32;&lt;&#32;szblk;&#32;i++)&#32;{
<anchor xml:id="_ff_8c_source_1l02085"/>02085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;<link linkend="_ff_8c_1a784a27bba3d35dddeb57d7fa99670b2a">XDIR_SetSum</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Skip&#32;2-byte&#32;sum&#32;field&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02086"/>02086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i++;
<anchor xml:id="_ff_8c_source_1l02087"/>02087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02088"/>02088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;((sum&#32;&amp;&#32;1)&#32;?&#32;0x8000&#32;:&#32;0)&#32;+&#32;(sum&#32;&gt;&gt;&#32;1)&#32;+&#32;dir[i];
<anchor xml:id="_ff_8c_source_1l02089"/>02089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02090"/>02090 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02091"/>02091 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;sum;
<anchor xml:id="_ff_8c_source_1l02092"/>02092 }
<anchor xml:id="_ff_8c_source_1l02093"/>02093 
<anchor xml:id="_ff_8c_source_1l02094"/>02094 
<anchor xml:id="_ff_8c_source_1l02095"/>02095 
<anchor xml:id="_ff_8c_source_1l02096"/>02096 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;xname_sum&#32;(&#32;<emphasis role="comment">/*&#32;Get&#32;check&#32;sum&#32;(to&#32;be&#32;used&#32;as&#32;hash)&#32;of&#32;the&#32;file&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02097"/>02097 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>*&#32;<link linkend="__dino_game_8cpp_1a8f8f80d37794cde9472343e4487ba3eb">name</link>&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;name&#32;to&#32;be&#32;calculated&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02098"/>02098 )
<anchor xml:id="_ff_8c_source_1l02099"/>02099 {
<anchor xml:id="_ff_8c_source_1l02100"/>02100 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;chr;
<anchor xml:id="_ff_8c_source_1l02101"/>02101 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;sum&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02102"/>02102 
<anchor xml:id="_ff_8c_source_1l02103"/>02103 
<anchor xml:id="_ff_8c_source_1l02104"/>02104 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;((chr&#32;=&#32;*<link linkend="__dino_game_8cpp_1a8f8f80d37794cde9472343e4487ba3eb">name</link>++)&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l02105"/>02105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;chr&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(chr);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;name&#32;needs&#32;to&#32;be&#32;up-case&#32;converted&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02106"/>02106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;((sum&#32;&amp;&#32;1)&#32;?&#32;0x8000&#32;:&#32;0)&#32;+&#32;(sum&#32;&gt;&gt;&#32;1)&#32;+&#32;(chr&#32;&amp;&#32;0xFF);
<anchor xml:id="_ff_8c_source_1l02107"/>02107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;((sum&#32;&amp;&#32;1)&#32;?&#32;0x8000&#32;:&#32;0)&#32;+&#32;(sum&#32;&gt;&gt;&#32;1)&#32;+&#32;(chr&#32;&gt;&gt;&#32;8);
<anchor xml:id="_ff_8c_source_1l02108"/>02108 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02109"/>02109 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;sum;
<anchor xml:id="_ff_8c_source_1l02110"/>02110 }
<anchor xml:id="_ff_8c_source_1l02111"/>02111 
<anchor xml:id="_ff_8c_source_1l02112"/>02112 
<anchor xml:id="_ff_8c_source_1l02113"/>02113 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_USE_MKFS</emphasis>
<anchor xml:id="_ff_8c_source_1l02114"/>02114 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;xsum32&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;32-bit&#32;checksum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02115"/>02115 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;&#32;dat,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Byte&#32;to&#32;be&#32;calculated&#32;(byte-by-byte&#32;processing)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02116"/>02116 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sum&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Previous&#32;sum&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02117"/>02117 )
<anchor xml:id="_ff_8c_source_1l02118"/>02118 {
<anchor xml:id="_ff_8c_source_1l02119"/>02119 &#32;&#32;&#32;&#32;sum&#32;=&#32;((sum&#32;&amp;&#32;1)&#32;?&#32;0x80000000&#32;:&#32;0)&#32;+&#32;(sum&#32;&gt;&gt;&#32;1)&#32;+&#32;dat;
<anchor xml:id="_ff_8c_source_1l02120"/>02120 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;sum;
<anchor xml:id="_ff_8c_source_1l02121"/>02121 }
<anchor xml:id="_ff_8c_source_1l02122"/>02122 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02123"/>02123 
<anchor xml:id="_ff_8c_source_1l02124"/>02124 
<anchor xml:id="_ff_8c_source_1l02125"/>02125 
<anchor xml:id="_ff_8c_source_1l02126"/>02126 <emphasis role="comment">/*------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02127"/>02127 <emphasis role="comment">/*&#32;exFAT:&#32;Get&#32;a&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02128"/>02128 <emphasis role="comment">/*------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02129"/>02129 
<anchor xml:id="_ff_8c_source_1l02130"/>02130 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;load_xdir&#32;(&#32;&#32;<emphasis role="comment">/*&#32;FR_INT_ERR:&#32;invalid&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02131"/>02131 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reading&#32;directory&#32;object&#32;pointing&#32;top&#32;of&#32;the&#32;entry&#32;block&#32;to&#32;load&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02132"/>02132 )
<anchor xml:id="_ff_8c_source_1l02133"/>02133 {
<anchor xml:id="_ff_8c_source_1l02134"/>02134 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l02135"/>02135 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;sz_ent;
<anchor xml:id="_ff_8c_source_1l02136"/>02136 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*dirb&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;dirbuf;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;on-memory&#32;directory&#32;entry&#32;block&#32;85+C0+C1s&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02137"/>02137 
<anchor xml:id="_ff_8c_source_1l02138"/>02138 
<anchor xml:id="_ff_8c_source_1l02139"/>02139 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;file&#32;directory&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02140"/>02140 &#32;&#32;&#32;&#32;res&#32;=&#32;move_window(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02141"/>02141 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02142"/>02142 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;!=&#32;<link linkend="_ff_8c_1a4b213905cd7d1c590f56a8244abc3479">ET_FILEDIR</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;order&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02143"/>02143 &#32;&#32;&#32;&#32;memcpy(dirb&#32;+&#32;0&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);
<anchor xml:id="_ff_8c_source_1l02144"/>02144 &#32;&#32;&#32;&#32;sz_ent&#32;=&#32;(dirb[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>]&#32;+&#32;1)&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>;
<anchor xml:id="_ff_8c_source_1l02145"/>02145 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_ent&#32;&lt;&#32;3&#32;*&#32;SZDIRE&#32;||&#32;sz_ent&#32;&gt;&#32;19&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l02146"/>02146 
<anchor xml:id="_ff_8c_source_1l02147"/>02147 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;stream&#32;extension&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02148"/>02148 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);
<anchor xml:id="_ff_8c_source_1l02149"/>02149 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;cannot&#32;be&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02150"/>02150 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02151"/>02151 &#32;&#32;&#32;&#32;res&#32;=&#32;move_window(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02152"/>02152 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02153"/>02153 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;!=&#32;<link linkend="_ff_8c_1a1166d46cb68eb191dd4991829aab3cf9">ET_STREAM</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;<emphasis role="comment">/*&#32;Invalid&#32;order&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02154"/>02154 &#32;&#32;&#32;&#32;memcpy(dirb&#32;+&#32;1&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);
<anchor xml:id="_ff_8c_source_1l02155"/>02155 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a01c7bbfbe635cd0d0ab3e59a3f44dc64">MAXDIRB</link>(dirb[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>])&#32;&gt;&#32;sz_ent)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l02156"/>02156 
<anchor xml:id="_ff_8c_source_1l02157"/>02157 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;file&#32;name&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02158"/>02158 &#32;&#32;&#32;&#32;i&#32;=&#32;2&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>;&#32;<emphasis role="comment">/*&#32;Name&#32;offset&#32;to&#32;load&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02159"/>02159 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02160"/>02160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);
<anchor xml:id="_ff_8c_source_1l02161"/>02161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;cannot&#32;be&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02162"/>02162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02163"/>02163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02164"/>02164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02165"/>02165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;!=&#32;<link linkend="_ff_8c_1a7e5707cf4bb01cc3b0c7e438cd4c601c">ET_FILENAME</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;order&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02166"/>02166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;&#32;<link linkend="_ff_8c_1a01c7bbfbe635cd0d0ab3e59a3f44dc64">MAXDIRB</link>(<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>))&#32;memcpy(dirb&#32;+&#32;i,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);
<anchor xml:id="_ff_8c_source_1l02167"/>02167 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;((i&#32;+=&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>)&#32;&lt;&#32;sz_ent);
<anchor xml:id="_ff_8c_source_1l02168"/>02168 
<anchor xml:id="_ff_8c_source_1l02169"/>02169 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sanity&#32;check&#32;(do&#32;it&#32;for&#32;only&#32;accessible&#32;object)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02170"/>02170 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;=&#32;<link linkend="_ff_8c_1a01c7bbfbe635cd0d0ab3e59a3f44dc64">MAXDIRB</link>(<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l02171"/>02171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(xdir_sum(dirb)&#32;!=&#32;ld_word(dirb&#32;+&#32;<link linkend="_ff_8c_1a784a27bba3d35dddeb57d7fa99670b2a">XDIR_SetSum</link>))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l02172"/>02172 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02173"/>02173 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l02174"/>02174 }
<anchor xml:id="_ff_8c_source_1l02175"/>02175 
<anchor xml:id="_ff_8c_source_1l02176"/>02176 
<anchor xml:id="_ff_8c_source_1l02177"/>02177 <emphasis role="comment">/*------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02178"/>02178 <emphasis role="comment">/*&#32;exFAT:&#32;Initialize&#32;object&#32;allocation&#32;info&#32;with&#32;loaded&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02179"/>02179 <emphasis role="comment">/*------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02180"/>02180 
<anchor xml:id="_ff_8c_source_1l02181"/>02181 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;init_alloc_info&#32;(
<anchor xml:id="_ff_8c_source_1l02182"/>02182 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02183"/>02183 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;allocation&#32;information&#32;to&#32;be&#32;initialized&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02184"/>02184 )
<anchor xml:id="_ff_8c_source_1l02185"/>02185 {
<anchor xml:id="_ff_8c_source_1l02186"/>02186 &#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02187"/>02187 &#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;ld_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02188"/>02188 &#32;&#32;&#32;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;&amp;&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocation&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02189"/>02189 &#32;&#32;&#32;&#32;obj-&gt;n_frag&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;last&#32;fragment&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02190"/>02190 }
<anchor xml:id="_ff_8c_source_1l02191"/>02191 
<anchor xml:id="_ff_8c_source_1l02192"/>02192 
<anchor xml:id="_ff_8c_source_1l02193"/>02193 
<anchor xml:id="_ff_8c_source_1l02194"/>02194 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;||&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l02195"/>02195 <emphasis role="comment">/*------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02196"/>02196 <emphasis role="comment">/*&#32;exFAT:&#32;Load&#32;the&#32;object&apos;s&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02197"/>02197 <emphasis role="comment">/*------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02198"/>02198 
<anchor xml:id="_ff_8c_source_1l02199"/>02199 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;load_obj_xdir&#32;(
<anchor xml:id="_ff_8c_source_1l02200"/>02200 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Blank&#32;directory&#32;object&#32;to&#32;be&#32;used&#32;to&#32;access&#32;containing&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02201"/>02201 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;with&#32;its&#32;containing&#32;directory&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02202"/>02202 )
<anchor xml:id="_ff_8c_source_1l02203"/>02203 {
<anchor xml:id="_ff_8c_source_1l02204"/>02204 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l02205"/>02205 
<anchor xml:id="_ff_8c_source_1l02206"/>02206 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;object&#32;containing&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02207"/>02207 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l02208"/>02208 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;obj-&gt;c_scl;
<anchor xml:id="_ff_8c_source_1l02209"/>02209 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)obj-&gt;c_size;
<anchor xml:id="_ff_8c_source_1l02210"/>02210 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;obj-&gt;c_size&#32;&amp;&#32;0xFFFFFF00;
<anchor xml:id="_ff_8c_source_1l02211"/>02211 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.n_frag&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02212"/>02212 &#32;&#32;&#32;&#32;dp-&gt;blk_ofs&#32;=&#32;obj-&gt;c_ofs;
<anchor xml:id="_ff_8c_source_1l02213"/>02213 
<anchor xml:id="_ff_8c_source_1l02214"/>02214 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;dp-&gt;blk_ofs);&#32;<emphasis role="comment">/*&#32;Goto&#32;object&apos;s&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02215"/>02215 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02216"/>02216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;load_xdir(dp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;the&#32;object&apos;s&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02217"/>02217 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02218"/>02218 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02219"/>02219 }
<anchor xml:id="_ff_8c_source_1l02220"/>02220 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02221"/>02221 
<anchor xml:id="_ff_8c_source_1l02222"/>02222 
<anchor xml:id="_ff_8c_source_1l02223"/>02223 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l02224"/>02224 <emphasis role="comment">/*----------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02225"/>02225 <emphasis role="comment">/*&#32;exFAT:&#32;Store&#32;the&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02226"/>02226 <emphasis role="comment">/*----------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02227"/>02227 
<anchor xml:id="_ff_8c_source_1l02228"/>02228 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;store_xdir&#32;(
<anchor xml:id="_ff_8c_source_1l02229"/>02229 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02230"/>02230 )
<anchor xml:id="_ff_8c_source_1l02231"/>02231 {
<anchor xml:id="_ff_8c_source_1l02232"/>02232 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l02233"/>02233 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;nent;
<anchor xml:id="_ff_8c_source_1l02234"/>02234 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*dirb&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;dirbuf;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;entry&#32;block&#32;85+C0+C1s&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02235"/>02235 
<anchor xml:id="_ff_8c_source_1l02236"/>02236 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;set&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02237"/>02237 &#32;&#32;&#32;&#32;st_word(dirb&#32;+&#32;<link linkend="_ff_8c_1a784a27bba3d35dddeb57d7fa99670b2a">XDIR_SetSum</link>,&#32;xdir_sum(dirb));
<anchor xml:id="_ff_8c_source_1l02238"/>02238 &#32;&#32;&#32;&#32;nent&#32;=&#32;dirb[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>]&#32;+&#32;1;
<anchor xml:id="_ff_8c_source_1l02239"/>02239 
<anchor xml:id="_ff_8c_source_1l02240"/>02240 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;directory&#32;entry&#32;block&#32;to&#32;the&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02241"/>02241 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;dp-&gt;blk_ofs);
<anchor xml:id="_ff_8c_source_1l02242"/>02242 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02243"/>02243 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02244"/>02244 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02245"/>02245 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dirb,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);
<anchor xml:id="_ff_8c_source_1l02246"/>02246 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02247"/>02247 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(--nent&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02248"/>02248 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dirb&#32;+=&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>;
<anchor xml:id="_ff_8c_source_1l02249"/>02249 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);
<anchor xml:id="_ff_8c_source_1l02250"/>02250 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02251"/>02251 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>)&#32;?&#32;res&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l02252"/>02252 }
<anchor xml:id="_ff_8c_source_1l02253"/>02253 
<anchor xml:id="_ff_8c_source_1l02254"/>02254 
<anchor xml:id="_ff_8c_source_1l02255"/>02255 
<anchor xml:id="_ff_8c_source_1l02256"/>02256 <emphasis role="comment">/*-------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02257"/>02257 <emphasis role="comment">/*&#32;exFAT:&#32;Create&#32;a&#32;new&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02258"/>02258 <emphasis role="comment">/*-------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02259"/>02259 
<anchor xml:id="_ff_8c_source_1l02260"/>02260 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;create_xdir&#32;(
<anchor xml:id="_ff_8c_source_1l02261"/>02261 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;dirb,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;entry&#32;block&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02262"/>02262 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>*&#32;lfn&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;object&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02263"/>02263 )
<anchor xml:id="_ff_8c_source_1l02264"/>02264 {
<anchor xml:id="_ff_8c_source_1l02265"/>02265 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l02266"/>02266 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;nc1,&#32;nlen;
<anchor xml:id="_ff_8c_source_1l02267"/>02267 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l02268"/>02268 
<anchor xml:id="_ff_8c_source_1l02269"/>02269 
<anchor xml:id="_ff_8c_source_1l02270"/>02270 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;file-directory&#32;and&#32;stream-extension&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02271"/>02271 &#32;&#32;&#32;&#32;memset(dirb,&#32;0,&#32;2&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);
<anchor xml:id="_ff_8c_source_1l02272"/>02272 &#32;&#32;&#32;&#32;dirb[0&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;+&#32;<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;=&#32;<link linkend="_ff_8c_1a4b213905cd7d1c590f56a8244abc3479">ET_FILEDIR</link>;
<anchor xml:id="_ff_8c_source_1l02273"/>02273 &#32;&#32;&#32;&#32;dirb[1&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;+&#32;<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;=&#32;<link linkend="_ff_8c_1a1166d46cb68eb191dd4991829aab3cf9">ET_STREAM</link>;
<anchor xml:id="_ff_8c_source_1l02274"/>02274 
<anchor xml:id="_ff_8c_source_1l02275"/>02275 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;file-name&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02276"/>02276 &#32;&#32;&#32;&#32;i&#32;=&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2;&#32;<emphasis role="comment">/*&#32;Top&#32;of&#32;file_name&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02277"/>02277 &#32;&#32;&#32;&#32;nlen&#32;=&#32;nc1&#32;=&#32;0;&#32;wc&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02278"/>02278 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02279"/>02279 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dirb[i++]&#32;=&#32;<link linkend="_ff_8c_1a7e5707cf4bb01cc3b0c7e438cd4c601c">ET_FILENAME</link>;&#32;dirb[i++]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02280"/>02280 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;name&#32;field&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02281"/>02281 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;!=&#32;0&#32;&amp;&amp;&#32;(wc&#32;=&#32;lfn[nlen])&#32;!=&#32;0)&#32;nlen++;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;character&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02282"/>02282 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dirb&#32;+&#32;i,&#32;wc);&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02283"/>02283 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l02284"/>02284 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(i&#32;%&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;!=&#32;0);
<anchor xml:id="_ff_8c_source_1l02285"/>02285 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc1++;
<anchor xml:id="_ff_8c_source_1l02286"/>02286 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(lfn[nlen]);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;next&#32;entry&#32;if&#32;any&#32;char&#32;follows&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02287"/>02287 
<anchor xml:id="_ff_8c_source_1l02288"/>02288 &#32;&#32;&#32;&#32;dirb[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>]&#32;=&#32;nlen;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;name&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02289"/>02289 &#32;&#32;&#32;&#32;dirb[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>]&#32;=&#32;1&#32;+&#32;nc1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;secondary&#32;count&#32;(C0&#32;+&#32;C1s)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02290"/>02290 &#32;&#32;&#32;&#32;st_word(dirb&#32;+&#32;<link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">XDIR_NameHash</link>,&#32;xname_sum(lfn));&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;name&#32;hash&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02291"/>02291 }
<anchor xml:id="_ff_8c_source_1l02292"/>02292 
<anchor xml:id="_ff_8c_source_1l02293"/>02293 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02294"/>02294 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_EXFAT&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02295"/>02295 
<anchor xml:id="_ff_8c_source_1l02296"/>02296 
<anchor xml:id="_ff_8c_source_1l02297"/>02297 
<anchor xml:id="_ff_8c_source_1l02298"/>02298 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;||&#32;FF_FS_RPATH&#32;&gt;=&#32;2&#32;||&#32;FF_USE_LABEL&#32;||&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l02299"/>02299 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02300"/>02300 <emphasis role="comment">/*&#32;Read&#32;an&#32;object&#32;from&#32;the&#32;directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02301"/>02301 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02302"/>02302 
<anchor xml:id="_ff_8c_source_1l02303"/><link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">02303</link> <emphasis role="preprocessor">#define&#32;DIR_READ_FILE(dp)&#32;dir_read(dp,&#32;0)</emphasis>
<anchor xml:id="_ff_8c_source_1l02304"/><link linkend="_ff_8c_1afd5d25039aad72791c8fd0e911ba7e97">02304</link> <emphasis role="preprocessor">#define&#32;DIR_READ_LABEL(dp)&#32;dir_read(dp,&#32;1)</emphasis>
<anchor xml:id="_ff_8c_source_1l02305"/>02305 
<anchor xml:id="_ff_8c_source_1l02306"/>02306 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_read&#32;(
<anchor xml:id="_ff_8c_source_1l02307"/>02307 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02308"/>02308 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filtered&#32;by&#32;0:file/directory&#32;or&#32;1:volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02309"/>02309 )
<anchor xml:id="_ff_8c_source_1l02310"/>02310 {
<anchor xml:id="_ff_8c_source_1l02311"/>02311 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
<anchor xml:id="_ff_8c_source_1l02312"/>02312 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l02313"/>02313 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;attr,&#32;b;
<anchor xml:id="_ff_8c_source_1l02314"/>02314 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l02315"/>02315 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;ord&#32;=&#32;0xFF,&#32;sum&#32;=&#32;0xFF;
<anchor xml:id="_ff_8c_source_1l02316"/>02316 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02317"/>02317 
<anchor xml:id="_ff_8c_source_1l02318"/>02318 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02319"/>02319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02320"/>02320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02321"/>02321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>];&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;the&#32;entry&#32;type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02322"/>02322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;==&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l02323"/>02323 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;Reached&#32;to&#32;end&#32;of&#32;the&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02324"/>02324 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02325"/>02325 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l02326"/>02326 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02327"/>02327 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a46c839d4e87f5873f44166c7b5bf7592">FF_USE_LABEL</link>&#32;&amp;&amp;&#32;vol)&#32;{
<anchor xml:id="_ff_8c_source_1l02328"/>02328 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;==&#32;<link linkend="_ff_8c_1a9c991beac4793083d6bd370735bcb9c6">ET_VLABEL</link>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label&#32;entry?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02329"/>02329 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02330"/>02330 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;==&#32;<link linkend="_ff_8c_1a4b213905cd7d1c590f56a8244abc3479">ET_FILEDIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;the&#32;file&#32;entry&#32;block?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02331"/>02331 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;blk_ofs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>;&#32;<emphasis role="comment">/*&#32;Get&#32;location&#32;of&#32;the&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02332"/>02332 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;load_xdir(dp);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;the&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02333"/>02333 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02334"/>02334 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1aefa78fd6b130faaca4e115602869b57c">AM_MASK</link>;&#32;<emphasis role="comment">/*&#32;Get&#32;attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02335"/>02335 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02336"/>02336 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02337"/>02337 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02338"/>02338 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02339"/>02339 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l02340"/>02340 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02341"/>02341 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02342"/>02342 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;=&#32;attr&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1aefa78fd6b130faaca4e115602869b57c">AM_MASK</link>;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02343"/>02343 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02344"/>02344 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>&#32;||&#32;b&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;||&#32;(<emphasis role="keywordtype">int</emphasis>)((attr&#32;&amp;&#32;~<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>)&#32;==&#32;<link linkend="_ff_8c_1a5cfae62dabae0a54809e43b36685ce7c">AM_VOL</link>)&#32;!=&#32;vol)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;entry&#32;without&#32;valid&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02345"/>02345 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ord&#32;=&#32;0xFF;
<anchor xml:id="_ff_8c_source_1l02346"/>02346 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02347"/>02347 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(attr&#32;==&#32;<link linkend="_ff_8c_1a91161ef62e0e85ba3c2876d3d339473d">AM_LFN</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;LFN&#32;entry&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02348"/>02348 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;&amp;&#32;<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;start&#32;of&#32;an&#32;LFN&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02349"/>02349 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ade1d529763d2d097a6d1410956c8a84f">LDIR_Chksum</link>];
<anchor xml:id="_ff_8c_source_1l02350"/>02350 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>;&#32;ord&#32;=&#32;b;
<anchor xml:id="_ff_8c_source_1l02351"/>02351 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;blk_ofs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>;
<anchor xml:id="_ff_8c_source_1l02352"/>02352 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02353"/>02353 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;LFN&#32;validity&#32;and&#32;capture&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02354"/>02354 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ord&#32;=&#32;(b&#32;==&#32;ord&#32;&amp;&amp;&#32;sum&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ade1d529763d2d097a6d1410956c8a84f">LDIR_Chksum</link>]&#32;&amp;&amp;&#32;pick_lfn(fs-&gt;lfnbuf,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>))&#32;?&#32;ord&#32;-&#32;1&#32;:&#32;0xFF;
<anchor xml:id="_ff_8c_source_1l02355"/>02355 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;SFN&#32;entry&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02356"/>02356 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ord&#32;!=&#32;0&#32;||&#32;sum&#32;!=&#32;sum_sfn(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;a&#32;valid&#32;LFN?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02357"/>02357 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;blk_ofs&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;has&#32;no&#32;LFN.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02358"/>02358 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02359"/>02359 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02360"/>02360 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02361"/>02361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02362"/>02362 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Non&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02363"/>02363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;!=&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>&#32;&amp;&amp;&#32;b&#32;!=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;&amp;&amp;&#32;attr&#32;!=&#32;<link linkend="_ff_8c_1a91161ef62e0e85ba3c2876d3d339473d">AM_LFN</link>&#32;&amp;&amp;&#32;(<emphasis role="keywordtype">int</emphasis>)((attr&#32;&amp;&#32;~<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>)&#32;==&#32;<link linkend="_ff_8c_1a5cfae62dabae0a54809e43b36685ce7c">AM_VOL</link>)&#32;==&#32;vol)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;valid&#32;entry?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02364"/>02364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02365"/>02365 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02366"/>02366 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02367"/>02367 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02368"/>02368 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02369"/>02369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02370"/>02370 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02371"/>02371 
<anchor xml:id="_ff_8c_source_1l02372"/>02372 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;read&#32;operation&#32;on&#32;error&#32;or&#32;EOT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02373"/>02373 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02374"/>02374 }
<anchor xml:id="_ff_8c_source_1l02375"/>02375 
<anchor xml:id="_ff_8c_source_1l02376"/>02376 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;||&#32;FF_USE_LABEL&#32;||&#32;FF_FS_RPATH&#32;&gt;=&#32;2&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02377"/>02377 
<anchor xml:id="_ff_8c_source_1l02378"/>02378 
<anchor xml:id="_ff_8c_source_1l02379"/>02379 
<anchor xml:id="_ff_8c_source_1l02380"/>02380 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02381"/>02381 <emphasis role="comment">/*&#32;Directory&#32;handling&#32;-&#32;Find&#32;an&#32;object&#32;in&#32;the&#32;directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02382"/>02382 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02383"/>02383 
<anchor xml:id="_ff_8c_source_1l02384"/>02384 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_find&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):succeeded,&#32;!=0:error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02385"/>02385 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;with&#32;the&#32;file&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02386"/>02386 )
<anchor xml:id="_ff_8c_source_1l02387"/>02387 {
<anchor xml:id="_ff_8c_source_1l02388"/>02388 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l02389"/>02389 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l02390"/>02390 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;c;
<anchor xml:id="_ff_8c_source_1l02391"/>02391 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l02392"/>02392 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;a,&#32;ord,&#32;sum;
<anchor xml:id="_ff_8c_source_1l02393"/>02393 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02394"/>02394 
<anchor xml:id="_ff_8c_source_1l02395"/>02395 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Rewind&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02396"/>02396 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02397"/>02397 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l02398"/>02398 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02399"/>02399 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;nc;
<anchor xml:id="_ff_8c_source_1l02400"/>02400 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;di,&#32;ni;
<anchor xml:id="_ff_8c_source_1l02401"/>02401 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;hash&#32;=&#32;xname_sum(fs-&gt;lfnbuf);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Hash&#32;value&#32;of&#32;the&#32;name&#32;to&#32;find&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02402"/>02402 
<anchor xml:id="_ff_8c_source_1l02403"/>02403 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;((res&#32;=&#32;<link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">DIR_READ_FILE</link>(dp))&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;an&#32;item&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02404"/>02404 <emphasis role="preprocessor">#if&#32;FF_MAX_LFN&#32;&lt;&#32;255</emphasis>
<anchor xml:id="_ff_8c_source_1l02405"/>02405 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>]&#32;&gt;&#32;<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;comparison&#32;if&#32;inaccessible&#32;object&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02406"/>02406 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02407"/>02407 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">XDIR_NameHash</link>)&#32;!=&#32;hash)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;comparison&#32;if&#32;hash&#32;mismatched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02408"/>02408 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(nc&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>],&#32;di&#32;=&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2,&#32;ni&#32;=&#32;0;&#32;nc;&#32;nc--,&#32;di&#32;+=&#32;2,&#32;ni++)&#32;{&#32;<emphasis role="comment">/*&#32;Compare&#32;the&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02409"/>02409 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((di&#32;%&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>)&#32;==&#32;0)&#32;di&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l02410"/>02410 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(ld_word(fs-&gt;dirbuf&#32;+&#32;di))&#32;!=&#32;<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(fs-&gt;lfnbuf[ni]))&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02411"/>02411 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02412"/>02412 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nc&#32;==&#32;0&#32;&amp;&amp;&#32;!fs-&gt;lfnbuf[ni])&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Name&#32;matched?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02413"/>02413 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02414"/>02414 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02415"/>02415 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02416"/>02416 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02417"/>02417 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02418"/>02418 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l02419"/>02419 &#32;&#32;&#32;&#32;ord&#32;=&#32;sum&#32;=&#32;0xFF;&#32;dp-&gt;blk_ofs&#32;=&#32;0xFFFFFFFF;&#32;<emphasis role="comment">/*&#32;Reset&#32;LFN&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02420"/>02420 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02421"/>02421 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02422"/>02422 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02423"/>02423 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02424"/>02424 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>];
<anchor xml:id="_ff_8c_source_1l02425"/>02425 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;==&#32;0)&#32;{&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;}&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reached&#32;to&#32;end&#32;of&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02426"/>02426 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02427"/>02427 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;=&#32;a&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1aefa78fd6b130faaca4e115602869b57c">AM_MASK</link>;
<anchor xml:id="_ff_8c_source_1l02428"/>02428 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>&#32;||&#32;((a&#32;&amp;&#32;<link linkend="_ff_8c_1a5cfae62dabae0a54809e43b36685ce7c">AM_VOL</link>)&#32;&amp;&amp;&#32;a&#32;!=&#32;<link linkend="_ff_8c_1a91161ef62e0e85ba3c2876d3d339473d">AM_LFN</link>))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;entry&#32;without&#32;valid&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02429"/>02429 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ord&#32;=&#32;0xFF;&#32;dp-&gt;blk_ofs&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reset&#32;LFN&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02430"/>02430 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02431"/>02431 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(a&#32;==&#32;<link linkend="_ff_8c_1a91161ef62e0e85ba3c2876d3d339473d">AM_LFN</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;LFN&#32;entry&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02432"/>02432 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a4355b699eba89ff8a3615ef62128caff">NS_NOLFN</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l02433"/>02433 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&amp;&#32;<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;start&#32;of&#32;LFN&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02434"/>02434 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ade1d529763d2d097a6d1410956c8a84f">LDIR_Chksum</link>];
<anchor xml:id="_ff_8c_source_1l02435"/>02435 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1a31ec96cd263bb14418cb8b7b2b54b3ca">LLEF</link>;&#32;ord&#32;=&#32;c;&#32;&#32;<emphasis role="comment">/*&#32;LFN&#32;start&#32;order&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02436"/>02436 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;blk_ofs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>;&#32;<emphasis role="comment">/*&#32;Start&#32;offset&#32;of&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02437"/>02437 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02438"/>02438 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;LFN&#32;entry&#32;and&#32;compare&#32;it&#32;with&#32;given&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02439"/>02439 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ord&#32;=&#32;(c&#32;==&#32;ord&#32;&amp;&amp;&#32;sum&#32;==&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ade1d529763d2d097a6d1410956c8a84f">LDIR_Chksum</link>]&#32;&amp;&amp;&#32;cmp_lfn(fs-&gt;lfnbuf,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>))&#32;?&#32;ord&#32;-&#32;1&#32;:&#32;0xFF;
<anchor xml:id="_ff_8c_source_1l02440"/>02440 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02441"/>02441 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;SFN&#32;entry&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02442"/>02442 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ord&#32;==&#32;0&#32;&amp;&amp;&#32;sum&#32;==&#32;sum_sfn(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;LFN&#32;matched?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02443"/>02443 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>)&#32;&amp;&amp;&#32;!memcmp(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>,&#32;11))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;SFN&#32;matched?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02444"/>02444 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ord&#32;=&#32;0xFF;&#32;dp-&gt;blk_ofs&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reset&#32;LFN&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02445"/>02445 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02446"/>02446 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02447"/>02447 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Non&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02448"/>02448 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1aefa78fd6b130faaca4e115602869b57c">AM_MASK</link>;
<anchor xml:id="_ff_8c_source_1l02449"/>02449 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a5cfae62dabae0a54809e43b36685ce7c">AM_VOL</link>)&#32;&amp;&amp;&#32;!memcmp(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>,&#32;11))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;valid&#32;entry?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02450"/>02450 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02451"/>02451 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02452"/>02452 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l02453"/>02453 
<anchor xml:id="_ff_8c_source_1l02454"/>02454 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02455"/>02455 }
<anchor xml:id="_ff_8c_source_1l02456"/>02456 
<anchor xml:id="_ff_8c_source_1l02457"/>02457 
<anchor xml:id="_ff_8c_source_1l02458"/>02458 
<anchor xml:id="_ff_8c_source_1l02459"/>02459 
<anchor xml:id="_ff_8c_source_1l02460"/>02460 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l02461"/>02461 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02462"/>02462 <emphasis role="comment">/*&#32;Register&#32;an&#32;object&#32;to&#32;the&#32;directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02463"/>02463 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02464"/>02464 
<anchor xml:id="_ff_8c_source_1l02465"/>02465 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_register&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK:succeeded,&#32;FR_DENIED:no&#32;free&#32;entry&#32;or&#32;too&#32;many&#32;SFN&#32;collision,&#32;FR_DISK_ERR:disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02466"/>02466 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Target&#32;directory&#32;with&#32;object&#32;name&#32;to&#32;be&#32;created&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02467"/>02467 )
<anchor xml:id="_ff_8c_source_1l02468"/>02468 {
<anchor xml:id="_ff_8c_source_1l02469"/>02469 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l02470"/>02470 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l02471"/>02471 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02472"/>02472 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n,&#32;len,&#32;n_ent;
<anchor xml:id="_ff_8c_source_1l02473"/>02473 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;sn[12],&#32;sum;
<anchor xml:id="_ff_8c_source_1l02474"/>02474 
<anchor xml:id="_ff_8c_source_1l02475"/>02475 
<anchor xml:id="_ff_8c_source_1l02476"/>02476 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;(<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>&#32;|&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;name&#32;validity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02477"/>02477 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(len&#32;=&#32;0;&#32;fs-&gt;lfnbuf[len];&#32;len++)&#32;;&#32;<emphasis role="comment">/*&#32;Get&#32;lfn&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02478"/>02478 
<anchor xml:id="_ff_8c_source_1l02479"/>02479 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l02480"/>02480 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02481"/>02481 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_ent&#32;=&#32;(len&#32;+&#32;14)&#32;/&#32;15&#32;+&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;to&#32;allocate&#32;(85+C0+C1s)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02482"/>02482 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_alloc(dp,&#32;n_ent);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;directory&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02483"/>02483 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02484"/>02484 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;blk_ofs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;-&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;(n_ent&#32;-&#32;1);&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;the&#32;allocated&#32;entry&#32;block&#32;offset&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02485"/>02485 
<anchor xml:id="_ff_8c_source_1l02486"/>02486 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;&amp;&#32;4)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Has&#32;the&#32;directory&#32;been&#32;stretched&#32;by&#32;new&#32;allocation?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02487"/>02487 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;&amp;=&#32;~4;
<anchor xml:id="_ff_8c_source_1l02488"/>02488 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_first_frag(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;the&#32;first&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02489"/>02489 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02490"/>02490 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_last_frag(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a219d74c6cc62ca86743f35b4dee1bb7e">clust</link>,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;the&#32;last&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02491"/>02491 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02492"/>02492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;sub-directory?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02493"/>02493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l02494"/>02494 
<anchor xml:id="_ff_8c_source_1l02495"/>02495 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;load_obj_xdir(&amp;dj,&#32;&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>);&#32;<emphasis role="comment">/*&#32;Load&#32;the&#32;object&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02496"/>02496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02497"/>02497 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;+=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Increase&#32;the&#32;directory&#32;size&#32;by&#32;cluster&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02498"/>02498 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);
<anchor xml:id="_ff_8c_source_1l02499"/>02499 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a543e2a11cefac978a0108a7973416d56">XDIR_ValidFileSize</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);
<anchor xml:id="_ff_8c_source_1l02500"/>02500 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;|&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;the&#32;allocation&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02501"/>02501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;object&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02502"/>02502 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02503"/>02503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02504"/>02504 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02505"/>02505 
<anchor xml:id="_ff_8c_source_1l02506"/>02506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;create_xdir(fs-&gt;dirbuf,&#32;fs-&gt;lfnbuf);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;on-memory&#32;directory&#32;block&#32;to&#32;be&#32;written&#32;later&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02507"/>02507 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l02508"/>02508 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02509"/>02509 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02510"/>02510 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02511"/>02511 &#32;&#32;&#32;&#32;memcpy(sn,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>,&#32;12);
<anchor xml:id="_ff_8c_source_1l02512"/>02512 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sn[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;LFN&#32;is&#32;out&#32;of&#32;8.3&#32;format,&#32;generate&#32;a&#32;numbered&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02513"/>02513 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;<link linkend="_ff_8c_1a4355b699eba89ff8a3615ef62128caff">NS_NOLFN</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;only&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02514"/>02514 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;1;&#32;n&#32;&lt;&#32;100;&#32;n++)&#32;{
<anchor xml:id="_ff_8c_source_1l02515"/>02515 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;gen_numname(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>,&#32;sn,&#32;fs-&gt;lfnbuf,&#32;n);&#32;<emphasis role="comment">/*&#32;Generate&#32;a&#32;numbered&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02516"/>02516 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_find(dp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;name&#32;collides&#32;with&#32;existing&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02517"/>02517 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02518"/>02518 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02519"/>02519 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;100)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Abort&#32;if&#32;too&#32;many&#32;collisions&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02520"/>02520 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;&#32;&#32;<emphasis role="comment">/*&#32;Abort&#32;if&#32;the&#32;result&#32;is&#32;other&#32;than&#32;&apos;not&#32;collided&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02521"/>02521 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;sn[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>];
<anchor xml:id="_ff_8c_source_1l02522"/>02522 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02523"/>02523 
<anchor xml:id="_ff_8c_source_1l02524"/>02524 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;an&#32;SFN&#32;with/without&#32;LFNs.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02525"/>02525 &#32;&#32;&#32;&#32;n_ent&#32;=&#32;(sn[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>)&#32;?&#32;(len&#32;+&#32;12)&#32;/&#32;13&#32;+&#32;1&#32;:&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;to&#32;allocate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02526"/>02526 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_alloc(dp,&#32;n_ent);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02527"/>02527 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;--n_ent)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;LFN&#32;entry&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02528"/>02528 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;-&#32;n_ent&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);
<anchor xml:id="_ff_8c_source_1l02529"/>02529 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02530"/>02530 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;sum_sfn(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>);&#32;&#32;<emphasis role="comment">/*&#32;Checksum&#32;value&#32;of&#32;the&#32;SFN&#32;tied&#32;to&#32;the&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02531"/>02531 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;LFN&#32;entries&#32;in&#32;bottom&#32;first&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02532"/>02532 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02533"/>02533 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02534"/>02534 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;put_lfn(fs-&gt;lfnbuf,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)n_ent,&#32;sum);
<anchor xml:id="_ff_8c_source_1l02535"/>02535 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02536"/>02536 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02537"/>02537 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;--n_ent);
<anchor xml:id="_ff_8c_source_1l02538"/>02538 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02539"/>02539 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02540"/>02540 
<anchor xml:id="_ff_8c_source_1l02541"/>02541 <emphasis role="preprocessor">#else&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Non&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02542"/>02542 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_alloc(dp,&#32;1);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;an&#32;entry&#32;for&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02543"/>02543 
<anchor xml:id="_ff_8c_source_1l02544"/>02544 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02545"/>02545 
<anchor xml:id="_ff_8c_source_1l02546"/>02546 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;SFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02547"/>02547 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02548"/>02548 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02549"/>02549 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02550"/>02550 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;0,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;<emphasis role="comment">/*&#32;Clean&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02551"/>02551 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>,&#32;11);&#32;<emphasis role="comment">/*&#32;Put&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02552"/>02552 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l02553"/>02553 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a87ee1f701c2ab941862e3ce00c1c1e9d">DIR_NTres</link>]&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;(<link linkend="_ff_8c_1a4a0e89b504dece19e2e4b02c83782ca2">NS_BODY</link>&#32;|&#32;<link linkend="_ff_8c_1a3b7fad0942e816fdb84d869c1f7a613e">NS_EXT</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;NT&#32;flag&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02554"/>02554 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02555"/>02555 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02556"/>02556 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02557"/>02557 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02558"/>02558 
<anchor xml:id="_ff_8c_source_1l02559"/>02559 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02560"/>02560 }
<anchor xml:id="_ff_8c_source_1l02561"/>02561 
<anchor xml:id="_ff_8c_source_1l02562"/>02562 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02563"/>02563 
<anchor xml:id="_ff_8c_source_1l02564"/>02564 
<anchor xml:id="_ff_8c_source_1l02565"/>02565 
<anchor xml:id="_ff_8c_source_1l02566"/>02566 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_FS_MINIMIZE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l02567"/>02567 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02568"/>02568 <emphasis role="comment">/*&#32;Remove&#32;an&#32;object&#32;from&#32;the&#32;directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02569"/>02569 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02570"/>02570 
<anchor xml:id="_ff_8c_source_1l02571"/>02571 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;dir_remove&#32;(&#32;<emphasis role="comment">/*&#32;FR_OK:Succeeded,&#32;FR_DISK_ERR:A&#32;disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02572"/>02572 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;object&#32;pointing&#32;the&#32;entry&#32;to&#32;be&#32;removed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02573"/>02573 )
<anchor xml:id="_ff_8c_source_1l02574"/>02574 {
<anchor xml:id="_ff_8c_source_1l02575"/>02575 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l02576"/>02576 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l02577"/>02577 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02578"/>02578 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;last&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>;
<anchor xml:id="_ff_8c_source_1l02579"/>02579 
<anchor xml:id="_ff_8c_source_1l02580"/>02580 &#32;&#32;&#32;&#32;res&#32;=&#32;(dp-&gt;blk_ofs&#32;==&#32;0xFFFFFFFF)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;:&#32;dir_sdi(dp,&#32;dp-&gt;blk_ofs);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Goto&#32;top&#32;of&#32;the&#32;entry&#32;block&#32;if&#32;LFN&#32;is&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02581"/>02581 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02582"/>02582 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02583"/>02583 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02584"/>02584 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02585"/>02585 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02586"/>02586 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;&amp;=&#32;0x7F;&#32;<emphasis role="comment">/*&#32;Clear&#32;the&#32;entry&#32;InUse&#32;flag.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02587"/>02587 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02588"/>02588 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;=&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;entry&#32;&apos;deleted&apos;.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02589"/>02589 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02590"/>02590 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02591"/>02591 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;&gt;=&#32;last)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;reached&#32;last&#32;entry&#32;then&#32;all&#32;entries&#32;of&#32;the&#32;object&#32;has&#32;been&#32;deleted.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02592"/>02592 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02593"/>02593 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l02594"/>02594 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l02595"/>02595 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02596"/>02596 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Non&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02597"/>02597 
<anchor xml:id="_ff_8c_source_1l02598"/>02598 &#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l02599"/>02599 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l02600"/>02600 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;=&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;entry&#32;&apos;deleted&apos;.*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02601"/>02601 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l02602"/>02602 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02603"/>02603 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02604"/>02604 
<anchor xml:id="_ff_8c_source_1l02605"/>02605 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l02606"/>02606 }
<anchor xml:id="_ff_8c_source_1l02607"/>02607 
<anchor xml:id="_ff_8c_source_1l02608"/>02608 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_FS_MINIMIZE&#32;==&#32;0&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02609"/>02609 
<anchor xml:id="_ff_8c_source_1l02610"/>02610 
<anchor xml:id="_ff_8c_source_1l02611"/>02611 
<anchor xml:id="_ff_8c_source_1l02612"/>02612 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;||&#32;FF_FS_RPATH&#32;&gt;=&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l02613"/>02613 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02614"/>02614 <emphasis role="comment">/*&#32;Get&#32;file&#32;information&#32;from&#32;directory&#32;entry&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02615"/>02615 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02616"/>02616 
<anchor xml:id="_ff_8c_source_1l02617"/>02617 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;get_fileinfo&#32;(
<anchor xml:id="_ff_8c_source_1l02618"/>02618 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02619"/>02619 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>*&#32;fno&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;information&#32;to&#32;be&#32;filled&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02620"/>02620 )
<anchor xml:id="_ff_8c_source_1l02621"/>02621 {
<anchor xml:id="_ff_8c_source_1l02622"/>02622 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;si,&#32;di;
<anchor xml:id="_ff_8c_source_1l02623"/>02623 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l02624"/>02624 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;lcf;
<anchor xml:id="_ff_8c_source_1l02625"/>02625 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc,&#32;hs;
<anchor xml:id="_ff_8c_source_1l02626"/>02626 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l02627"/>02627 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;nw;
<anchor xml:id="_ff_8c_source_1l02628"/>02628 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l02629"/>02629 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;c;
<anchor xml:id="_ff_8c_source_1l02630"/>02630 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02631"/>02631 
<anchor xml:id="_ff_8c_source_1l02632"/>02632 
<anchor xml:id="_ff_8c_source_1l02633"/>02633 &#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[0]&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invaidate&#32;file&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02634"/>02634 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Exit&#32;if&#32;read&#32;pointer&#32;has&#32;reached&#32;end&#32;of&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02635"/>02635 
<anchor xml:id="_ff_8c_source_1l02636"/>02636 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02637"/>02637 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l02638"/>02638 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02639"/>02639 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;nc&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02640"/>02640 
<anchor xml:id="_ff_8c_source_1l02641"/>02641 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;si&#32;=&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2;&#32;di&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;1st&#32;C1&#32;entry&#32;in&#32;the&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02642"/>02642 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02643"/>02643 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nc&#32;&lt;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>])&#32;{
<anchor xml:id="_ff_8c_source_1l02644"/>02644 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;&gt;=&#32;<link linkend="_ff_8c_1a01c7bbfbe635cd0d0ab3e59a3f44dc64">MAXDIRB</link>(<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncated&#32;directory&#32;block?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02645"/>02645 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02646"/>02646 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02647"/>02647 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((si&#32;%&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>)&#32;==&#32;0)&#32;si&#32;+=&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;entry&#32;type&#32;field&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02648"/>02648 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;ld_word(fs-&gt;dirbuf&#32;+&#32;si);&#32;si&#32;+=&#32;2;&#32;nc++;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02649"/>02649 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;==&#32;0&#32;&amp;&amp;&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(wc))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02650"/>02650 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;wc;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;low&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02651"/>02651 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02652"/>02652 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nw&#32;=&#32;put_utf((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)hs&#32;&lt;&lt;&#32;16&#32;|&#32;wc,&#32;&amp;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di],&#32;<link linkend="_ffconf_8h_1a7d29ac29d2d2db71cc7d045ea38fa927">FF_LFN_BUF</link>&#32;-&#32;di);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;in&#32;API&#32;encoding&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02653"/>02653 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nw&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow&#32;or&#32;wrong&#32;char?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02654"/>02654 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02655"/>02655 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02656"/>02656 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;+=&#32;nw;
<anchor xml:id="_ff_8c_source_1l02657"/>02657 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02658"/>02658 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02659"/>02659 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;di&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Broken&#32;surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02660"/>02660 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;==&#32;0)&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di++]&#32;=&#32;<emphasis role="charliteral">&apos;\?&apos;</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Inaccessible&#32;object&#32;name?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02661"/>02661 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di]&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02662"/>02662 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;altname[0]&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;does&#32;not&#32;support&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02663"/>02663 
<anchor xml:id="_ff_8c_source_1l02664"/>02664 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a838d542585831b085537b363f18205c0">fattrib</link>&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a97c7440ecac113384e04b26a5518a895">AM_MASKX</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02665"/>02665 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a9e5b78ed7190f73de3ebcbdfbd6d1844">fsize</link>&#32;=&#32;(fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a838d542585831b085537b363f18205c0">fattrib</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;?&#32;0&#32;:&#32;ld_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02666"/>02666 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ae0f751b79621bf7b29669f177bbe6b9a">ftime</link>&#32;=&#32;ld_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>&#32;+&#32;0);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02667"/>02667 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a7c01c48a15b1b49da459924437b0bd52">fdate</link>&#32;=&#32;ld_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>&#32;+&#32;2);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Date&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02668"/>02668 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_ff_8c_source_1l02669"/>02669 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l02670"/>02670 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02671"/>02671 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02672"/>02672 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;blk_ofs&#32;!=&#32;0xFFFFFFFF)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;LFN&#32;if&#32;available&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02673"/>02673 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;si&#32;=&#32;di&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02674"/>02674 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02675"/>02675 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(fs-&gt;lfnbuf[si]&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l02676"/>02676 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;fs-&gt;lfnbuf[si++];&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;LFN&#32;character&#32;(UTF-16)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02677"/>02677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;==&#32;0&#32;&amp;&amp;&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(wc))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02678"/>02678 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;wc;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;low&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02679"/>02679 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02680"/>02680 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nw&#32;=&#32;put_utf((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)hs&#32;&lt;&lt;&#32;16&#32;|&#32;wc,&#32;&amp;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di],&#32;<link linkend="_ffconf_8h_1a7d29ac29d2d2db71cc7d045ea38fa927">FF_LFN_BUF</link>&#32;-&#32;di);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;in&#32;API&#32;encoding&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02681"/>02681 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nw&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow&#32;or&#32;wrong&#32;char?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02682"/>02682 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02683"/>02683 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02684"/>02684 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;+=&#32;nw;
<anchor xml:id="_ff_8c_source_1l02685"/>02685 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02686"/>02686 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02687"/>02687 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;di&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Broken&#32;surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02688"/>02688 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di]&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;LFN&#32;(null&#32;string&#32;means&#32;LFN&#32;is&#32;invalid)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02689"/>02689 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02690"/>02690 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02691"/>02691 
<anchor xml:id="_ff_8c_source_1l02692"/>02692 &#32;&#32;&#32;&#32;si&#32;=&#32;di&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02693"/>02693 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(si&#32;&lt;&#32;11)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;SFN&#32;from&#32;SFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02694"/>02694 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[si++];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02695"/>02695 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;padding&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02696"/>02696 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;<link linkend="_ff_8c_1a24b6bc427cbd37fbe76e087f7f188abb">RDDEM</link>)&#32;wc&#32;=&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>;&#32;<emphasis role="comment">/*&#32;Restore&#32;replaced&#32;DDEM&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02697"/>02697 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;==&#32;9&#32;&amp;&amp;&#32;di&#32;&lt;&#32;<link linkend="_ffconf_8h_1ac19c6abcf1fc6e2bbf204003462cfedb">FF_SFN_BUF</link>)&#32;fno-&gt;altname[di++]&#32;=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Insert&#32;a&#32;.&#32;if&#32;extension&#32;is&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02698"/>02698 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;&gt;=&#32;1&#32;</emphasis><emphasis role="comment">/*&#32;Unicode&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02699"/>02699 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc)&#32;&amp;&amp;&#32;si&#32;!=&#32;8&#32;&amp;&amp;&#32;si&#32;!=&#32;11&#32;&amp;&amp;&#32;dbc_2nd(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[si]))&#32;{&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;DBC&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02700"/>02700 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;wc&#32;&lt;&lt;&#32;8&#32;|&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[si++];
<anchor xml:id="_ff_8c_source_1l02701"/>02701 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02702"/>02702 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a52f09f31c84747cc135c90282509961a">ff_oem2uni</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;ANSI/OEM&#32;-&gt;&#32;Unicode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02703"/>02703 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;char&#32;in&#32;the&#32;current&#32;code&#32;page?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02704"/>02704 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02705"/>02705 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02706"/>02706 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nw&#32;=&#32;put_utf(wc,&#32;&amp;fno-&gt;altname[di],&#32;<link linkend="_ffconf_8h_1ac19c6abcf1fc6e2bbf204003462cfedb">FF_SFN_BUF</link>&#32;-&#32;di);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;in&#32;API&#32;encoding&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02707"/>02707 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nw&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02708"/>02708 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02709"/>02709 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02710"/>02710 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;+=&#32;nw;
<anchor xml:id="_ff_8c_source_1l02711"/>02711 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02712"/>02712 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;altname[di++]&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)wc;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;without&#32;any&#32;conversion&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02713"/>02713 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02714"/>02714 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02715"/>02715 &#32;&#32;&#32;&#32;fno-&gt;altname[di]&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;SFN&#32;&#32;(null&#32;string&#32;means&#32;SFN&#32;is&#32;invalid)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02716"/>02716 
<anchor xml:id="_ff_8c_source_1l02717"/>02717 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[0]&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;LFN&#32;is&#32;invalid,&#32;altname[]&#32;needs&#32;to&#32;be&#32;copied&#32;to&#32;fname[]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02718"/>02718 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;==&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;If&#32;LFN&#32;and&#32;SFN&#32;both&#32;are&#32;invalid,&#32;this&#32;object&#32;is&#32;inaccessible&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02719"/>02719 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di++]&#32;=&#32;<emphasis role="charliteral">&apos;\?&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l02720"/>02720 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02721"/>02721 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(si&#32;=&#32;di&#32;=&#32;0,&#32;lcf&#32;=&#32;<link linkend="_ff_8c_1a4a0e89b504dece19e2e4b02c83782ca2">NS_BODY</link>;&#32;fno-&gt;altname[si];&#32;si++,&#32;di++)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Copy&#32;altname[]&#32;to&#32;fname[]&#32;with&#32;case&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02722"/>02722 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)fno-&gt;altname[si];
<anchor xml:id="_ff_8c_source_1l02723"/>02723 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;lcf&#32;=&#32;<link linkend="_ff_8c_1a3b7fad0942e816fdb84d869c1f7a613e">NS_EXT</link>;
<anchor xml:id="_ff_8c_source_1l02724"/>02724 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a89b2514198590e139dd064c5d534f302">IsUpper</link>(wc)&#32;&amp;&amp;&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a87ee1f701c2ab941862e3ce00c1c1e9d">DIR_NTres</link>]&#32;&amp;&#32;lcf))&#32;wc&#32;+=&#32;0x20;
<anchor xml:id="_ff_8c_source_1l02725"/>02725 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di]&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)wc;
<anchor xml:id="_ff_8c_source_1l02726"/>02726 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02727"/>02727 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02728"/>02728 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di]&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02729"/>02729 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a87ee1f701c2ab941862e3ce00c1c1e9d">DIR_NTres</link>])&#32;fno-&gt;altname[0]&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Altname&#32;is&#32;not&#32;needed&#32;if&#32;neither&#32;LFN&#32;nor&#32;case&#32;info&#32;is&#32;exist.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02730"/>02730 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02731"/>02731 
<anchor xml:id="_ff_8c_source_1l02732"/>02732 <emphasis role="preprocessor">#else&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Non-LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02733"/>02733 &#32;&#32;&#32;&#32;si&#32;=&#32;di&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02734"/>02734 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(si&#32;&lt;&#32;11)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Copy&#32;name&#32;body&#32;and&#32;extension&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02735"/>02735 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[si++];
<anchor xml:id="_ff_8c_source_1l02736"/>02736 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;==&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;padding&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02737"/>02737 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;==&#32;<link linkend="_ff_8c_1a24b6bc427cbd37fbe76e087f7f188abb">RDDEM</link>)&#32;c&#32;=&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;replaced&#32;DDEM&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02738"/>02738 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;==&#32;9)&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di++]&#32;=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;<emphasis role="comment">/*&#32;Insert&#32;a&#32;.&#32;if&#32;extension&#32;is&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02739"/>02739 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di++]&#32;=&#32;c;
<anchor xml:id="_ff_8c_source_1l02740"/>02740 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02741"/>02741 &#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[di]&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02742"/>02742 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02743"/>02743 
<anchor xml:id="_ff_8c_source_1l02744"/>02744 &#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a838d542585831b085537b363f18205c0">fattrib</link>&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1aefa78fd6b130faaca4e115602869b57c">AM_MASK</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02745"/>02745 &#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a9e5b78ed7190f73de3ebcbdfbd6d1844">fsize</link>&#32;=&#32;ld_dword(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02746"/>02746 &#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ae0f751b79621bf7b29669f177bbe6b9a">ftime</link>&#32;=&#32;ld_word(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>&#32;+&#32;0);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02747"/>02747 &#32;&#32;&#32;&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a7c01c48a15b1b49da459924437b0bd52">fdate</link>&#32;=&#32;ld_word(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>&#32;+&#32;2);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Date&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02748"/>02748 }
<anchor xml:id="_ff_8c_source_1l02749"/>02749 
<anchor xml:id="_ff_8c_source_1l02750"/>02750 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;||&#32;FF_FS_RPATH&#32;&gt;=&#32;2&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02751"/>02751 
<anchor xml:id="_ff_8c_source_1l02752"/>02752 
<anchor xml:id="_ff_8c_source_1l02753"/>02753 
<anchor xml:id="_ff_8c_source_1l02754"/>02754 <emphasis role="preprocessor">#if&#32;FF_USE_FIND&#32;&amp;&amp;&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l02755"/>02755 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02756"/>02756 <emphasis role="comment">/*&#32;Pattern&#32;matching&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02757"/>02757 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02758"/>02758 
<anchor xml:id="_ff_8c_source_1l02759"/>02759 <emphasis role="preprocessor">#define&#32;FIND_RECURS&#32;4&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Maximum&#32;number&#32;of&#32;wildcard&#32;terms&#32;in&#32;the&#32;pattern&#32;to&#32;limit&#32;recursion&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02760"/>02760 
<anchor xml:id="_ff_8c_source_1l02761"/>02761 
<anchor xml:id="_ff_8c_source_1l02762"/>02762 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;get_achar&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;character&#32;and&#32;advance&#32;ptr&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02763"/>02763 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>**&#32;ptr&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;the&#32;ANSI/OEM&#32;or&#32;Unicode&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02764"/>02764 )
<anchor xml:id="_ff_8c_source_1l02765"/>02765 {
<anchor xml:id="_ff_8c_source_1l02766"/>02766 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;chr;
<anchor xml:id="_ff_8c_source_1l02767"/>02767 
<anchor xml:id="_ff_8c_source_1l02768"/>02768 
<anchor xml:id="_ff_8c_source_1l02769"/>02769 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;&gt;=&#32;1&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Unicode&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02770"/>02770 &#32;&#32;&#32;&#32;chr&#32;=&#32;tchar2uni(ptr);
<anchor xml:id="_ff_8c_source_1l02771"/>02771 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chr&#32;==&#32;0xFFFFFFFF)&#32;chr&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;UTF&#32;encoding&#32;is&#32;recognized&#32;as&#32;end&#32;of&#32;the&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02772"/>02772 &#32;&#32;&#32;&#32;chr&#32;=&#32;<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(chr);
<anchor xml:id="_ff_8c_source_1l02773"/>02773 
<anchor xml:id="_ff_8c_source_1l02774"/>02774 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02775"/>02775 &#32;&#32;&#32;&#32;chr&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*(*ptr)++;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02776"/>02776 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(chr))&#32;chr&#32;-=&#32;0x20;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;ASCII&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02777"/>02777 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l02778"/>02778 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ExCvt&#32;&amp;&amp;&#32;chr&#32;&gt;=&#32;0x80)&#32;chr&#32;=&#32;ExCvt[chr&#32;-&#32;0x80];&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;SBCS&#32;extended&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02779"/>02779 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&lt;&#32;900</emphasis>
<anchor xml:id="_ff_8c_source_1l02780"/>02780 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chr&#32;&gt;=&#32;0x80)&#32;chr&#32;=&#32;ExCvt[chr&#32;-&#32;0x80];&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;SBCS&#32;extended&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02781"/>02781 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02782"/>02782 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0&#32;||&#32;FF_CODE_PAGE&#32;&gt;=&#32;900</emphasis>
<anchor xml:id="_ff_8c_source_1l02783"/>02783 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)chr))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;DBC&#32;2nd&#32;byte&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02784"/>02784 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;chr&#32;=&#32;dbc_2nd((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)**ptr)&#32;?&#32;chr&#32;&lt;&lt;&#32;8&#32;|&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*(*ptr)++&#32;:&#32;0;
<anchor xml:id="_ff_8c_source_1l02785"/>02785 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02786"/>02786 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02787"/>02787 
<anchor xml:id="_ff_8c_source_1l02788"/>02788 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02789"/>02789 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;chr;
<anchor xml:id="_ff_8c_source_1l02790"/>02790 }
<anchor xml:id="_ff_8c_source_1l02791"/>02791 
<anchor xml:id="_ff_8c_source_1l02792"/>02792 
<anchor xml:id="_ff_8c_source_1l02793"/>02793 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;pattern_match&#32;(&#32;&#32;<emphasis role="comment">/*&#32;0:mismatched,&#32;1:matched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02794"/>02794 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;<link linkend="__dino_game_8cpp_1a24a31bc0d344f77c0b94c05f47cbeede">pat</link>,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Matching&#32;pattern&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02795"/>02795 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;nam,&#32;&#32;&#32;<emphasis role="comment">/*&#32;String&#32;to&#32;be&#32;tested&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02796"/>02796 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;skip,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;pre-skip&#32;chars&#32;(number&#32;of&#32;?s,&#32;b8:infinite&#32;(*&#32;specified))&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02797"/>02797 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;recur&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Recursion&#32;count&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02798"/>02798 )
<anchor xml:id="_ff_8c_source_1l02799"/>02799 {
<anchor xml:id="_ff_8c_source_1l02800"/>02800 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*pptr;
<anchor xml:id="_ff_8c_source_1l02801"/>02801 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*nptr;
<anchor xml:id="_ff_8c_source_1l02802"/>02802 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;pchr,&#32;nchr;
<anchor xml:id="_ff_8c_source_1l02803"/>02803 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;sk;
<anchor xml:id="_ff_8c_source_1l02804"/>02804 
<anchor xml:id="_ff_8c_source_1l02805"/>02805 
<anchor xml:id="_ff_8c_source_1l02806"/>02806 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;((skip&#32;&amp;&#32;0xFF)&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pre-skip&#32;name&#32;chars&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02807"/>02807 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!get_achar(&amp;nam))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;<emphasis role="comment">/*&#32;Branch&#32;mismatched&#32;if&#32;less&#32;name&#32;chars&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02808"/>02808 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;skip--;
<anchor xml:id="_ff_8c_source_1l02809"/>02809 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02810"/>02810 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(*<link linkend="__dino_game_8cpp_1a24a31bc0d344f77c0b94c05f47cbeede">pat</link>&#32;==&#32;0&#32;&amp;&amp;&#32;skip)&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Matched?&#32;(short&#32;circuit)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02811"/>02811 
<anchor xml:id="_ff_8c_source_1l02812"/>02812 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02813"/>02813 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pptr&#32;=&#32;<link linkend="__dino_game_8cpp_1a24a31bc0d344f77c0b94c05f47cbeede">pat</link>;&#32;nptr&#32;=&#32;nam;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top&#32;of&#32;pattern&#32;and&#32;name&#32;to&#32;match&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02814"/>02814 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l02815"/>02815 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(*pptr&#32;==&#32;<emphasis role="charliteral">&apos;\?&apos;</emphasis>&#32;||&#32;*pptr&#32;==&#32;<emphasis role="charliteral">&apos;*&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wildcard&#32;term?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02816"/>02816 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(recur&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;wildcard&#32;terms?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02817"/>02817 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sk&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02818"/>02818 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Analyze&#32;the&#32;wildcard&#32;term&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02819"/>02819 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(*pptr++&#32;==&#32;<emphasis role="charliteral">&apos;\?&apos;</emphasis>)&#32;{
<anchor xml:id="_ff_8c_source_1l02820"/>02820 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sk++;
<anchor xml:id="_ff_8c_source_1l02821"/>02821 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02822"/>02822 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sk&#32;|=&#32;0x100;
<anchor xml:id="_ff_8c_source_1l02823"/>02823 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02824"/>02824 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(*pptr&#32;==&#32;<emphasis role="charliteral">&apos;\?&apos;</emphasis>&#32;||&#32;*pptr&#32;==&#32;<emphasis role="charliteral">&apos;*&apos;</emphasis>);
<anchor xml:id="_ff_8c_source_1l02825"/>02825 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pattern_match(pptr,&#32;nptr,&#32;sk,&#32;recur&#32;-&#32;1))&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;<emphasis role="comment">/*&#32;Test&#32;new&#32;branch&#32;(recursive&#32;call)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02826"/>02826 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nchr&#32;=&#32;*nptr;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Branch&#32;mismatched&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02827"/>02827 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02828"/>02828 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pchr&#32;=&#32;get_achar(&amp;pptr);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;pattern&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02829"/>02829 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nchr&#32;=&#32;get_achar(&amp;nptr);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;name&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02830"/>02830 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pchr&#32;!=&#32;nchr)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Branch&#32;mismatched?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02831"/>02831 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pchr&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Branch&#32;matched?&#32;(matched&#32;at&#32;end&#32;of&#32;both&#32;strings)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02832"/>02832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02833"/>02833 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;get_achar(&amp;nam);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;nam++&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02834"/>02834 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(skip&#32;&amp;&amp;&#32;nchr);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Retry&#32;until&#32;end&#32;of&#32;name&#32;if&#32;infinite&#32;search&#32;is&#32;specified&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02835"/>02835 
<anchor xml:id="_ff_8c_source_1l02836"/>02836 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_ff_8c_source_1l02837"/>02837 }
<anchor xml:id="_ff_8c_source_1l02838"/>02838 
<anchor xml:id="_ff_8c_source_1l02839"/>02839 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_FIND&#32;&amp;&amp;&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02840"/>02840 
<anchor xml:id="_ff_8c_source_1l02841"/>02841 
<anchor xml:id="_ff_8c_source_1l02842"/>02842 
<anchor xml:id="_ff_8c_source_1l02843"/>02843 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02844"/>02844 <emphasis role="comment">/*&#32;Pick&#32;a&#32;top&#32;segment&#32;and&#32;create&#32;the&#32;object&#32;name&#32;in&#32;directory&#32;form&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02845"/>02845 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02846"/>02846 
<anchor xml:id="_ff_8c_source_1l02847"/>02847 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;create_name&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK:&#32;successful,&#32;FR_INVALID_NAME:&#32;could&#32;not&#32;create&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02848"/>02848 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02849"/>02849 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>**&#32;path&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;the&#32;segment&#32;in&#32;the&#32;path&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02850"/>02850 )
<anchor xml:id="_ff_8c_source_1l02851"/>02851 {
<anchor xml:id="_ff_8c_source_1l02852"/>02852 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02853"/>02853 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;b,&#32;cf;
<anchor xml:id="_ff_8c_source_1l02854"/>02854 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l02855"/>02855 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;*lfn;
<anchor xml:id="_ff_8c_source_1l02856"/>02856 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;p;
<anchor xml:id="_ff_8c_source_1l02857"/>02857 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;uc;
<anchor xml:id="_ff_8c_source_1l02858"/>02858 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;ni,&#32;si,&#32;di;
<anchor xml:id="_ff_8c_source_1l02859"/>02859 
<anchor xml:id="_ff_8c_source_1l02860"/>02860 
<anchor xml:id="_ff_8c_source_1l02861"/>02861 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;LFN&#32;into&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02862"/>02862 &#32;&#32;&#32;&#32;p&#32;=&#32;*path;&#32;lfn&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;lfnbuf;&#32;di&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02863"/>02863 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l02864"/>02864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;uc&#32;=&#32;tchar2uni(&amp;p);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02865"/>02865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;code&#32;or&#32;UTF&#32;decode&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02866"/>02866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(uc&#32;&gt;=&#32;0x10000)&#32;lfn[di++]&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(uc&#32;&gt;&gt;&#32;16);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;high&#32;surrogate&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02867"/>02867 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)uc;
<anchor xml:id="_ff_8c_source_1l02868"/>02868 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&lt;&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>&#32;||&#32;<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(wc))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;Break&#32;if&#32;end&#32;of&#32;the&#32;path&#32;or&#32;a&#32;separator&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02869"/>02869 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&lt;&#32;0x80&#32;&amp;&amp;&#32;strchr(<emphasis role="stringliteral">&quot;*:&lt;&gt;|\&quot;\?\x7F&quot;</emphasis>,&#32;(<emphasis role="keywordtype">int</emphasis>)wc))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;<emphasis role="comment">/*&#32;Reject&#32;illegal&#32;characters&#32;for&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02870"/>02870 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;&gt;=&#32;<link linkend="_ffconf_8h_1adf88cd7c56034e4b94a6f2b3b83f95bf">FF_MAX_LFN</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reject&#32;too&#32;long&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02871"/>02871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lfn[di++]&#32;=&#32;wc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;Unicode&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02872"/>02872 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02873"/>02873 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&lt;&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Stopped&#32;at&#32;end&#32;of&#32;the&#32;path?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02874"/>02874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cf&#32;=&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;segment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02875"/>02875 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Stopped&#32;at&#32;a&#32;separator&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02876"/>02876 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(*p))&#32;p++;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;duplicated&#32;separators&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02877"/>02877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cf&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;segment&#32;may&#32;follow&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02878"/>02878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4f1355f5f96b054e17ef5883ab29863e">IsTerminator</link>(*p))&#32;cf&#32;=&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>;&#32;<emphasis role="comment">/*&#32;Ignore&#32;terminating&#32;separator&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02879"/>02879 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02880"/>02880 &#32;&#32;&#32;&#32;*path&#32;=&#32;p;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;pointer&#32;to&#32;the&#32;next&#32;segment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02881"/>02881 
<anchor xml:id="_ff_8c_source_1l02882"/>02882 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l02883"/>02883 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((di&#32;==&#32;1&#32;&amp;&amp;&#32;lfn[di&#32;-&#32;1]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;||
<anchor xml:id="_ff_8c_source_1l02884"/>02884 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(di&#32;==&#32;2&#32;&amp;&amp;&#32;lfn[di&#32;-&#32;1]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;&amp;&amp;&#32;lfn[di&#32;-&#32;2]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;this&#32;segment&#32;a&#32;dot&#32;name?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02885"/>02885 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lfn[di]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l02886"/>02886 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;11;&#32;i++)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;dot&#32;name&#32;for&#32;SFN&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02887"/>02887 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[i]&#32;=&#32;(i&#32;&lt;&#32;di)&#32;?&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;:&#32;<emphasis role="stringliteral">&apos;&#32;&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l02888"/>02888 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02889"/>02889 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[i]&#32;=&#32;cf&#32;|&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;This&#32;is&#32;a&#32;dot&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02890"/>02890 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l02891"/>02891 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02892"/>02892 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02893"/>02893 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(di)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;off&#32;trailing&#32;spaces&#32;and&#32;dots&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02894"/>02894 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;lfn[di&#32;-&#32;1];
<anchor xml:id="_ff_8c_source_1l02895"/>02895 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;!=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>&#32;&amp;&amp;&#32;wc&#32;!=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02896"/>02896 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di--;
<anchor xml:id="_ff_8c_source_1l02897"/>02897 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02898"/>02898 &#32;&#32;&#32;&#32;lfn[di]&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LFN&#32;is&#32;created&#32;into&#32;the&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02899"/>02899 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reject&#32;null&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02900"/>02900 
<anchor xml:id="_ff_8c_source_1l02901"/>02901 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;SFN&#32;in&#32;directory&#32;form&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02902"/>02902 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(si&#32;=&#32;0;&#32;lfn[si]&#32;==&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>;&#32;si++)&#32;;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;leading&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02903"/>02903 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;&gt;&#32;0&#32;||&#32;lfn[si]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>&#32;|&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;any&#32;leading&#32;space&#32;or&#32;dot?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02904"/>02904 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(di&#32;&gt;&#32;0&#32;&amp;&amp;&#32;lfn[di&#32;-&#32;1]&#32;!=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;di--;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;last&#32;dot&#32;(di&lt;=si:&#32;no&#32;extension)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02905"/>02905 
<anchor xml:id="_ff_8c_source_1l02906"/>02906 &#32;&#32;&#32;&#32;memset(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>,&#32;11);
<anchor xml:id="_ff_8c_source_1l02907"/>02907 &#32;&#32;&#32;&#32;i&#32;=&#32;b&#32;=&#32;0;&#32;ni&#32;=&#32;8;
<anchor xml:id="_ff_8c_source_1l02908"/>02908 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l02909"/>02909 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;lfn[si++];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;LFN&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02910"/>02910 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Break&#32;on&#32;end&#32;of&#32;the&#32;LFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02911"/>02911 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>&#32;||&#32;(wc&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;&amp;&amp;&#32;si&#32;!=&#32;di))&#32;{&#32;<emphasis role="comment">/*&#32;Remove&#32;embedded&#32;spaces&#32;and&#32;dots&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02912"/>02912 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>&#32;|&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;
<anchor xml:id="_ff_8c_source_1l02913"/>02913 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l02914"/>02914 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02915"/>02915 
<anchor xml:id="_ff_8c_source_1l02916"/>02916 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;ni&#32;||&#32;si&#32;==&#32;di)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;field?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02917"/>02917 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ni&#32;==&#32;11)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Name&#32;extension&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02918"/>02918 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>&#32;|&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;
<anchor xml:id="_ff_8c_source_1l02919"/>02919 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02920"/>02920 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02921"/>02921 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;!=&#32;di)&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>&#32;|&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Name&#32;body&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02922"/>02922 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;&gt;&#32;di)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;name&#32;extension?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02923"/>02923 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;si&#32;=&#32;di;&#32;i&#32;=&#32;8;&#32;ni&#32;=&#32;11;&#32;b&#32;&lt;&lt;=&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Enter&#32;name&#32;extension&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02924"/>02924 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l02925"/>02925 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02926"/>02926 
<anchor xml:id="_ff_8c_source_1l02927"/>02927 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&gt;=&#32;0x80)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;this&#32;an&#32;extended&#32;character?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02928"/>02928 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LFN&#32;entry&#32;needs&#32;to&#32;be&#32;created&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02929"/>02929 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l02930"/>02930 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ExCvt)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;In&#32;SBCS&#32;cfg&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02931"/>02931 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unicode&#32;==&gt;&#32;ANSI/OEM&#32;code&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02932"/>02932 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&amp;&#32;0x80)&#32;wc&#32;=&#32;ExCvt[wc&#32;&amp;&#32;0x7F];&#32;&#32;&#32;<emphasis role="comment">/*&#32;Convert&#32;extended&#32;character&#32;to&#32;upper&#32;(SBCS)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02933"/>02933 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;In&#32;DBCS&#32;cfg&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02934"/>02934 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(wc),&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;<emphasis role="comment">/*&#32;Unicode&#32;==&gt;&#32;Up-convert&#32;==&gt;&#32;ANSI/OEM&#32;code&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02935"/>02935 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02936"/>02936 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&lt;&#32;900&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;In&#32;SBCS&#32;cfg&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02937"/>02937 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unicode&#32;==&gt;&#32;ANSI/OEM&#32;code&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02938"/>02938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&amp;&#32;0x80)&#32;wc&#32;=&#32;ExCvt[wc&#32;&amp;&#32;0x7F];&#32;&#32;&#32;<emphasis role="comment">/*&#32;Convert&#32;extended&#32;character&#32;to&#32;upper&#32;(SBCS)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02939"/>02939 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;In&#32;DBCS&#32;cfg&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02940"/>02940 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(wc),&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;<emphasis role="comment">/*&#32;Unicode&#32;==&gt;&#32;Up-convert&#32;==&gt;&#32;ANSI/OEM&#32;code&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02941"/>02941 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l02942"/>02942 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02943"/>02943 
<anchor xml:id="_ff_8c_source_1l02944"/>02944 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&gt;=&#32;0x100)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;this&#32;a&#32;DBC?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02945"/>02945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;ni&#32;-&#32;1)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Field&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02946"/>02946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>&#32;|&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;
<anchor xml:id="_ff_8c_source_1l02947"/>02947 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;ni;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;field&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02948"/>02948 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02949"/>02949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(wc&#32;&gt;&gt;&#32;8);&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;1st&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02950"/>02950 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;SBC&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02951"/>02951 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0&#32;||&#32;strchr(<emphasis role="stringliteral">&quot;+,;=[]&quot;</emphasis>,&#32;(<emphasis role="keywordtype">int</emphasis>)wc))&#32;{&#32;<emphasis role="comment">/*&#32;Replace&#32;illegal&#32;characters&#32;for&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02952"/>02952 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<emphasis role="charliteral">&apos;_&apos;</emphasis>;&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ac92c92c3a3d6b9235ac98feeb00e565a">NS_LOSS</link>&#32;|&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;<emphasis role="comment">/*&#32;Lossy&#32;conversion&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02953"/>02953 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l02954"/>02954 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a89b2514198590e139dd064c5d534f302">IsUpper</link>(wc))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;ASCII&#32;upper&#32;case?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02955"/>02955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;|=&#32;2;
<anchor xml:id="_ff_8c_source_1l02956"/>02956 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02957"/>02957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(wc))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;ASCII&#32;lower&#32;case?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02958"/>02958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;|=&#32;1;&#32;wc&#32;-=&#32;0x20;
<anchor xml:id="_ff_8c_source_1l02959"/>02959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02960"/>02960 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02961"/>02961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02962"/>02962 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc;
<anchor xml:id="_ff_8c_source_1l02963"/>02963 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02964"/>02964 
<anchor xml:id="_ff_8c_source_1l02965"/>02965 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[0]&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[0]&#32;=&#32;<link linkend="_ff_8c_1a24b6bc427cbd37fbe76e087f7f188abb">RDDEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;the&#32;first&#32;character&#32;collides&#32;with&#32;DDEM,&#32;replace&#32;it&#32;with&#32;RDDEM&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02966"/>02966 
<anchor xml:id="_ff_8c_source_1l02967"/>02967 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ni&#32;==&#32;8)&#32;b&#32;&lt;&lt;=&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Shift&#32;capital&#32;flags&#32;if&#32;no&#32;extension&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02968"/>02968 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((b&#32;&amp;&#32;0x0C)&#32;==&#32;0x0C&#32;||&#32;(b&#32;&amp;&#32;0x03)&#32;==&#32;0x03)&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>;&#32;<emphasis role="comment">/*&#32;LFN&#32;entry&#32;needs&#32;to&#32;be&#32;created&#32;if&#32;composite&#32;capitals&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02969"/>02969 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(cf&#32;&amp;&#32;<link linkend="_ff_8c_1ae957b8d4065ea0b3eed822aec5368d29">NS_LFN</link>))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;LFN&#32;is&#32;in&#32;8.3&#32;format&#32;without&#32;extended&#32;character,&#32;NT&#32;flags&#32;are&#32;created&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02970"/>02970 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;&amp;&#32;0x01)&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1a3b7fad0942e816fdb84d869c1f7a613e">NS_EXT</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;NT&#32;flag&#32;(Extension&#32;has&#32;small&#32;capital&#32;letters&#32;only)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02971"/>02971 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;&amp;&#32;0x04)&#32;cf&#32;|=&#32;<link linkend="_ff_8c_1a4a0e89b504dece19e2e4b02c83782ca2">NS_BODY</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;NT&#32;flag&#32;(Body&#32;has&#32;small&#32;capital&#32;letters&#32;only)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02972"/>02972 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02973"/>02973 
<anchor xml:id="_ff_8c_source_1l02974"/>02974 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;cf;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;SFN&#32;is&#32;created&#32;into&#32;dp-&gt;fn[]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02975"/>02975 
<anchor xml:id="_ff_8c_source_1l02976"/>02976 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l02977"/>02977 
<anchor xml:id="_ff_8c_source_1l02978"/>02978 
<anchor xml:id="_ff_8c_source_1l02979"/>02979 <emphasis role="preprocessor">#else&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;:&#32;Non-LFN&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l02980"/>02980 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;c,&#32;d;
<anchor xml:id="_ff_8c_source_1l02981"/>02981 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*sfn;
<anchor xml:id="_ff_8c_source_1l02982"/>02982 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;ni,&#32;si,&#32;i;
<anchor xml:id="_ff_8c_source_1l02983"/>02983 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*p;
<anchor xml:id="_ff_8c_source_1l02984"/>02984 
<anchor xml:id="_ff_8c_source_1l02985"/>02985 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;file&#32;name&#32;in&#32;directory&#32;form&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02986"/>02986 &#32;&#32;&#32;&#32;p&#32;=&#32;*path;&#32;sfn&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>;
<anchor xml:id="_ff_8c_source_1l02987"/>02987 &#32;&#32;&#32;&#32;memset(sfn,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>,&#32;11);
<anchor xml:id="_ff_8c_source_1l02988"/>02988 &#32;&#32;&#32;&#32;si&#32;=&#32;i&#32;=&#32;0;&#32;ni&#32;=&#32;8;
<anchor xml:id="_ff_8c_source_1l02989"/>02989 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l02990"/>02990 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(p[si]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;this&#32;a&#32;dot&#32;entry?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02991"/>02991 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l02992"/>02992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)p[si++];
<anchor xml:id="_ff_8c_source_1l02993"/>02993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;!=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;||&#32;si&#32;&gt;=&#32;3)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l02994"/>02994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sfn[i++]&#32;=&#32;c;
<anchor xml:id="_ff_8c_source_1l02995"/>02995 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l02996"/>02996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(c)&#32;&amp;&amp;&#32;c&#32;&gt;&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
<anchor xml:id="_ff_8c_source_1l02997"/>02997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*path&#32;=&#32;p&#32;+&#32;si;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;pointer&#32;to&#32;the&#32;next&#32;segment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02998"/>02998 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sfn[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;(c&#32;&lt;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;?&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>&#32;|&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>&#32;:&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;last&#32;segment&#32;flag&#32;if&#32;end&#32;of&#32;the&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l02999"/>02999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l03000"/>03000 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03001"/>03001 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03002"/>03002 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l03003"/>03003 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)p[si++];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03004"/>03004 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&lt;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Break&#32;if&#32;end&#32;of&#32;the&#32;path&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03005"/>03005 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(c))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Break&#32;if&#32;a&#32;separator&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03006"/>03006 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(p[si]))&#32;si++;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;duplicated&#32;separator&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03007"/>03007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l03008"/>03008 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03009"/>03009 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>&#32;||&#32;i&#32;&gt;=&#32;ni)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;body&#32;or&#32;field&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03010"/>03010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ni&#32;==&#32;11&#32;||&#32;c&#32;!=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Field&#32;overflow&#32;or&#32;invalid&#32;dot?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03011"/>03011 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;8;&#32;ni&#32;=&#32;11;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Enter&#32;file&#32;extension&#32;field&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03012"/>03012 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l03013"/>03013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03014"/>03014 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03015"/>03015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ExCvt&#32;&amp;&amp;&#32;c&#32;&gt;=&#32;0x80)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;SBC&#32;extended&#32;character?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03016"/>03016 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;ExCvt[c&#32;&amp;&#32;0x7F];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;SBC&#32;extended&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03017"/>03017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03018"/>03018 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&lt;&#32;900</emphasis>
<anchor xml:id="_ff_8c_source_1l03019"/>03019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;0x80)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;SBC&#32;extended&#32;character?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03020"/>03020 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;ExCvt[c&#32;&amp;&#32;0x7F];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;SBC&#32;extended&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03021"/>03021 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03022"/>03022 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03023"/>03023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st(c))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;it&#32;is&#32;a&#32;DBC&#32;1st&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03024"/>03024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;d&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)p[si++];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;2nd&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03025"/>03025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dbc_2nd(d)&#32;||&#32;i&#32;&gt;=&#32;ni&#32;-&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;<emphasis role="comment">/*&#32;Reject&#32;invalid&#32;DBC&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03026"/>03026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sfn[i++]&#32;=&#32;c;
<anchor xml:id="_ff_8c_source_1l03027"/>03027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sfn[i++]&#32;=&#32;d;
<anchor xml:id="_ff_8c_source_1l03028"/>03028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;SBC&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03029"/>03029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(strchr(<emphasis role="stringliteral">&quot;*+,:;&lt;=&gt;[]|\&quot;\?\x7F&quot;</emphasis>,&#32;(<emphasis role="keywordtype">int</emphasis>)c))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;<emphasis role="comment">/*&#32;Reject&#32;illegal&#32;chrs&#32;for&#32;SFN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03030"/>03030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(c))&#32;c&#32;-=&#32;0x20;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03031"/>03031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sfn[i++]&#32;=&#32;c;
<anchor xml:id="_ff_8c_source_1l03032"/>03032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03033"/>03033 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03034"/>03034 &#32;&#32;&#32;&#32;*path&#32;=&#32;&amp;p[si];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;pointer&#32;to&#32;the&#32;next&#32;segment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03035"/>03035 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;<emphasis role="comment">/*&#32;Reject&#32;nul&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03036"/>03036 
<anchor xml:id="_ff_8c_source_1l03037"/>03037 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sfn[0]&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>)&#32;sfn[0]&#32;=&#32;<link linkend="_ff_8c_1a24b6bc427cbd37fbe76e087f7f188abb">RDDEM</link>;&#32;<emphasis role="comment">/*&#32;If&#32;the&#32;first&#32;character&#32;collides&#32;with&#32;DDEM,&#32;replace&#32;it&#32;with&#32;RDDEM&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03038"/>03038 &#32;&#32;&#32;&#32;sfn[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;(c&#32;&lt;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>&#32;||&#32;p[si]&#32;&lt;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;?&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>&#32;:&#32;0;&#32;<emphasis role="comment">/*&#32;Set&#32;last&#32;segment&#32;flag&#32;if&#32;end&#32;of&#32;the&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03039"/>03039 
<anchor xml:id="_ff_8c_source_1l03040"/>03040 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l03041"/>03041 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LFN&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03042"/>03042 }
<anchor xml:id="_ff_8c_source_1l03043"/>03043 
<anchor xml:id="_ff_8c_source_1l03044"/>03044 
<anchor xml:id="_ff_8c_source_1l03045"/>03045 
<anchor xml:id="_ff_8c_source_1l03046"/>03046 
<anchor xml:id="_ff_8c_source_1l03047"/>03047 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03048"/>03048 <emphasis role="comment">/*&#32;Follow&#32;a&#32;file&#32;path&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03049"/>03049 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03050"/>03050 
<anchor xml:id="_ff_8c_source_1l03051"/>03051 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;follow_path&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):&#32;successful,&#32;!=0:&#32;error&#32;code&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03052"/>03052 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;object&#32;to&#32;return&#32;last&#32;directory&#32;and&#32;found&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03053"/>03053 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Full-path&#32;string&#32;to&#32;find&#32;a&#32;file&#32;or&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03054"/>03054 )
<anchor xml:id="_ff_8c_source_1l03055"/>03055 {
<anchor xml:id="_ff_8c_source_1l03056"/>03056 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l03057"/>03057 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;ns;
<anchor xml:id="_ff_8c_source_1l03058"/>03058 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>;
<anchor xml:id="_ff_8c_source_1l03059"/>03059 
<anchor xml:id="_ff_8c_source_1l03060"/>03060 
<anchor xml:id="_ff_8c_source_1l03061"/>03061 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03062"/>03062 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(*path)&#32;&amp;&amp;&#32;(<link linkend="_ffconf_8h_1a056575130662da5bc7ac26a5b1d25838">FF_STR_VOLUME_ID</link>&#32;!=&#32;2&#32;||&#32;!<link linkend="_ff_8c_1a4f1355f5f96b054e17ef5883ab29863e">IsTerminator</link>(*path)))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Without&#32;heading&#32;separator&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03063"/>03063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;fs-&gt;cdir;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;at&#32;the&#32;current&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03064"/>03064 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l03065"/>03065 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03066"/>03066 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;With&#32;heading&#32;separator&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03067"/>03067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<link linkend="_ff_8c_1ad82f39ae601a5fa01233b70cf8a03080">IsSeparator</link>(*path))&#32;path++;&#32;&#32;<emphasis role="comment">/*&#32;Strip&#32;separators&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03068"/>03068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;from&#32;the&#32;root&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03069"/>03069 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03070"/>03070 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03071"/>03071 &#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.n_frag&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;last&#32;fragment&#32;counter&#32;of&#32;the&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03072"/>03072 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03073"/>03073 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#32;&amp;&amp;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT:&#32;Retrieve&#32;the&#32;sub-directory&apos;s&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03074"/>03074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l03075"/>03075 
<anchor xml:id="_ff_8c_source_1l03076"/>03076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_scl&#32;=&#32;fs-&gt;cdc_scl;
<anchor xml:id="_ff_8c_source_1l03077"/>03077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_size&#32;=&#32;fs-&gt;cdc_size;
<anchor xml:id="_ff_8c_source_1l03078"/>03078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_ofs&#32;=&#32;fs-&gt;cdc_ofs;
<anchor xml:id="_ff_8c_source_1l03079"/>03079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;load_obj_xdir(&amp;dj,&#32;&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>);
<anchor xml:id="_ff_8c_source_1l03080"/>03080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l03081"/>03081 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;ld_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>);
<anchor xml:id="_ff_8c_source_1l03082"/>03082 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;&amp;&#32;2;
<anchor xml:id="_ff_8c_source_1l03083"/>03083 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03084"/>03084 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03085"/>03085 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03086"/>03086 
<anchor xml:id="_ff_8c_source_1l03087"/>03087 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)*path&#32;&lt;&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Null&#32;path&#32;name&#32;is&#32;the&#32;origin&#32;directory&#32;itself&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03088"/>03088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>;
<anchor xml:id="_ff_8c_source_1l03089"/>03089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);
<anchor xml:id="_ff_8c_source_1l03090"/>03090 
<anchor xml:id="_ff_8c_source_1l03091"/>03091 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03092"/>03092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l03093"/>03093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;create_name(dp,&#32;&amp;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;segment&#32;name&#32;of&#32;the&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03094"/>03094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l03095"/>03095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_find(dp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;an&#32;object&#32;with&#32;the&#32;segment&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03096"/>03096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ns&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>];
<anchor xml:id="_ff_8c_source_1l03097"/>03097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Failed&#32;to&#32;find&#32;the&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03098"/>03098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;is&#32;not&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03099"/>03099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1af0d4b41a010f1a611bc6fb9e42357350">FF_FS_RPATH</link>&#32;&amp;&amp;&#32;(ns&#32;&amp;&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>))&#32;{&#32;<emphasis role="comment">/*&#32;If&#32;dot&#32;entry&#32;is&#32;not&#32;exist,&#32;stay&#32;there&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03100"/>03100 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(ns&#32;&amp;&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>))&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Continue&#32;to&#32;follow&#32;if&#32;not&#32;last&#32;segment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03101"/>03101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;=&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>;
<anchor xml:id="_ff_8c_source_1l03102"/>03102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l03103"/>03103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Could&#32;not&#32;find&#32;the&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03104"/>03104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(ns&#32;&amp;&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>))&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;error&#32;code&#32;if&#32;not&#32;last&#32;segment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03105"/>03105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03106"/>03106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03107"/>03107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l03108"/>03108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03109"/>03109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ns&#32;&amp;&#32;<link linkend="_ff_8c_1a5a0742bfc1d94f0c3baa5ede485048c4">NS_LAST</link>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;segment&#32;matched.&#32;Function&#32;completed.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03110"/>03110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;into&#32;the&#32;sub-directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03111"/>03111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;{&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;not&#32;a&#32;sub-directory&#32;and&#32;cannot&#32;follow&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03112"/>03112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l03113"/>03113 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03114"/>03114 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03115"/>03115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;containing&#32;directory&#32;information&#32;for&#32;next&#32;dir&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03116"/>03116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_scl&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
<anchor xml:id="_ff_8c_source_1l03117"/>03117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
<anchor xml:id="_ff_8c_source_1l03118"/>03118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_ofs&#32;=&#32;dp-&gt;blk_ofs;
<anchor xml:id="_ff_8c_source_1l03119"/>03119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>);&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;next&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03120"/>03120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l03121"/>03121 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03122"/>03122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03123"/>03123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_clust(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));&#32;<emphasis role="comment">/*&#32;Open&#32;next&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03124"/>03124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03125"/>03125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03126"/>03126 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03127"/>03127 
<anchor xml:id="_ff_8c_source_1l03128"/>03128 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l03129"/>03129 }
<anchor xml:id="_ff_8c_source_1l03130"/>03130 
<anchor xml:id="_ff_8c_source_1l03131"/>03131 
<anchor xml:id="_ff_8c_source_1l03132"/>03132 
<anchor xml:id="_ff_8c_source_1l03133"/>03133 
<anchor xml:id="_ff_8c_source_1l03134"/>03134 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03135"/>03135 <emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;number&#32;from&#32;path&#32;name&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03136"/>03136 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03137"/>03137 
<anchor xml:id="_ff_8c_source_1l03138"/>03138 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;get_ldnumber&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;logical&#32;drive&#32;number&#32;(-1:invalid&#32;drive&#32;number&#32;or&#32;null&#32;pointer)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03139"/>03139 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>**&#32;path&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;the&#32;path&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03140"/>03140 )
<anchor xml:id="_ff_8c_source_1l03141"/>03141 {
<anchor xml:id="_ff_8c_source_1l03142"/>03142 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*tp;
<anchor xml:id="_ff_8c_source_1l03143"/>03143 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*tt;
<anchor xml:id="_ff_8c_source_1l03144"/>03144 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;tc;
<anchor xml:id="_ff_8c_source_1l03145"/>03145 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;i;
<anchor xml:id="_ff_8c_source_1l03146"/>03146 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol&#32;=&#32;-1;
<anchor xml:id="_ff_8c_source_1l03147"/>03147 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Find&#32;string&#32;volume&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03148"/>03148 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*sp;
<anchor xml:id="_ff_8c_source_1l03149"/>03149 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;c;
<anchor xml:id="_ff_8c_source_1l03150"/>03150 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03151"/>03151 
<anchor xml:id="_ff_8c_source_1l03152"/>03152 &#32;&#32;&#32;&#32;tt&#32;=&#32;tp&#32;=&#32;*path;
<anchor xml:id="_ff_8c_source_1l03153"/>03153 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!tp)&#32;<emphasis role="keywordflow">return</emphasis>&#32;vol;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;path&#32;name?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03154"/>03154 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;colon&#32;in&#32;the&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03155"/>03155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*tt++;
<anchor xml:id="_ff_8c_source_1l03156"/>03156 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(!<link linkend="_ff_8c_1a4f1355f5f96b054e17ef5883ab29863e">IsTerminator</link>(tc)&#32;&amp;&amp;&#32;tc&#32;!=&#32;<emphasis role="charliteral">&apos;:&apos;</emphasis>);
<anchor xml:id="_ff_8c_source_1l03157"/>03157 
<anchor xml:id="_ff_8c_source_1l03158"/>03158 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;:&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;DOS/Windows&#32;style&#32;volume&#32;ID?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03159"/>03159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>;
<anchor xml:id="_ff_8c_source_1l03160"/>03160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a65dee564f69f2ec27f25b67a348018b9">IsDigit</link>(*tp)&#32;&amp;&amp;&#32;tp&#32;+&#32;2&#32;==&#32;tt)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;a&#32;numeric&#32;volume&#32;ID&#32;+&#32;colon?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03161"/>03161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;(int)*tp&#32;-&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;LD&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03162"/>03162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03163"/>03163 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;==&#32;1&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Arbitrary&#32;string&#32;is&#32;enabled&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03164"/>03164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03165"/>03165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03166"/>03166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03167"/>03167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sp&#32;=&#32;VolumeStr[i];&#32;tp&#32;=&#32;*path;&#32;&#32;<emphasis role="comment">/*&#32;This&#32;string&#32;volume&#32;ID&#32;and&#32;path&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03168"/>03168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Compare&#32;the&#32;volume&#32;ID&#32;with&#32;path&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03169"/>03169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;*sp++;&#32;tc&#32;=&#32;*tp++;
<anchor xml:id="_ff_8c_source_1l03170"/>03170 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(c))&#32;c&#32;-=&#32;0x20;
<anchor xml:id="_ff_8c_source_1l03171"/>03171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(tc))&#32;tc&#32;-=&#32;0x20;
<anchor xml:id="_ff_8c_source_1l03172"/>03172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(c&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)c&#32;==&#32;tc);
<anchor xml:id="_ff_8c_source_1l03173"/>03173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;((c&#32;||&#32;tp&#32;!=&#32;tt)&#32;&amp;&amp;&#32;++i&#32;&lt;&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>);&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;for&#32;each&#32;id&#32;until&#32;pattern&#32;match&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03174"/>03174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03175"/>03175 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03176"/>03176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;a&#32;volume&#32;ID&#32;is&#32;found,&#32;get&#32;the&#32;drive&#32;number&#32;and&#32;strip&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03177"/>03177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vol&#32;=&#32;i;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03178"/>03178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*path&#32;=&#32;tt;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;the&#32;drive&#32;prefix&#32;off&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03179"/>03179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03180"/>03180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;vol;
<anchor xml:id="_ff_8c_source_1l03181"/>03181 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03182"/>03182 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;==&#32;2&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Unix&#32;style&#32;volume&#32;ID&#32;is&#32;enabled&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03183"/>03183 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(*tp&#32;==&#32;<emphasis role="charliteral">&apos;/&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;a&#32;volume&#32;ID?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03184"/>03184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(*(tp&#32;+&#32;1)&#32;==&#32;<emphasis role="charliteral">&apos;/&apos;</emphasis>)&#32;tp++;&#32;&#32;<emphasis role="comment">/*&#32;Skip&#32;duplicated&#32;separator&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03185"/>03185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03186"/>03186 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03187"/>03187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tt&#32;=&#32;tp;&#32;sp&#32;=&#32;VolumeStr[i];&#32;<emphasis role="comment">/*&#32;Path&#32;name&#32;and&#32;this&#32;string&#32;volume&#32;ID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03188"/>03188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Compare&#32;the&#32;volume&#32;ID&#32;with&#32;path&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03189"/>03189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;*sp++;&#32;tc&#32;=&#32;*(++tt);
<anchor xml:id="_ff_8c_source_1l03190"/>03190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(c))&#32;c&#32;-=&#32;0x20;
<anchor xml:id="_ff_8c_source_1l03191"/>03191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(tc))&#32;tc&#32;-=&#32;0x20;
<anchor xml:id="_ff_8c_source_1l03192"/>03192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(c&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)c&#32;==&#32;tc);
<anchor xml:id="_ff_8c_source_1l03193"/>03193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;((c&#32;||&#32;(tc&#32;!=&#32;<emphasis role="charliteral">&apos;/&apos;</emphasis>&#32;&amp;&amp;&#32;!<link linkend="_ff_8c_1a4f1355f5f96b054e17ef5883ab29863e">IsTerminator</link>(tc)))&#32;&amp;&amp;&#32;++i&#32;&lt;&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>);&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;for&#32;each&#32;ID&#32;until&#32;pattern&#32;match&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03194"/>03194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;a&#32;volume&#32;ID&#32;is&#32;found,&#32;get&#32;the&#32;drive&#32;number&#32;and&#32;strip&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03195"/>03195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vol&#32;=&#32;i;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03196"/>03196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*path&#32;=&#32;tt;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;the&#32;drive&#32;prefix&#32;off&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03197"/>03197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03198"/>03198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;vol;
<anchor xml:id="_ff_8c_source_1l03199"/>03199 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03200"/>03200 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03201"/>03201 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;drive&#32;prefix&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03202"/>03202 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03203"/>03203 &#32;&#32;&#32;&#32;vol&#32;=&#32;CurrVol;&#32;&#32;<emphasis role="comment">/*&#32;Default&#32;drive&#32;is&#32;current&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03204"/>03204 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l03205"/>03205 &#32;&#32;&#32;&#32;vol&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Default&#32;drive&#32;is&#32;0&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03206"/>03206 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03207"/>03207 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;vol;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;the&#32;default&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03208"/>03208 }
<anchor xml:id="_ff_8c_source_1l03209"/>03209 
<anchor xml:id="_ff_8c_source_1l03210"/>03210 
<anchor xml:id="_ff_8c_source_1l03211"/>03211 
<anchor xml:id="_ff_8c_source_1l03212"/>03212 
<anchor xml:id="_ff_8c_source_1l03213"/>03213 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03214"/>03214 <emphasis role="comment">/*&#32;GPT&#32;support&#32;functions&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03215"/>03215 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03216"/>03216 
<anchor xml:id="_ff_8c_source_1l03217"/>03217 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l03218"/>03218 
<anchor xml:id="_ff_8c_source_1l03219"/>03219 <emphasis role="comment">/*&#32;Calculate&#32;CRC32&#32;in&#32;byte-by-byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03220"/>03220 
<anchor xml:id="_ff_8c_source_1l03221"/>03221 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;crc32&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;next&#32;CRC&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03222"/>03222 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;crc,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;CRC&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03223"/>03223 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;d&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;byte&#32;to&#32;be&#32;processed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03224"/>03224 )
<anchor xml:id="_ff_8c_source_1l03225"/>03225 {
<anchor xml:id="_ff_8c_source_1l03226"/>03226 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;b;
<anchor xml:id="_ff_8c_source_1l03227"/>03227 
<anchor xml:id="_ff_8c_source_1l03228"/>03228 
<anchor xml:id="_ff_8c_source_1l03229"/>03229 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(b&#32;=&#32;1;&#32;b;&#32;b&#32;&lt;&lt;=&#32;1)&#32;{
<anchor xml:id="_ff_8c_source_1l03230"/>03230 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;crc&#32;^=&#32;(d&#32;&amp;&#32;b)&#32;?&#32;1&#32;:&#32;0;
<anchor xml:id="_ff_8c_source_1l03231"/>03231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;crc&#32;=&#32;(crc&#32;&amp;&#32;1)&#32;?&#32;crc&#32;&gt;&gt;&#32;1&#32;^&#32;0xEDB88320&#32;:&#32;crc&#32;&gt;&gt;&#32;1;
<anchor xml:id="_ff_8c_source_1l03232"/>03232 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03233"/>03233 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;crc;
<anchor xml:id="_ff_8c_source_1l03234"/>03234 }
<anchor xml:id="_ff_8c_source_1l03235"/>03235 
<anchor xml:id="_ff_8c_source_1l03236"/>03236 
<anchor xml:id="_ff_8c_source_1l03237"/>03237 <emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;GPT&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03238"/>03238 
<anchor xml:id="_ff_8c_source_1l03239"/>03239 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;test_gpt_header&#32;(&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;0:Invalid,&#32;1:Valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03240"/>03240 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*&#32;gpth&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;GPT&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03241"/>03241 )
<anchor xml:id="_ff_8c_source_1l03242"/>03242 {
<anchor xml:id="_ff_8c_source_1l03243"/>03243 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l03244"/>03244 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;bcc,&#32;hlen;
<anchor xml:id="_ff_8c_source_1l03245"/>03245 
<anchor xml:id="_ff_8c_source_1l03246"/>03246 
<anchor xml:id="_ff_8c_source_1l03247"/>03247 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(memcmp(gpth&#32;+&#32;<link linkend="_ff_8c_1afff5a1b885cf62ef3382022e6f2bf5c2">GPTH_Sign</link>,&#32;<emphasis role="stringliteral">&quot;EFI&#32;PART&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;\0\0\1&quot;</emphasis>,&#32;12))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;signature&#32;and&#32;version&#32;(1.0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03248"/>03248 &#32;&#32;&#32;&#32;hlen&#32;=&#32;ld_dword(gpth&#32;+&#32;<link linkend="_ff_8c_1a58237ab846855bf2b4a0ab750493e8a3">GPTH_Size</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;header&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03249"/>03249 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hlen&#32;&lt;&#32;92&#32;||&#32;hlen&#32;&gt;&#32;<link linkend="_ffconf_8h_1a5c25535bf118c111157fe72fff3cbea5">FF_MIN_SS</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_ff_8c_source_1l03250"/>03250 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;bcc&#32;=&#32;0xFFFFFFFF;&#32;i&#32;&lt;&#32;hlen;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;header&#32;BCC&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03251"/>03251 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcc&#32;=&#32;crc32(bcc,&#32;i&#32;-&#32;<link linkend="_ff_8c_1ac1a4c52079edc7bf25dddc7bf02e1882">GPTH_Bcc</link>&#32;&lt;&#32;4&#32;?&#32;0&#32;:&#32;gpth[i]);
<anchor xml:id="_ff_8c_source_1l03252"/>03252 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03253"/>03253 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(~bcc&#32;!=&#32;ld_dword(gpth&#32;+&#32;<link linkend="_ff_8c_1ac1a4c52079edc7bf25dddc7bf02e1882">GPTH_Bcc</link>))&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;
<anchor xml:id="_ff_8c_source_1l03254"/>03254 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_dword(gpth&#32;+&#32;<link linkend="_ff_8c_1a16b1364aca6d6fc7991516ee883606ff">GPTH_PteSize</link>)&#32;!=&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;<emphasis role="comment">/*&#32;Table&#32;entry&#32;size&#32;(must&#32;be&#32;SZ_GPTE&#32;bytes)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03255"/>03255 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_dword(gpth&#32;+&#32;<link linkend="_ff_8c_1a950d43a4211a4bdcc19888bfc8fde5f9">GPTH_PtNum</link>)&#32;&gt;&#32;128)&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;size&#32;(must&#32;be&#32;128&#32;entries&#32;or&#32;less)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03256"/>03256 
<anchor xml:id="_ff_8c_source_1l03257"/>03257 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;
<anchor xml:id="_ff_8c_source_1l03258"/>03258 }
<anchor xml:id="_ff_8c_source_1l03259"/>03259 
<anchor xml:id="_ff_8c_source_1l03260"/>03260 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_USE_MKFS</emphasis>
<anchor xml:id="_ff_8c_source_1l03261"/>03261 
<anchor xml:id="_ff_8c_source_1l03262"/>03262 <emphasis role="comment">/*&#32;Generate&#32;random&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03263"/>03263 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;make_rand&#32;(
<anchor xml:id="_ff_8c_source_1l03264"/>03264 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;seed,&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Seed&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03265"/>03265 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*buff,&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Output&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03266"/>03266 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Data&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03267"/>03267 )
<anchor xml:id="_ff_8c_source_1l03268"/>03268 {
<anchor xml:id="_ff_8c_source_1l03269"/>03269 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;r;
<anchor xml:id="_ff_8c_source_1l03270"/>03270 
<anchor xml:id="_ff_8c_source_1l03271"/>03271 
<anchor xml:id="_ff_8c_source_1l03272"/>03272 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(seed&#32;==&#32;0)&#32;seed&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l03273"/>03273 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03274"/>03274 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(r&#32;=&#32;0;&#32;r&#32;&lt;&#32;8;&#32;r++)&#32;seed&#32;=&#32;seed&#32;&amp;&#32;1&#32;?&#32;seed&#32;&gt;&gt;&#32;1&#32;^&#32;0xA3000000&#32;:&#32;seed&#32;&gt;&gt;&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Shift&#32;8&#32;bits&#32;the&#32;32-bit&#32;LFSR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03275"/>03275 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buff++&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)seed;
<anchor xml:id="_ff_8c_source_1l03276"/>03276 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(--n);
<anchor xml:id="_ff_8c_source_1l03277"/>03277 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;seed;
<anchor xml:id="_ff_8c_source_1l03278"/>03278 }
<anchor xml:id="_ff_8c_source_1l03279"/>03279 
<anchor xml:id="_ff_8c_source_1l03280"/>03280 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03281"/>03281 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03282"/>03282 
<anchor xml:id="_ff_8c_source_1l03283"/>03283 
<anchor xml:id="_ff_8c_source_1l03284"/>03284 
<anchor xml:id="_ff_8c_source_1l03285"/>03285 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03286"/>03286 <emphasis role="comment">/*&#32;Load&#32;a&#32;sector&#32;and&#32;check&#32;if&#32;it&#32;is&#32;an&#32;FAT&#32;VBR&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03287"/>03287 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03288"/>03288 
<anchor xml:id="_ff_8c_source_1l03289"/>03289 <emphasis role="comment">/*&#32;Check&#32;what&#32;the&#32;sector&#32;is&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03290"/>03290 
<anchor xml:id="_ff_8c_source_1l03291"/>03291 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;check_fs&#32;(&#32;&#32;<emphasis role="comment">/*&#32;0:FAT/FAT32&#32;VBR,&#32;1:exFAT&#32;VBR,&#32;2:Not&#32;FAT&#32;and&#32;valid&#32;BS,&#32;3:Not&#32;FAT&#32;and&#32;invalid&#32;BS,&#32;4:Disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03292"/>03292 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03293"/>03293 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;to&#32;load&#32;and&#32;check&#32;if&#32;it&#32;is&#32;an&#32;FAT-VBR&#32;or&#32;not&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03294"/>03294 )
<anchor xml:id="_ff_8c_source_1l03295"/>03295 {
<anchor xml:id="_ff_8c_source_1l03296"/>03296 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;w,&#32;sign;
<anchor xml:id="_ff_8c_source_1l03297"/>03297 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;b;
<anchor xml:id="_ff_8c_source_1l03298"/>03298 
<anchor xml:id="_ff_8c_source_1l03299"/>03299 
<anchor xml:id="_ff_8c_source_1l03300"/>03300 &#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;0;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;=&#32;(<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>)0&#32;-&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invaidate&#32;window&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03301"/>03301 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;sect)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;4;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;the&#32;boot&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03302"/>03302 &#32;&#32;&#32;&#32;sign&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>);
<anchor xml:id="_ff_8c_source_1l03303"/>03303 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03304"/>03304 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sign&#32;==&#32;0xAA55&#32;&amp;&amp;&#32;!memcmp(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">BS_JmpBoot</link>,&#32;<emphasis role="stringliteral">&quot;\xEB\x76\x90&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;EXFAT&#32;&#32;&#32;&quot;</emphasis>,&#32;11))&#32;<emphasis role="keywordflow">return</emphasis>&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;an&#32;exFAT&#32;VBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03305"/>03305 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03306"/>03306 &#32;&#32;&#32;&#32;b&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">BS_JmpBoot</link>];
<anchor xml:id="_ff_8c_source_1l03307"/>03307 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b&#32;==&#32;0xEB&#32;||&#32;b&#32;==&#32;0xE9&#32;||&#32;b&#32;==&#32;0xE8)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Valid&#32;JumpBoot&#32;code?&#32;(short&#32;jump,&#32;near&#32;jump&#32;or&#32;near&#32;call)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03308"/>03308 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sign&#32;==&#32;0xAA55&#32;&amp;&amp;&#32;!memcmp(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a8d8786452966cd0ce579f2575a54a348">BS_FilSysType32</link>,&#32;<emphasis role="stringliteral">&quot;FAT32&#32;&#32;&#32;&quot;</emphasis>,&#32;8))&#32;{
<anchor xml:id="_ff_8c_source_1l03309"/>03309 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;an&#32;FAT32&#32;VBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03310"/>03310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03311"/>03311 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;volumes&#32;formatted&#32;with&#32;early&#32;MS-DOS&#32;lack&#32;BS_55AA&#32;and&#32;BS_FilSysType,&#32;so&#32;FAT&#32;VBR&#32;needs&#32;to&#32;be&#32;identified&#32;without&#32;them.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03312"/>03312 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;w&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a8551844b4eb4e15aecd8cc9aa3585fa2">BPB_BytsPerSec</link>);
<anchor xml:id="_ff_8c_source_1l03313"/>03313 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1aab78e41c617a14b9540c0563d6b957fa">BPB_SecPerClus</link>];
<anchor xml:id="_ff_8c_source_1l03314"/>03314 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((w&#32;&amp;&#32;(w&#32;-&#32;1))&#32;==&#32;0&#32;&amp;&amp;&#32;w&#32;&gt;=&#32;<link linkend="_ffconf_8h_1a5c25535bf118c111157fe72fff3cbea5">FF_MIN_SS</link>&#32;&amp;&amp;&#32;w&#32;&lt;=&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;sector&#32;size&#32;(512-4096&#32;and&#32;2^n)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03315"/>03315 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;b&#32;!=&#32;0&#32;&amp;&amp;&#32;(b&#32;&amp;&#32;(b&#32;-&#32;1))&#32;==&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;cluster&#32;size&#32;(2^n)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03316"/>03316 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ab3ec444c8457c9bc98aa07e846f5c1b7">BPB_RsvdSecCnt</link>)&#32;!=&#32;0&#32;&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;reserved&#32;sectors&#32;(MNBZ)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03317"/>03317 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1af44a1e8c89ec5502595f23496d24cbf1">BPB_NumFATs</link>]&#32;-&#32;1&#32;&lt;=&#32;1&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;FATs&#32;(1&#32;or&#32;2)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03318"/>03318 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1aaa667f14c87c45dc128f2ab208e92f98">BPB_RootEntCnt</link>)&#32;!=&#32;0&#32;&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;root&#32;dir&#32;entries&#32;(MNBZ)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03319"/>03319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a4eb540eecde0f2df26fa8c7969341d68">BPB_TotSec16</link>)&#32;&gt;=&#32;128&#32;||&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a7723a9f0da553e8879d60909d85ccb7b">BPB_TotSec32</link>)&#32;&gt;=&#32;0x10000)&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;volume&#32;sectors&#32;(&gt;=128)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03320"/>03320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a60a2f6efeb6a4c7cb2da1e5def6ca43b">BPB_FATSz16</link>)&#32;!=&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Properness&#32;of&#32;FAT&#32;size&#32;(MNBZ)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03321"/>03321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;can&#32;be&#32;presumed&#32;an&#32;FAT&#32;VBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03322"/>03322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03323"/>03323 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03324"/>03324 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;sign&#32;==&#32;0xAA55&#32;?&#32;2&#32;:&#32;3;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;an&#32;FAT&#32;VBR&#32;(valid&#32;or&#32;invalid&#32;BS)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03325"/>03325 }
<anchor xml:id="_ff_8c_source_1l03326"/>03326 
<anchor xml:id="_ff_8c_source_1l03327"/>03327 
<anchor xml:id="_ff_8c_source_1l03328"/>03328 <emphasis role="comment">/*&#32;Find&#32;an&#32;FAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03329"/>03329 <emphasis role="comment">/*&#32;(It&#32;supports&#32;only&#32;generic&#32;partitioning&#32;rules,&#32;MBR,&#32;GPT&#32;and&#32;SFD)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03330"/>03330 
<anchor xml:id="_ff_8c_source_1l03331"/>03331 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;find_volume&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;BS&#32;status&#32;found&#32;in&#32;the&#32;hosting&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03332"/>03332 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03333"/>03333 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;part&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partition&#32;to&#32;fined&#32;=&#32;0:find&#32;as&#32;SFD&#32;and&#32;partitions,&#32;&gt;0:forced&#32;partition&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03334"/>03334 )
<anchor xml:id="_ff_8c_source_1l03335"/>03335 {
<anchor xml:id="_ff_8c_source_1l03336"/>03336 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;fmt,&#32;i;
<anchor xml:id="_ff_8c_source_1l03337"/>03337 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;mbr_pt[4];
<anchor xml:id="_ff_8c_source_1l03338"/>03338 
<anchor xml:id="_ff_8c_source_1l03339"/>03339 
<anchor xml:id="_ff_8c_source_1l03340"/>03340 &#32;&#32;&#32;&#32;fmt&#32;=&#32;check_fs(fs,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;sector&#32;0&#32;and&#32;check&#32;if&#32;it&#32;is&#32;an&#32;FAT&#32;VBR&#32;as&#32;SFD&#32;format&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03341"/>03341 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;!=&#32;2&#32;&amp;&amp;&#32;(fmt&#32;&gt;=&#32;3&#32;||&#32;part&#32;==&#32;0))&#32;<emphasis role="keywordflow">return</emphasis>&#32;fmt;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;if&#32;it&#32;is&#32;an&#32;FAT&#32;VBR&#32;as&#32;auto&#32;scan,&#32;not&#32;a&#32;BS&#32;or&#32;disk&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03342"/>03342 
<anchor xml:id="_ff_8c_source_1l03343"/>03343 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;0&#32;is&#32;not&#32;an&#32;FAT&#32;VBR&#32;or&#32;forced&#32;partition&#32;number&#32;wants&#32;a&#32;partition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03344"/>03344 
<anchor xml:id="_ff_8c_source_1l03345"/>03345 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l03346"/>03346 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;==&#32;0xEE)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;GPT&#32;protective&#32;MBR?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03347"/>03347 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;n_ent,&#32;v_ent,&#32;ofs;
<anchor xml:id="_ff_8c_source_1l03348"/>03348 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;QWORD&#32;pt_lba;
<anchor xml:id="_ff_8c_source_1l03349"/>03349 
<anchor xml:id="_ff_8c_source_1l03350"/>03350 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;1)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;4;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;GPT&#32;header&#32;sector&#32;(next&#32;to&#32;MBR)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03351"/>03351 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!test_gpt_header(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>))&#32;<emphasis role="keywordflow">return</emphasis>&#32;3;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;GPT&#32;header&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03352"/>03352 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_ent&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a950d43a4211a4bdcc19888bfc8fde5f9">GPTH_PtNum</link>);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03353"/>03353 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pt_lba&#32;=&#32;ld_qword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1acf59802a11562c5dc1f0d99ae5a89946">GPTH_PtOfs</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;location&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03354"/>03354 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(v_ent&#32;=&#32;i&#32;=&#32;0;&#32;i&#32;&lt;&#32;n_ent;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;FAT&#32;partition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03355"/>03355 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;pt_lba&#32;+&#32;i&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;4;&#32;&#32;<emphasis role="comment">/*&#32;PT&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03356"/>03356 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;i&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03357"/>03357 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!memcmp(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a8e8517c1287b2d9c93d164bccc0133db">GPTE_PtGuid</link>,&#32;GUID_MS_Basic,&#32;16))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;MS&#32;basic&#32;data&#32;partition?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03358"/>03358 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v_ent++;
<anchor xml:id="_ff_8c_source_1l03359"/>03359 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fmt&#32;=&#32;check_fs(fs,&#32;ld_qword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a25029670f9bc74da6eae5001fe4acdb4">GPTE_FstLba</link>));&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;VBR&#32;and&#32;check&#32;status&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03360"/>03360 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(part&#32;==&#32;0&#32;&amp;&amp;&#32;fmt&#32;&lt;=&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;fmt;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Auto&#32;search&#32;(valid&#32;FAT&#32;volume&#32;found&#32;first)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03361"/>03361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(part&#32;!=&#32;0&#32;&amp;&amp;&#32;v_ent&#32;==&#32;part)&#32;<emphasis role="keywordflow">return</emphasis>&#32;fmt;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Forced&#32;partition&#32;order&#32;(regardless&#32;of&#32;it&#32;is&#32;valid&#32;or&#32;not)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03362"/>03362 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03363"/>03363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03364"/>03364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;3;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03365"/>03365 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03366"/>03366 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03367"/>03367 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a6f07d18b72c37af9fb5deda0e8a13131">FF_MULTI_PARTITION</link>&#32;&amp;&amp;&#32;part&#32;&gt;&#32;4)&#32;<emphasis role="keywordflow">return</emphasis>&#32;3;&#32;&#32;&#32;<emphasis role="comment">/*&#32;MBR&#32;has&#32;4&#32;partitions&#32;max&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03368"/>03368 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;4;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;partition&#32;offset&#32;in&#32;the&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03369"/>03369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;mbr_pt[i]&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;i&#32;*&#32;<link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">SZ_PTE</link>&#32;+&#32;<link linkend="_ff_8c_1ae33f69bfe238a35fb3fd1949c4e087da">PTE_StLba</link>);
<anchor xml:id="_ff_8c_source_1l03370"/>03370 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03371"/>03371 &#32;&#32;&#32;&#32;i&#32;=&#32;part&#32;?&#32;part&#32;-&#32;1&#32;:&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;index&#32;to&#32;find&#32;first&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03372"/>03372 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;an&#32;FAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03373"/>03373 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fmt&#32;=&#32;mbr_pt[i]&#32;?&#32;check_fs(fs,&#32;mbr_pt[i])&#32;:&#32;3;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;partition&#32;is&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03374"/>03374 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(part&#32;==&#32;0&#32;&amp;&amp;&#32;fmt&#32;&gt;=&#32;2&#32;&amp;&amp;&#32;++i&#32;&lt;&#32;4);
<anchor xml:id="_ff_8c_source_1l03375"/>03375 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;fmt;
<anchor xml:id="_ff_8c_source_1l03376"/>03376 }
<anchor xml:id="_ff_8c_source_1l03377"/>03377 
<anchor xml:id="_ff_8c_source_1l03378"/>03378 
<anchor xml:id="_ff_8c_source_1l03379"/>03379 
<anchor xml:id="_ff_8c_source_1l03380"/>03380 
<anchor xml:id="_ff_8c_source_1l03381"/>03381 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03382"/>03382 <emphasis role="comment">/*&#32;Determine&#32;logical&#32;drive&#32;number&#32;and&#32;mount&#32;the&#32;volume&#32;if&#32;needed&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03383"/>03383 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03384"/>03384 
<anchor xml:id="_ff_8c_source_1l03385"/>03385 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;mount_volume&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;FR_OK(0):&#32;successful,&#32;!=0:&#32;an&#32;error&#32;occurred&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03386"/>03386 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>**&#32;path,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;the&#32;path&#32;name&#32;(drive&#32;number)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03387"/>03387 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>**&#32;rfs,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;the&#32;found&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03388"/>03388 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;mode&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Desiered&#32;access&#32;mode&#32;to&#32;check&#32;write&#32;protection&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03389"/>03389 )
<anchor xml:id="_ff_8c_source_1l03390"/>03390 {
<anchor xml:id="_ff_8c_source_1l03391"/>03391 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
<anchor xml:id="_ff_8c_source_1l03392"/>03392 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l03393"/>03393 &#32;&#32;&#32;&#32;<link linkend="_diskio_8h_1adba6790898ce4029c20a34b898ce73c1">DSTATUS</link>&#32;stat;
<anchor xml:id="_ff_8c_source_1l03394"/>03394 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;bsect;
<anchor xml:id="_ff_8c_source_1l03395"/>03395 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;tsect,&#32;sysect,&#32;fasize,&#32;nclst,&#32;szbfat;
<anchor xml:id="_ff_8c_source_1l03396"/>03396 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;nrsv;
<anchor xml:id="_ff_8c_source_1l03397"/>03397 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;fmt;
<anchor xml:id="_ff_8c_source_1l03398"/>03398 
<anchor xml:id="_ff_8c_source_1l03399"/>03399 
<anchor xml:id="_ff_8c_source_1l03400"/>03400 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03401"/>03401 &#32;&#32;&#32;&#32;*rfs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03402"/>03402 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(path);
<anchor xml:id="_ff_8c_source_1l03403"/>03403 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
<anchor xml:id="_ff_8c_source_1l03404"/>03404 
<anchor xml:id="_ff_8c_source_1l03405"/>03405 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;filesystem&#32;object&#32;is&#32;valid&#32;or&#32;not&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03406"/>03406 &#32;&#32;&#32;&#32;fs&#32;=&#32;FatFs[vol];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;pointer&#32;to&#32;the&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03407"/>03407 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!fs)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cafc56605c68aaffab4a428339a8bd600d">FR_NOT_ENABLED</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;filesystem&#32;object&#32;available?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03408"/>03408 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l03409"/>03409 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!lock_volume(fs,&#32;1))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3f8ca7e51af8b129d14328de7243c5d4">FR_TIMEOUT</link>;&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;volume,&#32;and&#32;system&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03410"/>03410 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03411"/>03411 &#32;&#32;&#32;&#32;*rfs&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;pointer&#32;to&#32;the&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03412"/>03412 
<anchor xml:id="_ff_8c_source_1l03413"/>03413 &#32;&#32;&#32;&#32;mode&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Desired&#32;access&#32;mode,&#32;write&#32;access&#32;or&#32;not&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03414"/>03414 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;the&#32;volume&#32;has&#32;been&#32;mounted&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03415"/>03415 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;stat&#32;=&#32;<link linkend="_fat_8c_1a8348ac5ee6d709420c02e45c111f4793">disk_status</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>);
<anchor xml:id="_ff_8c_source_1l03416"/>03416 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(stat&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>))&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;and&#32;the&#32;physical&#32;drive&#32;is&#32;kept&#32;initialized&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03417"/>03417 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;&amp;&amp;&#32;mode&#32;&amp;&amp;&#32;(stat&#32;&amp;&#32;<link linkend="_diskio_8h_1a9ec6dc5f6620a33fabe388d3a111ca8c">STA_PROTECT</link>))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;write&#32;protection&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03418"/>03418 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>;
<anchor xml:id="_ff_8c_source_1l03419"/>03419 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03420"/>03420 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;filesystem&#32;object&#32;is&#32;already&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03421"/>03421 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03422"/>03422 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03423"/>03423 
<anchor xml:id="_ff_8c_source_1l03424"/>03424 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;filesystem&#32;object&#32;is&#32;not&#32;valid.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03425"/>03425 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Following&#32;code&#32;attempts&#32;to&#32;mount&#32;the&#32;volume.&#32;(find&#32;an&#32;FAT&#32;volume,&#32;analyze&#32;the&#32;BPB&#32;and&#32;initialize&#32;the&#32;filesystem&#32;object)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03426"/>03426 
<anchor xml:id="_ff_8c_source_1l03427"/>03427 &#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03428"/>03428 &#32;&#32;&#32;&#32;stat&#32;=&#32;<link linkend="_fat_8c_1a09cdaa6f36fa409bdf002727bff98eb1">disk_initialize</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;volume&#32;hosting&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03429"/>03429 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;initialization&#32;succeeded&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03430"/>03430 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45">FR_NOT_READY</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Failed&#32;to&#32;initialize&#32;due&#32;to&#32;no&#32;medium&#32;or&#32;hard&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03431"/>03431 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03432"/>03432 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;&amp;&amp;&#32;mode&#32;&amp;&amp;&#32;(stat&#32;&amp;&#32;<link linkend="_diskio_8h_1a9ec6dc5f6620a33fabe388d3a111ca8c">STA_PROTECT</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Check&#32;disk&#32;write&#32;protection&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03433"/>03433 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>;
<anchor xml:id="_ff_8c_source_1l03434"/>03434 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03435"/>03435 <emphasis role="preprocessor">#if&#32;FF_MAX_SS&#32;!=&#32;FF_MIN_SS&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Get&#32;sector&#32;size&#32;(multiple&#32;sector&#32;size&#32;cfg&#32;only)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03436"/>03436 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;<link linkend="_diskio_8h_1ac73b5cf2135cbd459d109b96c9aa346a">GET_SECTOR_SIZE</link>,&#32;&amp;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03437"/>03437 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&gt;&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>&#32;||&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&lt;&#32;<link linkend="_ffconf_8h_1a5c25535bf118c111157fe72fff3cbea5">FF_MIN_SS</link>&#32;||&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;1)))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03438"/>03438 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03439"/>03439 
<anchor xml:id="_ff_8c_source_1l03440"/>03440 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;an&#32;FAT&#32;volume&#32;on&#32;the&#32;hosting&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03441"/>03441 &#32;&#32;&#32;&#32;fmt&#32;=&#32;find_volume(fs,&#32;<link linkend="_ff_8c_1aadc4a9aefaf2588bdd7565549f5d91e7">LD2PT</link>(vol));
<anchor xml:id="_ff_8c_source_1l03442"/>03442 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;==&#32;4)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;error&#32;occurred&#32;in&#32;the&#32;disk&#32;I/O&#32;layer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03443"/>03443 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;&gt;=&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;FAT&#32;volume&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03444"/>03444 &#32;&#32;&#32;&#32;bsect&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;offset&#32;in&#32;the&#32;hosting&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03445"/>03445 
<anchor xml:id="_ff_8c_source_1l03446"/>03446 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;An&#32;FAT&#32;volume&#32;is&#32;found&#32;(bsect).&#32;Following&#32;code&#32;initializes&#32;the&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03447"/>03447 
<anchor xml:id="_ff_8c_source_1l03448"/>03448 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03449"/>03449 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;==&#32;1)&#32;{
<anchor xml:id="_ff_8c_source_1l03450"/>03450 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;QWORD&#32;maxlba;
<anchor xml:id="_ff_8c_source_1l03451"/>03451 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;so,&#32;cv,&#32;bcl,&#32;i;
<anchor xml:id="_ff_8c_source_1l03452"/>03452 
<anchor xml:id="_ff_8c_source_1l03453"/>03453 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;<link linkend="_ff_8c_1a8b262d23932b103fc341cf6b631539bd">BPB_ZeroedEx</link>;&#32;i&#32;&lt;&#32;<link linkend="_ff_8c_1a8b262d23932b103fc341cf6b631539bd">BPB_ZeroedEx</link>&#32;+&#32;53&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i]&#32;==&#32;0;&#32;i++)&#32;;&#32;<emphasis role="comment">/*&#32;Check&#32;zero&#32;filler&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03454"/>03454 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;&#32;<link linkend="_ff_8c_1a8b262d23932b103fc341cf6b631539bd">BPB_ZeroedEx</link>&#32;+&#32;53)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;
<anchor xml:id="_ff_8c_source_1l03455"/>03455 
<anchor xml:id="_ff_8c_source_1l03456"/>03456 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a86f95a0a4b798a61967e086540e6ebd9">BPB_FSVerEx</link>)&#32;!=&#32;0x100)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;exFAT&#32;version&#32;(must&#32;be&#32;version&#32;1.0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03457"/>03457 
<anchor xml:id="_ff_8c_source_1l03458"/>03458 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(1&#32;&lt;&lt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1a3d35e000a1033bb913d3fbc3aa5c68af">BPB_BytsPerSecEx</link>]&#32;!=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;{&#32;<emphasis role="comment">/*&#32;(BPB_BytsPerSecEx&#32;must&#32;be&#32;equal&#32;to&#32;the&#32;physical&#32;sector&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03459"/>03459 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;
<anchor xml:id="_ff_8c_source_1l03460"/>03460 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03461"/>03461 
<anchor xml:id="_ff_8c_source_1l03462"/>03462 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;maxlba&#32;=&#32;ld_qword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ac0c21531f17f5690b31622fcf98d3581">BPB_TotSecEx</link>)&#32;+&#32;bsect;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;LBA&#32;of&#32;the&#32;volume&#32;+&#32;1&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03463"/>03463 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ab92e95c077afccc4d6f847cbf766e1cd">FF_LBA64</link>&#32;&amp;&amp;&#32;maxlba&#32;&gt;=&#32;0x100000000)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(It&#32;cannot&#32;be&#32;accessed&#32;in&#32;32-bit&#32;LBA)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03464"/>03464 
<anchor xml:id="_ff_8c_source_1l03465"/>03465 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a53e9560659f14e66f306c2c444198bf3">fsize</link>&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a54579961bdbed995bcb7e077fedff1f4">BPB_FatSzEx</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;per&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03466"/>03466 
<anchor xml:id="_ff_8c_source_1l03467"/>03467 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1a20cab50b62fe9cb5a99ce28cb54da60e">BPB_NumFATsEx</link>];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03468"/>03468 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>&#32;!=&#32;1)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Supports&#32;only&#32;1&#32;FAT)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03469"/>03469 
<anchor xml:id="_ff_8c_source_1l03470"/>03470 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;=&#32;1&#32;&lt;&lt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1a64dfd457aa404e53c16d58a3d249adfe">BPB_SecPerClusEx</link>];&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03471"/>03471 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Must&#32;be&#32;1..32768&#32;sectors)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03472"/>03472 
<anchor xml:id="_ff_8c_source_1l03473"/>03473 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nclst&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a5bb065cee85104cbb58390ea9dfa01d8">BPB_NumClusEx</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03474"/>03474 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nclst&#32;&gt;&#32;<link linkend="_ff_8c_1ad7bea1c4a86cb654807e6da0370cb694">MAX_EXFAT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;<emphasis role="comment">/*&#32;(Too&#32;many&#32;clusters)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03475"/>03475 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;=&#32;nclst&#32;+&#32;2;
<anchor xml:id="_ff_8c_source_1l03476"/>03476 
<anchor xml:id="_ff_8c_source_1l03477"/>03477 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boundaries&#32;and&#32;Limits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03478"/>03478 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a89358c0e7b2293254c9481dcd2984d30">volbase</link>&#32;=&#32;bsect;
<anchor xml:id="_ff_8c_source_1l03479"/>03479 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a4ce7c10569f45fae1c709c9ee41f69cb">database</link>&#32;=&#32;bsect&#32;+&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ad3ab64cc288e66c0643af23094aa9645">BPB_DataOfsEx</link>);
<anchor xml:id="_ff_8c_source_1l03480"/>03480 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;=&#32;bsect&#32;+&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a12af2061024593ffc7a92daf1c2d3470">BPB_FatOfsEx</link>);
<anchor xml:id="_ff_8c_source_1l03481"/>03481 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(maxlba&#32;&lt;&#32;(QWORD)fs-&gt;<link linkend="_struct_f_a_t_f_s_1a4ce7c10569f45fae1c709c9ee41f69cb">database</link>&#32;+&#32;nclst&#32;*&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;<emphasis role="comment">/*&#32;(Volume&#32;size&#32;must&#32;not&#32;be&#32;smaller&#32;than&#32;the&#32;size&#32;required)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03482"/>03482 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1afc8c3d5d8408b70379f23382c6e28168">dirbase</link>&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a8447a1c7d19cab308ab198e1de2e086f">BPB_RootClusEx</link>);
<anchor xml:id="_ff_8c_source_1l03483"/>03483 
<anchor xml:id="_ff_8c_source_1l03484"/>03484 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;bitmap&#32;location&#32;and&#32;check&#32;if&#32;it&#32;is&#32;contiguous&#32;(implementation&#32;assumption)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03485"/>03485 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;so&#32;=&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03486"/>03486 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;the&#32;bitmap&#32;entry&#32;in&#32;the&#32;root&#32;directory&#32;(in&#32;only&#32;first&#32;cluster)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03487"/>03487 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l03488"/>03488 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(so&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;found?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03489"/>03489 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;clst2sect(fs,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1afc8c3d5d8408b70379f23382c6e28168">dirbase</link>)&#32;+&#32;so)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03490"/>03490 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;so++;
<anchor xml:id="_ff_8c_source_1l03491"/>03491 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03492"/>03492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i]&#32;==&#32;<link linkend="_ff_8c_1ab9becfd202f51394d189dffe291a5959">ET_BITMAP</link>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;bitmap&#32;entry?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03493"/>03493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;(i&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>)&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03494"/>03494 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03495"/>03495 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcl&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;i&#32;+&#32;20);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bitmap&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03496"/>03496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(bcl&#32;&lt;&#32;2&#32;||&#32;bcl&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Wrong&#32;cluster#)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03497"/>03497 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;bitbase&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a4ce7c10569f45fae1c709c9ee41f69cb">database</link>&#32;+&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;(bcl&#32;-&#32;2);&#32;<emphasis role="comment">/*&#32;Bitmap&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03498"/>03498 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;bitmap&#32;is&#32;contiguous&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03499"/>03499 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;bcl&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;4))&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03500"/>03500 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cv&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;bcl&#32;%&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;4)&#32;*&#32;4);
<anchor xml:id="_ff_8c_source_1l03501"/>03501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cv&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;link?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03502"/>03502 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cv&#32;!=&#32;++bcl)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fragmented&#32;bitmap?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03503"/>03503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03504"/>03504 
<anchor xml:id="_ff_8c_source_1l03505"/>03505 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l03506"/>03506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;cluster&#32;allocation&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03507"/>03507 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03508"/>03508 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fmt&#32;=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;sub-type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03509"/>03509 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l03510"/>03510 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_EXFAT&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03511"/>03511 &#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03512"/>03512 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a8551844b4eb4e15aecd8cc9aa3585fa2">BPB_BytsPerSec</link>)&#32;!=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(BPB_BytsPerSec&#32;must&#32;be&#32;equal&#32;to&#32;the&#32;physical&#32;sector&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03513"/>03513 
<anchor xml:id="_ff_8c_source_1l03514"/>03514 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fasize&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a60a2f6efeb6a4c7cb2da1e5def6ca43b">BPB_FATSz16</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;per&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03515"/>03515 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fasize&#32;==&#32;0)&#32;fasize&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a6e6340030dc29e7da2e9f92e472a763d">BPB_FATSz32</link>);
<anchor xml:id="_ff_8c_source_1l03516"/>03516 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a53e9560659f14e66f306c2c444198bf3">fsize</link>&#32;=&#32;fasize;
<anchor xml:id="_ff_8c_source_1l03517"/>03517 
<anchor xml:id="_ff_8c_source_1l03518"/>03518 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1af44a1e8c89ec5502595f23496d24cbf1">BPB_NumFATs</link>];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03519"/>03519 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>&#32;!=&#32;1&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>&#32;!=&#32;2)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Must&#32;be&#32;1&#32;or&#32;2)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03520"/>03520 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fasize&#32;*=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a56716c7e7ac10cf46e73ffb2a2e9b545">n_fats</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;for&#32;FAT&#32;area&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03521"/>03521 
<anchor xml:id="_ff_8c_source_1l03522"/>03522 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1aab78e41c617a14b9540c0563d6b957fa">BPB_SecPerClus</link>];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03523"/>03523 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;==&#32;0&#32;||&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1)))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Must&#32;be&#32;power&#32;of&#32;2)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03524"/>03524 
<anchor xml:id="_ff_8c_source_1l03525"/>03525 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1aaa667f14c87c45dc128f2ab208e92f98">BPB_RootEntCnt</link>);&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;directory&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03526"/>03526 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>&#32;%&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;<emphasis role="comment">/*&#32;(Must&#32;be&#32;sector&#32;aligned)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03527"/>03527 
<anchor xml:id="_ff_8c_source_1l03528"/>03528 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tsect&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a4eb540eecde0f2df26fa8c7969341d68">BPB_TotSec16</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;on&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03529"/>03529 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tsect&#32;==&#32;0)&#32;tsect&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a7723a9f0da553e8879d60909d85ccb7b">BPB_TotSec32</link>);
<anchor xml:id="_ff_8c_source_1l03530"/>03530 
<anchor xml:id="_ff_8c_source_1l03531"/>03531 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nrsv&#32;=&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ab3ec444c8457c9bc98aa07e846f5c1b7">BPB_RsvdSecCnt</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;reserved&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03532"/>03532 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nrsv&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Must&#32;not&#32;be&#32;0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03533"/>03533 
<anchor xml:id="_ff_8c_source_1l03534"/>03534 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;the&#32;FAT&#32;sub&#32;type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03535"/>03535 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sysect&#32;=&#32;nrsv&#32;+&#32;fasize&#32;+&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>&#32;/&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;/&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;<emphasis role="comment">/*&#32;RSV&#32;+&#32;FAT&#32;+&#32;DIR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03536"/>03536 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tsect&#32;&lt;&#32;sysect)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Invalid&#32;volume&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03537"/>03537 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nclst&#32;=&#32;(tsect&#32;-&#32;sysect)&#32;/&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03538"/>03538 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nclst&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Invalid&#32;volume&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03539"/>03539 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fmt&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03540"/>03540 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nclst&#32;&lt;=&#32;<link linkend="_ff_8c_1a40e7471b7ae3620a0419aa4d8d6dc684">MAX_FAT32</link>)&#32;fmt&#32;=&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>;
<anchor xml:id="_ff_8c_source_1l03541"/>03541 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nclst&#32;&lt;=&#32;<link linkend="_ff_8c_1a259e5a1973d5209304482a5bcd89372f">MAX_FAT16</link>)&#32;fmt&#32;=&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>;
<anchor xml:id="_ff_8c_source_1l03542"/>03542 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nclst&#32;&lt;=&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;fmt&#32;=&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>;
<anchor xml:id="_ff_8c_source_1l03543"/>03543 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;
<anchor xml:id="_ff_8c_source_1l03544"/>03544 
<anchor xml:id="_ff_8c_source_1l03545"/>03545 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boundaries&#32;and&#32;Limits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03546"/>03546 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;=&#32;nclst&#32;+&#32;2;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FAT&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03547"/>03547 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a89358c0e7b2293254c9481dcd2984d30">volbase</link>&#32;=&#32;bsect;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03548"/>03548 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;=&#32;bsect&#32;+&#32;nrsv;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03549"/>03549 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a4ce7c10569f45fae1c709c9ee41f69cb">database</link>&#32;=&#32;bsect&#32;+&#32;sysect;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Data&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03550"/>03550 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03551"/>03551 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1aed6c1d79c193debd85f7dc9afd05eb22">BPB_FSVer32</link>)&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Must&#32;be&#32;FAT32&#32;revision&#32;0.0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03552"/>03552 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(BPB_RootEntCnt&#32;must&#32;be&#32;0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03553"/>03553 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1afc8c3d5d8408b70379f23382c6e28168">dirbase</link>&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a4c99b85429f73c8f6a0ac2bc7a1d81ea">BPB_RootClus32</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;directory&#32;start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03554"/>03554 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;szbfat&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;*&#32;4;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Needed&#32;FAT&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03555"/>03555 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03556"/>03556 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a189a00aa038044ffad0fc7f7dcf2aae1">n_rootdir</link>&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(BPB_RootEntCnt&#32;must&#32;not&#32;be&#32;0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03557"/>03557 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1afc8c3d5d8408b70379f23382c6e28168">dirbase</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>&#32;+&#32;fasize;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;directory&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03558"/>03558 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;szbfat&#32;=&#32;(fmt&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;?&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;(Needed&#32;FAT&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03559"/>03559 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;*&#32;2&#32;:&#32;fs-&gt;n_fatent&#32;*&#32;3&#32;/&#32;2&#32;+&#32;(fs-&gt;n_fatent&#32;&amp;&#32;1);
<anchor xml:id="_ff_8c_source_1l03560"/>03560 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03561"/>03561 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a53e9560659f14e66f306c2c444198bf3">fsize</link>&#32;&lt;&#32;(szbfat&#32;+&#32;(<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;1))&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca086154b5fee763f28c49fd0e2c1cb463">FR_NO_FILESYSTEM</link>;&#32;&#32;<emphasis role="comment">/*&#32;(BPB_FATSz&#32;must&#32;not&#32;be&#32;less&#32;than&#32;the&#32;size&#32;needed)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03562"/>03562 
<anchor xml:id="_ff_8c_source_1l03563"/>03563 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l03564"/>03564 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;FSInfo&#32;if&#32;available&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03565"/>03565 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;cluster&#32;allocation&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03566"/>03566 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;=&#32;0x80;
<anchor xml:id="_ff_8c_source_1l03567"/>03567 <emphasis role="preprocessor">#if&#32;(FF_FS_NOFSINFO&#32;&amp;&#32;3)&#32;!=&#32;3</emphasis>
<anchor xml:id="_ff_8c_source_1l03568"/>03568 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allow&#32;to&#32;update&#32;FSInfo&#32;only&#32;if&#32;BPB_FSInfo32&#32;==&#32;1&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03569"/>03569 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a86b761a0ed35d7f6e9774be44482ee5b">BPB_FSInfo32</link>)&#32;==&#32;1
<anchor xml:id="_ff_8c_source_1l03570"/>03570 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;move_window(fs,&#32;bsect&#32;+&#32;1)&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)
<anchor xml:id="_ff_8c_source_1l03571"/>03571 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03572"/>03572 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03573"/>03573 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>)&#32;==&#32;0xAA55&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;FSInfo&#32;data&#32;if&#32;available&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03574"/>03574 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a318e58c1966aba52b90ab98dcb649883">FSI_LeadSig</link>)&#32;==&#32;0x41615252
<anchor xml:id="_ff_8c_source_1l03575"/>03575 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a3bac0e6ff5907873030db1d0a7c4ebef">FSI_StrucSig</link>)&#32;==&#32;0x61417272)
<anchor xml:id="_ff_8c_source_1l03576"/>03576 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03577"/>03577 <emphasis role="preprocessor">#if&#32;(FF_FS_NOFSINFO&#32;&amp;&#32;1)&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03578"/>03578 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1ab711e50459aba01b11c6b46a7cc1410b">FSI_Free_Count</link>);
<anchor xml:id="_ff_8c_source_1l03579"/>03579 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03580"/>03580 <emphasis role="preprocessor">#if&#32;(FF_FS_NOFSINFO&#32;&amp;&#32;2)&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03581"/>03581 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a320700cedf300c9b418edf56e5e6b086">FSI_Nxt_Free</link>);
<anchor xml:id="_ff_8c_source_1l03582"/>03582 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03583"/>03583 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03584"/>03584 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03585"/>03585 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;(FF_FS_NOFSINFO&#32;&amp;&#32;3)&#32;!=&#32;3&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03586"/>03586 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03587"/>03587 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03588"/>03588 
<anchor xml:id="_ff_8c_source_1l03589"/>03589 &#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)fmt;<emphasis role="comment">/*&#32;FAT&#32;sub-type&#32;(the&#32;filesystem&#32;object&#32;gets&#32;valid)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03590"/>03590 &#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a417095d7c20d56d417dc0998e0dd5a5c">id</link>&#32;=&#32;++Fsid;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;mount&#32;ID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03591"/>03591 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l03592"/>03592 &#32;&#32;&#32;&#32;fs-&gt;lfnbuf&#32;=&#32;LfnBuf;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Static&#32;LFN&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03593"/>03593 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03594"/>03594 &#32;&#32;&#32;&#32;fs-&gt;dirbuf&#32;=&#32;DirBuf;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Static&#32;directory&#32;block&#32;scratchpad&#32;buuffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03595"/>03595 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03596"/>03596 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03597"/>03597 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l03598"/>03598 &#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;current&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03599"/>03599 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03600"/>03600 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Clear&#32;file&#32;lock&#32;semaphores&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03601"/>03601 &#32;&#32;&#32;&#32;clear_share(fs);
<anchor xml:id="_ff_8c_source_1l03602"/>03602 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03603"/>03603 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l03604"/>03604 }
<anchor xml:id="_ff_8c_source_1l03605"/>03605 
<anchor xml:id="_ff_8c_source_1l03606"/>03606 
<anchor xml:id="_ff_8c_source_1l03607"/>03607 
<anchor xml:id="_ff_8c_source_1l03608"/>03608 
<anchor xml:id="_ff_8c_source_1l03609"/>03609 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03610"/>03610 <emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;file/directory&#32;object&#32;is&#32;valid&#32;or&#32;not&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03611"/>03611 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03612"/>03612 
<anchor xml:id="_ff_8c_source_1l03613"/>03613 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;validate&#32;(&#32;&#32;&#32;<emphasis role="comment">/*&#32;Returns&#32;FR_OK&#32;or&#32;FR_INVALID_OBJECT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03614"/>03614 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>*&#32;obj,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;FFOBJID,&#32;the&#32;1st&#32;member&#32;in&#32;the&#32;FIL/DIR&#32;structure,&#32;to&#32;check&#32;validity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03615"/>03615 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>**&#32;rfs&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;pointer&#32;to&#32;the&#32;owner&#32;filesystem&#32;object&#32;to&#32;return&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03616"/>03616 )
<anchor xml:id="_ff_8c_source_1l03617"/>03617 {
<anchor xml:id="_ff_8c_source_1l03618"/>03618 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>;
<anchor xml:id="_ff_8c_source_1l03619"/>03619 
<anchor xml:id="_ff_8c_source_1l03620"/>03620 
<anchor xml:id="_ff_8c_source_1l03621"/>03621 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(obj&#32;&amp;&amp;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;&amp;&amp;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;&amp;&amp;&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1afc765e01ff97bfd9645c42b0ba30397f">id</link>&#32;==&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1a417095d7c20d56d417dc0998e0dd5a5c">id</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;object&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03622"/>03622 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l03623"/>03623 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(lock_volume(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;0))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Take&#32;a&#32;grant&#32;to&#32;access&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03624"/>03624 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(<link linkend="_fat_8c_1a8348ac5ee6d709420c02e45c111f4793">disk_status</link>(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>)&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;hosting&#32;phsical&#32;drive&#32;is&#32;kept&#32;initialized&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03625"/>03625 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l03626"/>03626 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03627"/>03627 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;unlock_volume(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);&#32;&#32;<emphasis role="comment">/*&#32;Invalidated&#32;volume,&#32;abort&#32;to&#32;access&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03628"/>03628 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03629"/>03629 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Could&#32;not&#32;take&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03630"/>03630 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3f8ca7e51af8b129d14328de7243c5d4">FR_TIMEOUT</link>;
<anchor xml:id="_ff_8c_source_1l03631"/>03631 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03632"/>03632 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l03633"/>03633 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(<link linkend="_fat_8c_1a8348ac5ee6d709420c02e45c111f4793">disk_status</link>(obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>)&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;hosting&#32;phsical&#32;drive&#32;is&#32;kept&#32;initialized&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03634"/>03634 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l03635"/>03635 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03636"/>03636 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03637"/>03637 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03638"/>03638 &#32;&#32;&#32;&#32;*rfs&#32;=&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;?&#32;obj-&gt;<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;:&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;corresponding&#32;filesystem&#32;object&#32;if&#32;it&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03639"/>03639 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l03640"/>03640 }
<anchor xml:id="_ff_8c_source_1l03641"/>03641 
<anchor xml:id="_ff_8c_source_1l03642"/>03642 
<anchor xml:id="_ff_8c_source_1l03643"/>03643 
<anchor xml:id="_ff_8c_source_1l03644"/>03644 
<anchor xml:id="_ff_8c_source_1l03645"/>03645 <emphasis role="comment">/*---------------------------------------------------------------------------</emphasis>
<anchor xml:id="_ff_8c_source_1l03646"/>03646 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l03647"/>03647 <emphasis role="comment">&#32;&#32;&#32;Public&#32;Functions&#32;(FatFs&#32;API)</emphasis>
<anchor xml:id="_ff_8c_source_1l03648"/>03648 <emphasis role="comment"></emphasis>
<anchor xml:id="_ff_8c_source_1l03649"/>03649 <emphasis role="comment">----------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03650"/>03650 
<anchor xml:id="_ff_8c_source_1l03651"/>03651 
<anchor xml:id="_ff_8c_source_1l03652"/>03652 
<anchor xml:id="_ff_8c_source_1l03653"/>03653 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03654"/>03654 <emphasis role="comment">/*&#32;Mount/Unmount&#32;a&#32;Logical&#32;Drive&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03655"/>03655 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03656"/>03656 
<anchor xml:id="_ff_8c_source_1l03657"/><link linkend="_ff_8c_1a16a934c2bbfa2160295810adc49d5509">03657</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a16a934c2bbfa2160295810adc49d5509">f_mount</link>&#32;(
<anchor xml:id="_ff_8c_source_1l03658"/>03658 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>*&#32;fs,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;filesystem&#32;object&#32;to&#32;be&#32;registered&#32;(NULL:unmount)*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03659"/>03659 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Logical&#32;drive&#32;number&#32;to&#32;be&#32;mounted/unmounted&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03660"/>03660 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;opt&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mount&#32;option:&#32;0=Do&#32;not&#32;mount&#32;(delayed&#32;mount),&#32;1=Mount&#32;immediately&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03661"/>03661 )
<anchor xml:id="_ff_8c_source_1l03662"/>03662 {
<anchor xml:id="_ff_8c_source_1l03663"/>03663 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*cfs;
<anchor xml:id="_ff_8c_source_1l03664"/>03664 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
<anchor xml:id="_ff_8c_source_1l03665"/>03665 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l03666"/>03666 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*rp&#32;=&#32;path;
<anchor xml:id="_ff_8c_source_1l03667"/>03667 
<anchor xml:id="_ff_8c_source_1l03668"/>03668 
<anchor xml:id="_ff_8c_source_1l03669"/>03669 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;ID&#32;(logical&#32;drive&#32;number)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03670"/>03670 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(&amp;rp);
<anchor xml:id="_ff_8c_source_1l03671"/>03671 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
<anchor xml:id="_ff_8c_source_1l03672"/>03672 &#32;&#32;&#32;&#32;cfs&#32;=&#32;FatFs[vol];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;filesystem&#32;object&#32;of&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03673"/>03673 
<anchor xml:id="_ff_8c_source_1l03674"/>03674 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cfs)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unregister&#32;current&#32;filesystem&#32;object&#32;if&#32;regsitered&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03675"/>03675 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;FatFs[vol]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l03676"/>03676 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l03677"/>03677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clear_share(cfs);
<anchor xml:id="_ff_8c_source_1l03678"/>03678 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03679"/>03679 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Discard&#32;mutex&#32;of&#32;the&#32;current&#32;volume&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03680"/>03680 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_delete(vol);
<anchor xml:id="_ff_8c_source_1l03681"/>03681 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03682"/>03682 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cfs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;filesystem&#32;object&#32;to&#32;be&#32;unregistered&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03683"/>03683 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03684"/>03684 
<anchor xml:id="_ff_8c_source_1l03685"/>03685 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;new&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03686"/>03686 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>&#32;=&#32;<link linkend="_ff_8c_1a6577ed2f95527745bf4d27c53488b9a7">LD2PD</link>(vol);&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;hosting&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03687"/>03687 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Create&#32;a&#32;volume&#32;mutex&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03688"/>03688 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaa678cb2c36f5e7d8157ae295f1fbb42">ldrv</link>&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)vol;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Owner&#32;volume&#32;ID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03689"/>03689 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!ff_mutex_create(vol))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03690"/>03690 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l03691"/>03691 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(SysLock&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;system&#32;mutex&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03692"/>03692 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!ff_mutex_create(<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l03693"/>03693 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ff_mutex_delete(vol);
<anchor xml:id="_ff_8c_source_1l03694"/>03694 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03695"/>03695 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03696"/>03696 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;SysLock&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;mutex&#32;is&#32;ready&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03697"/>03697 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03698"/>03698 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03699"/>03699 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03700"/>03700 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;new&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03701"/>03701 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;FatFs[vol]&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;new&#32;fs&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03702"/>03702 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03703"/>03703 
<anchor xml:id="_ff_8c_source_1l03704"/>03704 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(opt&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Do&#32;not&#32;mount&#32;now,&#32;it&#32;will&#32;be&#32;mounted&#32;in&#32;subsequent&#32;file&#32;functions&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03705"/>03705 
<anchor xml:id="_ff_8c_source_1l03706"/>03706 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Force&#32;mounted&#32;the&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03707"/>03707 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l03708"/>03708 }
<anchor xml:id="_ff_8c_source_1l03709"/>03709 
<anchor xml:id="_ff_8c_source_1l03710"/>03710 
<anchor xml:id="_ff_8c_source_1l03711"/>03711 
<anchor xml:id="_ff_8c_source_1l03712"/>03712 
<anchor xml:id="_ff_8c_source_1l03713"/>03713 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03714"/>03714 <emphasis role="comment">/*&#32;Open&#32;or&#32;Create&#32;a&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03715"/>03715 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03716"/>03716 
<anchor xml:id="_ff_8c_source_1l03717"/><link linkend="_ff_8c_1aefdef7126128d99d0b3bd82c28e54d80">03717</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1aefdef7126128d99d0b3bd82c28e54d80">f_open</link>&#32;(
<anchor xml:id="_ff_8c_source_1l03718"/>03718 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;blank&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03719"/>03719 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03720"/>03720 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;mode&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Access&#32;mode&#32;and&#32;open&#32;mode&#32;flags&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03721"/>03721 )
<anchor xml:id="_ff_8c_source_1l03722"/>03722 {
<anchor xml:id="_ff_8c_source_1l03723"/>03723 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l03724"/>03724 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l03725"/>03725 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l03726"/>03726 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l03727"/>03727 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl,&#32;bcs,&#32;clst,&#32;tm;
<anchor xml:id="_ff_8c_source_1l03728"/>03728 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sc;
<anchor xml:id="_ff_8c_source_1l03729"/>03729 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;ofs;
<anchor xml:id="_ff_8c_source_1l03730"/>03730 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03731"/>03731 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l03732"/>03732 
<anchor xml:id="_ff_8c_source_1l03733"/>03733 
<anchor xml:id="_ff_8c_source_1l03734"/>03734 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!fp)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>;
<anchor xml:id="_ff_8c_source_1l03735"/>03735 
<anchor xml:id="_ff_8c_source_1l03736"/>03736 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03737"/>03737 &#32;&#32;&#32;&#32;mode&#32;&amp;=&#32;<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;?&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>&#32;:&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>&#32;|&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>&#32;|&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>&#32;|&#32;<link linkend="_ff_8h_1a17b01553029920ac0468912b4bcb16c7">FA_OPEN_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a90f135b2ae90fba5080f6bd2b6c57b8a">FA_OPEN_APPEND</link>;
<anchor xml:id="_ff_8c_source_1l03738"/>03738 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;mode);
<anchor xml:id="_ff_8c_source_1l03739"/>03739 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03740"/>03740 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l03741"/>03741 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l03742"/>03742 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03743"/>03743 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;</emphasis><emphasis role="comment">/*&#32;Read/Write&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03744"/>03744 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03745"/>03745 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Origin&#32;directory&#32;itself?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03746"/>03746 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
<anchor xml:id="_ff_8c_source_1l03747"/>03747 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03748"/>03748 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l03749"/>03749 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03750"/>03750 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;chk_share(&amp;dj,&#32;(mode&#32;&amp;&#32;~<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>)&#32;?&#32;1&#32;:&#32;0);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;the&#32;file&#32;can&#32;be&#32;used&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03751"/>03751 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03752"/>03752 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03753"/>03753 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03754"/>03754 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;or&#32;Open&#32;a&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03755"/>03755 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mode&#32;&amp;&#32;(<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a17b01553029920ac0468912b4bcb16c7">FA_OPEN_ALWAYS</link>&#32;|&#32;<link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l03756"/>03756 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;file,&#32;create&#32;new&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03757"/>03757 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;There&#32;is&#32;no&#32;file&#32;to&#32;open,&#32;create&#32;a&#32;new&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03758"/>03758 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l03759"/>03759 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;enq_share()&#32;?&#32;dir_register(&amp;dj)&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>;
<anchor xml:id="_ff_8c_source_1l03760"/>03760 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l03761"/>03761 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;dj);
<anchor xml:id="_ff_8c_source_1l03762"/>03762 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03763"/>03763 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03764"/>03764 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;mode&#32;|=&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;is&#32;created&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03765"/>03765 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03766"/>03766 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Any&#32;object&#32;with&#32;the&#32;same&#32;name&#32;is&#32;already&#32;existing&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03767"/>03767 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;(<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>&#32;|&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;overwrite&#32;it&#32;(R/O&#32;or&#32;DIR)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03768"/>03768 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;
<anchor xml:id="_ff_8c_source_1l03769"/>03769 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03770"/>03770 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mode&#32;&amp;&#32;<link linkend="_ff_8h_1a417bb1babd1785fd181a806b5613eba3">FA_CREATE_NEW</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;create&#32;as&#32;new&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03771"/>03771 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03772"/>03772 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03773"/>03773 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(mode&#32;&amp;&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncate&#32;the&#32;file&#32;if&#32;overwrite&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03774"/>03774 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03775"/>03775 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03776"/>03776 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;allocation&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03777"/>03777 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l03778"/>03778 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);
<anchor xml:id="_ff_8c_source_1l03779"/>03779 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;directory&#32;entry&#32;block&#32;initial&#32;state&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03780"/>03780 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;dirbuf&#32;+&#32;2,&#32;0,&#32;30);&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;85&#32;entry&#32;except&#32;for&#32;NumSec&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03781"/>03781 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;dirbuf&#32;+&#32;38,&#32;0,&#32;26);&#32;<emphasis role="comment">/*&#32;Clear&#32;C0&#32;entry&#32;except&#32;for&#32;NumName&#32;and&#32;NameHash&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03782"/>03782 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;
<anchor xml:id="_ff_8c_source_1l03783"/>03783 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a74046208323ac5e8b5214b05e1a43b87">XDIR_CrtTime</link>,&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>());
<anchor xml:id="_ff_8c_source_1l03784"/>03784 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l03785"/>03785 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);
<anchor xml:id="_ff_8c_source_1l03786"/>03786 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;cluster&#32;chain&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03787"/>03787 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l03788"/>03788 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;-&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reuse&#32;the&#32;cluster&#32;hole&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03789"/>03789 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03790"/>03790 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l03791"/>03791 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03792"/>03792 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03793"/>03793 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;directory&#32;entry&#32;initial&#32;state&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03794"/>03794 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tm&#32;=&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;created&#32;time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03795"/>03795 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1a47fb1881ea71d860db9b8280564cb4d5">DIR_CrtTime</link>,&#32;tm);
<anchor xml:id="_ff_8c_source_1l03796"/>03796 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);
<anchor xml:id="_ff_8c_source_1l03797"/>03797 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;cluster&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03798"/>03798 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reset&#32;attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03799"/>03799 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reset&#32;file&#32;allocation&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03800"/>03800 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l03801"/>03801 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l03802"/>03802 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;cluster&#32;chain&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03803"/>03803 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>;
<anchor xml:id="_ff_8c_source_1l03804"/>03804 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;cl,&#32;0);
<anchor xml:id="_ff_8c_source_1l03805"/>03805 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03806"/>03806 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sc);
<anchor xml:id="_ff_8c_source_1l03807"/>03807 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;cl&#32;-&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reuse&#32;the&#32;cluster&#32;hole&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03808"/>03808 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03809"/>03809 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03810"/>03810 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03811"/>03811 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03812"/>03812 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03813"/>03813 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;an&#32;existing&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03814"/>03814 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;object&#32;exsiting?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03815"/>03815 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;open&#32;against&#32;a&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03816"/>03816 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
<anchor xml:id="_ff_8c_source_1l03817"/>03817 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03818"/>03818 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((mode&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>)&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Write&#32;mode&#32;open&#32;against&#32;R/O&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03819"/>03819 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;
<anchor xml:id="_ff_8c_source_1l03820"/>03820 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03821"/>03821 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03822"/>03822 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03823"/>03823 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03824"/>03824 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03825"/>03825 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(mode&#32;&amp;&#32;<link linkend="_ff_8h_1afba4546b131dea4b24727fa20a80e29f">FA_CREATE_ALWAYS</link>)&#32;mode&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;change&#32;flag&#32;if&#32;created&#32;or&#32;overwritten&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03826"/>03826 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a19e61b116df8e6f2138243998e43f131">dir_sect</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03827"/>03827 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a5af9e9fb312b629220eaf684dd28c4a9">dir_ptr</link>&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>;
<anchor xml:id="_ff_8c_source_1l03828"/>03828 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l03829"/>03829 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid&#32;=&#32;inc_share(&amp;dj,&#32;(mode&#32;&amp;&#32;~<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>)&#32;?&#32;1&#32;:&#32;0);&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;file&#32;for&#32;this&#32;session&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03830"/>03830 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid&#32;==&#32;0)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03831"/>03831 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03832"/>03832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03833"/>03833 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;R/O&#32;configuration&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03834"/>03834 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03835"/>03835 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;origin&#32;directory&#32;itself?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03836"/>03836 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
<anchor xml:id="_ff_8c_source_1l03837"/>03837 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03838"/>03838 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;directory?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03839"/>03839 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>;
<anchor xml:id="_ff_8c_source_1l03840"/>03840 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03841"/>03841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03842"/>03842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03843"/>03843 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03844"/>03844 
<anchor xml:id="_ff_8c_source_1l03845"/>03845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03846"/>03846 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l03847"/>03847 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l03848"/>03848 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.c_scl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;containing&#32;directory&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03849"/>03849 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.c_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
<anchor xml:id="_ff_8c_source_1l03850"/>03850 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.c_ofs&#32;=&#32;dj.blk_ofs;
<anchor xml:id="_ff_8c_source_1l03851"/>03851 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);
<anchor xml:id="_ff_8c_source_1l03852"/>03852 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l03853"/>03853 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03854"/>03854 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03855"/>03855 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;object&#32;allocation&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03856"/>03856 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;ld_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>);
<anchor xml:id="_ff_8c_source_1l03857"/>03857 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03858"/>03858 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK</emphasis>
<anchor xml:id="_ff_8c_source_1l03859"/>03859 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;cltbl&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Disable&#32;fast&#32;seek&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03860"/>03860 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03861"/>03861 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Validate&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03862"/>03862 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1afc765e01ff97bfd9645c42b0ba30397f">id</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a417095d7c20d56d417dc0998e0dd5a5c">id</link>;
<anchor xml:id="_ff_8c_source_1l03863"/>03863 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;=&#32;mode;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;access&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03864"/>03864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;error&#32;flag&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03865"/>03865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;current&#32;data&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03866"/>03866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;pointer&#32;top&#32;of&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03867"/>03867 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l03868"/>03868 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l03869"/>03869 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;0,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>);&#32;<emphasis role="comment">/*&#32;Clear&#32;sector&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03870"/>03870 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03871"/>03871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((mode&#32;&amp;&#32;<link linkend="_ff_8c_1ad4d0d6afc5e28678b87a1b75b6645f7d">FA_SEEKEND</link>)&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Seek&#32;to&#32;end&#32;of&#32;file&#32;if&#32;FA_OPEN_APPEND&#32;is&#32;specified&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03872"/>03872 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;to&#32;seek&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03873"/>03873 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcs&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;in&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03874"/>03874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;cluster&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03875"/>03875 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(ofs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;ofs&#32;&gt;&#32;bcs;&#32;ofs&#32;-=&#32;bcs)&#32;{
<anchor xml:id="_ff_8c_source_1l03876"/>03876 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);
<anchor xml:id="_ff_8c_source_1l03877"/>03877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;=&#32;1)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03878"/>03878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03879"/>03879 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03880"/>03880 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;
<anchor xml:id="_ff_8c_source_1l03881"/>03881 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;{&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;buffer&#32;if&#32;not&#32;on&#32;the&#32;sector&#32;boundary&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03882"/>03882 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sc&#32;=&#32;clst2sect(fs,&#32;clst);
<anchor xml:id="_ff_8c_source_1l03883"/>03883 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sc&#32;==&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l03884"/>03884 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03885"/>03885 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l03886"/>03886 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sc&#32;+&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l03887"/>03887 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l03888"/>03888 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l03889"/>03889 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03890"/>03890 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03891"/>03891 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03892"/>03892 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l03893"/>03893 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dec_share(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid);&#32;<emphasis role="comment">/*&#32;Decrement&#32;file&#32;open&#32;counter&#32;if&#32;seek&#32;failed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03894"/>03894 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03895"/>03895 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03896"/>03896 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03897"/>03897 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03898"/>03898 
<anchor xml:id="_ff_8c_source_1l03899"/>03899 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l03900"/>03900 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03901"/>03901 
<anchor xml:id="_ff_8c_source_1l03902"/>03902 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;file&#32;object&#32;on&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03903"/>03903 
<anchor xml:id="_ff_8c_source_1l03904"/>03904 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l03905"/>03905 }
<anchor xml:id="_ff_8c_source_1l03906"/>03906 
<anchor xml:id="_ff_8c_source_1l03907"/>03907 
<anchor xml:id="_ff_8c_source_1l03908"/>03908 
<anchor xml:id="_ff_8c_source_1l03909"/>03909 
<anchor xml:id="_ff_8c_source_1l03910"/>03910 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03911"/>03911 <emphasis role="comment">/*&#32;Read&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03912"/>03912 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03913"/>03913 
<anchor xml:id="_ff_8c_source_1l03914"/><link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">03914</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>&#32;(
<anchor xml:id="_ff_8c_source_1l03915"/>03915 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;file&#32;to&#32;be&#32;read&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03916"/>03916 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>*&#32;buff,&#32;<emphasis role="comment">/*&#32;Data&#32;buffer&#32;to&#32;store&#32;the&#32;read&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03917"/>03917 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;btr,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;to&#32;read&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03918"/>03918 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>*&#32;br&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;read&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03919"/>03919 )
<anchor xml:id="_ff_8c_source_1l03920"/>03920 {
<anchor xml:id="_ff_8c_source_1l03921"/>03921 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l03922"/>03922 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l03923"/>03923 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst;
<anchor xml:id="_ff_8c_source_1l03924"/>03924 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l03925"/>03925 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;remain;
<anchor xml:id="_ff_8c_source_1l03926"/>03926 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;rcnt,&#32;cc,&#32;csect;
<anchor xml:id="_ff_8c_source_1l03927"/>03927 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*rbuff&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)buff;
<anchor xml:id="_ff_8c_source_1l03928"/>03928 
<anchor xml:id="_ff_8c_source_1l03929"/>03929 
<anchor xml:id="_ff_8c_source_1l03930"/>03930 &#32;&#32;&#32;&#32;*br&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;read&#32;byte&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03931"/>03931 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03932"/>03932 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03933"/>03933 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03934"/>03934 &#32;&#32;&#32;&#32;remain&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;-&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
<anchor xml:id="_ff_8c_source_1l03935"/>03935 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(btr&#32;&gt;&#32;remain)&#32;btr&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)remain;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncate&#32;btr&#32;by&#32;remaining&#32;bytes&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03936"/>03936 
<anchor xml:id="_ff_8c_source_1l03937"/>03937 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;btr&#32;&gt;&#32;0;&#32;btr&#32;-=&#32;rcnt,&#32;*br&#32;+=&#32;rcnt,&#32;rbuff&#32;+=&#32;rcnt,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;rcnt)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;btr&#32;bytes&#32;read&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03938"/>03938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;sector&#32;boundary?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03939"/>03939 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;csect&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1));&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;offset&#32;in&#32;the&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03940"/>03940 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;cluster&#32;boundary?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03941"/>03941 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;top&#32;of&#32;the&#32;file?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03942"/>03942 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;from&#32;the&#32;origin&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03943"/>03943 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Middle&#32;or&#32;end&#32;of&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03944"/>03944 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK</emphasis>
<anchor xml:id="_ff_8c_source_1l03945"/>03945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;cltbl)&#32;{
<anchor xml:id="_ff_8c_source_1l03946"/>03946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;clmt_clust(fp,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;cluster#&#32;from&#32;the&#32;CLMT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03947"/>03947 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l03948"/>03948 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03949"/>03949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l03950"/>03950 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03951"/>03951 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03952"/>03952 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03953"/>03953 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;&#32;2)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l03954"/>03954 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l03955"/>03955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;current&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03956"/>03956 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03957"/>03957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03958"/>03958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l03959"/>03959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;csect;
<anchor xml:id="_ff_8c_source_1l03960"/>03960 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;btr&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;remaining&#32;bytes&#32;&gt;=&#32;sector&#32;size,&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03961"/>03961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cc&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;maximum&#32;contiguous&#32;sectors&#32;directly&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03962"/>03962 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;+&#32;cc&#32;&gt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;cluster&#32;boundary&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03963"/>03963 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;csect;
<anchor xml:id="_ff_8c_source_1l03964"/>03964 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03965"/>03965 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;rbuff,&#32;sect,&#32;cc)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l03966"/>03966 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;2&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Replace&#32;one&#32;of&#32;the&#32;read&#32;sectors&#32;with&#32;cached&#32;data&#32;if&#32;it&#32;contains&#32;a&#32;dirty&#32;sector&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l03967"/>03967 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l03968"/>03968 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{
<anchor xml:id="_ff_8c_source_1l03969"/>03969 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff&#32;+&#32;((fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l03970"/>03970 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03971"/>03971 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l03972"/>03972 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{
<anchor xml:id="_ff_8c_source_1l03973"/>03973 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff&#32;+&#32;((fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l03974"/>03974 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03975"/>03975 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03976"/>03976 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03977"/>03977 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;*&#32;cc;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;transferred&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03978"/>03978 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l03979"/>03979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03980"/>03980 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l03981"/>03981 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;!=&#32;sect)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;data&#32;sector&#32;if&#32;not&#32;in&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03982"/>03982 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l03983"/>03983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03984"/>03984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l03985"/>03985 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l03986"/>03986 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03987"/>03987 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03988"/>03988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;sect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03989"/>03989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03990"/>03990 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l03991"/>03991 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sect;
<anchor xml:id="_ff_8c_source_1l03992"/>03992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l03993"/>03993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;remains&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03994"/>03994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rcnt&#32;&gt;&#32;btr)&#32;rcnt&#32;=&#32;btr;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;it&#32;by&#32;btr&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03995"/>03995 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l03996"/>03996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Move&#32;sector&#32;window&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03997"/>03997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;rcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extract&#32;partial&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l03998"/>03998 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l03999"/>03999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(rbuff,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;rcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extract&#32;partial&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04000"/>04000 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04001"/>04001 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04002"/>04002 
<anchor xml:id="_ff_8c_source_1l04003"/>04003 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l04004"/>04004 }
<anchor xml:id="_ff_8c_source_1l04005"/>04005 
<anchor xml:id="_ff_8c_source_1l04006"/>04006 
<anchor xml:id="_ff_8c_source_1l04007"/>04007 
<anchor xml:id="_ff_8c_source_1l04008"/>04008 
<anchor xml:id="_ff_8c_source_1l04009"/>04009 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04010"/>04010 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04011"/>04011 <emphasis role="comment">/*&#32;Write&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04012"/>04012 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04013"/>04013 
<anchor xml:id="_ff_8c_source_1l04014"/><link linkend="_ff_8c_1ae6a4dfae8a9e308bdb2283a37ef680f2">04014</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1ae6a4dfae8a9e308bdb2283a37ef680f2">f_write</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04015"/>04015 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;file&#32;to&#32;be&#32;written&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04016"/>04016 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>*&#32;buff,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Data&#32;to&#32;be&#32;written&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04017"/>04017 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;btw,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;to&#32;write&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04018"/>04018 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>*&#32;bw&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;written&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04019"/>04019 )
<anchor xml:id="_ff_8c_source_1l04020"/>04020 {
<anchor xml:id="_ff_8c_source_1l04021"/>04021 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04022"/>04022 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04023"/>04023 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst;
<anchor xml:id="_ff_8c_source_1l04024"/>04024 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l04025"/>04025 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;wcnt,&#32;cc,&#32;csect;
<anchor xml:id="_ff_8c_source_1l04026"/>04026 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*wbuff&#32;=&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)buff;
<anchor xml:id="_ff_8c_source_1l04027"/>04027 
<anchor xml:id="_ff_8c_source_1l04028"/>04028 
<anchor xml:id="_ff_8c_source_1l04029"/>04029 &#32;&#32;&#32;&#32;*bw&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;write&#32;byte&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04030"/>04030 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04031"/>04031 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04032"/>04032 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04033"/>04033 
<anchor xml:id="_ff_8c_source_1l04034"/>04034 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;fptr&#32;wrap-around&#32;(file&#32;size&#32;cannot&#32;reach&#32;4&#32;GiB&#32;at&#32;FAT&#32;volume)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04035"/>04035 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+&#32;btw)&#32;&lt;&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04036"/>04036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;btw&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(0xFFFFFFFF&#32;-&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>);
<anchor xml:id="_ff_8c_source_1l04037"/>04037 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04038"/>04038 
<anchor xml:id="_ff_8c_source_1l04039"/>04039 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;btw&#32;&gt;&#32;0;&#32;btw&#32;-=&#32;wcnt,&#32;*bw&#32;+=&#32;wcnt,&#32;wbuff&#32;+=&#32;wcnt,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;wcnt,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;?&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;:&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;all&#32;data&#32;written&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04040"/>04040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;sector&#32;boundary?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04041"/>04041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;csect&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;offset&#32;in&#32;the&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04042"/>04042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;cluster&#32;boundary?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04043"/>04043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;top&#32;of&#32;the&#32;file?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04044"/>04044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;from&#32;the&#32;origin&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04045"/>04045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;no&#32;cluster&#32;is&#32;allocated,&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04046"/>04046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;0);&#32;&#32;&#32;<emphasis role="comment">/*&#32;create&#32;a&#32;new&#32;cluster&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04047"/>04047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04048"/>04048 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;middle&#32;or&#32;end&#32;of&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04049"/>04049 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK</emphasis>
<anchor xml:id="_ff_8c_source_1l04050"/>04050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;cltbl)&#32;{
<anchor xml:id="_ff_8c_source_1l04051"/>04051 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;clmt_clust(fp,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;cluster#&#32;from&#32;the&#32;CLMT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04052"/>04052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04053"/>04053 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04054"/>04054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04055"/>04055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;or&#32;stretch&#32;cluster&#32;chain&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04056"/>04056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04057"/>04057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04058"/>04058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Could&#32;not&#32;allocate&#32;a&#32;new&#32;cluster&#32;(disk&#32;full)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04059"/>04059 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04060"/>04060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04061"/>04061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;current&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04062"/>04062 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;==&#32;0)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;clst;&#32;<emphasis role="comment">/*&#32;Set&#32;start&#32;cluster&#32;if&#32;the&#32;first&#32;write&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04063"/>04063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04064"/>04064 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04065"/>04065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;==&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;&amp;&amp;&#32;sync_window(fs)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04066"/>04066 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l04067"/>04067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04068"/>04068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04069"/>04069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04070"/>04070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04071"/>04071 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04072"/>04072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04073"/>04073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04074"/>04074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;csect;
<anchor xml:id="_ff_8c_source_1l04075"/>04075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;btw&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;remaining&#32;bytes&#32;&gt;=&#32;sector&#32;size,&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04076"/>04076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cc&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;maximum&#32;contiguous&#32;sectors&#32;directly&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04077"/>04077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;+&#32;cc&#32;&gt;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;cluster&#32;boundary&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04078"/>04078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cc&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;csect;
<anchor xml:id="_ff_8c_source_1l04079"/>04079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04080"/>04080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;wbuff,&#32;sect,&#32;cc)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04081"/>04081 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l04082"/>04082 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04083"/>04083 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Refill&#32;sector&#32;cache&#32;if&#32;it&#32;gets&#32;invalidated&#32;by&#32;the&#32;direct&#32;write&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04084"/>04084 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;wbuff&#32;+&#32;((fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l04085"/>04085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04086"/>04086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04087"/>04087 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l04088"/>04088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect&#32;&lt;&#32;cc)&#32;{&#32;<emphasis role="comment">/*&#32;Refill&#32;sector&#32;cache&#32;if&#32;it&#32;gets&#32;invalidated&#32;by&#32;the&#32;direct&#32;write&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04089"/>04089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;wbuff&#32;+&#32;((fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;-&#32;sect)&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l04090"/>04090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04091"/>04091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04092"/>04092 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04093"/>04093 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04094"/>04094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;*&#32;cc;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;transferred&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04095"/>04095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l04096"/>04096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04097"/>04097 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04098"/>04098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Avoid&#32;silly&#32;cache&#32;filling&#32;on&#32;the&#32;growing&#32;edge&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04099"/>04099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sync_window(fs)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04100"/>04100 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1aaf7eccaccdc9c4243230672d6b2f6566">winsect</link>&#32;=&#32;sect;
<anchor xml:id="_ff_8c_source_1l04101"/>04101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04102"/>04102 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l04103"/>04103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;!=&#32;sect&#32;&amp;&amp;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;with&#32;file&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04104"/>04104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&lt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&amp;
<anchor xml:id="_ff_8c_source_1l04105"/>04105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;sect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04106"/>04106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04107"/>04107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04108"/>04108 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04109"/>04109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sect;
<anchor xml:id="_ff_8c_source_1l04110"/>04110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04111"/>04111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;remains&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04112"/>04112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wcnt&#32;&gt;&#32;btw)&#32;wcnt&#32;=&#32;btw;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;it&#32;by&#32;btw&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04113"/>04113 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04114"/>04114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Move&#32;sector&#32;window&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04115"/>04115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;wbuff,&#32;wcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fit&#32;data&#32;to&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04116"/>04116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l04117"/>04117 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l04118"/>04118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>&#32;+&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs),&#32;wbuff,&#32;wcnt);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fit&#32;data&#32;to&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04119"/>04119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04120"/>04120 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04121"/>04121 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04122"/>04122 
<anchor xml:id="_ff_8c_source_1l04123"/>04123 &#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;change&#32;flag&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04124"/>04124 
<anchor xml:id="_ff_8c_source_1l04125"/>04125 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l04126"/>04126 }
<anchor xml:id="_ff_8c_source_1l04127"/>04127 
<anchor xml:id="_ff_8c_source_1l04128"/>04128 
<anchor xml:id="_ff_8c_source_1l04129"/>04129 
<anchor xml:id="_ff_8c_source_1l04130"/>04130 
<anchor xml:id="_ff_8c_source_1l04131"/>04131 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04132"/>04132 <emphasis role="comment">/*&#32;Synchronize&#32;the&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04133"/>04133 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04134"/>04134 
<anchor xml:id="_ff_8c_source_1l04135"/><link linkend="_ff_8c_1ad69c7246b122ba56a134939ee0eaf847">04135</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1ad69c7246b122ba56a134939ee0eaf847">f_sync</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04136"/>04136 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;file&#32;to&#32;be&#32;synced&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04137"/>04137 )
<anchor xml:id="_ff_8c_source_1l04138"/>04138 {
<anchor xml:id="_ff_8c_source_1l04139"/>04139 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04140"/>04140 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04141"/>04141 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;tm;
<anchor xml:id="_ff_8c_source_1l04142"/>04142 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*dir;
<anchor xml:id="_ff_8c_source_1l04143"/>04143 
<anchor xml:id="_ff_8c_source_1l04144"/>04144 
<anchor xml:id="_ff_8c_source_1l04145"/>04145 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04146"/>04146 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04147"/>04147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;any&#32;change&#32;to&#32;the&#32;file?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04148"/>04148 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04149"/>04149 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;cached&#32;data&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04150"/>04150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04151"/>04151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04152"/>04152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04153"/>04153 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04154"/>04154 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04155"/>04155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tm&#32;=&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Modified&#32;time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04156"/>04156 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04157"/>04157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04158"/>04158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_first_frag(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;first&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04159"/>04159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04160"/>04160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_last_frag(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;last&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04161"/>04161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04162"/>04162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04163"/>04163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l04164"/>04164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04165"/>04165 
<anchor xml:id="_ff_8c_source_1l04166"/>04166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l04167"/>04167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;load_obj_xdir(&amp;dj,&#32;&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>);&#32;<emphasis role="comment">/*&#32;Load&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04168"/>04168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04169"/>04169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;to&#32;indicate&#32;that&#32;the&#32;file&#32;has&#32;been&#32;changed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04170"/>04170 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;|&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;allocation&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04171"/>04171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04172"/>04172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04173"/>04173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a543e2a11cefac978a0108a7973416d56">XDIR_ValidFileSize</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);&#32;<emphasis role="comment">/*&#32;(FatFs&#32;does&#32;not&#32;support&#32;Valid&#32;File&#32;Size&#32;feature)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04174"/>04174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>,&#32;tm);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;modified&#32;time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04175"/>04175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a0f63c605687d0ed66c633ba6a10c01e5">XDIR_ModTime10</link>]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04176"/>04176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1af0a826e3f3902172e3ebd5a3132a0153">XDIR_AccTime</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l04177"/>04177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;it&#32;to&#32;the&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04178"/>04178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04179"/>04179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l04180"/>04180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
<anchor xml:id="_ff_8c_source_1l04181"/>04181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04182"/>04182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04183"/>04183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l04184"/>04184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04185"/>04185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04186"/>04186 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04187"/>04187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04188"/>04188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1a19e61b116df8e6f2138243998e43f131">dir_sect</link>);
<anchor xml:id="_ff_8c_source_1l04189"/>04189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04190"/>04190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a5af9e9fb312b629220eaf684dd28c4a9">dir_ptr</link>;
<anchor xml:id="_ff_8c_source_1l04191"/>04191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;to&#32;indicate&#32;that&#32;the&#32;file&#32;has&#32;been&#32;changed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04192"/>04192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;dir,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;allocation&#32;information&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04193"/>04193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dir&#32;+&#32;<link linkend="_ff_8c_1abfbfa613864a02a65f0bf70ead6672c7">DIR_FileSize</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;file&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04194"/>04194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dir&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;modified&#32;time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04195"/>04195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dir&#32;+&#32;<link linkend="_ff_8c_1afa0625d73f4683df24345f51e7a43da3">DIR_LstAccDate</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l04196"/>04196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l04197"/>04197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;it&#32;to&#32;the&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04198"/>04198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
<anchor xml:id="_ff_8c_source_1l04199"/>04199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04200"/>04200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04201"/>04201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04202"/>04202 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04203"/>04203 
<anchor xml:id="_ff_8c_source_1l04204"/>04204 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04205"/>04205 }
<anchor xml:id="_ff_8c_source_1l04206"/>04206 
<anchor xml:id="_ff_8c_source_1l04207"/>04207 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04208"/>04208 
<anchor xml:id="_ff_8c_source_1l04209"/>04209 
<anchor xml:id="_ff_8c_source_1l04210"/>04210 
<anchor xml:id="_ff_8c_source_1l04211"/>04211 
<anchor xml:id="_ff_8c_source_1l04212"/>04212 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04213"/>04213 <emphasis role="comment">/*&#32;Close&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04214"/>04214 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04215"/>04215 
<anchor xml:id="_ff_8c_source_1l04216"/><link linkend="_ff_8c_1a53882db20ef4323dcfd1874d7733ffc3">04216</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a53882db20ef4323dcfd1874d7733ffc3">f_close</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04217"/>04217 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;file&#32;to&#32;be&#32;closed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04218"/>04218 )
<anchor xml:id="_ff_8c_source_1l04219"/>04219 {
<anchor xml:id="_ff_8c_source_1l04220"/>04220 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04221"/>04221 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04222"/>04222 
<anchor xml:id="_ff_8c_source_1l04223"/>04223 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04224"/>04224 &#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1ad69c7246b122ba56a134939ee0eaf847">f_sync</link>(fp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flush&#32;cached&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04225"/>04225 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)
<anchor xml:id="_ff_8c_source_1l04226"/>04226 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04227"/>04227 &#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04228"/>04228 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Lock&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04229"/>04229 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04230"/>04230 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l04231"/>04231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dec_share(fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.lockid);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decrement&#32;file&#32;open&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04232"/>04232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04233"/>04233 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l04234"/>04234 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04235"/>04235 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04236"/>04236 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l04237"/>04237 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;unlock_volume(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unlock&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04238"/>04238 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04239"/>04239 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04240"/>04240 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04241"/>04241 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l04242"/>04242 }
<anchor xml:id="_ff_8c_source_1l04243"/>04243 
<anchor xml:id="_ff_8c_source_1l04244"/>04244 
<anchor xml:id="_ff_8c_source_1l04245"/>04245 
<anchor xml:id="_ff_8c_source_1l04246"/>04246 
<anchor xml:id="_ff_8c_source_1l04247"/>04247 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;&gt;=&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l04248"/>04248 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04249"/>04249 <emphasis role="comment">/*&#32;Change&#32;Current&#32;Directory&#32;or&#32;Current&#32;Drive,&#32;Get&#32;Current&#32;Directory&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04250"/>04250 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04251"/>04251 
<anchor xml:id="_ff_8c_source_1l04252"/><link linkend="_ff_8c_1a13e5933f851b436890361189f64261cd">04252</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a13e5933f851b436890361189f64261cd">f_chdrive</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04253"/>04253 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;to&#32;set&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04254"/>04254 )
<anchor xml:id="_ff_8c_source_1l04255"/>04255 {
<anchor xml:id="_ff_8c_source_1l04256"/>04256 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
<anchor xml:id="_ff_8c_source_1l04257"/>04257 
<anchor xml:id="_ff_8c_source_1l04258"/>04258 
<anchor xml:id="_ff_8c_source_1l04259"/>04259 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04260"/>04260 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(&amp;path);
<anchor xml:id="_ff_8c_source_1l04261"/>04261 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
<anchor xml:id="_ff_8c_source_1l04262"/>04262 &#32;&#32;&#32;&#32;CurrVol&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)vol;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;it&#32;as&#32;current&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04263"/>04263 
<anchor xml:id="_ff_8c_source_1l04264"/>04264 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l04265"/>04265 }
<anchor xml:id="_ff_8c_source_1l04266"/>04266 
<anchor xml:id="_ff_8c_source_1l04267"/>04267 
<anchor xml:id="_ff_8c_source_1l04268"/>04268 
<anchor xml:id="_ff_8c_source_1l04269"/><link linkend="_ff_8c_1a53c7e9a7fb3c279254cd2d0445667e2f">04269</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a53c7e9a7fb3c279254cd2d0445667e2f">f_chdir</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04270"/>04270 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04271"/>04271 )
<anchor xml:id="_ff_8c_source_1l04272"/>04272 {
<anchor xml:id="_ff_8c_source_1l04273"/>04273 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l04274"/>04274 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l04275"/>04275 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04276"/>04276 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04277"/>04277 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l04278"/>04278 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04279"/>04279 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04280"/>04280 
<anchor xml:id="_ff_8c_source_1l04281"/>04281 
<anchor xml:id="_ff_8c_source_1l04282"/>04282 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04283"/>04283 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
<anchor xml:id="_ff_8c_source_1l04284"/>04284 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04285"/>04285 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l04286"/>04286 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l04287"/>04287 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04288"/>04288 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;completed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04289"/>04289 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;the&#32;start&#32;directory&#32;itself?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04290"/>04290 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
<anchor xml:id="_ff_8c_source_1l04291"/>04291 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04292"/>04292 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04293"/>04293 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_scl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_scl;
<anchor xml:id="_ff_8c_source_1l04294"/>04294 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_size&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_size;
<anchor xml:id="_ff_8c_source_1l04295"/>04295 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_ofs&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_ofs;
<anchor xml:id="_ff_8c_source_1l04296"/>04296 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04297"/>04297 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04298"/>04298 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04299"/>04299 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;sub-directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04300"/>04300 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04301"/>04301 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04302"/>04302 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;ld_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sub-directory&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04303"/>04303 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_scl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;containing&#32;directory&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04304"/>04304 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
<anchor xml:id="_ff_8c_source_1l04305"/>04305 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdc_ofs&#32;=&#32;dj.blk_ofs;
<anchor xml:id="_ff_8c_source_1l04306"/>04306 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04307"/>04307 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04308"/>04308 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04309"/>04309 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;cdir&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sub-directory&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04310"/>04310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04311"/>04311 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04312"/>04312 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reached&#32;but&#32;a&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04313"/>04313 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04314"/>04314 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04315"/>04315 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04316"/>04316 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l04317"/>04317 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;
<anchor xml:id="_ff_8c_source_1l04318"/>04318 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Also&#32;current&#32;drive&#32;is&#32;changed&#32;if&#32;in&#32;Unix&#32;style&#32;volume&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04319"/>04319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04320"/>04320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;<link linkend="_ffconf_8h_1a2343dca8b59f249f6a88574fda8ac31c">FF_VOLUMES</link>&#32;-&#32;1;&#32;i&#32;&amp;&amp;&#32;fs&#32;!=&#32;FatFs[i];&#32;i--)&#32;;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;current&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04321"/>04321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;CurrVol&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)i;
<anchor xml:id="_ff_8c_source_1l04322"/>04322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04323"/>04323 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04324"/>04324 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04325"/>04325 
<anchor xml:id="_ff_8c_source_1l04326"/>04326 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04327"/>04327 }
<anchor xml:id="_ff_8c_source_1l04328"/>04328 
<anchor xml:id="_ff_8c_source_1l04329"/>04329 
<anchor xml:id="_ff_8c_source_1l04330"/>04330 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;&gt;=&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l04331"/>04331 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1acb865a03dbac0031ac5cb8a031f7b71c">f_getcwd</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04332"/>04332 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;buff,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04333"/>04333 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;len&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;buff&#32;in&#32;unit&#32;of&#32;TCHAR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04334"/>04334 )
<anchor xml:id="_ff_8c_source_1l04335"/>04335 {
<anchor xml:id="_ff_8c_source_1l04336"/>04336 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04337"/>04337 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l04338"/>04338 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04339"/>04339 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;n;
<anchor xml:id="_ff_8c_source_1l04340"/>04340 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ccl;
<anchor xml:id="_ff_8c_source_1l04341"/>04341 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*tp&#32;=&#32;buff;
<anchor xml:id="_ff_8c_source_1l04342"/>04342 <emphasis role="preprocessor">#if&#32;FF_VOLUMES&#32;&gt;=&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l04343"/>04343 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;vl;
<anchor xml:id="_ff_8c_source_1l04344"/>04344 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID</emphasis>
<anchor xml:id="_ff_8c_source_1l04345"/>04345 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*vp;
<anchor xml:id="_ff_8c_source_1l04346"/>04346 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04347"/>04347 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04348"/>04348 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>&#32;fno;
<anchor xml:id="_ff_8c_source_1l04349"/>04349 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04350"/>04350 
<anchor xml:id="_ff_8c_source_1l04351"/>04351 
<anchor xml:id="_ff_8c_source_1l04352"/>04352 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04353"/>04353 &#32;&#32;&#32;&#32;buff[0]&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;null&#32;string&#32;to&#32;get&#32;current&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04354"/>04354 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume((<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>**)&amp;buff,&#32;&amp;fs,&#32;0);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04355"/>04355 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04356"/>04356 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l04357"/>04357 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l04358"/>04358 
<anchor xml:id="_ff_8c_source_1l04359"/>04359 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;parent&#32;directories&#32;and&#32;create&#32;the&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04360"/>04360 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;len;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bottom&#32;of&#32;buffer&#32;(directory&#32;stack&#32;base)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04361"/>04361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;(Cannot&#32;do&#32;getcwd&#32;on&#32;exFAT&#32;and&#32;returns&#32;root&#32;path)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04362"/>04362 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;fs-&gt;cdir;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;to&#32;follow&#32;upper&#32;directory&#32;from&#32;current&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04363"/>04363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;((ccl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>)&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;while&#32;current&#32;directory&#32;is&#32;a&#32;sub-directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04364"/>04364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(&amp;dj,&#32;1&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;<emphasis role="comment">/*&#32;Get&#32;parent&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04365"/>04365 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04366"/>04366 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a9dbf89e967958c35ed9c7b2c3c60375e">sect</link>);
<anchor xml:id="_ff_8c_source_1l04367"/>04367 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04368"/>04368 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Goto&#32;parent&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04369"/>04369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(&amp;dj,&#32;0);
<anchor xml:id="_ff_8c_source_1l04370"/>04370 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04371"/>04371 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;the&#32;entry&#32;links&#32;to&#32;the&#32;child&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04372"/>04372 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">DIR_READ_FILE</link>(&amp;dj);
<anchor xml:id="_ff_8c_source_1l04373"/>04373 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04374"/>04374 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ccl&#32;==&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;Found&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04375"/>04375 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(&amp;dj,&#32;0);
<anchor xml:id="_ff_8c_source_1l04376"/>04376 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l04377"/>04377 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;<emphasis role="comment">/*&#32;It&#32;cannot&#32;be&#32;&apos;not&#32;found&apos;.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04378"/>04378 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04379"/>04379 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;get_fileinfo(&amp;dj,&#32;&amp;fno);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;directory&#32;name&#32;and&#32;push&#32;it&#32;to&#32;the&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04380"/>04380 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;0;&#32;fno.<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[n];&#32;n++)&#32;;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Name&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04381"/>04381 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;&#32;n&#32;+&#32;1)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Insufficient&#32;space&#32;to&#32;store&#32;the&#32;path&#32;name?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04382"/>04382 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04383"/>04383 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04384"/>04384 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n)&#32;buff[--i]&#32;=&#32;fno.<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[--n];&#32;&#32;&#32;<emphasis role="comment">/*&#32;Stack&#32;the&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04385"/>04385 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buff[--i]&#32;=&#32;<emphasis role="charliteral">&apos;/&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l04386"/>04386 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04387"/>04387 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04388"/>04388 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04389"/>04389 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;len)&#32;buff[--i]&#32;=&#32;<emphasis role="charliteral">&apos;/&apos;</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;the&#32;root-directory?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04390"/>04390 <emphasis role="preprocessor">#if&#32;FF_VOLUMES&#32;&gt;=&#32;2&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Put&#32;drive&#32;prefix&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04391"/>04391 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vl&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04392"/>04392 <emphasis role="preprocessor">#if&#32;FF_STR_VOLUME_ID&#32;&gt;=&#32;1&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;String&#32;volume&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04393"/>04393 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;0,&#32;vp&#32;=&#32;(<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>*)VolumeStr[CurrVol];&#32;vp[n];&#32;n++)&#32;;
<anchor xml:id="_ff_8c_source_1l04394"/>04394 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;n&#32;+&#32;2)&#32;{
<anchor xml:id="_ff_8c_source_1l04395"/>04395 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a056575130662da5bc7ac26a5b1d25838">FF_STR_VOLUME_ID</link>&#32;==&#32;2)&#32;*tp++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)<emphasis role="charliteral">&apos;/&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l04396"/>04396 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(vl&#32;=&#32;0;&#32;vl&#32;&lt;&#32;n;&#32;*tp++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)vp[vl],&#32;vl++)&#32;;
<anchor xml:id="_ff_8c_source_1l04397"/>04397 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a056575130662da5bc7ac26a5b1d25838">FF_STR_VOLUME_ID</link>&#32;==&#32;1)&#32;*tp++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)<emphasis role="charliteral">&apos;:&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l04398"/>04398 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vl++;
<anchor xml:id="_ff_8c_source_1l04399"/>04399 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04400"/>04400 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Numeric&#32;volume&#32;ID&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04401"/>04401 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;3)&#32;{
<anchor xml:id="_ff_8c_source_1l04402"/>04402 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tp++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)<emphasis role="charliteral">&apos;0&apos;</emphasis>&#32;+&#32;CurrVol;
<anchor xml:id="_ff_8c_source_1l04403"/>04403 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tp++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)<emphasis role="charliteral">&apos;:&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l04404"/>04404 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;vl&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l04405"/>04405 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04406"/>04406 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04407"/>04407 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vl&#32;==&#32;0)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;
<anchor xml:id="_ff_8c_source_1l04408"/>04408 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04409"/>04409 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Add&#32;current&#32;directory&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04410"/>04410 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04411"/>04411 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Copy&#32;stacked&#32;path&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04412"/>04412 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tp++&#32;=&#32;buff[i++];
<anchor xml:id="_ff_8c_source_1l04413"/>04413 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(i&#32;&lt;&#32;len);
<anchor xml:id="_ff_8c_source_1l04414"/>04414 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04415"/>04415 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04416"/>04416 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l04417"/>04417 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04418"/>04418 
<anchor xml:id="_ff_8c_source_1l04419"/>04419 &#32;&#32;&#32;&#32;*tp&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04420"/>04420 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04421"/>04421 }
<anchor xml:id="_ff_8c_source_1l04422"/>04422 
<anchor xml:id="_ff_8c_source_1l04423"/>04423 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_RPATH&#32;&gt;=&#32;2&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04424"/>04424 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_RPATH&#32;&gt;=&#32;1&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04425"/>04425 
<anchor xml:id="_ff_8c_source_1l04426"/>04426 
<anchor xml:id="_ff_8c_source_1l04427"/>04427 
<anchor xml:id="_ff_8c_source_1l04428"/>04428 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l04429"/>04429 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04430"/>04430 <emphasis role="comment">/*&#32;Seek&#32;File&#32;Read/Write&#32;Pointer&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04431"/>04431 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04432"/>04432 
<anchor xml:id="_ff_8c_source_1l04433"/><link linkend="_ff_8c_1a7c4bcf81d9122f0b5376852ec6a8c3eb">04433</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a7c4bcf81d9122f0b5376852ec6a8c3eb">f_lseek</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04434"/>04434 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04435"/>04435 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;ofs&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;pointer&#32;from&#32;top&#32;of&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04436"/>04436 )
<anchor xml:id="_ff_8c_source_1l04437"/>04437 {
<anchor xml:id="_ff_8c_source_1l04438"/>04438 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04439"/>04439 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04440"/>04440 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;bcs;
<anchor xml:id="_ff_8c_source_1l04441"/>04441 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;nsect;
<anchor xml:id="_ff_8c_source_1l04442"/>04442 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;ifptr;
<anchor xml:id="_ff_8c_source_1l04443"/>04443 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK</emphasis>
<anchor xml:id="_ff_8c_source_1l04444"/>04444 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;cl,&#32;pcl,&#32;ncl,&#32;tcl,&#32;tlen,&#32;ulen;
<anchor xml:id="_ff_8c_source_1l04445"/>04445 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;*tbl;
<anchor xml:id="_ff_8c_source_1l04446"/>04446 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;dsc;
<anchor xml:id="_ff_8c_source_1l04447"/>04447 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04448"/>04448 
<anchor xml:id="_ff_8c_source_1l04449"/>04449 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04450"/>04450 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>;
<anchor xml:id="_ff_8c_source_1l04451"/>04451 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT&#32;&amp;&amp;&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04452"/>04452 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04453"/>04453 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;fill_last_frag(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;last&#32;fragment&#32;on&#32;the&#32;FAT&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04454"/>04454 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04455"/>04455 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04456"/>04456 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04457"/>04457 
<anchor xml:id="_ff_8c_source_1l04458"/>04458 <emphasis role="preprocessor">#if&#32;FF_USE_FASTSEEK</emphasis>
<anchor xml:id="_ff_8c_source_1l04459"/>04459 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;cltbl)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fast&#32;seek&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04460"/>04460 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;==&#32;<link linkend="_ff_8h_1aee297a9011164cf485a4df2a72758b08">CREATE_LINKMAP</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;CLMT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04461"/>04461 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tbl&#32;=&#32;fp-&gt;cltbl;
<anchor xml:id="_ff_8c_source_1l04462"/>04462 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tlen&#32;=&#32;*tbl++;&#32;ulen&#32;=&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Given&#32;table&#32;size&#32;and&#32;required&#32;table&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04463"/>04463 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Origin&#32;of&#32;the&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04464"/>04464 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l04465"/>04465 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04466"/>04466 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04467"/>04467 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tcl&#32;=&#32;cl;&#32;ncl&#32;=&#32;0;&#32;ulen&#32;+=&#32;2;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top,&#32;length&#32;and&#32;used&#32;items&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04468"/>04468 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04469"/>04469 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pcl&#32;=&#32;cl;&#32;ncl++;
<anchor xml:id="_ff_8c_source_1l04470"/>04470 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cl&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;cl);
<anchor xml:id="_ff_8c_source_1l04471"/>04471 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;&lt;=&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04472"/>04472 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cl&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04473"/>04473 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(cl&#32;==&#32;pcl&#32;+&#32;1);
<anchor xml:id="_ff_8c_source_1l04474"/>04474 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ulen&#32;&lt;=&#32;tlen)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;length&#32;and&#32;top&#32;of&#32;the&#32;fragment&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04475"/>04475 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tbl++&#32;=&#32;ncl;&#32;*tbl++&#32;=&#32;tcl;
<anchor xml:id="_ff_8c_source_1l04476"/>04476 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04477"/>04477 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(cl&#32;&lt;&#32;fs-&gt;n_fatent);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;end&#32;of&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04478"/>04478 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04479"/>04479 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*fp-&gt;cltbl&#32;=&#32;ulen;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;items&#32;used&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04480"/>04480 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ulen&#32;&lt;=&#32;tlen)&#32;{
<anchor xml:id="_ff_8c_source_1l04481"/>04481 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*tbl&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04482"/>04482 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04483"/>04483 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Given&#32;table&#32;size&#32;is&#32;smaller&#32;than&#32;required&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04484"/>04484 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04485"/>04485 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fast&#32;seek&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04486"/>04486 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;ofs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;offset&#32;at&#32;the&#32;file&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04487"/>04487 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;ofs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;pointer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04488"/>04488 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l04489"/>04489 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clmt_clust(fp,&#32;ofs&#32;-&#32;1);
<anchor xml:id="_ff_8c_source_1l04490"/>04490 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dsc&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);
<anchor xml:id="_ff_8c_source_1l04491"/>04491 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dsc&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04492"/>04492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dsc&#32;+=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((ofs&#32;-&#32;1)&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1);
<anchor xml:id="_ff_8c_source_1l04493"/>04493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&amp;&#32;dsc&#32;!=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Refill&#32;sector&#32;cache&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04494"/>04494 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04495"/>04495 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04496"/>04496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04497"/>04497 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04498"/>04498 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04499"/>04499 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04500"/>04500 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04501"/>04501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;dsc,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Load&#32;current&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04502"/>04502 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04503"/>04503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;dsc;
<anchor xml:id="_ff_8c_source_1l04504"/>04504 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04505"/>04505 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04506"/>04506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04507"/>04507 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04508"/>04508 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04509"/>04509 
<anchor xml:id="_ff_8c_source_1l04510"/>04510 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Normal&#32;Seek&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04511"/>04511 &#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04512"/>04512 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04513"/>04513 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#32;&amp;&amp;&#32;ofs&#32;&gt;=&#32;0x100000000)&#32;ofs&#32;=&#32;0xFFFFFFFF;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;4&#32;GiB&#32;-&#32;1&#32;if&#32;at&#32;FATxx&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04514"/>04514 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04515"/>04515 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&amp;&#32;(<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;||&#32;!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>)))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;In&#32;read-only&#32;mode,&#32;clip&#32;offset&#32;with&#32;the&#32;file&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04516"/>04516 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;
<anchor xml:id="_ff_8c_source_1l04517"/>04517 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04518"/>04518 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ifptr&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
<anchor xml:id="_ff_8c_source_1l04519"/>04519 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;nsect&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04520"/>04520 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;&gt;&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l04521"/>04521 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcs&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;(byte)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04522"/>04522 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ifptr&#32;&gt;&#32;0&#32;&amp;&amp;
<anchor xml:id="_ff_8c_source_1l04523"/>04523 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;(ofs&#32;-&#32;1)&#32;/&#32;bcs&#32;&gt;=&#32;(ifptr&#32;-&#32;1)&#32;/&#32;bcs)&#32;{&#32;<emphasis role="comment">/*&#32;When&#32;seek&#32;to&#32;same&#32;or&#32;following&#32;cluster,&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04524"/>04524 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;=&#32;(ifptr&#32;-&#32;1)&#32;&amp;&#32;~(<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>)(bcs&#32;-&#32;1);&#32;&#32;&#32;<emphasis role="comment">/*&#32;start&#32;from&#32;the&#32;current&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04525"/>04525 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;-=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
<anchor xml:id="_ff_8c_source_1l04526"/>04526 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>;
<anchor xml:id="_ff_8c_source_1l04527"/>04527 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;seek&#32;to&#32;back&#32;cluster,&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04528"/>04528 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;start&#32;from&#32;the&#32;first&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04529"/>04529 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04530"/>04530 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;no&#32;cluster&#32;chain,&#32;create&#32;a&#32;new&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04531"/>04531 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l04532"/>04532 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04533"/>04533 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04534"/>04534 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;clst;
<anchor xml:id="_ff_8c_source_1l04535"/>04535 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04536"/>04536 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04537"/>04537 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;
<anchor xml:id="_ff_8c_source_1l04538"/>04538 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04539"/>04539 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l04540"/>04540 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(ofs&#32;&gt;&#32;bcs)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;following&#32;loop&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04541"/>04541 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;-=&#32;bcs;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;bcs;
<anchor xml:id="_ff_8c_source_1l04542"/>04542 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04543"/>04543 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;in&#32;write&#32;mode&#32;or&#32;not&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04544"/>04544 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;FAT&#32;chain&#32;object&#32;needs&#32;correct&#32;objsize&#32;to&#32;generate&#32;FAT&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04545"/>04545 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
<anchor xml:id="_ff_8c_source_1l04546"/>04546 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
<anchor xml:id="_ff_8c_source_1l04547"/>04547 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04548"/>04548 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;create_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;chain&#32;with&#32;forceed&#32;stretch&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04549"/>04549 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;file&#32;size&#32;in&#32;case&#32;of&#32;disk&#32;full&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04550"/>04550 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04551"/>04551 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04552"/>04552 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04553"/>04553 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04554"/>04554 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04555"/>04555 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);&#32;<emphasis role="comment">/*&#32;Follow&#32;cluster&#32;chain&#32;if&#32;not&#32;in&#32;write&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04556"/>04556 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04557"/>04557 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04558"/>04558 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;=&#32;1&#32;||&#32;clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04559"/>04559 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;
<anchor xml:id="_ff_8c_source_1l04560"/>04560 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04561"/>04561 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;ofs;
<anchor xml:id="_ff_8c_source_1l04562"/>04562 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs))&#32;{
<anchor xml:id="_ff_8c_source_1l04563"/>04563 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;=&#32;clst2sect(fs,&#32;clst);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Current&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04564"/>04564 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nsect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04565"/>04565 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;+=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(ofs&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l04566"/>04566 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04567"/>04567 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04568"/>04568 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04569"/>04569 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ac932d228331b07248a3faa6f5904a49d">FF_FS_READONLY</link>&#32;&amp;&amp;&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&gt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;change&#32;flag&#32;if&#32;the&#32;file&#32;size&#32;is&#32;extended&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04570"/>04570 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
<anchor xml:id="_ff_8c_source_1l04571"/>04571 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
<anchor xml:id="_ff_8c_source_1l04572"/>04572 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04573"/>04573 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&amp;&#32;nsect&#32;!=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04574"/>04574 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04575"/>04575 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04576"/>04576 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04577"/>04577 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l04578"/>04578 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04579"/>04579 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04580"/>04580 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04581"/>04581 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;nsect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04582"/>04582 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04583"/>04583 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;nsect;
<anchor xml:id="_ff_8c_source_1l04584"/>04584 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04585"/>04585 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04586"/>04586 
<anchor xml:id="_ff_8c_source_1l04587"/>04587 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04588"/>04588 }
<anchor xml:id="_ff_8c_source_1l04589"/>04589 
<anchor xml:id="_ff_8c_source_1l04590"/>04590 
<anchor xml:id="_ff_8c_source_1l04591"/>04591 
<anchor xml:id="_ff_8c_source_1l04592"/>04592 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l04593"/>04593 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04594"/>04594 <emphasis role="comment">/*&#32;Create&#32;a&#32;Directory&#32;Object&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04595"/>04595 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04596"/>04596 
<anchor xml:id="_ff_8c_source_1l04597"/><link linkend="_ff_8c_1a0d5b386636ec82d4c1e912d5902aa0e0">04597</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a0d5b386636ec82d4c1e912d5902aa0e0">f_opendir</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04598"/>04598 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;directory&#32;object&#32;to&#32;create&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04599"/>04599 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04600"/>04600 )
<anchor xml:id="_ff_8c_source_1l04601"/>04601 {
<anchor xml:id="_ff_8c_source_1l04602"/>04602 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04603"/>04603 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04604"/>04604 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04605"/>04605 
<anchor xml:id="_ff_8c_source_1l04606"/>04606 
<anchor xml:id="_ff_8c_source_1l04607"/>04607 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dp)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3dec4eba481cdf5e99d7cd6009e6dcf8">FR_INVALID_OBJECT</link>;
<anchor xml:id="_ff_8c_source_1l04608"/>04608 
<anchor xml:id="_ff_8c_source_1l04609"/>04609 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04610"/>04610 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
<anchor xml:id="_ff_8c_source_1l04611"/>04611 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04612"/>04612 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l04613"/>04613 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l04614"/>04614 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(dp,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;path&#32;to&#32;the&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04615"/>04615 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;completed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04616"/>04616 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;not&#32;the&#32;origin&#32;directory&#32;itself&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04617"/>04617 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;This&#32;object&#32;is&#32;a&#32;sub-directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04618"/>04618 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04619"/>04619 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04620"/>04620 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_scl&#32;=&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;&#32;<emphasis role="comment">/*&#32;Get&#32;containing&#32;directory&#32;inforamation&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04621"/>04621 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_size&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;&amp;&#32;0xFFFFFF00)&#32;|&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
<anchor xml:id="_ff_8c_source_1l04622"/>04622 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.c_ofs&#32;=&#32;dp-&gt;blk_ofs;
<anchor xml:id="_ff_8c_source_1l04623"/>04623 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>);&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;object&#32;allocation&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04624"/>04624 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04625"/>04625 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04626"/>04626 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l04627"/>04627 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;ld_clust(fs,&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);&#32;<emphasis role="comment">/*&#32;Get&#32;object&#32;allocation&#32;info&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04628"/>04628 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04629"/>04629 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;This&#32;object&#32;is&#32;a&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04630"/>04630 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;
<anchor xml:id="_ff_8c_source_1l04631"/>04631 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04632"/>04632 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04633"/>04633 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04634"/>04634 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1afc765e01ff97bfd9645c42b0ba30397f">id</link>&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a417095d7c20d56d417dc0998e0dd5a5c">id</link>;
<anchor xml:id="_ff_8c_source_1l04635"/>04635 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Rewind&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04636"/>04636 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l04637"/>04637 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04638"/>04638 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l04639"/>04639 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid&#32;=&#32;inc_share(dp,&#32;0);&#32;&#32;<emphasis role="comment">/*&#32;Lock&#32;the&#32;sub&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04640"/>04640 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca50dd3c3c274ccebb2cfbddde9d065bb9">FR_TOO_MANY_OPEN_FILES</link>;
<anchor xml:id="_ff_8c_source_1l04641"/>04641 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04642"/>04642 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Root&#32;directory&#32;need&#32;not&#32;to&#32;be&#32;locked&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04643"/>04643 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04644"/>04644 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04645"/>04645 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04646"/>04646 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04647"/>04647 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04648"/>04648 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l04649"/>04649 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cae4529c8cc8b59783d6efc9ba4f574532">FR_NO_PATH</link>;
<anchor xml:id="_ff_8c_source_1l04650"/>04650 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04651"/>04651 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;the&#32;directory&#32;object&#32;if&#32;function&#32;failed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04652"/>04652 
<anchor xml:id="_ff_8c_source_1l04653"/>04653 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04654"/>04654 }
<anchor xml:id="_ff_8c_source_1l04655"/>04655 
<anchor xml:id="_ff_8c_source_1l04656"/>04656 
<anchor xml:id="_ff_8c_source_1l04657"/>04657 
<anchor xml:id="_ff_8c_source_1l04658"/>04658 
<anchor xml:id="_ff_8c_source_1l04659"/>04659 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04660"/>04660 <emphasis role="comment">/*&#32;Close&#32;Directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04661"/>04661 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04662"/>04662 
<anchor xml:id="_ff_8c_source_1l04663"/><link linkend="_ff_8c_1aba2c2f47f12fd4875bd6a62fa58fa1a9">04663</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1aba2c2f47f12fd4875bd6a62fa58fa1a9">f_closedir</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04664"/>04664 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;*dp&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;object&#32;to&#32;be&#32;closed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04665"/>04665 )
<anchor xml:id="_ff_8c_source_1l04666"/>04666 {
<anchor xml:id="_ff_8c_source_1l04667"/>04667 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04668"/>04668 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04669"/>04669 
<anchor xml:id="_ff_8c_source_1l04670"/>04670 
<anchor xml:id="_ff_8c_source_1l04671"/>04671 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04672"/>04672 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04673"/>04673 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l04674"/>04674 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid)&#32;res&#32;=&#32;dec_share(dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.lockid);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decrement&#32;sub-directory&#32;open&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04675"/>04675 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04676"/>04676 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l04677"/>04677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Invalidate&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04678"/>04678 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04679"/>04679 <emphasis role="preprocessor">#if&#32;FF_FS_REENTRANT</emphasis>
<anchor xml:id="_ff_8c_source_1l04680"/>04680 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;unlock_volume(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unlock&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04681"/>04681 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04682"/>04682 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04683"/>04683 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l04684"/>04684 }
<anchor xml:id="_ff_8c_source_1l04685"/>04685 
<anchor xml:id="_ff_8c_source_1l04686"/>04686 
<anchor xml:id="_ff_8c_source_1l04687"/>04687 
<anchor xml:id="_ff_8c_source_1l04688"/>04688 
<anchor xml:id="_ff_8c_source_1l04689"/>04689 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04690"/>04690 <emphasis role="comment">/*&#32;Read&#32;Directory&#32;Entries&#32;in&#32;Sequence&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04691"/>04691 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04692"/>04692 
<anchor xml:id="_ff_8c_source_1l04693"/><link linkend="_ff_8c_1ab8b2c70a95ca61f4f516c56fda7f82ab">04693</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1ab8b2c70a95ca61f4f516c56fda7f82ab">f_readdir</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04694"/>04694 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;open&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04695"/>04695 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>*&#32;fno&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;file&#32;information&#32;to&#32;return&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04696"/>04696 )
<anchor xml:id="_ff_8c_source_1l04697"/>04697 {
<anchor xml:id="_ff_8c_source_1l04698"/>04698 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04699"/>04699 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04700"/>04700 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04701"/>04701 
<anchor xml:id="_ff_8c_source_1l04702"/>04702 
<anchor xml:id="_ff_8c_source_1l04703"/>04703 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;dp-&gt;<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04704"/>04704 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04705"/>04705 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!fno)&#32;{
<anchor xml:id="_ff_8c_source_1l04706"/>04706 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Rewind&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04707"/>04707 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04708"/>04708 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l04709"/>04709 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">DIR_READ_FILE</link>(dp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;an&#32;item&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04710"/>04710 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Ignore&#32;end&#32;of&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04711"/>04711 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;valid&#32;entry&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04712"/>04712 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;get_fileinfo(dp,&#32;fno);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;object&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04713"/>04713 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_next(dp,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Increment&#32;index&#32;for&#32;next&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04714"/>04714 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Ignore&#32;end&#32;of&#32;directory&#32;now&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04715"/>04715 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04716"/>04716 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l04717"/>04717 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04718"/>04718 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04719"/>04719 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04720"/>04720 }
<anchor xml:id="_ff_8c_source_1l04721"/>04721 
<anchor xml:id="_ff_8c_source_1l04722"/>04722 
<anchor xml:id="_ff_8c_source_1l04723"/>04723 
<anchor xml:id="_ff_8c_source_1l04724"/>04724 <emphasis role="preprocessor">#if&#32;FF_USE_FIND</emphasis>
<anchor xml:id="_ff_8c_source_1l04725"/>04725 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04726"/>04726 <emphasis role="comment">/*&#32;Find&#32;Next&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04727"/>04727 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04728"/>04728 
<anchor xml:id="_ff_8c_source_1l04729"/>04729 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a23f97e2171ad7045eea5c1e21a9622a8">f_findnext</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04730"/>04730 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;open&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04731"/>04731 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>*&#32;fno&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;information&#32;structure&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04732"/>04732 )
<anchor xml:id="_ff_8c_source_1l04733"/>04733 {
<anchor xml:id="_ff_8c_source_1l04734"/>04734 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04735"/>04735 
<anchor xml:id="_ff_8c_source_1l04736"/>04736 
<anchor xml:id="_ff_8c_source_1l04737"/>04737 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l04738"/>04738 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1ab8b2c70a95ca61f4f516c56fda7f82ab">f_readdir</link>(dp,&#32;fno);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;directory&#32;item&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04739"/>04739 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;!fno&#32;||&#32;!fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>[0])&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;if&#32;any&#32;error&#32;or&#32;end&#32;of&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04740"/>04740 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pattern_match(dp-&gt;pat,&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ac06b247cfb3b708c76413c436e52fa7e">fname</link>,&#32;0,&#32;FIND_RECURS))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;the&#32;file&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04741"/>04741 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_USE_FIND&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l04742"/>04742 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pattern_match(dp-&gt;pat,&#32;fno-&gt;altname,&#32;0,&#32;FIND_RECURS))&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;for&#32;alternative&#32;name&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04743"/>04743 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04744"/>04744 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04745"/>04745 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l04746"/>04746 }
<anchor xml:id="_ff_8c_source_1l04747"/>04747 
<anchor xml:id="_ff_8c_source_1l04748"/>04748 
<anchor xml:id="_ff_8c_source_1l04749"/>04749 
<anchor xml:id="_ff_8c_source_1l04750"/>04750 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04751"/>04751 <emphasis role="comment">/*&#32;Find&#32;First&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04752"/>04752 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04753"/>04753 
<anchor xml:id="_ff_8c_source_1l04754"/>04754 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a505edb263ef2c2a95e4f38f628b57ed3">f_findfirst</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04755"/>04755 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>*&#32;dp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;blank&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04756"/>04756 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>*&#32;fno,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;information&#32;structure&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04757"/>04757 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;to&#32;open&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04758"/>04758 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;<link linkend="__dino_game_8cpp_1a0d20517626e480f07ceee32bcff56db8">pattern</link>&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;matching&#32;pattern&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04759"/>04759 )
<anchor xml:id="_ff_8c_source_1l04760"/>04760 {
<anchor xml:id="_ff_8c_source_1l04761"/>04761 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04762"/>04762 
<anchor xml:id="_ff_8c_source_1l04763"/>04763 
<anchor xml:id="_ff_8c_source_1l04764"/>04764 &#32;&#32;&#32;&#32;dp-&gt;pat&#32;=&#32;<link linkend="__dino_game_8cpp_1a0d20517626e480f07ceee32bcff56db8">pattern</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;pointer&#32;to&#32;pattern&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04765"/>04765 &#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1a0d5b386636ec82d4c1e912d5902aa0e0">f_opendir</link>(dp,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;the&#32;target&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04766"/>04766 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04767"/>04767 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a23f97e2171ad7045eea5c1e21a9622a8">f_findnext</link>(dp,&#32;fno);&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;the&#32;first&#32;item&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04768"/>04768 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04769"/>04769 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;res;
<anchor xml:id="_ff_8c_source_1l04770"/>04770 }
<anchor xml:id="_ff_8c_source_1l04771"/>04771 
<anchor xml:id="_ff_8c_source_1l04772"/>04772 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_FIND&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l04773"/>04773 
<anchor xml:id="_ff_8c_source_1l04774"/>04774 
<anchor xml:id="_ff_8c_source_1l04775"/>04775 
<anchor xml:id="_ff_8c_source_1l04776"/>04776 <emphasis role="preprocessor">#if&#32;FF_FS_MINIMIZE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l04777"/>04777 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04778"/>04778 <emphasis role="comment">/*&#32;Get&#32;File&#32;Status&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04779"/>04779 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04780"/>04780 
<anchor xml:id="_ff_8c_source_1l04781"/><link linkend="_ff_8c_1abe1f60daab5c7d11170c334fb832c798">04781</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1abe1f60daab5c7d11170c334fb832c798">f_stat</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04782"/>04782 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04783"/>04783 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>*&#32;fno&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;file&#32;information&#32;to&#32;return&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04784"/>04784 )
<anchor xml:id="_ff_8c_source_1l04785"/>04785 {
<anchor xml:id="_ff_8c_source_1l04786"/>04786 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04787"/>04787 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l04788"/>04788 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04789"/>04789 
<anchor xml:id="_ff_8c_source_1l04790"/>04790 
<anchor xml:id="_ff_8c_source_1l04791"/>04791 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04792"/>04792 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l04793"/>04793 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04794"/>04794 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>);
<anchor xml:id="_ff_8c_source_1l04795"/>04795 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04796"/>04796 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;completed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04797"/>04797 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;origin&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04798"/>04798 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
<anchor xml:id="_ff_8c_source_1l04799"/>04799 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Found&#32;an&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04800"/>04800 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fno)&#32;get_fileinfo(&amp;dj,&#32;fno);
<anchor xml:id="_ff_8c_source_1l04801"/>04801 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04802"/>04802 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04803"/>04803 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l04804"/>04804 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04805"/>04805 
<anchor xml:id="_ff_8c_source_1l04806"/>04806 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>,&#32;res);
<anchor xml:id="_ff_8c_source_1l04807"/>04807 }
<anchor xml:id="_ff_8c_source_1l04808"/>04808 
<anchor xml:id="_ff_8c_source_1l04809"/>04809 
<anchor xml:id="_ff_8c_source_1l04810"/>04810 
<anchor xml:id="_ff_8c_source_1l04811"/>04811 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l04812"/>04812 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04813"/>04813 <emphasis role="comment">/*&#32;Get&#32;Number&#32;of&#32;Free&#32;Clusters&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04814"/>04814 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04815"/>04815 
<anchor xml:id="_ff_8c_source_1l04816"/><link linkend="_ff_8c_1a0ff39f75a87cbda9cd6ea65d83f16cec">04816</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a0ff39f75a87cbda9cd6ea65d83f16cec">f_getfree</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04817"/>04817 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04818"/>04818 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>*&#32;nclst,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;a&#32;variable&#32;to&#32;return&#32;number&#32;of&#32;free&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04819"/>04819 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>**&#32;fatfs&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;return&#32;pointer&#32;to&#32;corresponding&#32;filesystem&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04820"/>04820 )
<anchor xml:id="_ff_8c_source_1l04821"/>04821 {
<anchor xml:id="_ff_8c_source_1l04822"/>04822 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04823"/>04823 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04824"/>04824 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;nfree,&#32;clst,&#32;stat;
<anchor xml:id="_ff_8c_source_1l04825"/>04825 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l04826"/>04826 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l04827"/>04827 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>&#32;obj;
<anchor xml:id="_ff_8c_source_1l04828"/>04828 
<anchor xml:id="_ff_8c_source_1l04829"/>04829 
<anchor xml:id="_ff_8c_source_1l04830"/>04830 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04831"/>04831 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
<anchor xml:id="_ff_8c_source_1l04832"/>04832 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04833"/>04833 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*fatfs&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;ptr&#32;to&#32;the&#32;fs&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04834"/>04834 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;If&#32;free_clst&#32;is&#32;valid,&#32;return&#32;it&#32;without&#32;full&#32;FAT&#32;scan&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04835"/>04835 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;&lt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;{
<anchor xml:id="_ff_8c_source_1l04836"/>04836 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*nclst&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>;
<anchor xml:id="_ff_8c_source_1l04837"/>04837 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04838"/>04838 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Scan&#32;FAT&#32;to&#32;obtain&#32;number&#32;of&#32;free&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04839"/>04839 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nfree&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04840"/>04840 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;FAT12:&#32;Scan&#32;bit&#32;field&#32;FAT&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04841"/>04841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;2;&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l04842"/>04842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04843"/>04843 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;stat&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;obj,&#32;clst);
<anchor xml:id="_ff_8c_source_1l04844"/>04844 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;==&#32;0xFFFFFFFF)&#32;{
<anchor xml:id="_ff_8c_source_1l04845"/>04845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04846"/>04846 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04847"/>04847 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;==&#32;1)&#32;{
<anchor xml:id="_ff_8c_source_1l04848"/>04848 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04849"/>04849 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04850"/>04850 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;==&#32;0)&#32;nfree++;
<anchor xml:id="_ff_8c_source_1l04851"/>04851 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++clst&#32;&lt;&#32;fs-&gt;n_fatent);
<anchor xml:id="_ff_8c_source_1l04852"/>04852 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04853"/>04853 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04854"/>04854 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;exFAT:&#32;Scan&#32;allocation&#32;bitmap&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04855"/>04855 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;bm;
<anchor xml:id="_ff_8c_source_1l04856"/>04856 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;b;
<anchor xml:id="_ff_8c_source_1l04857"/>04857 
<anchor xml:id="_ff_8c_source_1l04858"/>04858 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04859"/>04859 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;fs-&gt;bitbase;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bitmap&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04860"/>04860 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04861"/>04861 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Counts&#32;numbuer&#32;of&#32;bits&#32;with&#32;zero&#32;in&#32;the&#32;bitmap&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04862"/>04862 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;sector?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04863"/>04863 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sect++);
<anchor xml:id="_ff_8c_source_1l04864"/>04864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04865"/>04865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04866"/>04866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(b&#32;=&#32;8,&#32;bm&#32;=&#32;~fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[i];&#32;b&#32;&amp;&amp;&#32;clst;&#32;b--,&#32;clst--)&#32;{
<anchor xml:id="_ff_8c_source_1l04867"/>04867 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nfree&#32;+=&#32;bm&#32;&amp;&#32;1;
<anchor xml:id="_ff_8c_source_1l04868"/>04868 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bm&#32;&gt;&gt;=&#32;1;
<anchor xml:id="_ff_8c_source_1l04869"/>04869 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04870"/>04870 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;(i&#32;+&#32;1)&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
<anchor xml:id="_ff_8c_source_1l04871"/>04871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(clst);
<anchor xml:id="_ff_8c_source_1l04872"/>04872 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l04873"/>04873 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04874"/>04874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT16/32:&#32;Scan&#32;WORD/DWORD&#32;FAT&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04875"/>04875 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04876"/>04876 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a78b1024e7d7d086d132a58ee943b31df">fatbase</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Top&#32;of&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04877"/>04877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04878"/>04878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Counts&#32;numbuer&#32;of&#32;entries&#32;with&#32;zero&#32;in&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04879"/>04879 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;sector?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04880"/>04880 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sect++);
<anchor xml:id="_ff_8c_source_1l04881"/>04881 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l04882"/>04882 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04883"/>04883 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04884"/>04884 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;i)&#32;==&#32;0)&#32;nfree++;
<anchor xml:id="_ff_8c_source_1l04885"/>04885 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l04886"/>04886 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04887"/>04887 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;i)&#32;&amp;&#32;0x0FFFFFFF)&#32;==&#32;0)&#32;nfree++;
<anchor xml:id="_ff_8c_source_1l04888"/>04888 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;4;
<anchor xml:id="_ff_8c_source_1l04889"/>04889 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04890"/>04890 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;%=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);
<anchor xml:id="_ff_8c_source_1l04891"/>04891 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(--clst);
<anchor xml:id="_ff_8c_source_1l04892"/>04892 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04893"/>04893 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04894"/>04894 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;parameters&#32;if&#32;succeeded&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04895"/>04895 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*nclst&#32;=&#32;nfree;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Return&#32;the&#32;free&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04896"/>04896 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;=&#32;nfree;&#32;&#32;<emphasis role="comment">/*&#32;Now&#32;free_clst&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04897"/>04897 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;|=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT32:&#32;FSInfo&#32;is&#32;to&#32;be&#32;updated&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04898"/>04898 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04899"/>04899 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04900"/>04900 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04901"/>04901 
<anchor xml:id="_ff_8c_source_1l04902"/>04902 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04903"/>04903 }
<anchor xml:id="_ff_8c_source_1l04904"/>04904 
<anchor xml:id="_ff_8c_source_1l04905"/>04905 
<anchor xml:id="_ff_8c_source_1l04906"/>04906 
<anchor xml:id="_ff_8c_source_1l04907"/>04907 
<anchor xml:id="_ff_8c_source_1l04908"/>04908 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04909"/>04909 <emphasis role="comment">/*&#32;Truncate&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04910"/>04910 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04911"/>04911 
<anchor xml:id="_ff_8c_source_1l04912"/><link linkend="_ff_8c_1a691a27b40c348f7c84b42e911636f38a">04912</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a691a27b40c348f7c84b42e911636f38a">f_truncate</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04913"/>04913 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04914"/>04914 )
<anchor xml:id="_ff_8c_source_1l04915"/>04915 {
<anchor xml:id="_ff_8c_source_1l04916"/>04916 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04917"/>04917 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04918"/>04918 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;ncl;
<anchor xml:id="_ff_8c_source_1l04919"/>04919 
<anchor xml:id="_ff_8c_source_1l04920"/>04920 
<anchor xml:id="_ff_8c_source_1l04921"/>04921 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04922"/>04922 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04923"/>04923 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04924"/>04924 
<anchor xml:id="_ff_8c_source_1l04925"/>04925 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;&lt;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Process&#32;when&#32;fptr&#32;is&#32;not&#32;on&#32;the&#32;eof&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04926"/>04926 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;set&#32;file&#32;size&#32;to&#32;zero,&#32;remove&#32;entire&#32;cluster&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04927"/>04927 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l04928"/>04928 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04929"/>04929 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;truncate&#32;a&#32;part&#32;of&#32;the&#32;file,&#32;remove&#32;remaining&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04930"/>04930 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ncl&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);
<anchor xml:id="_ff_8c_source_1l04931"/>04931 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l04932"/>04932 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l04933"/>04933 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ncl&#32;==&#32;1)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l04934"/>04934 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;ncl&#32;&lt;&#32;fs-&gt;n_fatent)&#32;{
<anchor xml:id="_ff_8c_source_1l04935"/>04935 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;ncl,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);
<anchor xml:id="_ff_8c_source_1l04936"/>04936 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04937"/>04937 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04938"/>04938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;&#32;<emphasis role="comment">/*&#32;Set&#32;file&#32;size&#32;to&#32;current&#32;read/write&#32;point&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04939"/>04939 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
<anchor xml:id="_ff_8c_source_1l04940"/>04940 <emphasis role="preprocessor">#if&#32;!FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l04941"/>04941 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l04942"/>04942 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04943"/>04943 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l04944"/>04944 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04945"/>04945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l04946"/>04946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04947"/>04947 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04948"/>04948 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04949"/>04949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04950"/>04950 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04951"/>04951 
<anchor xml:id="_ff_8c_source_1l04952"/>04952 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l04953"/>04953 }
<anchor xml:id="_ff_8c_source_1l04954"/>04954 
<anchor xml:id="_ff_8c_source_1l04955"/>04955 
<anchor xml:id="_ff_8c_source_1l04956"/>04956 
<anchor xml:id="_ff_8c_source_1l04957"/>04957 
<anchor xml:id="_ff_8c_source_1l04958"/>04958 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04959"/>04959 <emphasis role="comment">/*&#32;Delete&#32;a&#32;File/Directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04960"/>04960 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04961"/>04961 
<anchor xml:id="_ff_8c_source_1l04962"/><link linkend="_ff_8c_1a2858167fcd0bced48e9be434b3895efe">04962</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a2858167fcd0bced48e9be434b3895efe">f_unlink</link>&#32;(
<anchor xml:id="_ff_8c_source_1l04963"/>04963 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;or&#32;directory&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04964"/>04964 )
<anchor xml:id="_ff_8c_source_1l04965"/>04965 {
<anchor xml:id="_ff_8c_source_1l04966"/>04966 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l04967"/>04967 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l04968"/>04968 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj,&#32;sdj;
<anchor xml:id="_ff_8c_source_1l04969"/>04969 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dclst&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l04970"/>04970 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04971"/>04971 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>&#32;obj;
<anchor xml:id="_ff_8c_source_1l04972"/>04972 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04973"/>04973 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l04974"/>04974 
<anchor xml:id="_ff_8c_source_1l04975"/>04975 
<anchor xml:id="_ff_8c_source_1l04976"/>04976 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04977"/>04977 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);
<anchor xml:id="_ff_8c_source_1l04978"/>04978 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04979"/>04979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l04980"/>04980 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l04981"/>04981 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04982"/>04982 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1af0d4b41a010f1a611bc6fb9e42357350">FF_FS_RPATH</link>&#32;&amp;&amp;&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l04983"/>04983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;remove&#32;dot&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04984"/>04984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04985"/>04985 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l04986"/>04986 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;chk_share(&amp;dj,&#32;2);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;it&#32;is&#32;an&#32;open&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04987"/>04987 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l04988"/>04988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;object&#32;is&#32;accessible&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04989"/>04989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04990"/>04990 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;remove&#32;the&#32;origin&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04991"/>04991 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l04992"/>04992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04993"/>04993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cannot&#32;remove&#32;R/O&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l04994"/>04994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04995"/>04995 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l04996"/>04996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l04997"/>04997 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l04998"/>04998 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l04999"/>04999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05000"/>05000 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;init_alloc_info(fs,&#32;&amp;obj);
<anchor xml:id="_ff_8c_source_1l05001"/>05001 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dclst&#32;=&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
<anchor xml:id="_ff_8c_source_1l05002"/>05002 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05003"/>05003 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05004"/>05004 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05005"/>05005 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dclst&#32;=&#32;ld_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>);
<anchor xml:id="_ff_8c_source_1l05006"/>05006 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05007"/>05007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ae9b1e6f98dbad367cc00f92b87f8d279">attr</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;sub-directory?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05008"/>05008 <emphasis role="preprocessor">#if&#32;FF_FS_RPATH&#32;!=&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l05009"/>05009 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dclst&#32;==&#32;fs-&gt;cdir)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;the&#32;current&#32;directory?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05010"/>05010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;
<anchor xml:id="_ff_8c_source_1l05011"/>05011 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05012"/>05012 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05013"/>05013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05014"/>05014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;the&#32;sub-directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05015"/>05015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;dclst;
<anchor xml:id="_ff_8c_source_1l05016"/>05016 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05017"/>05017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05018"/>05018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>;
<anchor xml:id="_ff_8c_source_1l05019"/>05019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sdj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;obj.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>;
<anchor xml:id="_ff_8c_source_1l05020"/>05020 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05021"/>05021 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05022"/>05022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(&amp;sdj,&#32;0);
<anchor xml:id="_ff_8c_source_1l05023"/>05023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05024"/>05024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1a7dc00ac3fd99f0a14d6b7f3fc76b8778">DIR_READ_FILE</link>(&amp;sdj);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Test&#32;if&#32;the&#32;directory&#32;is&#32;empty&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05025"/>05025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;empty?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05026"/>05026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;&#32;<emphasis role="comment">/*&#32;Empty?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05027"/>05027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05028"/>05028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05029"/>05029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05030"/>05030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05031"/>05031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05032"/>05032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_remove(&amp;dj);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;directory&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05033"/>05033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;dclst&#32;!=&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;cluster&#32;chain&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05034"/>05034 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05035"/>05035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;obj,&#32;dclst,&#32;0);
<anchor xml:id="_ff_8c_source_1l05036"/>05036 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l05037"/>05037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;remove_chain(&amp;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>,&#32;dclst,&#32;0);
<anchor xml:id="_ff_8c_source_1l05038"/>05038 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05039"/>05039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05040"/>05040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05041"/>05041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05042"/>05042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05043"/>05043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l05044"/>05044 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05045"/>05045 
<anchor xml:id="_ff_8c_source_1l05046"/>05046 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05047"/>05047 }
<anchor xml:id="_ff_8c_source_1l05048"/>05048 
<anchor xml:id="_ff_8c_source_1l05049"/>05049 
<anchor xml:id="_ff_8c_source_1l05050"/>05050 
<anchor xml:id="_ff_8c_source_1l05051"/>05051 
<anchor xml:id="_ff_8c_source_1l05052"/>05052 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05053"/>05053 <emphasis role="comment">/*&#32;Create&#32;a&#32;Directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05054"/>05054 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05055"/>05055 
<anchor xml:id="_ff_8c_source_1l05056"/><link linkend="_ff_8c_1a4b4d38db58e89c526cfcf53200d719d0">05056</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a4b4d38db58e89c526cfcf53200d719d0">f_mkdir</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05057"/>05057 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;directory&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05058"/>05058 )
<anchor xml:id="_ff_8c_source_1l05059"/>05059 {
<anchor xml:id="_ff_8c_source_1l05060"/>05060 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05061"/>05061 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05062"/>05062 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l05063"/>05063 &#32;&#32;&#32;&#32;<link linkend="_struct_f_f_o_b_j_i_d">FFOBJID</link>&#32;sobj;
<anchor xml:id="_ff_8c_source_1l05064"/>05064 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dcl,&#32;pcl,&#32;tm;
<anchor xml:id="_ff_8c_source_1l05065"/>05065 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l05066"/>05066 
<anchor xml:id="_ff_8c_source_1l05067"/>05067 
<anchor xml:id="_ff_8c_source_1l05068"/>05068 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05069"/>05069 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05070"/>05070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l05071"/>05071 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l05072"/>05072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05073"/>05073 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Name&#32;collision?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05074"/>05074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1af0d4b41a010f1a611bc6fb9e42357350">FF_FS_RPATH</link>&#32;&amp;&amp;&#32;res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>))&#32;{&#32;<emphasis role="comment">/*&#32;Invalid&#32;name?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05075"/>05075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;
<anchor xml:id="_ff_8c_source_1l05076"/>05076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05077"/>05077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;clear&#32;to&#32;create&#32;a&#32;new&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05078"/>05078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sobj.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;New&#32;object&#32;id&#32;to&#32;create&#32;a&#32;new&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05079"/>05079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dcl&#32;=&#32;create_chain(&amp;sobj,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;a&#32;cluster&#32;for&#32;the&#32;new&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05080"/>05080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l05081"/>05081 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dcl&#32;==&#32;0)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;space&#32;to&#32;allocate&#32;a&#32;new&#32;cluster?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05082"/>05082 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dcl&#32;==&#32;1)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Any&#32;insanity?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05083"/>05083 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dcl&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Disk&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05084"/>05084 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tm&#32;=&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();
<anchor xml:id="_ff_8c_source_1l05085"/>05085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05086"/>05086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_clear(fs,&#32;dcl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clean&#32;up&#32;the&#32;new&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05087"/>05087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05088"/>05088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;||&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;dot&#32;entries&#32;(FAT&#32;only)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05089"/>05089 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>,&#32;11);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;&quot;.&quot;&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05090"/>05090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l05091"/>05091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>;
<anchor xml:id="_ff_8c_source_1l05092"/>05092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);
<anchor xml:id="_ff_8c_source_1l05093"/>05093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;dcl);
<anchor xml:id="_ff_8c_source_1l05094"/>05094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;&quot;..&quot;&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05095"/>05095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;+&#32;1]&#32;=&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;&#32;pcl&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>;
<anchor xml:id="_ff_8c_source_1l05096"/>05096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>,&#32;pcl);
<anchor xml:id="_ff_8c_source_1l05097"/>05097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05098"/>05098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05099"/>05099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;dj);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;the&#32;object&#32;to&#32;the&#32;parent&#32;directoy&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05100"/>05100 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05101"/>05101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05102"/>05102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05103"/>05103 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05104"/>05104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;directory&#32;entry&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05105"/>05105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>,&#32;tm);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Created&#32;time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05106"/>05106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1ae08bbe65fd20259cb98c85ce08aa53cb">XDIR_FstClus</link>,&#32;dcl);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05107"/>05107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a899bf596ce53d81a373229662249f524">XDIR_FileSize</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Directory&#32;size&#32;needs&#32;to&#32;be&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05108"/>05108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a543e2a11cefac978a0108a7973416d56">XDIR_ValidFileSize</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs));
<anchor xml:id="_ff_8c_source_1l05109"/>05109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1ac3fd42ab7ee833b0e3683b1843d310d6">XDIR_GenFlags</link>]&#32;=&#32;3;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;object&#32;flag&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05110"/>05110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05111"/>05111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);
<anchor xml:id="_ff_8c_source_1l05112"/>05112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05113"/>05113 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05114"/>05114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05115"/>05115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;tm);&#32;<emphasis role="comment">/*&#32;Created&#32;time&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05116"/>05116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dcl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05117"/>05117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05118"/>05118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05119"/>05119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05120"/>05120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05121"/>05121 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05122"/>05122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05123"/>05123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05124"/>05124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;remove_chain(&amp;sobj,&#32;dcl,&#32;0);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Could&#32;not&#32;register,&#32;remove&#32;the&#32;allocated&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05125"/>05125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05126"/>05126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05127"/>05127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l05128"/>05128 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05129"/>05129 
<anchor xml:id="_ff_8c_source_1l05130"/>05130 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05131"/>05131 }
<anchor xml:id="_ff_8c_source_1l05132"/>05132 
<anchor xml:id="_ff_8c_source_1l05133"/>05133 
<anchor xml:id="_ff_8c_source_1l05134"/>05134 
<anchor xml:id="_ff_8c_source_1l05135"/>05135 
<anchor xml:id="_ff_8c_source_1l05136"/>05136 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05137"/>05137 <emphasis role="comment">/*&#32;Rename&#32;a&#32;File/Directory&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05138"/>05138 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05139"/>05139 
<anchor xml:id="_ff_8c_source_1l05140"/><link linkend="_ff_8c_1aa775b9b024acfeb3a66523cab497d142">05140</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1aa775b9b024acfeb3a66523cab497d142">f_rename</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05141"/>05141 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path_old,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;object&#32;name&#32;to&#32;be&#32;renamed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05142"/>05142 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path_new&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;new&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05143"/>05143 )
<anchor xml:id="_ff_8c_source_1l05144"/>05144 {
<anchor xml:id="_ff_8c_source_1l05145"/>05145 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05146"/>05146 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05147"/>05147 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;djo,&#32;djn;
<anchor xml:id="_ff_8c_source_1l05148"/>05148 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;buf[<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;?&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;:&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>],&#32;*dir;
<anchor xml:id="_ff_8c_source_1l05149"/>05149 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l05150"/>05150 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l05151"/>05151 
<anchor xml:id="_ff_8c_source_1l05152"/>05152 
<anchor xml:id="_ff_8c_source_1l05153"/>05153 &#32;&#32;&#32;&#32;get_ldnumber(&amp;path_new);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;the&#32;drive&#32;number&#32;of&#32;new&#32;name&#32;off&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05154"/>05154 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path_old,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;of&#32;the&#32;old&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05155"/>05155 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05156"/>05156 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l05157"/>05157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l05158"/>05158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;djo,&#32;path_old);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;old&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05159"/>05159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;(<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>&#32;|&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)))&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05160"/>05160 <emphasis role="preprocessor">#if&#32;FF_FS_LOCK</emphasis>
<anchor xml:id="_ff_8c_source_1l05161"/>05161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05162"/>05162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;chk_share(&amp;djo,&#32;2);
<anchor xml:id="_ff_8c_source_1l05163"/>05163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05164"/>05164 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05165"/>05165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Object&#32;to&#32;be&#32;renamed&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05166"/>05166 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05167"/>05167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;At&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05168"/>05168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;nf,&#32;nn;
<anchor xml:id="_ff_8c_source_1l05169"/>05169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;nh;
<anchor xml:id="_ff_8c_source_1l05170"/>05170 
<anchor xml:id="_ff_8c_source_1l05171"/>05171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf,&#32;fs-&gt;dirbuf,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;85+C0&#32;entry&#32;of&#32;old&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05172"/>05172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(&amp;djn,&#32;&amp;djo,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;djo);
<anchor xml:id="_ff_8c_source_1l05173"/>05173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;djn,&#32;path_new);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;sure&#32;if&#32;new&#32;object&#32;name&#32;is&#32;not&#32;in&#32;use&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05174"/>05174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;new&#32;name&#32;already&#32;in&#32;use&#32;by&#32;any&#32;other&#32;object?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05175"/>05175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;(djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;&amp;&amp;&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;
<anchor xml:id="_ff_8c_source_1l05176"/>05176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05177"/>05177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;valid&#32;path&#32;and&#32;no&#32;name&#32;collision&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05178"/>05178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;djn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;the&#32;new&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05179"/>05179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05180"/>05180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nf&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>];&#32;nn&#32;=&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>];
<anchor xml:id="_ff_8c_source_1l05181"/>05181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nh&#32;=&#32;ld_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">XDIR_NameHash</link>);
<anchor xml:id="_ff_8c_source_1l05182"/>05182 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(fs-&gt;dirbuf,&#32;buf,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Restore&#32;85+C0&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05183"/>05183 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a37e729265403caf1ae349714e069a3e6">XDIR_NumSec</link>]&#32;=&#32;nf;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1a382f456b33f0c719163bcf521aa7ecea">XDIR_NumName</link>]&#32;=&#32;nn;
<anchor xml:id="_ff_8c_source_1l05184"/>05184 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1a7c0a94f8a7efc7a710d6eb897059462d">XDIR_NameHash</link>,&#32;nh);
<anchor xml:id="_ff_8c_source_1l05185"/>05185 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;if&#32;it&#32;is&#32;a&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05186"/>05186 <emphasis role="comment">/*&#32;Start&#32;of&#32;critical&#32;section&#32;where&#32;an&#32;interruption&#32;can&#32;cause&#32;a&#32;cross-link&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05187"/>05187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;djn);
<anchor xml:id="_ff_8c_source_1l05188"/>05188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05189"/>05189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05190"/>05190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05191"/>05191 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05192"/>05192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;At&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05193"/>05193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf,&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;directory&#32;entry&#32;of&#32;the&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05194"/>05194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(&amp;djn,&#32;&amp;djo,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;(<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>));&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Duplicate&#32;the&#32;directory&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05195"/>05195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;djn,&#32;path_new);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;sure&#32;if&#32;new&#32;object&#32;name&#32;is&#32;not&#32;in&#32;use&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05196"/>05196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;new&#32;name&#32;already&#32;in&#32;use&#32;by&#32;any&#32;other&#32;object?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05197"/>05197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;(djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;&amp;&amp;&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>&#32;==&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1a00a9b9829a3a72bc7881d3ea8a0779a9">dptr</link>)&#32;?&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>&#32;:&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca0d8f024d256df76e84782b95018a2450">FR_EXIST</link>;
<anchor xml:id="_ff_8c_source_1l05198"/>05198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05199"/>05199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;It&#32;is&#32;a&#32;valid&#32;path&#32;and&#32;no&#32;name&#32;collision&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05200"/>05200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_register(&amp;djn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Register&#32;the&#32;new&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05201"/>05201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05202"/>05202 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir&#32;=&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Copy&#32;directory&#32;entry&#32;of&#32;the&#32;object&#32;except&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05203"/>05203 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dir&#32;+&#32;13,&#32;buf&#32;+&#32;13,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;-&#32;13);
<anchor xml:id="_ff_8c_source_1l05204"/>05204 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;buf[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>];
<anchor xml:id="_ff_8c_source_1l05205"/>05205 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>))&#32;dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;|=&#32;<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;<emphasis role="comment">/*&#32;Set&#32;archive&#32;attribute&#32;if&#32;it&#32;is&#32;a&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05206"/>05206 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05207"/>05207 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((dir[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;<link linkend="_ff_8h_1a3a9db44e978ed6c13b641e092d4cd7d3">AM_DIR</link>)&#32;&amp;&amp;&#32;djo.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;!=&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Update&#32;..&#32;entry&#32;in&#32;the&#32;sub-directory&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05208"/>05208 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;ld_clust(fs,&#32;dir));
<anchor xml:id="_ff_8c_source_1l05209"/>05209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l05210"/>05210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05211"/>05211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05212"/>05212 <emphasis role="comment">/*&#32;Start&#32;of&#32;critical&#32;section&#32;where&#32;an&#32;interruption&#32;can&#32;cause&#32;a&#32;cross-link&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05213"/>05213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;sect);
<anchor xml:id="_ff_8c_source_1l05214"/>05214 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dir&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1;&#32;<emphasis role="comment">/*&#32;Ptr&#32;to&#32;..&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05215"/>05215 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;dir[1]&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;{
<anchor xml:id="_ff_8c_source_1l05216"/>05216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_clust(fs,&#32;dir,&#32;djn.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>);
<anchor xml:id="_ff_8c_source_1l05217"/>05217 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05218"/>05218 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05219"/>05219 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05220"/>05220 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05221"/>05221 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05222"/>05222 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05223"/>05223 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05224"/>05224 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05225"/>05225 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_remove(&amp;djo);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;old&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05226"/>05226 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05227"/>05227 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05228"/>05228 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05229"/>05229 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05230"/>05230 <emphasis role="comment">/*&#32;End&#32;of&#32;the&#32;critical&#32;section&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05231"/>05231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05232"/>05232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l05233"/>05233 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05234"/>05234 
<anchor xml:id="_ff_8c_source_1l05235"/>05235 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05236"/>05236 }
<anchor xml:id="_ff_8c_source_1l05237"/>05237 
<anchor xml:id="_ff_8c_source_1l05238"/>05238 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05239"/>05239 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_MINIMIZE&#32;==&#32;0&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05240"/>05240 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;1&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05241"/>05241 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_MINIMIZE&#32;&lt;=&#32;2&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05242"/>05242 
<anchor xml:id="_ff_8c_source_1l05243"/>05243 
<anchor xml:id="_ff_8c_source_1l05244"/>05244 
<anchor xml:id="_ff_8c_source_1l05245"/>05245 <emphasis role="preprocessor">#if&#32;FF_USE_CHMOD&#32;&amp;&amp;&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l05246"/>05246 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05247"/>05247 <emphasis role="comment">/*&#32;Change&#32;Attribute&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05248"/>05248 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05249"/>05249 
<anchor xml:id="_ff_8c_source_1l05250"/>05250 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a9ee7e560eec8d82755c636ae41e702cd">f_chmod</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05251"/>05251 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05252"/>05252 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;attr,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;bits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05253"/>05253 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;mask&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Attribute&#32;mask&#32;to&#32;change&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05254"/>05254 )
<anchor xml:id="_ff_8c_source_1l05255"/>05255 {
<anchor xml:id="_ff_8c_source_1l05256"/>05256 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05257"/>05257 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05258"/>05258 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l05259"/>05259 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l05260"/>05260 
<anchor xml:id="_ff_8c_source_1l05261"/>05261 
<anchor xml:id="_ff_8c_source_1l05262"/>05262 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05263"/>05263 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05264"/>05264 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l05265"/>05265 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l05266"/>05266 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05267"/>05267 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;(<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>&#32;|&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)))&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;object&#32;validity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05268"/>05268 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05269"/>05269 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;mask&#32;&amp;=&#32;<link linkend="_ff_8h_1add6d85d1e7a02b4f6188783ef91a5f1e">AM_RDO</link>|<link linkend="_ff_8h_1aa90c4c921c1955fd407d8bbf17f1674e">AM_HID</link>|<link linkend="_ff_8h_1a1f25d5c17b5a3a6397b3398add8cdc15">AM_SYS</link>|<link linkend="_ff_8h_1ae8174d00798e34e7c9e95898cb9e1a09">AM_ARC</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Valid&#32;attribute&#32;mask&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05270"/>05270 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05271"/>05271 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05272"/>05272 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;=&#32;(attr&#32;&amp;&#32;mask)&#32;|&#32;(fs-&gt;dirbuf[<link linkend="_ff_8c_1aafe8687fb9356906c13ccd9fe88eb3de">XDIR_Attr</link>]&#32;&amp;&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~mask);&#32;&#32;<emphasis role="comment">/*&#32;Apply&#32;attribute&#32;change&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05273"/>05273 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);
<anchor xml:id="_ff_8c_source_1l05274"/>05274 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05275"/>05275 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05276"/>05276 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05277"/>05277 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;(attr&#32;&amp;&#32;mask)&#32;|&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;&amp;&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~mask);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Apply&#32;attribute&#32;change&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05278"/>05278 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05279"/>05279 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05280"/>05280 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05281"/>05281 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05282"/>05282 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05283"/>05283 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05284"/>05284 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l05285"/>05285 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05286"/>05286 
<anchor xml:id="_ff_8c_source_1l05287"/>05287 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05288"/>05288 }
<anchor xml:id="_ff_8c_source_1l05289"/>05289 
<anchor xml:id="_ff_8c_source_1l05290"/>05290 
<anchor xml:id="_ff_8c_source_1l05291"/>05291 
<anchor xml:id="_ff_8c_source_1l05292"/>05292 
<anchor xml:id="_ff_8c_source_1l05293"/>05293 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05294"/>05294 <emphasis role="comment">/*&#32;Change&#32;Timestamp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05295"/>05295 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05296"/>05296 
<anchor xml:id="_ff_8c_source_1l05297"/>05297 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1aafaa718d1a487e12a8f0087173dba0b9">f_utime</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05298"/>05298 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file/directory&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05299"/>05299 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_f_i_l_i_n_f_o">FILINFO</link>*&#32;fno&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;timestamp&#32;to&#32;be&#32;set&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05300"/>05300 )
<anchor xml:id="_ff_8c_source_1l05301"/>05301 {
<anchor xml:id="_ff_8c_source_1l05302"/>05302 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05303"/>05303 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05304"/>05304 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l05305"/>05305 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ad9aa172b1cf1d54aca234228a7ae8503">DEF_NAMBUF</link>
<anchor xml:id="_ff_8c_source_1l05306"/>05306 
<anchor xml:id="_ff_8c_source_1l05307"/>05307 
<anchor xml:id="_ff_8c_source_1l05308"/>05308 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05309"/>05309 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05310"/>05310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;
<anchor xml:id="_ff_8c_source_1l05311"/>05311 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a9880dce2d33fe7708f982b5f80a31142">INIT_NAMBUF</link>(fs);
<anchor xml:id="_ff_8c_source_1l05312"/>05312 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;follow_path(&amp;dj,&#32;path);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Follow&#32;the&#32;file&#32;path&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05313"/>05313 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a625eb75f8fcc601fd9135724e5b8f4df">fn</link>[<link linkend="_ff_8c_1ad2306816015e67e72cfd0a20a880b227">NSFLAG</link>]&#32;&amp;&#32;(<link linkend="_ff_8c_1a2db528782a021797b34bdc6e9e9de1c3">NS_DOT</link>&#32;|&#32;<link linkend="_ff_8c_1a03a711029b966a7fad4f01e546b5e034">NS_NONAME</link>)))&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;object&#32;validity&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05314"/>05314 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05315"/>05315 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05316"/>05316 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05317"/>05317 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(fs-&gt;dirbuf&#32;+&#32;<link linkend="_ff_8c_1aecb0af980a40b38b30dd0a736c8d6406">XDIR_ModTime</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a7c01c48a15b1b49da459924437b0bd52">fdate</link>&#32;&lt;&lt;&#32;16&#32;|&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ae0f751b79621bf7b29669f177bbe6b9a">ftime</link>);
<anchor xml:id="_ff_8c_source_1l05318"/>05318 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;store_xdir(&amp;dj);
<anchor xml:id="_ff_8c_source_1l05319"/>05319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05320"/>05320 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05321"/>05321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05322"/>05322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1aa136ac8eaf0b3febba999e37b7d01803">DIR_ModTime</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1a7c01c48a15b1b49da459924437b0bd52">fdate</link>&#32;&lt;&lt;&#32;16&#32;|&#32;fno-&gt;<link linkend="_struct_f_i_l_i_n_f_o_1ae0f751b79621bf7b29669f177bbe6b9a">ftime</link>);
<anchor xml:id="_ff_8c_source_1l05323"/>05323 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05324"/>05324 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05325"/>05325 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05326"/>05326 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05327"/>05327 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05328"/>05328 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05329"/>05329 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aa2d2dda6ad1a1ec4a09e5cb30ae40e2a">FREE_NAMBUF</link>();
<anchor xml:id="_ff_8c_source_1l05330"/>05330 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05331"/>05331 
<anchor xml:id="_ff_8c_source_1l05332"/>05332 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05333"/>05333 }
<anchor xml:id="_ff_8c_source_1l05334"/>05334 
<anchor xml:id="_ff_8c_source_1l05335"/>05335 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_CHMOD&#32;&amp;&amp;&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05336"/>05336 
<anchor xml:id="_ff_8c_source_1l05337"/>05337 
<anchor xml:id="_ff_8c_source_1l05338"/>05338 
<anchor xml:id="_ff_8c_source_1l05339"/>05339 <emphasis role="preprocessor">#if&#32;FF_USE_LABEL</emphasis>
<anchor xml:id="_ff_8c_source_1l05340"/>05340 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05341"/>05341 <emphasis role="comment">/*&#32;Get&#32;Volume&#32;Label&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05342"/>05342 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05343"/>05343 
<anchor xml:id="_ff_8c_source_1l05344"/>05344 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1ac4ff40a674bcbfe40d81b1e8e54befc6">f_getlabel</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05345"/>05345 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;<emphasis role="comment">/*&#32;Logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05346"/>05346 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;label,&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;to&#32;store&#32;the&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05347"/>05347 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>*&#32;vsn&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Variable&#32;to&#32;store&#32;the&#32;volume&#32;serial&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05348"/>05348 )
<anchor xml:id="_ff_8c_source_1l05349"/>05349 {
<anchor xml:id="_ff_8c_source_1l05350"/>05350 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05351"/>05351 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05352"/>05352 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l05353"/>05353 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;si,&#32;di;
<anchor xml:id="_ff_8c_source_1l05354"/>05354 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l05355"/>05355 
<anchor xml:id="_ff_8c_source_1l05356"/>05356 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05357"/>05357 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;path,&#32;&amp;fs,&#32;0);
<anchor xml:id="_ff_8c_source_1l05358"/>05358 
<anchor xml:id="_ff_8c_source_1l05359"/>05359 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05360"/>05360 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;label)&#32;{
<anchor xml:id="_ff_8c_source_1l05361"/>05361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;root&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05362"/>05362 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(&amp;dj,&#32;0);
<anchor xml:id="_ff_8c_source_1l05363"/>05363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05364"/>05364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1afd5d25039aad72791c8fd0e911ba7e97">DIR_READ_LABEL</link>(&amp;dj);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;volume&#32;label&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05365"/>05365 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05366"/>05366 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05367"/>05367 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05368"/>05368 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;hs;
<anchor xml:id="_ff_8c_source_1l05369"/>05369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;nw;
<anchor xml:id="_ff_8c_source_1l05370"/>05370 
<anchor xml:id="_ff_8c_source_1l05371"/>05371 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(si&#32;=&#32;di&#32;=&#32;hs&#32;=&#32;0;&#32;si&#32;&lt;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1aac6d45371e0269e7b10c5a08f2f4b422">XDIR_NumLabel</link>];&#32;si++)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Extract&#32;volume&#32;label&#32;from&#32;83&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05372"/>05372 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;ld_word(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1ac154e61682dfed7bb071b0926db1efac">XDIR_Label</link>&#32;+&#32;si&#32;*&#32;2);
<anchor xml:id="_ff_8c_source_1l05373"/>05373 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;==&#32;0&#32;&amp;&amp;&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(wc))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;code&#32;a&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05374"/>05374 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;wc;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l05375"/>05375 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05376"/>05376 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nw&#32;=&#32;put_utf((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)hs&#32;&lt;&lt;&#32;16&#32;|&#32;wc,&#32;&amp;label[di],&#32;4);&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;in&#32;API&#32;encoding&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05377"/>05377 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nw&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Encode&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05378"/>05378 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05379"/>05379 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05380"/>05380 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;+=&#32;nw;
<anchor xml:id="_ff_8c_source_1l05381"/>05381 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05382"/>05382 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05383"/>05383 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;di&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Broken&#32;surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05384"/>05384 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;label[di]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05385"/>05385 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05386"/>05386 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05387"/>05387 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05388"/>05388 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;si&#32;=&#32;di&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extract&#32;volume&#32;label&#32;from&#32;AM_VOL&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05389"/>05389 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(si&#32;&lt;&#32;11)&#32;{
<anchor xml:id="_ff_8c_source_1l05390"/>05390 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[si++];
<anchor xml:id="_ff_8c_source_1l05391"/>05391 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;&gt;=&#32;1&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Unicode&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05392"/>05392 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc)&#32;&amp;&amp;&#32;si&#32;&lt;&#32;11)&#32;wc&#32;=&#32;wc&#32;&lt;&lt;&#32;8&#32;|&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[si++];&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;DBC?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05393"/>05393 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a52f09f31c84747cc135c90282509961a">ff_oem2uni</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Convert&#32;it&#32;into&#32;Unicode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05394"/>05394 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;char&#32;in&#32;current&#32;code&#32;page?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05395"/>05395 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05396"/>05396 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05397"/>05397 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;+=&#32;put_utf(wc,&#32;&amp;label[di],&#32;4);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;it&#32;in&#32;Unicode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05398"/>05398 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;output&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05399"/>05399 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;label[di++]&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)wc;
<anchor xml:id="_ff_8c_source_1l05400"/>05400 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05401"/>05401 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05402"/>05402 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncate&#32;trailing&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05403"/>05403 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;label[di]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05404"/>05404 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05405"/>05405 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(label[--di]&#32;==&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>);
<anchor xml:id="_ff_8c_source_1l05406"/>05406 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05407"/>05407 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05408"/>05408 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05409"/>05409 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;label&#32;entry&#32;and&#32;return&#32;nul&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05410"/>05410 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;label[0]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05411"/>05411 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l05412"/>05412 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05413"/>05413 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05414"/>05414 
<anchor xml:id="_ff_8c_source_1l05415"/>05415 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;serial&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05416"/>05416 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;&amp;&amp;&#32;vsn)&#32;{
<anchor xml:id="_ff_8c_source_1l05417"/>05417 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;move_window(fs,&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a89358c0e7b2293254c9481dcd2984d30">volbase</link>);
<anchor xml:id="_ff_8c_source_1l05418"/>05418 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05419"/>05419 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05420"/>05420 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>:
<anchor xml:id="_ff_8c_source_1l05421"/>05421 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;<link linkend="_ff_8c_1a465d34bfcd2bf930e04ae1b379047199">BPB_VolIDEx</link>;
<anchor xml:id="_ff_8c_source_1l05422"/>05422 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05423"/>05423 
<anchor xml:id="_ff_8c_source_1l05424"/>05424 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>:
<anchor xml:id="_ff_8c_source_1l05425"/>05425 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;<link linkend="_ff_8c_1abaa3aafdcf5e83f8cb7e2bb373b13525">BS_VolID32</link>;
<anchor xml:id="_ff_8c_source_1l05426"/>05426 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05427"/>05427 
<anchor xml:id="_ff_8c_source_1l05428"/>05428 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:
<anchor xml:id="_ff_8c_source_1l05429"/>05429 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;<link linkend="_ff_8c_1a383a71bda500a0fb5a37f4edd785acbf">BS_VolID</link>;
<anchor xml:id="_ff_8c_source_1l05430"/>05430 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05431"/>05431 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*vsn&#32;=&#32;ld_dword(fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>&#32;+&#32;di);
<anchor xml:id="_ff_8c_source_1l05432"/>05432 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05433"/>05433 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05434"/>05434 
<anchor xml:id="_ff_8c_source_1l05435"/>05435 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05436"/>05436 }
<anchor xml:id="_ff_8c_source_1l05437"/>05437 
<anchor xml:id="_ff_8c_source_1l05438"/>05438 
<anchor xml:id="_ff_8c_source_1l05439"/>05439 
<anchor xml:id="_ff_8c_source_1l05440"/>05440 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l05441"/>05441 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05442"/>05442 <emphasis role="comment">/*&#32;Set&#32;Volume&#32;Label&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05443"/>05443 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05444"/>05444 
<anchor xml:id="_ff_8c_source_1l05445"/>05445 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1aa82bca64e28bc0d656a7999dd0eadec7">f_setlabel</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05446"/>05446 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;label&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label&#32;to&#32;set&#32;with&#32;heading&#32;logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05447"/>05447 )
<anchor xml:id="_ff_8c_source_1l05448"/>05448 {
<anchor xml:id="_ff_8c_source_1l05449"/>05449 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05450"/>05450 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05451"/>05451 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s___d_i_r">FATFS_DIR</link>&#32;dj;
<anchor xml:id="_ff_8c_source_1l05452"/>05452 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;dirvn[22];
<anchor xml:id="_ff_8c_source_1l05453"/>05453 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;di;
<anchor xml:id="_ff_8c_source_1l05454"/>05454 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l05455"/>05455 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;badchr[18]&#32;=&#32;<emphasis role="stringliteral">&quot;+.,;=[]&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;/*:&lt;&gt;|\\\&quot;\?\x7F&quot;</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;[0..16]&#32;for&#32;FAT,&#32;[7..16]&#32;for&#32;exFAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05456"/>05456 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l05457"/>05457 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dc;
<anchor xml:id="_ff_8c_source_1l05458"/>05458 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05459"/>05459 
<anchor xml:id="_ff_8c_source_1l05460"/>05460 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05461"/>05461 &#32;&#32;&#32;&#32;res&#32;=&#32;mount_volume(&amp;label,&#32;&amp;fs,&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>);
<anchor xml:id="_ff_8c_source_1l05462"/>05462 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05463"/>05463 
<anchor xml:id="_ff_8c_source_1l05464"/>05464 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05465"/>05465 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05466"/>05466 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(dirvn,&#32;0,&#32;22);
<anchor xml:id="_ff_8c_source_1l05467"/>05467 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05468"/>05468 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;((<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)*label&#32;&gt;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05469"/>05469 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;tchar2uni(&amp;label);&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;Unicode&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05470"/>05470 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;&gt;=&#32;0x10000)&#32;{
<anchor xml:id="_ff_8c_source_1l05471"/>05471 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;0xFFFFFFFF&#32;||&#32;di&#32;&gt;=&#32;10)&#32;{&#32;<emphasis role="comment">/*&#32;Wrong&#32;surrogate&#32;or&#32;buffer&#32;overflow&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05472"/>05472 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05473"/>05473 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05474"/>05474 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dirvn&#32;+&#32;di&#32;*&#32;2,&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(dc&#32;&gt;&gt;&#32;16));&#32;di++;
<anchor xml:id="_ff_8c_source_1l05475"/>05475 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05476"/>05476 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05477"/>05477 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;0&#32;||&#32;strchr(&amp;badchr[7],&#32;(<emphasis role="keywordtype">int</emphasis>)dc)&#32;||&#32;di&#32;&gt;=&#32;11)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05478"/>05478 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>);
<anchor xml:id="_ff_8c_source_1l05479"/>05479 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05480"/>05480 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(dirvn&#32;+&#32;di&#32;*&#32;2,&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)dc);&#32;di++;
<anchor xml:id="_ff_8c_source_1l05481"/>05481 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05482"/>05482 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05483"/>05483 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05484"/>05484 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05485"/>05485 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(dirvn,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>,&#32;11);
<anchor xml:id="_ff_8c_source_1l05486"/>05486 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;di&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05487"/>05487 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;((<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)*label&#32;&gt;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05488"/>05488 <emphasis role="preprocessor">#if&#32;FF_USE_LFN</emphasis>
<anchor xml:id="_ff_8c_source_1l05489"/>05489 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;tchar2uni(&amp;label);
<anchor xml:id="_ff_8c_source_1l05490"/>05490 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(dc&#32;&lt;&#32;0x10000)&#32;?&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(dc),&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>)&#32;:&#32;0;
<anchor xml:id="_ff_8c_source_1l05491"/>05491 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05492"/>05492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*label++;
<anchor xml:id="_ff_8c_source_1l05493"/>05493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc))&#32;wc&#32;=&#32;dbc_2nd((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*label)&#32;?&#32;wc&#32;&lt;&lt;&#32;8&#32;|&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)*label++&#32;:&#32;0;
<anchor xml:id="_ff_8c_source_1l05494"/>05494 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a4a9d454724926bd51a3aed589a97f08b">IsLower</link>(wc))&#32;wc&#32;-=&#32;0x20;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;ASCII&#32;characters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05495"/>05495 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l05496"/>05496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ExCvt&#32;&amp;&amp;&#32;wc&#32;&gt;=&#32;0x80)&#32;wc&#32;=&#32;ExCvt[wc&#32;-&#32;0x80];&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;extended&#32;characters&#32;(SBCS&#32;cfg)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05497"/>05497 <emphasis role="preprocessor">#elif&#32;FF_CODE_PAGE&#32;&lt;&#32;900</emphasis>
<anchor xml:id="_ff_8c_source_1l05498"/>05498 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&gt;=&#32;0x80)&#32;wc&#32;=&#32;ExCvt[wc&#32;-&#32;0x80];&#32;&#32;<emphasis role="comment">/*&#32;To&#32;upper&#32;extended&#32;characters&#32;(SBCS&#32;cfg)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05499"/>05499 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05500"/>05500 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05501"/>05501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0&#32;||&#32;strchr(&amp;badchr[0],&#32;(<emphasis role="keywordtype">int</emphasis>)wc)&#32;||&#32;di&#32;&gt;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)((wc&#32;&gt;=&#32;0x100)&#32;?&#32;10&#32;:&#32;11))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Reject&#32;invalid&#32;characters&#32;for&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05502"/>05502 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>);
<anchor xml:id="_ff_8c_source_1l05503"/>05503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05504"/>05504 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&gt;=&#32;0x100)&#32;dirvn[di++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(wc&#32;&gt;&gt;&#32;8);
<anchor xml:id="_ff_8c_source_1l05505"/>05505 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dirvn[di++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc;
<anchor xml:id="_ff_8c_source_1l05506"/>05506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05507"/>05507 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dirvn[0]&#32;==&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca83e45a4b579558c57192c0a391b9bb45">FR_INVALID_NAME</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Reject&#32;illegal&#32;name&#32;(heading&#32;DDEM)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05508"/>05508 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(di&#32;&amp;&amp;&#32;dirvn[di&#32;-&#32;1]&#32;==&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>)&#32;di--;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;trailing&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05509"/>05509 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05510"/>05510 
<anchor xml:id="_ff_8c_source_1l05511"/>05511 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05512"/>05512 &#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>&#32;=&#32;fs;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1aa093b756538e6307178680c5c24939f7">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;0;&#32;&#32;<emphasis role="comment">/*&#32;Open&#32;root&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05513"/>05513 &#32;&#32;&#32;&#32;res&#32;=&#32;dir_sdi(&amp;dj,&#32;0);
<anchor xml:id="_ff_8c_source_1l05514"/>05514 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05515"/>05515 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8c_1afd5d25039aad72791c8fd0e911ba7e97">DIR_READ_LABEL</link>(&amp;dj);&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;label&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05516"/>05516 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05517"/>05517 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05518"/>05518 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1aac6d45371e0269e7b10c5a08f2f4b422">XDIR_NumLabel</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)di;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;the&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05519"/>05519 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1ac154e61682dfed7bb071b0926db1efac">XDIR_Label</link>,&#32;dirvn,&#32;22);
<anchor xml:id="_ff_8c_source_1l05520"/>05520 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05521"/>05521 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;!=&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l05522"/>05522 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dirvn,&#32;11);&#32;&#32;<emphasis role="comment">/*&#32;Change&#32;the&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05523"/>05523 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05524"/>05524 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1afa89348e9fc2de82ae9e12c661366b0e">DIR_Name</link>]&#32;=&#32;<link linkend="_ff_8c_1a0f2455f7318e6d56318c62f5e4048e1e">DDEM</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Remove&#32;the&#32;volume&#32;label&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05525"/>05525 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05526"/>05526 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05527"/>05527 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05528"/>05528 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05529"/>05529 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;volume&#32;label&#32;entry&#32;or&#32;an&#32;error&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05530"/>05530 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97da8f98fc2e66d8fa7847f9ebb19b8c">FR_NO_FILE</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05531"/>05531 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l05532"/>05532 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(di&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;volume&#32;label&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05533"/>05533 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;dir_alloc(&amp;dj,&#32;1);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;an&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05534"/>05534 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05535"/>05535 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;0,&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>);&#32;&#32;<emphasis role="comment">/*&#32;Clean&#32;the&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05536"/>05536 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05537"/>05537 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1a55c8dde2fcff23002e196ae2c3eeaa08">XDIR_Type</link>]&#32;=&#32;<link linkend="_ff_8c_1a9c991beac4793083d6bd370735bcb9c6">ET_VLABEL</link>;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;volume&#32;label&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05538"/>05538 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1aac6d45371e0269e7b10c5a08f2f4b422">XDIR_NumLabel</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)di;
<anchor xml:id="_ff_8c_source_1l05539"/>05539 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>&#32;+&#32;<link linkend="_ff_8c_1ac154e61682dfed7bb071b0926db1efac">XDIR_Label</link>,&#32;dirvn,&#32;22);
<anchor xml:id="_ff_8c_source_1l05540"/>05540 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05541"/>05541 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>[<link linkend="_ff_8c_1ad3233e40118ed66095f3c9545b788f8a">DIR_Attr</link>]&#32;=&#32;<link linkend="_ff_8c_1a5cfae62dabae0a54809e43b36685ce7c">AM_VOL</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;volume&#32;label&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05542"/>05542 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(dj.<link linkend="_struct_f_a_t_f_s___d_i_r_1a98b1f6c364ef043e542a558a5ea99ec5">dir</link>,&#32;dirvn,&#32;11);
<anchor xml:id="_ff_8c_source_1l05543"/>05543 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05544"/>05544 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a647e43c9ccae94b7274793d1909897de">wflag</link>&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05545"/>05545 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;sync_fs(fs);
<anchor xml:id="_ff_8c_source_1l05546"/>05546 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05547"/>05547 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05548"/>05548 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05549"/>05549 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05550"/>05550 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05551"/>05551 
<anchor xml:id="_ff_8c_source_1l05552"/>05552 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05553"/>05553 }
<anchor xml:id="_ff_8c_source_1l05554"/>05554 
<anchor xml:id="_ff_8c_source_1l05555"/>05555 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05556"/>05556 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_LABEL&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05557"/>05557 
<anchor xml:id="_ff_8c_source_1l05558"/>05558 
<anchor xml:id="_ff_8c_source_1l05559"/>05559 
<anchor xml:id="_ff_8c_source_1l05560"/>05560 <emphasis role="preprocessor">#if&#32;FF_USE_EXPAND&#32;&amp;&amp;&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l05561"/>05561 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05562"/>05562 <emphasis role="comment">/*&#32;Allocate&#32;a&#32;Contiguous&#32;Blocks&#32;to&#32;the&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05563"/>05563 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05564"/>05564 
<anchor xml:id="_ff_8c_source_1l05565"/>05565 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a35ff90f5219df5cdb6c8f408b1b9e1a3">f_expand</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05566"/>05566 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05567"/>05567 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;fsz,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;File&#32;size&#32;to&#32;be&#32;expanded&#32;to&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05568"/>05568 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;opt&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Operation&#32;mode&#32;0:Find&#32;and&#32;prepare&#32;or&#32;1:Find&#32;and&#32;allocate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05569"/>05569 )
<anchor xml:id="_ff_8c_source_1l05570"/>05570 {
<anchor xml:id="_ff_8c_source_1l05571"/>05571 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05572"/>05572 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05573"/>05573 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;n,&#32;clst,&#32;stcl,&#32;scl,&#32;ncl,&#32;tcl,&#32;lclst;
<anchor xml:id="_ff_8c_source_1l05574"/>05574 
<anchor xml:id="_ff_8c_source_1l05575"/>05575 
<anchor xml:id="_ff_8c_source_1l05576"/>05576 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05577"/>05577 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05578"/>05578 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsz&#32;==&#32;0&#32;||&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;!=&#32;0&#32;||&#32;!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1afa366963220c89b882c0361794020c14">FA_WRITE</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);
<anchor xml:id="_ff_8c_source_1l05579"/>05579 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05580"/>05580 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;!=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>&#32;&amp;&amp;&#32;fsz&#32;&gt;=&#32;0x100000000)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;in&#32;size&#32;limit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05581"/>05581 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05582"/>05582 &#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05583"/>05583 &#32;&#32;&#32;&#32;tcl&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(fsz&#32;/&#32;n)&#32;+&#32;((fsz&#32;&amp;&#32;(n&#32;-&#32;1))&#32;?&#32;1&#32;:&#32;0);&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;required&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05584"/>05584 &#32;&#32;&#32;&#32;stcl&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>;&#32;lclst&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05585"/>05585 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stcl&#32;&lt;&#32;2&#32;||&#32;stcl&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;stcl&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l05586"/>05586 
<anchor xml:id="_ff_8c_source_1l05587"/>05587 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l05588"/>05588 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1add27d97babe807b573eac98a71dc4ae5">fs_type</link>&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05589"/>05589 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;find_bitmap(fs,&#32;stcl,&#32;tcl);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;contiguous&#32;cluster&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05590"/>05590 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(scl&#32;==&#32;0)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;contiguous&#32;cluster&#32;block&#32;was&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05591"/>05591 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(scl&#32;==&#32;0xFFFFFFFF)&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05592"/>05592 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;<emphasis role="comment">/*&#32;A&#32;contiguous&#32;free&#32;area&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05593"/>05593 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(opt)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;it&#32;now&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05594"/>05594 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;change_bitmap(fs,&#32;scl,&#32;tcl,&#32;1);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;the&#32;cluster&#32;block&#32;&apos;in&#32;use&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05595"/>05595 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lclst&#32;=&#32;scl&#32;+&#32;tcl&#32;-&#32;1;
<anchor xml:id="_ff_8c_source_1l05596"/>05596 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;it&#32;as&#32;suggested&#32;point&#32;for&#32;next&#32;allocation&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05597"/>05597 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lclst&#32;=&#32;scl&#32;-&#32;1;
<anchor xml:id="_ff_8c_source_1l05598"/>05598 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05599"/>05599 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05600"/>05600 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05601"/>05601 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05602"/>05602 &#32;&#32;&#32;&#32;{
<anchor xml:id="_ff_8c_source_1l05603"/>05603 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;clst&#32;=&#32;stcl;&#32;ncl&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05604"/>05604 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;a&#32;contiguous&#32;cluster&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05605"/>05605 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;clst);
<anchor xml:id="_ff_8c_source_1l05606"/>05606 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(++clst&#32;&gt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>)&#32;clst&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l05607"/>05607 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;1)&#32;{
<anchor xml:id="_ff_8c_source_1l05608"/>05608 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05609"/>05609 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05610"/>05610 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;0xFFFFFFFF)&#32;{
<anchor xml:id="_ff_8c_source_1l05611"/>05611 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05612"/>05612 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05613"/>05613 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;a&#32;free&#32;cluster?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05614"/>05614 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(++ncl&#32;==&#32;tcl)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Break&#32;if&#32;a&#32;contiguous&#32;cluster&#32;block&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05615"/>05615 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05616"/>05616 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scl&#32;=&#32;clst;&#32;ncl&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;a&#32;free&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05617"/>05617 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05618"/>05618 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;stcl)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;contiguous&#32;cluster?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05619"/>05619 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05620"/>05620 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05621"/>05621 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05622"/>05622 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{&#32;<emphasis role="comment">/*&#32;A&#32;contiguous&#32;free&#32;area&#32;is&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05623"/>05623 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(opt)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Allocate&#32;it&#32;now&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05624"/>05624 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(clst&#32;=&#32;scl,&#32;n&#32;=&#32;tcl;&#32;n;&#32;clst++,&#32;n--)&#32;{&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;cluster&#32;chain&#32;on&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05625"/>05625 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;<link linkend="_app3_8c_1abd4b6b071a8d728a88727051c12bc6d7">put_fat</link>(fs,&#32;clst,&#32;(n&#32;==&#32;1)&#32;?&#32;0xFFFFFFFF&#32;:&#32;clst&#32;+&#32;1);
<anchor xml:id="_ff_8c_source_1l05626"/>05626 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05627"/>05627 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lclst&#32;=&#32;clst;
<anchor xml:id="_ff_8c_source_1l05628"/>05628 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05629"/>05629 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;it&#32;as&#32;suggested&#32;point&#32;for&#32;next&#32;allocation&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05630"/>05630 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lclst&#32;=&#32;scl&#32;-&#32;1;
<anchor xml:id="_ff_8c_source_1l05631"/>05631 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05632"/>05632 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05633"/>05633 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05634"/>05634 
<anchor xml:id="_ff_8c_source_1l05635"/>05635 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05636"/>05636 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac26e848817569fedc15a9a4e49ddedd1">last_clst</link>&#32;=&#32;lclst;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;suggested&#32;start&#32;cluster&#32;to&#32;start&#32;next&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05637"/>05637 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(opt)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;it&#32;allocated&#32;now?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05638"/>05638 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;=&#32;scl;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;object&#32;allocation&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05639"/>05639 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;=&#32;fsz;
<anchor xml:id="_ff_8c_source_1l05640"/>05640 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>)&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1aa7bfa8dd8958d11df042a67e1da25f63">stat</link>&#32;=&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;status&#32;&apos;contiguous&#32;chain&apos;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05641"/>05641 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;|=&#32;<link linkend="_ff_8c_1a9ae82de1b6841df9041411357f8d3eb5">FA_MODIFIED</link>;
<anchor xml:id="_ff_8c_source_1l05642"/>05642 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;&lt;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a8da50eeba6469bc20d60ca0cf9a1307c">n_fatent</link>&#32;-&#32;2)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;FSINFO&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05643"/>05643 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1ac834248773bf338df807f0d7e6b6a579">free_clst</link>&#32;-=&#32;tcl;
<anchor xml:id="_ff_8c_source_1l05644"/>05644 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a84e9cdc5a6a8e33ea7ec192058abf161">fsi_flag</link>&#32;|=&#32;1;
<anchor xml:id="_ff_8c_source_1l05645"/>05645 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05646"/>05646 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05647"/>05647 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05648"/>05648 
<anchor xml:id="_ff_8c_source_1l05649"/>05649 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05650"/>05650 }
<anchor xml:id="_ff_8c_source_1l05651"/>05651 
<anchor xml:id="_ff_8c_source_1l05652"/>05652 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_EXPAND&#32;&amp;&amp;&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05653"/>05653 
<anchor xml:id="_ff_8c_source_1l05654"/>05654 
<anchor xml:id="_ff_8c_source_1l05655"/>05655 
<anchor xml:id="_ff_8c_source_1l05656"/>05656 <emphasis role="preprocessor">#if&#32;FF_USE_FORWARD</emphasis>
<anchor xml:id="_ff_8c_source_1l05657"/>05657 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05658"/>05658 <emphasis role="comment">/*&#32;Forward&#32;Data&#32;to&#32;the&#32;Stream&#32;Directly&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05659"/>05659 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05660"/>05660 
<anchor xml:id="_ff_8c_source_1l05661"/>05661 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a6c0c4cd695704aa6d952c90be81d9849">f_forward</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05662"/>05662 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05663"/>05663 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;(*func)(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*,<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>),&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;streaming&#32;function&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05664"/>05664 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;btf,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;to&#32;forward&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05665"/>05665 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>*&#32;bf&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;number&#32;of&#32;bytes&#32;forwarded&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05666"/>05666 )
<anchor xml:id="_ff_8c_source_1l05667"/>05667 {
<anchor xml:id="_ff_8c_source_1l05668"/>05668 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05669"/>05669 &#32;&#32;&#32;&#32;<link linkend="_struct_f_a_t_f_s">FATFS</link>&#32;*fs;
<anchor xml:id="_ff_8c_source_1l05670"/>05670 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst;
<anchor xml:id="_ff_8c_source_1l05671"/>05671 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect;
<anchor xml:id="_ff_8c_source_1l05672"/>05672 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;remain;
<anchor xml:id="_ff_8c_source_1l05673"/>05673 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;rcnt,&#32;csect;
<anchor xml:id="_ff_8c_source_1l05674"/>05674 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*dbuf;
<anchor xml:id="_ff_8c_source_1l05675"/>05675 
<anchor xml:id="_ff_8c_source_1l05676"/>05676 
<anchor xml:id="_ff_8c_source_1l05677"/>05677 &#32;&#32;&#32;&#32;*bf&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;transfer&#32;byte&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05678"/>05678 &#32;&#32;&#32;&#32;res&#32;=&#32;validate(&amp;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>,&#32;&amp;fs);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;validity&#32;of&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05679"/>05679 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>&#32;||&#32;(res&#32;=&#32;(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>)fp-&gt;<link linkend="_struct_f_i_l_1aea440945db26de9c4a88065c0c887fda">err</link>)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;res);
<anchor xml:id="_ff_8c_source_1l05680"/>05680 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8h_1a1f4f3530ff03abbd979b072536e72290">FA_READ</link>))&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca897e9f2dd7629a80f48af242d8bc1a3d">FR_DENIED</link>);&#32;<emphasis role="comment">/*&#32;Check&#32;access&#32;mode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05681"/>05681 
<anchor xml:id="_ff_8c_source_1l05682"/>05682 &#32;&#32;&#32;&#32;remain&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a83c51ba99687054f0cc653b45f195268">objsize</link>&#32;-&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>;
<anchor xml:id="_ff_8c_source_1l05683"/>05683 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(btf&#32;&gt;&#32;remain)&#32;btf&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)remain;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Truncate&#32;btf&#32;by&#32;remaining&#32;bytes&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05684"/>05684 
<anchor xml:id="_ff_8c_source_1l05685"/>05685 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;btf&#32;&gt;&#32;0&#32;&amp;&amp;&#32;(*func)(0,&#32;0);&#32;fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;+=&#32;rcnt,&#32;*bf&#32;+=&#32;rcnt,&#32;btf&#32;-=&#32;rcnt)&#32;{&#32;<emphasis role="comment">/*&#32;Repeat&#32;until&#32;all&#32;data&#32;transferred&#32;or&#32;stream&#32;goes&#32;busy&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05686"/>05686 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;csect&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;/&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;&amp;&#32;(fs-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;-&#32;1));&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;offset&#32;in&#32;the&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05687"/>05687 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;sector&#32;boundary?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05688"/>05688 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(csect&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;cluster&#32;boundary?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05689"/>05689 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;(fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;==&#32;0)&#32;?&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;On&#32;the&#32;top&#32;of&#32;the&#32;file?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05690"/>05690 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;:&#32;<link linkend="_app3_8c_1a65611adf1626e5e08da77cd33a98dd8b">get_fat</link>(&amp;fp-&gt;obj,&#32;fp-&gt;clust);
<anchor xml:id="_ff_8c_source_1l05691"/>05691 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;&lt;=&#32;1)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05692"/>05692 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;==&#32;0xFFFFFFFF)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05693"/>05693 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>&#32;=&#32;clst;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;current&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05694"/>05694 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05695"/>05695 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05696"/>05696 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;clst2sect(fs,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;data&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05697"/>05697 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sect&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05698"/>05698 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;csect;
<anchor xml:id="_ff_8c_source_1l05699"/>05699 <emphasis role="preprocessor">#if&#32;FF_FS_TINY</emphasis>
<anchor xml:id="_ff_8c_source_1l05700"/>05700 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(move_window(fs,&#32;sect)&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Move&#32;sector&#32;window&#32;to&#32;the&#32;file&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05701"/>05701 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dbuf&#32;=&#32;fs-&gt;<link linkend="_struct_f_a_t_f_s_1a49e9c5c3ae9c13755242b6ce5748ecb1">win</link>;
<anchor xml:id="_ff_8c_source_1l05702"/>05702 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l05703"/>05703 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;!=&#32;sect)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;sector&#32;cache&#32;with&#32;file&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05704"/>05704 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l05705"/>05705 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;&#32;<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write-back&#32;dirty&#32;sector&#32;cache&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05706"/>05706 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05707"/>05707 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac409508881f5a16f2998ae675072b376">flag</link>&#32;&amp;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)~<link linkend="_ff_8c_1affd69e5e6d205e09e1070b2f3c039072">FA_DIRTY</link>;
<anchor xml:id="_ff_8c_source_1l05708"/>05708 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05709"/>05709 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05710"/>05710 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(fs-&gt;<link linkend="_struct_f_a_t_f_s_1acae426c920cd7f59e5883f948e1b3184">pdrv</link>,&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>,&#32;sect,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05711"/>05711 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05712"/>05712 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dbuf&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ac2aa36f0fa61cd82f905173d51f719b0">buf</link>;
<anchor xml:id="_ff_8c_source_1l05713"/>05713 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05714"/>05714 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa3f9f9ed9341b765862d073a95c86001">sect</link>&#32;=&#32;sect;
<anchor xml:id="_ff_8c_source_1l05715"/>05715 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rcnt&#32;=&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)&#32;-&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;bytes&#32;remains&#32;in&#32;the&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05716"/>05716 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rcnt&#32;&gt;&#32;btf)&#32;rcnt&#32;=&#32;btf;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;it&#32;by&#32;btr&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05717"/>05717 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rcnt&#32;=&#32;(*func)(dbuf&#32;+&#32;((<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)fp-&gt;<link linkend="_struct_f_i_l_1a088b03ab2e02f82e10e17bdd938190a6">fptr</link>&#32;%&#32;<link linkend="_ff_8c_1a42b5140fc5e09a53c8f4cba66dc0e6c1">SS</link>(fs)),&#32;rcnt);&#32;<emphasis role="comment">/*&#32;Forward&#32;the&#32;file&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05718"/>05718 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rcnt&#32;==&#32;0)&#32;<link linkend="_ff_8c_1a41e4c46636679236568cf50b5535847f">ABORT</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cab6c9903af6e9bffbb7a288705f4a6a76">FR_INT_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05719"/>05719 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05720"/>05720 
<anchor xml:id="_ff_8c_source_1l05721"/>05721 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1a7e653d8ca0ae09faa49cd5b7335fea84">LEAVE_FF</link>(fs,&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l05722"/>05722 }
<anchor xml:id="_ff_8c_source_1l05723"/>05723 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_FORWARD&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05724"/>05724 
<anchor xml:id="_ff_8c_source_1l05725"/>05725 
<anchor xml:id="_ff_8c_source_1l05726"/>05726 
<anchor xml:id="_ff_8c_source_1l05727"/>05727 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_USE_MKFS</emphasis>
<anchor xml:id="_ff_8c_source_1l05728"/>05728 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05729"/>05729 <emphasis role="comment">/*&#32;Create&#32;FAT/exFAT&#32;volume&#32;(with&#32;sub-functions)&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05730"/>05730 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05731"/>05731 
<anchor xml:id="_ff_8c_source_1l05732"/><link linkend="_ff_8c_1aa7655ed8fbdcfec3965be1d6f412d0f6">05732</link> <emphasis role="preprocessor">#define&#32;N_SEC_TRACK&#32;63&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Sectors&#32;per&#32;track&#32;for&#32;determination&#32;of&#32;drive&#32;CHS&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05733"/><link linkend="_ff_8c_1a7f901110fcf3b8bc941e6086cc7ba860">05733</link> <emphasis role="preprocessor">#define&#32;GPT_ALIGN&#32;&#32;&#32;0x100000&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Alignment&#32;of&#32;partitions&#32;in&#32;GPT&#32;[byte]&#32;(&gt;=128KB)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05734"/><link linkend="_ff_8c_1a5ba0a17d3228d2ccda3859b6ed0c4fb8">05734</link> <emphasis role="preprocessor">#define&#32;GPT_ITEMS&#32;&#32;&#32;128&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Number&#32;of&#32;GPT&#32;table&#32;size&#32;(&gt;=128,&#32;sector&#32;aligned)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l05735"/>05735 
<anchor xml:id="_ff_8c_source_1l05736"/>05736 
<anchor xml:id="_ff_8c_source_1l05737"/>05737 <emphasis role="comment">/*&#32;Create&#32;partitions&#32;on&#32;the&#32;physical&#32;drive&#32;in&#32;format&#32;of&#32;MBR&#32;or&#32;GPT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05738"/>05738 
<anchor xml:id="_ff_8c_source_1l05739"/>05739 <emphasis role="keyword">static</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;create_partition&#32;(
<anchor xml:id="_ff_8c_source_1l05740"/>05740 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;drv,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Physical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05741"/>05741 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;plst[],&#32;<emphasis role="comment">/*&#32;Partition&#32;list&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05742"/>05742 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;sys,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;ID&#32;for&#32;each&#32;partition&#32;(for&#32;only&#32;MBR)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05743"/>05743 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*buf&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Working&#32;buffer&#32;for&#32;a&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05744"/>05744 )
<anchor xml:id="_ff_8c_source_1l05745"/>05745 {
<anchor xml:id="_ff_8c_source_1l05746"/>05746 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;cy;
<anchor xml:id="_ff_8c_source_1l05747"/>05747 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sz_drv;
<anchor xml:id="_ff_8c_source_1l05748"/>05748 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sz_drv32,&#32;nxt_alloc32,&#32;sz_part32;
<anchor xml:id="_ff_8c_source_1l05749"/>05749 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*pte;
<anchor xml:id="_ff_8c_source_1l05750"/>05750 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;hd,&#32;n_hd,&#32;sc,&#32;n_sc;
<anchor xml:id="_ff_8c_source_1l05751"/>05751 
<anchor xml:id="_ff_8c_source_1l05752"/>05752 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;physical&#32;drive&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05753"/>05753 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(drv,&#32;<link linkend="_diskio_8h_1a570216006f6a8fc4e1698b1bbb2d1dde">GET_SECTOR_COUNT</link>,&#32;&amp;sz_drv)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05754"/>05754 
<anchor xml:id="_ff_8c_source_1l05755"/>05755 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l05756"/>05756 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_drv&#32;&gt;=&#32;<link linkend="_ffconf_8h_1a1f3a98483912d219d3688edfa5717949">FF_MIN_GPT</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Create&#32;partitions&#32;in&#32;GPT&#32;format&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05757"/>05757 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;ss;
<anchor xml:id="_ff_8c_source_1l05758"/>05758 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;sz_ptbl,&#32;pi,&#32;si,&#32;ofs;
<anchor xml:id="_ff_8c_source_1l05759"/>05759 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;bcc,&#32;rnd,&#32;align;
<anchor xml:id="_ff_8c_source_1l05760"/>05760 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;QWORD&#32;nxt_alloc,&#32;sz_part,&#32;sz_pool,&#32;top_bpt;
<anchor xml:id="_ff_8c_source_1l05761"/>05761 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;gpt_mbr[16]&#32;=&#32;{0x00,&#32;0x00,&#32;0x02,&#32;0x00,&#32;0xEE,&#32;0xFE,&#32;0xFF,&#32;0x00,&#32;0x01,&#32;0x00,&#32;0x00,&#32;0x00,&#32;0xFF,&#32;0xFF,&#32;0xFF,&#32;0xFF};
<anchor xml:id="_ff_8c_source_1l05762"/>05762 
<anchor xml:id="_ff_8c_source_1l05763"/>05763 <emphasis role="preprocessor">#if&#32;FF_MAX_SS&#32;!=&#32;FF_MIN_SS</emphasis>
<anchor xml:id="_ff_8c_source_1l05764"/>05764 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(drv,&#32;<link linkend="_diskio_8h_1ac73b5cf2135cbd459d109b96c9aa346a">GET_SECTOR_SIZE</link>,&#32;&amp;ss)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;sector&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05765"/>05765 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ss&#32;&gt;&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>&#32;||&#32;ss&#32;&lt;&#32;<link linkend="_ffconf_8h_1a5c25535bf118c111157fe72fff3cbea5">FF_MIN_SS</link>&#32;||&#32;(ss&#32;&amp;&#32;(ss&#32;-&#32;1)))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05766"/>05766 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l05767"/>05767 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ss&#32;=&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>;
<anchor xml:id="_ff_8c_source_1l05768"/>05768 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05769"/>05769 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rnd&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_drv&#32;+&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Random&#32;seed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05770"/>05770 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;align&#32;=&#32;<link linkend="_ff_8c_1a7f901110fcf3b8bc941e6086cc7ba860">GPT_ALIGN</link>&#32;/&#32;ss;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partition&#32;alignment&#32;for&#32;GPT&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05771"/>05771 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_ptbl&#32;=&#32;<link linkend="_ff_8c_1a5ba0a17d3228d2ccda3859b6ed0c4fb8">GPT_ITEMS</link>&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;/&#32;ss;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;partition&#32;table&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05772"/>05772 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;top_bpt&#32;=&#32;sz_drv&#32;-&#32;sz_ptbl&#32;-&#32;1;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Backup&#32;partition&#32;table&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05773"/>05773 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nxt_alloc&#32;=&#32;2&#32;+&#32;sz_ptbl;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;First&#32;allocatable&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05774"/>05774 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_pool&#32;=&#32;top_bpt&#32;-&#32;nxt_alloc;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;allocatable&#32;area&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05775"/>05775 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;bcc&#32;=&#32;0xFFFFFFFF;&#32;sz_part&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l05776"/>05776 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pi&#32;=&#32;si&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;partition&#32;table&#32;index,&#32;size&#32;table&#32;index&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05777"/>05777 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l05778"/>05778 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pi&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;%&#32;ss&#32;==&#32;0)&#32;memset(buf,&#32;0,&#32;ss);&#32;<emphasis role="comment">/*&#32;Clean&#32;the&#32;buffer&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05779"/>05779 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_part&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;size&#32;table&#32;not&#32;termintated?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05780"/>05780 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nxt_alloc&#32;=&#32;(nxt_alloc&#32;+&#32;align&#32;-&#32;1)&#32;&amp;&#32;((QWORD)0&#32;-&#32;align);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Align&#32;partition&#32;start&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05781"/>05781 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_part&#32;=&#32;plst[si++];&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;partition&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05782"/>05782 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_part&#32;&lt;=&#32;100)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;size&#32;in&#32;percentage?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05783"/>05783 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_part&#32;=&#32;sz_pool&#32;*&#32;sz_part&#32;/&#32;100;
<anchor xml:id="_ff_8c_source_1l05784"/>05784 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_part&#32;=&#32;(sz_part&#32;+&#32;align&#32;-&#32;1)&#32;&amp;&#32;((QWORD)0&#32;-&#32;align);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Align&#32;partition&#32;end&#32;(only&#32;if&#32;in&#32;percentage)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05785"/>05785 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05786"/>05786 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt_alloc&#32;+&#32;sz_part&#32;&gt;&#32;top_bpt)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;the&#32;size&#32;at&#32;end&#32;of&#32;the&#32;pool&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05787"/>05787 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_part&#32;=&#32;(nxt_alloc&#32;&lt;&#32;top_bpt)&#32;?&#32;top_bpt&#32;-&#32;nxt_alloc&#32;:&#32;0;
<anchor xml:id="_ff_8c_source_1l05788"/>05788 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05789"/>05789 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05790"/>05790 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_part&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Add&#32;a&#32;partition?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05791"/>05791 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;pi&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;%&#32;ss;
<anchor xml:id="_ff_8c_source_1l05792"/>05792 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a8e8517c1287b2d9c93d164bccc0133db">GPTE_PtGuid</link>,&#32;GUID_MS_Basic,&#32;16);&#32;<emphasis role="comment">/*&#32;Set&#32;partition&#32;GUID&#32;(Microsoft&#32;Basic&#32;Data)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05793"/>05793 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rnd&#32;=&#32;make_rand(rnd,&#32;buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a0b89556f11a98b5c3d893d92d7d32334">GPTE_UpGuid</link>,&#32;16);&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;unique&#32;partition&#32;GUID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05794"/>05794 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a25029670f9bc74da6eae5001fe4acdb4">GPTE_FstLba</link>,&#32;nxt_alloc);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;partition&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05795"/>05795 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a4f37e50e5eabcfb8353749dc8b8be4b4">GPTE_LstLba</link>,&#32;nxt_alloc&#32;+&#32;sz_part&#32;-&#32;1);&#32;<emphasis role="comment">/*&#32;Set&#32;partition&#32;end&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05796"/>05796 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nxt_alloc&#32;+=&#32;sz_part;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;allocatable&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05797"/>05797 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05798"/>05798 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((pi&#32;+&#32;1)&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;%&#32;ss&#32;==&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;the&#32;buffer&#32;if&#32;it&#32;is&#32;filled&#32;up&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05799"/>05799 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;bcc&#32;=&#32;crc32(bcc,&#32;buf[i++]))&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Calculate&#32;table&#32;check&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05800"/>05800 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(drv,&#32;buf,&#32;2&#32;+&#32;pi&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;/&#32;ss,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;to&#32;primary&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05801"/>05801 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(drv,&#32;buf,&#32;top_bpt&#32;+&#32;pi&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;/&#32;ss,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;<emphasis role="comment">/*&#32;Write&#32;to&#32;secondary&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05802"/>05802 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05803"/>05803 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++pi&#32;&lt;&#32;<link linkend="_ff_8c_1a5ba0a17d3228d2ccda3859b6ed0c4fb8">GPT_ITEMS</link>);
<anchor xml:id="_ff_8c_source_1l05804"/>05804 
<anchor xml:id="_ff_8c_source_1l05805"/>05805 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;primary&#32;GPT&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05806"/>05806 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l05807"/>05807 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1afff5a1b885cf62ef3382022e6f2bf5c2">GPTH_Sign</link>,&#32;<emphasis role="stringliteral">&quot;EFI&#32;PART&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;\0\0\1\0&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;\x5C\0\0&quot;</emphasis>,&#32;16);&#32;&#32;<emphasis role="comment">/*&#32;Signature,&#32;version&#32;(1.0)&#32;and&#32;size&#32;(92)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05808"/>05808 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a94ea6178d6f9e74b6b8eb4bb68eb4470">GPTH_PtBcc</link>,&#32;~bcc);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;check&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05809"/>05809 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1a985c526784a91120bec12f33f3169408">GPTH_CurLba</link>,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;this&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05810"/>05810 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1ad65d7cc56b164352a9f487a69e3a1281">GPTH_BakLba</link>,&#32;sz_drv&#32;-&#32;1);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;secondary&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05811"/>05811 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1a14df7c4b0d469d423e2c1b5f4f0ea02d">GPTH_FstLba</link>,&#32;2&#32;+&#32;sz_ptbl);&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;first&#32;allocatable&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05812"/>05812 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1adaa930215faa1e6f51430b080130f9e5">GPTH_LstLba</link>,&#32;top_bpt&#32;-&#32;1);&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;last&#32;allocatable&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05813"/>05813 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a16b1364aca6d6fc7991516ee883606ff">GPTH_PteSize</link>,&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;a&#32;table&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05814"/>05814 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a950d43a4211a4bdcc19888bfc8fde5f9">GPTH_PtNum</link>,&#32;<link linkend="_ff_8c_1a5ba0a17d3228d2ccda3859b6ed0c4fb8">GPT_ITEMS</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;table&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05815"/>05815 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1acf59802a11562c5dc1f0d99ae5a89946">GPTH_PtOfs</link>,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;this&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05816"/>05816 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rnd&#32;=&#32;make_rand(rnd,&#32;buf&#32;+&#32;<link linkend="_ff_8c_1a32df4a198d3dc8acebd987be74c304ee">GPTH_DskGuid</link>,&#32;16);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Disk&#32;GUID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05817"/>05817 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;bcc=&#32;0xFFFFFFFF;&#32;i&#32;&lt;&#32;92;&#32;bcc&#32;=&#32;crc32(bcc,&#32;buf[i++]))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Calculate&#32;header&#32;check&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05818"/>05818 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ac1a4c52079edc7bf25dddc7bf02e1882">GPTH_Bcc</link>,&#32;~bcc);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Header&#32;check&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05819"/>05819 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(drv,&#32;buf,&#32;1,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05820"/>05820 
<anchor xml:id="_ff_8c_source_1l05821"/>05821 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;secondary&#32;GPT&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05822"/>05822 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1a985c526784a91120bec12f33f3169408">GPTH_CurLba</link>,&#32;sz_drv&#32;-&#32;1);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;this&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05823"/>05823 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1ad65d7cc56b164352a9f487a69e3a1281">GPTH_BakLba</link>,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;primary&#32;header&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05824"/>05824 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1acf59802a11562c5dc1f0d99ae5a89946">GPTH_PtOfs</link>,&#32;top_bpt);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;LBA&#32;of&#32;this&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05825"/>05825 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ac1a4c52079edc7bf25dddc7bf02e1882">GPTH_Bcc</link>,&#32;0);
<anchor xml:id="_ff_8c_source_1l05826"/>05826 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;bcc=&#32;0xFFFFFFFF;&#32;i&#32;&lt;&#32;92;&#32;bcc&#32;=&#32;crc32(bcc,&#32;buf[i++]))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Calculate&#32;header&#32;check&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05827"/>05827 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ac1a4c52079edc7bf25dddc7bf02e1882">GPTH_Bcc</link>,&#32;~bcc);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Header&#32;check&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05828"/>05828 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(drv,&#32;buf,&#32;sz_drv&#32;-&#32;1,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05829"/>05829 
<anchor xml:id="_ff_8c_source_1l05830"/>05830 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;protective&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05831"/>05831 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l05832"/>05832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>,&#32;gpt_mbr,&#32;16);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;GPT&#32;partition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05833"/>05833 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);
<anchor xml:id="_ff_8c_source_1l05834"/>05834 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(drv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05835"/>05835 
<anchor xml:id="_ff_8c_source_1l05836"/>05836 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05837"/>05837 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05838"/>05838 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;partitions&#32;in&#32;MBR&#32;format&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05839"/>05839 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_drv32&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_drv;
<anchor xml:id="_ff_8c_source_1l05840"/>05840 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_sc&#32;=&#32;<link linkend="_ff_8c_1aa7655ed8fbdcfec3965be1d6f412d0f6">N_SEC_TRACK</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;drive&#32;CHS&#32;without&#32;any&#32;consideration&#32;of&#32;the&#32;drive&#32;geometry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05841"/>05841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n_hd&#32;=&#32;8;&#32;n_hd&#32;!=&#32;0&#32;&amp;&amp;&#32;sz_drv32&#32;/&#32;n_hd&#32;/&#32;n_sc&#32;&gt;&#32;1024;&#32;n_hd&#32;*=&#32;2)&#32;;
<anchor xml:id="_ff_8c_source_1l05842"/>05842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_hd&#32;==&#32;0)&#32;n_hd&#32;=&#32;255;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;heads&#32;needs&#32;to&#32;be&#32;&lt;256&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05843"/>05843 
<anchor xml:id="_ff_8c_source_1l05844"/>05844 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05845"/>05845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte&#32;=&#32;buf&#32;+&#32;<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>;&#32;&#32;<emphasis role="comment">/*&#32;Partition&#32;table&#32;in&#32;the&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05846"/>05846 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;nxt_alloc32&#32;=&#32;n_sc;&#32;i&#32;&lt;&#32;4&#32;&amp;&amp;&#32;nxt_alloc32&#32;!=&#32;0&#32;&amp;&amp;&#32;nxt_alloc32&#32;&lt;&#32;sz_drv32;&#32;i++,&#32;nxt_alloc32&#32;+=&#32;sz_part32)&#32;{
<anchor xml:id="_ff_8c_source_1l05847"/>05847 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_part32&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)plst[i];&#32;<emphasis role="comment">/*&#32;Get&#32;partition&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05848"/>05848 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_part32&#32;&lt;=&#32;100)&#32;sz_part32&#32;=&#32;(sz_part32&#32;==&#32;100)&#32;?&#32;sz_drv32&#32;:&#32;sz_drv32&#32;/&#32;100&#32;*&#32;sz_part32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;in&#32;percentage?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05849"/>05849 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nxt_alloc32&#32;+&#32;sz_part32&#32;&gt;&#32;sz_drv32&#32;||&#32;nxt_alloc32&#32;+&#32;sz_part32&#32;&lt;&#32;nxt_alloc32)&#32;sz_part32&#32;=&#32;sz_drv32&#32;-&#32;nxt_alloc32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clip&#32;at&#32;drive&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05850"/>05850 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_part32&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;table&#32;or&#32;no&#32;sector&#32;to&#32;allocate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05851"/>05851 
<anchor xml:id="_ff_8c_source_1l05852"/>05852 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(pte&#32;+&#32;<link linkend="_ff_8c_1ae33f69bfe238a35fb3fd1949c4e087da">PTE_StLba</link>,&#32;nxt_alloc32);&#32;<emphasis role="comment">/*&#32;Start&#32;LBA&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05853"/>05853 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(pte&#32;+&#32;<link linkend="_ff_8c_1a195f11dd0185a4edbe7064ebe40092bc">PTE_SizLba</link>,&#32;sz_part32);&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05854"/>05854 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;=&#32;sys;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;System&#32;type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05855"/>05855 
<anchor xml:id="_ff_8c_source_1l05856"/>05856 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cy&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)(nxt_alloc32&#32;/&#32;n_sc&#32;/&#32;n_hd);&#32;<emphasis role="comment">/*&#32;Start&#32;cylinder&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05857"/>05857 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hd&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(nxt_alloc32&#32;/&#32;n_sc&#32;%&#32;n_hd);&#32;<emphasis role="comment">/*&#32;Start&#32;head&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05858"/>05858 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sc&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(nxt_alloc32&#32;%&#32;n_sc&#32;+&#32;1);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05859"/>05859 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1a72ec8d9f48ea97de79e5878dfa593ca3">PTE_StHead</link>]&#32;=&#32;hd;
<anchor xml:id="_ff_8c_source_1l05860"/>05860 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1a3fd894243a30fe6253a78fb9221eb5f4">PTE_StSec</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)((cy&#32;&gt;&gt;&#32;2&#32;&amp;&#32;0xC0)&#32;|&#32;sc);
<anchor xml:id="_ff_8c_source_1l05861"/>05861 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1a973d54c6ad9ae5c0b40e1832db4976f9">PTE_StCyl</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)cy;
<anchor xml:id="_ff_8c_source_1l05862"/>05862 
<anchor xml:id="_ff_8c_source_1l05863"/>05863 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;cy&#32;=&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)((nxt_alloc32&#32;+&#32;sz_part32&#32;-&#32;1)&#32;/&#32;n_sc&#32;/&#32;n_hd);&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;cylinder&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05864"/>05864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hd&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)((nxt_alloc32&#32;+&#32;sz_part32&#32;-&#32;1)&#32;/&#32;n_sc&#32;%&#32;n_hd);&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;head&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05865"/>05865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sc&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)((nxt_alloc32&#32;+&#32;sz_part32&#32;-&#32;1)&#32;%&#32;n_sc&#32;+&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05866"/>05866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1a151137a5b01c29730bbf4ee63c773d12">PTE_EdHead</link>]&#32;=&#32;hd;
<anchor xml:id="_ff_8c_source_1l05867"/>05867 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1aa3b0eae83b150116114dfa582a297ee9">PTE_EdSec</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)((cy&#32;&gt;&gt;&#32;2&#32;&amp;&#32;0xC0)&#32;|&#32;sc);
<anchor xml:id="_ff_8c_source_1l05868"/>05868 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte[<link linkend="_ff_8c_1a0f96bb9d52c3a5bbd489b59772463cab">PTE_EdCyl</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)cy;
<anchor xml:id="_ff_8c_source_1l05869"/>05869 
<anchor xml:id="_ff_8c_source_1l05870"/>05870 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte&#32;+=&#32;<link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">SZ_PTE</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05871"/>05871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05872"/>05872 
<anchor xml:id="_ff_8c_source_1l05873"/>05873 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;MBR&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05874"/>05874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(drv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;to&#32;the&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05875"/>05875 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05876"/>05876 
<anchor xml:id="_ff_8c_source_1l05877"/>05877 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l05878"/>05878 }
<anchor xml:id="_ff_8c_source_1l05879"/>05879 
<anchor xml:id="_ff_8c_source_1l05880"/>05880 
<anchor xml:id="_ff_8c_source_1l05881"/>05881 
<anchor xml:id="_ff_8c_source_1l05882"/><link linkend="_ff_8c_1a983f0614033bd7cf587eb56d3054a91c">05882</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8c_1a983f0614033bd7cf587eb56d3054a91c">f_mkfs</link>&#32;(
<anchor xml:id="_ff_8c_source_1l05883"/>05883 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;path,&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Logical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05884"/>05884 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_m_k_f_s___p_a_r_m">MKFS_PARM</link>*&#32;opt,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Format&#32;options&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05885"/>05885 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>*&#32;work,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;working&#32;buffer&#32;(null:&#32;use&#32;len&#32;bytes&#32;of&#32;heap&#32;memory)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05886"/>05886 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;len&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;working&#32;buffer&#32;[byte]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05887"/>05887 )
<anchor xml:id="_ff_8c_source_1l05888"/>05888 {
<anchor xml:id="_ff_8c_source_1l05889"/>05889 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;cst[]&#32;=&#32;{1,&#32;4,&#32;16,&#32;64,&#32;256,&#32;512,&#32;0};&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;boundary&#32;for&#32;FAT&#32;volume&#32;(4Ks&#32;unit)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05890"/>05890 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;cst32[]&#32;=&#32;{1,&#32;2,&#32;4,&#32;8,&#32;16,&#32;32,&#32;0};&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;boundary&#32;for&#32;FAT32&#32;volume&#32;(128Ks&#32;unit)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05891"/>05891 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_struct_m_k_f_s___p_a_r_m">MKFS_PARM</link>&#32;defopt&#32;=&#32;{<link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>,&#32;0,&#32;0,&#32;0,&#32;0};&#32;&#32;&#32;<emphasis role="comment">/*&#32;Default&#32;parameter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05892"/>05892 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;fsopt,&#32;fsty,&#32;sys,&#32;pdrv,&#32;ipart;
<anchor xml:id="_ff_8c_source_1l05893"/>05893 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*buf;
<anchor xml:id="_ff_8c_source_1l05894"/>05894 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*pte;
<anchor xml:id="_ff_8c_source_1l05895"/>05895 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05896"/>05896 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sz_buf,&#32;sz_blk,&#32;n_clst,&#32;pau,&#32;nsect,&#32;n,&#32;vsn;
<anchor xml:id="_ff_8c_source_1l05897"/>05897 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sz_vol,&#32;b_vol,&#32;b_fat,&#32;b_data;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;volume,&#32;Base&#32;LBA&#32;of&#32;volume,&#32;fat,&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05898"/>05898 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;sect,&#32;lba[2];
<anchor xml:id="_ff_8c_source_1l05899"/>05899 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;sz_rsv,&#32;sz_fat,&#32;sz_dir,&#32;sz_au;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;reserved,&#32;fat,&#32;dir,&#32;data,&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05900"/>05900 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n_fat,&#32;n_root,&#32;i;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Index,&#32;Number&#32;of&#32;FATs&#32;and&#32;Number&#32;of&#32;roor&#32;dir&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05901"/>05901 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;vol;
<anchor xml:id="_ff_8c_source_1l05902"/>05902 &#32;&#32;&#32;&#32;<link linkend="_diskio_8h_1adba6790898ce4029c20a34b898ce73c1">DSTATUS</link>&#32;ds;
<anchor xml:id="_ff_8c_source_1l05903"/>05903 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l05904"/>05904 
<anchor xml:id="_ff_8c_source_1l05905"/>05905 
<anchor xml:id="_ff_8c_source_1l05906"/>05906 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;mounted&#32;drive&#32;and&#32;clear&#32;work&#32;area&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05907"/>05907 &#32;&#32;&#32;&#32;vol&#32;=&#32;get_ldnumber(&amp;path);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;target&#32;logical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05908"/>05908 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(vol&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca487844af77de15f6932a3b41ef3a2d65">FR_INVALID_DRIVE</link>;
<anchor xml:id="_ff_8c_source_1l05909"/>05909 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(FatFs[vol])&#32;FatFs[vol]-&gt;fs_type&#32;=&#32;0;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Clear&#32;the&#32;fs&#32;object&#32;if&#32;mounted&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05910"/>05910 &#32;&#32;&#32;&#32;pdrv&#32;=&#32;<link linkend="_ff_8c_1a6577ed2f95527745bf4d27c53488b9a7">LD2PD</link>(vol);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Hosting&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05911"/>05911 &#32;&#32;&#32;&#32;ipart&#32;=&#32;<link linkend="_ff_8c_1aadc4a9aefaf2588bdd7565549f5d91e7">LD2PT</link>(vol);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Hosting&#32;partition&#32;(0:create&#32;as&#32;new,&#32;1..:existing&#32;partition)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05912"/>05912 
<anchor xml:id="_ff_8c_source_1l05913"/>05913 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;hosting&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05914"/>05914 &#32;&#32;&#32;&#32;ds&#32;=&#32;<link linkend="_fat_8c_1a09cdaa6f36fa409bdf002727bff98eb1">disk_initialize</link>(pdrv);
<anchor xml:id="_ff_8c_source_1l05915"/>05915 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ds&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45">FR_NOT_READY</link>;
<anchor xml:id="_ff_8c_source_1l05916"/>05916 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ds&#32;&amp;&#32;<link linkend="_diskio_8h_1a9ec6dc5f6620a33fabe388d3a111ca8c">STA_PROTECT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>;
<anchor xml:id="_ff_8c_source_1l05917"/>05917 
<anchor xml:id="_ff_8c_source_1l05918"/>05918 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;physical&#32;drive&#32;parameters&#32;(sz_drv,&#32;sz_blk&#32;and&#32;ss)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05919"/>05919 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!opt)&#32;opt&#32;=&#32;&amp;defopt;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;default&#32;parameter&#32;if&#32;it&#32;is&#32;not&#32;given&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05920"/>05920 &#32;&#32;&#32;&#32;sz_blk&#32;=&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1af244e017c4cb2c821e5e819fff7db710">align</link>;
<anchor xml:id="_ff_8c_source_1l05921"/>05921 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_blk&#32;==&#32;0)&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1aec3bb4dfe075d0ba2f3b07b300a95500">GET_BLOCK_SIZE</link>,&#32;&amp;sz_blk);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Block&#32;size&#32;from&#32;the&#32;paramter&#32;or&#32;lower&#32;layer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05922"/>05922 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_blk&#32;==&#32;0&#32;||&#32;sz_blk&#32;&gt;&#32;0x8000&#32;||&#32;(sz_blk&#32;&amp;&#32;(sz_blk&#32;-&#32;1)))&#32;sz_blk&#32;=&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;default&#32;if&#32;the&#32;block&#32;size&#32;is&#32;invalid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05923"/>05923 <emphasis role="preprocessor">#if&#32;FF_MAX_SS&#32;!=&#32;FF_MIN_SS</emphasis>
<anchor xml:id="_ff_8c_source_1l05924"/>05924 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1ac73b5cf2135cbd459d109b96c9aa346a">GET_SECTOR_SIZE</link>,&#32;&amp;ss)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05925"/>05925 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ss&#32;&gt;&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>&#32;||&#32;ss&#32;&lt;&#32;<link linkend="_ffconf_8h_1a5c25535bf118c111157fe72fff3cbea5">FF_MIN_SS</link>&#32;||&#32;(ss&#32;&amp;&#32;(ss&#32;-&#32;1)))&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>;
<anchor xml:id="_ff_8c_source_1l05926"/>05926 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l05927"/>05927 &#32;&#32;&#32;&#32;ss&#32;=&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>;
<anchor xml:id="_ff_8c_source_1l05928"/>05928 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05929"/>05929 
<anchor xml:id="_ff_8c_source_1l05930"/>05930 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Options&#32;for&#32;FAT&#32;sub-type&#32;and&#32;FAT&#32;parameters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05931"/>05931 &#32;&#32;&#32;&#32;fsopt&#32;=&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a54cb609ecff9f1586f3628b00aeb8f23">fmt</link>&#32;&amp;&#32;(<link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>&#32;|&#32;<link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>);
<anchor xml:id="_ff_8c_source_1l05932"/>05932 &#32;&#32;&#32;&#32;n_fat&#32;=&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a0ff8e4728bddfe0636c50367af399e25">n_fat</link>&#32;&gt;=&#32;1&#32;&amp;&amp;&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a0ff8e4728bddfe0636c50367af399e25">n_fat</link>&#32;&lt;=&#32;2)&#32;?&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a0ff8e4728bddfe0636c50367af399e25">n_fat</link>&#32;:&#32;1;
<anchor xml:id="_ff_8c_source_1l05933"/>05933 &#32;&#32;&#32;&#32;n_root&#32;=&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;&gt;=&#32;1&#32;&amp;&amp;&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;&lt;=&#32;32768&#32;&amp;&amp;&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;%&#32;(ss&#32;/&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>))&#32;==&#32;0)&#32;?&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1a2b8a26b614381e0c2e0ff26f138feea6">n_root</link>&#32;:&#32;512;
<anchor xml:id="_ff_8c_source_1l05934"/>05934 &#32;&#32;&#32;&#32;sz_au&#32;=&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;&lt;=&#32;0x1000000&#32;&amp;&amp;&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;&amp;&#32;(opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;-&#32;1))&#32;==&#32;0)&#32;?&#32;opt-&gt;<link linkend="_struct_m_k_f_s___p_a_r_m_1adb29b0af8e486fc53d8b629c3e49d567">au_size</link>&#32;:&#32;0;
<anchor xml:id="_ff_8c_source_1l05935"/>05935 &#32;&#32;&#32;&#32;sz_au&#32;/=&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Byte&#32;--&gt;&#32;Sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05936"/>05936 
<anchor xml:id="_ff_8c_source_1l05937"/>05937 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05938"/>05938 &#32;&#32;&#32;&#32;sz_buf&#32;=&#32;len&#32;/&#32;ss;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;working&#32;buffer&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05939"/>05939 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_buf&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;
<anchor xml:id="_ff_8c_source_1l05940"/>05940 &#32;&#32;&#32;&#32;buf&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)work;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05941"/>05941 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;3</emphasis>
<anchor xml:id="_ff_8c_source_1l05942"/>05942 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!buf)&#32;buf&#32;=&#32;<link linkend="_ffsystem_8c_1ae63913186246b80cfce42dbab9e8bcab">ff_memalloc</link>(sz_buf&#32;*&#32;ss);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Use&#32;heap&#32;memory&#32;for&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05943"/>05943 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05944"/>05944 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!buf)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;
<anchor xml:id="_ff_8c_source_1l05945"/>05945 
<anchor xml:id="_ff_8c_source_1l05946"/>05946 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;where&#32;the&#32;volume&#32;to&#32;be&#32;located&#32;(b_vol,&#32;sz_vol)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05947"/>05947 &#32;&#32;&#32;&#32;b_vol&#32;=&#32;sz_vol&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05948"/>05948 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a6f07d18b72c37af9fb5deda0e8a13131">FF_MULTI_PARTITION</link>&#32;&amp;&amp;&#32;ipart&#32;!=&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;volume&#32;associated&#32;with&#32;any&#32;specific&#32;partition?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05949"/>05949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;partition&#32;location&#32;from&#32;the&#32;existing&#32;partition&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05950"/>05950 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05951"/>05951 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ld_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>)&#32;!=&#32;0xAA55)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;MBR&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05952"/>05952 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l05953"/>05953 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(buf[<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;==&#32;0xEE)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;GPT&#32;protective&#32;MBR?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05954"/>05954 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;n_ent,&#32;ofs;
<anchor xml:id="_ff_8c_source_1l05955"/>05955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;QWORD&#32;pt_lba;
<anchor xml:id="_ff_8c_source_1l05956"/>05956 
<anchor xml:id="_ff_8c_source_1l05957"/>05957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;partition&#32;location&#32;from&#32;GPT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05958"/>05958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;1,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;<emphasis role="comment">/*&#32;Load&#32;GPT&#32;header&#32;sector&#32;(next&#32;to&#32;MBR)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05959"/>05959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!test_gpt_header(buf))&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;GPT&#32;header&#32;is&#32;valid&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05960"/>05960 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_ent&#32;=&#32;ld_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a950d43a4211a4bdcc19888bfc8fde5f9">GPTH_PtNum</link>);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05961"/>05961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pt_lba&#32;=&#32;ld_qword(buf&#32;+&#32;<link linkend="_ff_8c_1acf59802a11562c5dc1f0d99ae5a89946">GPTH_PtOfs</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05962"/>05962 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ofs&#32;=&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l05963"/>05963 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n_ent)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Find&#32;MS&#32;Basic&#32;partition&#32;with&#32;order&#32;of&#32;ipart&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05964"/>05964 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ofs&#32;==&#32;0&#32;&amp;&amp;&#32;<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;pt_lba++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;PT&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05965"/>05965 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!memcmp(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a8e8517c1287b2d9c93d164bccc0133db">GPTE_PtGuid</link>,&#32;GUID_MS_Basic,&#32;16)&#32;&amp;&amp;&#32;++i&#32;==&#32;ipart)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;MS&#32;basic&#32;data&#32;partition?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05966"/>05966 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;ld_qword(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a25029670f9bc74da6eae5001fe4acdb4">GPTE_FstLba</link>);
<anchor xml:id="_ff_8c_source_1l05967"/>05967 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_vol&#32;=&#32;ld_qword(buf&#32;+&#32;ofs&#32;+&#32;<link linkend="_ff_8c_1a4f37e50e5eabcfb8353749dc8b8be4b4">GPTE_LstLba</link>)&#32;-&#32;b_vol&#32;+&#32;1;
<anchor xml:id="_ff_8c_source_1l05968"/>05968 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l05969"/>05969 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05970"/>05970 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_ent--;&#32;ofs&#32;=&#32;(ofs&#32;+&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>)&#32;%&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Next&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05971"/>05971 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05972"/>05972 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_ent&#32;==&#32;0)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partition&#32;not&#32;found&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05973"/>05973 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsopt&#32;|=&#32;0x80;&#32;&#32;<emphasis role="comment">/*&#32;Partitioning&#32;is&#32;in&#32;GPT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05974"/>05974 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05975"/>05975 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05976"/>05976 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;the&#32;partition&#32;location&#32;from&#32;MBR&#32;partition&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05977"/>05977 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pte&#32;=&#32;buf&#32;+&#32;(<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;(ipart&#32;-&#32;1)&#32;*&#32;<link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">SZ_PTE</link>);
<anchor xml:id="_ff_8c_source_1l05978"/>05978 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ipart&#32;&gt;&#32;4&#32;||&#32;pte[<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;==&#32;0)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;<emphasis role="comment">/*&#32;No&#32;partition?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05979"/>05979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;ld_dword(pte&#32;+&#32;<link linkend="_ff_8c_1ae33f69bfe238a35fb3fd1949c4e087da">PTE_StLba</link>);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05980"/>05980 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_vol&#32;=&#32;ld_dword(pte&#32;+&#32;<link linkend="_ff_8c_1a195f11dd0185a4edbe7064ebe40092bc">PTE_SizLba</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;volume&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05981"/>05981 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05982"/>05982 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;The&#32;volume&#32;is&#32;associated&#32;with&#32;a&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05983"/>05983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1a570216006f6a8fc4e1698b1bbb2d1dde">GET_SECTOR_COUNT</link>,&#32;&amp;sz_vol)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l05984"/>05984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;To&#32;be&#32;partitioned?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05985"/>05985 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;single-partition&#32;on&#32;the&#32;drive&#32;in&#32;this&#32;function&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05986"/>05986 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l05987"/>05987 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;<link linkend="_ffconf_8h_1a1f3a98483912d219d3688edfa5717949">FF_MIN_GPT</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Which&#32;partition&#32;type&#32;to&#32;create,&#32;MBR&#32;or&#32;GPT?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05988"/>05988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsopt&#32;|=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partitioning&#32;is&#32;in&#32;GPT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05989"/>05989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;<link linkend="_ff_8c_1a7f901110fcf3b8bc941e6086cc7ba860">GPT_ALIGN</link>&#32;/&#32;ss;&#32;sz_vol&#32;-=&#32;b_vol&#32;+&#32;<link linkend="_ff_8c_1a5ba0a17d3228d2ccda3859b6ed0c4fb8">GPT_ITEMS</link>&#32;*&#32;<link linkend="_ff_8c_1aaaa69650a3bce4a6f68f88e2e3a07f43">SZ_GPTE</link>&#32;/&#32;ss&#32;+&#32;1;&#32;<emphasis role="comment">/*&#32;Estimated&#32;partition&#32;offset&#32;and&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05990"/>05990 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l05991"/>05991 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l05992"/>05992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Partitioning&#32;is&#32;in&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05993"/>05993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;&#32;<link linkend="_ff_8c_1aa7655ed8fbdcfec3965be1d6f412d0f6">N_SEC_TRACK</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l05994"/>05994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_vol&#32;=&#32;<link linkend="_ff_8c_1aa7655ed8fbdcfec3965be1d6f412d0f6">N_SEC_TRACK</link>;&#32;sz_vol&#32;-=&#32;b_vol;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Estimated&#32;partition&#32;offset&#32;and&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l05995"/>05995 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05996"/>05996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05997"/>05997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05998"/>05998 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l05999"/>05999 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;128)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;<emphasis role="comment">/*&#32;Check&#32;if&#32;volume&#32;size&#32;is&#32;&gt;=128s&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06000"/>06000 
<anchor xml:id="_ff_8c_source_1l06001"/>06001 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Now&#32;start&#32;to&#32;create&#32;an&#32;FAT&#32;volume&#32;at&#32;b_vol&#32;and&#32;sz_vol&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06002"/>06002 
<anchor xml:id="_ff_8c_source_1l06003"/>06003 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pre-determine&#32;the&#32;FAT&#32;type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06004"/>06004 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a9348c28116bc29e88195b23f6945f81d">FM_EXFAT</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;possible?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06005"/>06005 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a701ab2eee8c2d9b5b445aadc8f14df4d">FM_ANY</link>)&#32;==&#32;<link linkend="_ff_8h_1a9348c28116bc29e88195b23f6945f81d">FM_EXFAT</link>&#32;||&#32;sz_vol&#32;&gt;=&#32;0x4000000&#32;||&#32;sz_au&#32;&gt;&#32;128)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;only,&#32;vol&#32;&gt;=&#32;64MS&#32;or&#32;sz_au&#32;&gt;&#32;128S&#32;?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06006"/>06006 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06007"/>06007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06008"/>06008 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06009"/>06009 <emphasis role="preprocessor">#if&#32;FF_LBA64</emphasis>
<anchor xml:id="_ff_8c_source_1l06010"/>06010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x100000000)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;<emphasis role="comment">/*&#32;Too&#32;large&#32;volume&#32;for&#32;FAT/FAT32&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06011"/>06011 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06012"/>06012 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;&gt;&#32;128)&#32;sz_au&#32;=&#32;128;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Invalid&#32;AU&#32;for&#32;FAT/FAT32?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06013"/>06013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1aff61d3ed8f8c6ea5c25c3cb366320e08">FM_FAT32</link>)&#32;{&#32;<emphasis role="comment">/*&#32;FAT32&#32;possible?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06014"/>06014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a8bd205b7d09147e55169d3713f46e9ea">FM_FAT</link>))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;no-FAT?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06015"/>06015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06016"/>06016 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06017"/>06017 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06018"/>06018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a8bd205b7d09147e55169d3713f46e9ea">FM_FAT</link>))&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3b89faeceab64db277d0fcdeaaa315d6">FR_INVALID_PARAMETER</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;no-FAT?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06019"/>06019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>;
<anchor xml:id="_ff_8c_source_1l06020"/>06020 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(0);
<anchor xml:id="_ff_8c_source_1l06021"/>06021 
<anchor xml:id="_ff_8c_source_1l06022"/>06022 &#32;&#32;&#32;&#32;vsn&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;+&#32;<link linkend="_ff_8c_1a72589f5bbb514c0b222ab8b292764418">GET_FATTIME</link>();&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;generated&#32;from&#32;current&#32;time&#32;and&#32;partitiion&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06023"/>06023 
<anchor xml:id="_ff_8c_source_1l06024"/>06024 <emphasis role="preprocessor">#if&#32;FF_FS_EXFAT</emphasis>
<anchor xml:id="_ff_8c_source_1l06025"/>06025 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Create&#32;an&#32;exFAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06026"/>06026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;szb_bit,&#32;szb_case,&#32;sum,&#32;nbit,&#32;clu,&#32;clen[3];
<anchor xml:id="_ff_8c_source_1l06027"/>06027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;ch,&#32;si;
<anchor xml:id="_ff_8c_source_1l06028"/>06028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;j,&#32;st;
<anchor xml:id="_ff_8c_source_1l06029"/>06029 
<anchor xml:id="_ff_8c_source_1l06030"/>06030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;0x1000)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;small&#32;volume&#32;for&#32;exFAT?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06031"/>06031 <emphasis role="preprocessor">#if&#32;FF_USE_TRIM</emphasis>
<anchor xml:id="_ff_8c_source_1l06032"/>06032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lba[0]&#32;=&#32;b_vol;&#32;lba[1]&#32;=&#32;b_vol&#32;+&#32;sz_vol&#32;-&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Inform&#32;storage&#32;device&#32;that&#32;the&#32;volume&#32;area&#32;may&#32;be&#32;erased&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06033"/>06033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1af09fd84bea8d4e889e272471f44d60d6">CTRL_TRIM</link>,&#32;lba);
<anchor xml:id="_ff_8c_source_1l06034"/>06034 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06035"/>06035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;FAT&#32;location,&#32;data&#32;location&#32;and&#32;number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06036"/>06036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;AU&#32;auto-selection&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06037"/>06037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_au&#32;=&#32;8;
<anchor xml:id="_ff_8c_source_1l06038"/>06038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x80000)&#32;sz_au&#32;=&#32;64;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&gt;=&#32;512Ks&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06039"/>06039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x4000000)&#32;sz_au&#32;=&#32;256;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&gt;=&#32;64Ms&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06040"/>06040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06041"/>06041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_fat&#32;=&#32;b_vol&#32;+&#32;32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;start&#32;at&#32;offset&#32;32&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06042"/>06042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((sz_vol&#32;/&#32;sz_au&#32;+&#32;2)&#32;*&#32;4&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FAT&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06043"/>06043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_data&#32;=&#32;(b_fat&#32;+&#32;sz_fat&#32;+&#32;sz_blk&#32;-&#32;1)&#32;&amp;&#32;~((<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>)sz_blk&#32;-&#32;1);&#32;&#32;<emphasis role="comment">/*&#32;Align&#32;data&#32;area&#32;to&#32;the&#32;erase&#32;block&#32;boundary&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06044"/>06044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(b_data&#32;-&#32;b_vol&#32;&gt;=&#32;sz_vol&#32;/&#32;2)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;small&#32;volume?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06045"/>06045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)((sz_vol&#32;-&#32;(b_data&#32;-&#32;b_vol))&#32;/&#32;sz_au);&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06046"/>06046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&lt;16)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;few&#32;clusters?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06047"/>06047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1ad7bea1c4a86cb654807e6da0370cb694">MAX_EXFAT</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;clusters?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06048"/>06048 
<anchor xml:id="_ff_8c_source_1l06049"/>06049 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;szb_bit&#32;=&#32;(n_clst&#32;+&#32;7)&#32;/&#32;8;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;allocation&#32;bitmap&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06050"/>06050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clen[0]&#32;=&#32;(szb_bit&#32;+&#32;sz_au&#32;*&#32;ss&#32;-&#32;1)&#32;/&#32;(sz_au&#32;*&#32;ss);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;allocation&#32;bitmap&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06051"/>06051 
<anchor xml:id="_ff_8c_source_1l06052"/>06052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;compressed&#32;up-case&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06053"/>06053 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_data&#32;+&#32;sz_au&#32;*&#32;clen[0];&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06054"/>06054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Table&#32;checksum&#32;to&#32;be&#32;stored&#32;in&#32;the&#32;82&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06055"/>06055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st&#32;=&#32;0;&#32;si&#32;=&#32;0;&#32;i&#32;=&#32;0;&#32;j&#32;=&#32;0;&#32;szb_case&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06056"/>06056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06057"/>06057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(st)&#32;{
<anchor xml:id="_ff_8c_source_1l06058"/>06058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;0:
<anchor xml:id="_ff_8c_source_1l06059"/>06059 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>(si);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;up-case&#32;char&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06060"/>06060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ch&#32;!=&#32;si)&#32;{
<anchor xml:id="_ff_8c_source_1l06061"/>06061 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;si++;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Store&#32;the&#32;up-case&#32;char&#32;if&#32;exist&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06062"/>06062 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06063"/>06063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;1;&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(si&#32;+&#32;j)&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(si&#32;+&#32;j)&#32;==&#32;<link linkend="_ffunicode_8c_1acb0bf9acde41b603662ab45811cbc806">ff_wtoupper</link>((<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(si&#32;+&#32;j));&#32;j++)&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;run&#32;length&#32;of&#32;no-case&#32;block&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06064"/>06064 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(j&#32;&gt;=&#32;128)&#32;{
<anchor xml:id="_ff_8c_source_1l06065"/>06065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;0xFFFF;&#32;st&#32;=&#32;2;&#32;<emphasis role="keywordflow">break</emphasis>;&#32;<emphasis role="comment">/*&#32;Compress&#32;the&#32;no-case&#32;block&#32;if&#32;run&#32;is&#32;&gt;=&#32;128&#32;chars&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06066"/>06066 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06067"/>06067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Do&#32;not&#32;compress&#32;short&#32;run&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06068"/>06068 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FALLTHROUGH&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06069"/>06069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;1:
<anchor xml:id="_ff_8c_source_1l06070"/>06070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;si++;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;the&#32;short&#32;run&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06071"/>06071 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(--j&#32;==&#32;0)&#32;st&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06072"/>06072 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06073"/>06073 
<anchor xml:id="_ff_8c_source_1l06074"/>06074 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:
<anchor xml:id="_ff_8c_source_1l06075"/>06075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ch&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)j;&#32;si&#32;+=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)j;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;chars&#32;to&#32;skip&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06076"/>06076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06077"/>06077 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06078"/>06078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;xsum32(buf[i&#32;+&#32;0]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)ch,&#32;sum);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;it&#32;into&#32;the&#32;write&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06079"/>06079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sum&#32;=&#32;xsum32(buf[i&#32;+&#32;1]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(ch&#32;&gt;&gt;&#32;8),&#32;sum);
<anchor xml:id="_ff_8c_source_1l06080"/>06080 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;2;&#32;szb_case&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l06081"/>06081 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(si&#32;==&#32;0&#32;||&#32;i&#32;==&#32;sz_buf&#32;*&#32;ss)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;buffered&#32;data&#32;when&#32;buffer&#32;full&#32;or&#32;end&#32;of&#32;process&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06082"/>06082 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(i&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;
<anchor xml:id="_ff_8c_source_1l06083"/>06083 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06084"/>06084 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06085"/>06085 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06086"/>06086 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(si);
<anchor xml:id="_ff_8c_source_1l06087"/>06087 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clen[1]&#32;=&#32;(szb_case&#32;+&#32;sz_au&#32;*&#32;ss&#32;-&#32;1)&#32;/&#32;(sz_au&#32;*&#32;ss);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;up-case&#32;table&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06088"/>06088 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clen[2]&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;dir&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06089"/>06089 
<anchor xml:id="_ff_8c_source_1l06090"/>06090 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;allocation&#32;bitmap&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06091"/>06091 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_data;&#32;nsect&#32;=&#32;(szb_bit&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;bitmap&#32;and&#32;number&#32;of&#32;bitmap&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06092"/>06092 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nbit&#32;=&#32;clen[0]&#32;+&#32;clen[1]&#32;+&#32;clen[2];&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;in-use&#32;by&#32;system&#32;(bitmap,&#32;up-case&#32;and&#32;root-dir)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06093"/>06093 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06094"/>06094 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;bitmap&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06095"/>06095 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;nbit&#32;!=&#32;0&#32;&amp;&amp;&#32;i&#32;/&#32;8&#32;&lt;&#32;sz_buf&#32;*&#32;ss;&#32;buf[i&#32;/&#32;8]&#32;|=&#32;1&#32;&lt;&lt;&#32;(i&#32;%&#32;8),&#32;i++,&#32;nbit--)&#32;;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Mark&#32;used&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06096"/>06096 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;the&#32;buffered&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06097"/>06097 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06098"/>06098 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
<anchor xml:id="_ff_8c_source_1l06099"/>06099 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
<anchor xml:id="_ff_8c_source_1l06100"/>06100 
<anchor xml:id="_ff_8c_source_1l06101"/>06101 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06102"/>06102 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_fat;&#32;nsect&#32;=&#32;sz_fat;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;FAT&#32;and&#32;number&#32;of&#32;FAT&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06103"/>06103 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;j&#32;=&#32;nbit&#32;=&#32;clu&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06104"/>06104 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06105"/>06105 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);&#32;i&#32;=&#32;0;&#32;<emphasis role="comment">/*&#32;Clear&#32;work&#32;area&#32;and&#32;reset&#32;write&#32;offset&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06106"/>06106 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clu&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Initialize&#32;FAT&#32;[0]&#32;and&#32;FAT[1]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06107"/>06107 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;i,&#32;0xFFFFFFF8);&#32;i&#32;+=&#32;4;&#32;clu++;
<anchor xml:id="_ff_8c_source_1l06108"/>06108 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;i,&#32;0xFFFFFFFF);&#32;i&#32;+=&#32;4;&#32;clu++;
<anchor xml:id="_ff_8c_source_1l06109"/>06109 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06110"/>06110 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;chains&#32;of&#32;bitmap,&#32;up-case&#32;and&#32;root&#32;dir&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06111"/>06111 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nbit&#32;!=&#32;0&#32;&amp;&amp;&#32;i&#32;&lt;&#32;sz_buf&#32;*&#32;ss)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;a&#32;chain&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06112"/>06112 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;i,&#32;(nbit&#32;&gt;&#32;1)&#32;?&#32;clu&#32;+&#32;1&#32;:&#32;0xFFFFFFFF);
<anchor xml:id="_ff_8c_source_1l06113"/>06113 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;4;&#32;clu++;&#32;nbit--;
<anchor xml:id="_ff_8c_source_1l06114"/>06114 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06115"/>06115 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(nbit&#32;==&#32;0&#32;&amp;&amp;&#32;j&#32;&lt;&#32;3)&#32;nbit&#32;=&#32;clen[j++];&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;next&#32;chain&#32;length&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06116"/>06116 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nbit&#32;!=&#32;0&#32;&amp;&amp;&#32;i&#32;&lt;&#32;sz_buf&#32;*&#32;ss);
<anchor xml:id="_ff_8c_source_1l06117"/>06117 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;the&#32;buffered&#32;data&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06118"/>06118 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06119"/>06119 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
<anchor xml:id="_ff_8c_source_1l06120"/>06120 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
<anchor xml:id="_ff_8c_source_1l06121"/>06121 
<anchor xml:id="_ff_8c_source_1l06122"/>06122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;root&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06123"/>06123 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);
<anchor xml:id="_ff_8c_source_1l06124"/>06124 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;0&#32;+&#32;0]&#32;=&#32;<link linkend="_ff_8c_1a9c991beac4793083d6bd370735bcb9c6">ET_VLABEL</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label&#32;entry&#32;(no&#32;label)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06125"/>06125 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1&#32;+&#32;0]&#32;=&#32;<link linkend="_ff_8c_1ab9becfd202f51394d189dffe291a5959">ET_BITMAP</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Bitmap&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06126"/>06126 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1&#32;+&#32;20,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06127"/>06127 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;1&#32;+&#32;24,&#32;szb_bit);&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06128"/>06128 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;0]&#32;=&#32;<link linkend="_ff_8c_1a25a8a4c5eb49dc0d306d0fa6011cd9af">ET_UPCASE</link>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Up-case&#32;table&#32;entry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06129"/>06129 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;4,&#32;sum);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;sum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06130"/>06130 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;20,&#32;2&#32;+&#32;clen[0]);&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06131"/>06131 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;*&#32;2&#32;+&#32;24,&#32;szb_case);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;&#32;size&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06132"/>06132 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_data&#32;+&#32;sz_au&#32;*&#32;(clen[0]&#32;+&#32;clen[1]);&#32;nsect&#32;=&#32;sz_au;&#32;<emphasis role="comment">/*&#32;Start&#32;of&#32;the&#32;root&#32;directory&#32;and&#32;number&#32;of&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06133"/>06133 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;root&#32;directory&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06134"/>06134 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;
<anchor xml:id="_ff_8c_source_1l06135"/>06135 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06136"/>06136 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);&#32;<emphasis role="comment">/*&#32;Rest&#32;of&#32;entries&#32;are&#32;filled&#32;with&#32;zero&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06137"/>06137 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
<anchor xml:id="_ff_8c_source_1l06138"/>06138 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
<anchor xml:id="_ff_8c_source_1l06139"/>06139 
<anchor xml:id="_ff_8c_source_1l06140"/>06140 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;two&#32;set&#32;of&#32;the&#32;exFAT&#32;VBR&#32;blocks&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06141"/>06141 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_vol;
<anchor xml:id="_ff_8c_source_1l06142"/>06142 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(n&#32;=&#32;0;&#32;n&#32;&lt;&#32;2;&#32;n++)&#32;{
<anchor xml:id="_ff_8c_source_1l06143"/>06143 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Main&#32;record&#32;(+0)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06144"/>06144 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l06145"/>06145 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">BS_JmpBoot</link>,&#32;<emphasis role="stringliteral">&quot;\xEB\x76\x90&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;EXFAT&#32;&#32;&#32;&quot;</emphasis>,&#32;11);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;jump&#32;code&#32;(x86),&#32;OEM&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06146"/>06146 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1ab09fe2e1cd6205eb848e5fd00374efd4">BPB_VolOfsEx</link>,&#32;b_vol);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;offset&#32;in&#32;the&#32;physical&#32;drive&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06147"/>06147 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_qword(buf&#32;+&#32;<link linkend="_ff_8c_1ac0c21531f17f5690b31622fcf98d3581">BPB_TotSecEx</link>,&#32;sz_vol);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06148"/>06148 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a12af2061024593ffc7a92daf1c2d3470">BPB_FatOfsEx</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(b_fat&#32;-&#32;b_vol));&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;offset&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06149"/>06149 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a54579961bdbed995bcb7e077fedff1f4">BPB_FatSzEx</link>,&#32;sz_fat);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06150"/>06150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ad3ab64cc288e66c0643af23094aa9645">BPB_DataOfsEx</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(b_data&#32;-&#32;b_vol));&#32;<emphasis role="comment">/*&#32;Data&#32;offset&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06151"/>06151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a5bb065cee85104cbb58390ea9dfa01d8">BPB_NumClusEx</link>,&#32;n_clst);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06152"/>06152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a8447a1c7d19cab308ab198e1de2e086f">BPB_RootClusEx</link>,&#32;2&#32;+&#32;clen[0]&#32;+&#32;clen[1]);&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;dir&#32;cluster&#32;#&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06153"/>06153 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a465d34bfcd2bf930e04ae1b379047199">BPB_VolIDEx</link>,&#32;vsn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06154"/>06154 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a86f95a0a4b798a61967e086540e6ebd9">BPB_FSVerEx</link>,&#32;0x100);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Filesystem&#32;version&#32;(1.00)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06155"/>06155 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(buf[<link linkend="_ff_8c_1a3d35e000a1033bb913d3fbc3aa5c68af">BPB_BytsPerSecEx</link>]&#32;=&#32;0,&#32;i&#32;=&#32;ss;&#32;i&#32;&gt;&gt;=&#32;1;&#32;buf[<link linkend="_ff_8c_1a3d35e000a1033bb913d3fbc3aa5c68af">BPB_BytsPerSecEx</link>]++)&#32;;&#32;<emphasis role="comment">/*&#32;Log2&#32;of&#32;sector&#32;size&#32;[byte]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06156"/>06156 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(buf[<link linkend="_ff_8c_1a64dfd457aa404e53c16d58a3d249adfe">BPB_SecPerClusEx</link>]&#32;=&#32;0,&#32;i&#32;=&#32;sz_au;&#32;i&#32;&gt;&gt;=&#32;1;&#32;buf[<link linkend="_ff_8c_1a64dfd457aa404e53c16d58a3d249adfe">BPB_SecPerClusEx</link>]++)&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Log2&#32;of&#32;cluster&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06157"/>06157 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a20cab50b62fe9cb5a99ce28cb54da60e">BPB_NumFATsEx</link>]&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06158"/>06158 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1ac926d7c74f368a033dc8240167df9bc0">BPB_DrvNumEx</link>]&#32;=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;(for&#32;int13)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06159"/>06159 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1adea4123eb450eb09933fac339b08eeee">BS_BootCodeEx</link>,&#32;0xFEEB);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;code&#32;(x86)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06160"/>06160 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Signature&#32;(placed&#32;here&#32;regardless&#32;of&#32;sector&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06161"/>06161 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;sum&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VBR&#32;checksum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06162"/>06162 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;!=&#32;<link linkend="_ff_8c_1af7b37995f89d832a47898aa787ecfbc8">BPB_VolFlagEx</link>&#32;&amp;&amp;&#32;i&#32;!=&#32;<link linkend="_ff_8c_1af7b37995f89d832a47898aa787ecfbc8">BPB_VolFlagEx</link>&#32;+&#32;1&#32;&amp;&amp;&#32;i&#32;!=&#32;<link linkend="_ff_8c_1a935b5f7cb38489adf96f42775583025b">BPB_PercInUseEx</link>)&#32;sum&#32;=&#32;xsum32(buf[i],&#32;sum);
<anchor xml:id="_ff_8c_source_1l06163"/>06163 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06164"/>06164 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06165"/>06165 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extended&#32;bootstrap&#32;record&#32;(+1..+8)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06166"/>06166 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l06167"/>06167 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;ss&#32;-&#32;2,&#32;0xAA55);&#32;&#32;<emphasis role="comment">/*&#32;Signature&#32;(placed&#32;at&#32;end&#32;of&#32;sector)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06168"/>06168 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;1;&#32;j&#32;&lt;&#32;9;&#32;j++)&#32;{
<anchor xml:id="_ff_8c_source_1l06169"/>06169 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;sum&#32;=&#32;xsum32(buf[i++],&#32;sum))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;VBR&#32;checksum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06170"/>06170 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06171"/>06171 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06172"/>06172 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;OEM/Reserved&#32;record&#32;(+9..+10)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06173"/>06173 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l06174"/>06174 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;j&#32;&lt;&#32;11;&#32;j++)&#32;{
<anchor xml:id="_ff_8c_source_1l06175"/>06175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;sum&#32;=&#32;xsum32(buf[i++],&#32;sum))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;VBR&#32;checksum&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06176"/>06176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06177"/>06177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06178"/>06178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sum&#32;record&#32;(+11)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06179"/>06179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;ss;&#32;i&#32;+=&#32;4)&#32;st_dword(buf&#32;+&#32;i,&#32;sum);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;with&#32;checksum&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06180"/>06180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect++,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06181"/>06181 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06182"/>06182 
<anchor xml:id="_ff_8c_source_1l06183"/>06183 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>
<anchor xml:id="_ff_8c_source_1l06184"/>06184 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_FS_EXFAT&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06185"/>06185 &#32;&#32;&#32;&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;an&#32;FAT/FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06186"/>06186 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06187"/>06187 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pau&#32;=&#32;sz_au;
<anchor xml:id="_ff_8c_source_1l06188"/>06188 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pre-determine&#32;number&#32;of&#32;clusters&#32;and&#32;FAT&#32;sub-type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06189"/>06189 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{&#32;<emphasis role="comment">/*&#32;FAT32&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06190"/>06190 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pau&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;AU&#32;auto-selection&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06191"/>06191 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;0x20000;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;unit&#32;of&#32;128KS&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06192"/>06192 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;pau&#32;=&#32;1;&#32;cst32[i]&#32;&amp;&amp;&#32;cst32[i]&#32;&lt;=&#32;n;&#32;i++,&#32;pau&#32;&lt;&lt;=&#32;1)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;from&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06193"/>06193 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06194"/>06194 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;pau;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06195"/>06195 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;=&#32;(n_clst&#32;*&#32;4&#32;+&#32;8&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06196"/>06196 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_rsv&#32;=&#32;32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;reserved&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06197"/>06197 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_dir&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;No&#32;static&#32;directory&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06198"/>06198 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&lt;=&#32;MAX_FAT16&#32;||&#32;n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a40e7471b7ae3620a0419aa4d8d6dc684">MAX_FAT32</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
<anchor xml:id="_ff_8c_source_1l06199"/>06199 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;volume&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06200"/>06200 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pau&#32;==&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;au&#32;auto-selection&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06201"/>06201 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;0x1000;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;unit&#32;of&#32;4KS&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06202"/>06202 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0,&#32;pau&#32;=&#32;1;&#32;cst[i]&#32;&amp;&amp;&#32;cst[i]&#32;&lt;=&#32;n;&#32;i++,&#32;pau&#32;&lt;&lt;=&#32;1)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;from&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06203"/>06203 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06204"/>06204 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;/&#32;pau;
<anchor xml:id="_ff_8c_source_1l06205"/>06205 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06206"/>06206 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;n_clst&#32;*&#32;2&#32;+&#32;4;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[byte]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06207"/>06207 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06208"/>06208 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>;
<anchor xml:id="_ff_8c_source_1l06209"/>06209 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(n_clst&#32;*&#32;3&#32;+&#32;1)&#32;/&#32;2&#32;+&#32;3;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[byte]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06210"/>06210 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06211"/>06211 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;=&#32;(n&#32;+&#32;ss&#32;-&#32;1)&#32;/&#32;ss;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06212"/>06212 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_rsv&#32;=&#32;1;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;reserved&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06213"/>06213 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_dir&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)n_root&#32;*&#32;<link linkend="_ff_8c_1a90943705ce4b32e47562c9f56860c7af">SZDIRE</link>&#32;/&#32;ss;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;dir&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06214"/>06214 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06215"/>06215 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_fat&#32;=&#32;b_vol&#32;+&#32;sz_rsv;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;base&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06216"/>06216 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;b_data&#32;=&#32;b_fat&#32;+&#32;sz_fat&#32;*&#32;n_fat&#32;+&#32;sz_dir;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Data&#32;base&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06217"/>06217 
<anchor xml:id="_ff_8c_source_1l06218"/>06218 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Align&#32;data&#32;area&#32;to&#32;erase&#32;block&#32;boundary&#32;(for&#32;flash&#32;memory&#32;media)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06219"/>06219 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(((b_data&#32;+&#32;sz_blk&#32;-&#32;1)&#32;&amp;&#32;~(sz_blk&#32;-&#32;1))&#32;-&#32;b_data);&#32;&#32;<emphasis role="comment">/*&#32;Sectors&#32;to&#32;next&#32;nearest&#32;from&#32;current&#32;data&#32;base&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06220"/>06220 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT32:&#32;Move&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06221"/>06221 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_rsv&#32;+=&#32;n;&#32;b_fat&#32;+=&#32;n;
<anchor xml:id="_ff_8c_source_1l06222"/>06222 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT:&#32;Expand&#32;FAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06223"/>06223 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;%&#32;n_fat)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;fractional&#32;error&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06224"/>06224 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n--;&#32;sz_rsv++;&#32;b_fat++;
<anchor xml:id="_ff_8c_source_1l06225"/>06225 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06226"/>06226 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_fat&#32;+=&#32;n&#32;/&#32;n_fat;
<anchor xml:id="_ff_8c_source_1l06227"/>06227 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06228"/>06228 
<anchor xml:id="_ff_8c_source_1l06229"/>06229 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;number&#32;of&#32;clusters&#32;and&#32;final&#32;check&#32;of&#32;validity&#32;of&#32;the&#32;FAT&#32;sub-type&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06230"/>06230 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;b_data&#32;+&#32;pau&#32;*&#32;16&#32;-&#32;b_vol)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;small&#32;volume?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06231"/>06231 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n_clst&#32;=&#32;((<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol&#32;-&#32;sz_rsv&#32;-&#32;sz_fat&#32;*&#32;n_fat&#32;-&#32;sz_dir)&#32;/&#32;pau;
<anchor xml:id="_ff_8c_source_1l06232"/>06232 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06233"/>06233 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&lt;=&#32;<link linkend="_ff_8c_1a259e5a1973d5209304482a5bcd89372f">MAX_FAT16</link>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;few&#32;clusters&#32;for&#32;FAT32?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06234"/>06234 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(sz_au&#32;=&#32;pau&#32;/&#32;2)&#32;!=&#32;0)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06235"/>06235 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
<anchor xml:id="_ff_8c_source_1l06236"/>06236 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06237"/>06237 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06238"/>06238 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06239"/>06239 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a259e5a1973d5209304482a5bcd89372f">MAX_FAT16</link>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;clusters&#32;for&#32;FAT16&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06240"/>06240 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(pau&#32;*&#32;2)&#32;&lt;=&#32;64)&#32;{
<anchor xml:id="_ff_8c_source_1l06241"/>06241 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sz_au&#32;=&#32;pau&#32;*&#32;2;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06242"/>06242 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06243"/>06243 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1aff61d3ed8f8c6ea5c25c3cb366320e08">FM_FAT32</link>))&#32;{
<anchor xml:id="_ff_8c_source_1l06244"/>06244 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fsty&#32;=&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Switch&#32;type&#32;to&#32;FAT32&#32;and&#32;retry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06245"/>06245 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06246"/>06246 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(sz_au&#32;=&#32;pau&#32;*&#32;2)&#32;&lt;=&#32;128)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06247"/>06247 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
<anchor xml:id="_ff_8c_source_1l06248"/>06248 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06249"/>06249 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;&#32;(n_clst&#32;&lt;=&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;{&#32;<emphasis role="comment">/*&#32;Too&#32;few&#32;clusters&#32;for&#32;FAT16&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06250"/>06250 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_au&#32;==&#32;0&#32;&amp;&amp;&#32;(sz_au&#32;=&#32;pau&#32;*&#32;2)&#32;&lt;=&#32;128)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Adjust&#32;cluster&#32;size&#32;and&#32;retry&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06251"/>06251 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);
<anchor xml:id="_ff_8c_source_1l06252"/>06252 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06253"/>06253 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06254"/>06254 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>&#32;&amp;&amp;&#32;n_clst&#32;&gt;&#32;<link linkend="_ff_8c_1a03962fce05a65b3e0ff6855d5436869f">MAX_FAT12</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca4b02760f758f5b1a89f445244fe9fbca">FR_MKFS_ABORTED</link>);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Too&#32;many&#32;clusters&#32;for&#32;FAT12&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06255"/>06255 
<anchor xml:id="_ff_8c_source_1l06256"/>06256 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Ok,&#32;it&#32;is&#32;the&#32;valid&#32;cluster&#32;configuration&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06257"/>06257 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06258"/>06258 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(1);
<anchor xml:id="_ff_8c_source_1l06259"/>06259 
<anchor xml:id="_ff_8c_source_1l06260"/>06260 <emphasis role="preprocessor">#if&#32;FF_USE_TRIM</emphasis>
<anchor xml:id="_ff_8c_source_1l06261"/>06261 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lba[0]&#32;=&#32;b_vol;&#32;lba[1]&#32;=&#32;b_vol&#32;+&#32;sz_vol&#32;-&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Inform&#32;storage&#32;device&#32;that&#32;the&#32;volume&#32;area&#32;may&#32;be&#32;erased&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06262"/>06262 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1af09fd84bea8d4e889e272471f44d60d6">CTRL_TRIM</link>,&#32;lba);
<anchor xml:id="_ff_8c_source_1l06263"/>06263 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06264"/>06264 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;FAT&#32;VBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06265"/>06265 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l06266"/>06266 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a664130f8583af5ccc48d5c79952cea8a">BS_JmpBoot</link>,&#32;<emphasis role="stringliteral">&quot;\xEB\xFE\x90&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;MSDOS5.0&quot;</emphasis>,&#32;11);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Boot&#32;jump&#32;code&#32;(x86),&#32;OEM&#32;name&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06267"/>06267 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a8551844b4eb4e15aecd8cc9aa3585fa2">BPB_BytsPerSec</link>,&#32;ss);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Sector&#32;size&#32;[byte]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06268"/>06268 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1aab78e41c617a14b9540c0563d6b957fa">BPB_SecPerClus</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)pau;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06269"/>06269 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1ab3ec444c8457c9bc98aa07e846f5c1b7">BPB_RsvdSecCnt</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)sz_rsv);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;reserved&#32;area&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06270"/>06270 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1af44a1e8c89ec5502595f23496d24cbf1">BPB_NumFATs</link>]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)n_fat;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FATs&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06271"/>06271 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1aaa667f14c87c45dc128f2ab208e92f98">BPB_RootEntCnt</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)((fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;?&#32;0&#32;:&#32;n_root));&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;directory&#32;entries&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06272"/>06272 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&lt;&#32;0x10000)&#32;{
<anchor xml:id="_ff_8c_source_1l06273"/>06273 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a4eb540eecde0f2df26fa8c7969341d68">BPB_TotSec16</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)sz_vol);&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;16-bit&#32;LBA&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06274"/>06274 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06275"/>06275 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a7723a9f0da553e8879d60909d85ccb7b">BPB_TotSec32</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)sz_vol);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;size&#32;in&#32;32-bit&#32;LBA&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06276"/>06276 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06277"/>06277 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a414e054c4b5ea3414ebefa3539e7e554">BPB_Media</link>]&#32;=&#32;0xF8;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Media&#32;descriptor&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06278"/>06278 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1ac71bb771432ea532bc47713a028ebd76">BPB_SecPerTrk</link>,&#32;63);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;sectors&#32;per&#32;track&#32;(for&#32;int13)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06279"/>06279 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a9c03603c3be34d4c5cc1b481b0bc6774">BPB_NumHeads</link>,&#32;255);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;heads&#32;(for&#32;int13)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06280"/>06280 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a449d4ed5c4c8105daf29aad9488277f7">BPB_HiddSec</link>,&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)b_vol);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;offset&#32;in&#32;the&#32;physical&#32;drive&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06281"/>06281 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06282"/>06282 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1abaa3aafdcf5e83f8cb7e2bb373b13525">BS_VolID32</link>,&#32;vsn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06283"/>06283 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a6e6340030dc29e7da2e9f92e472a763d">BPB_FATSz32</link>,&#32;sz_fat);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06284"/>06284 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a4c99b85429f73c8f6a0ac2bc7a1d81ea">BPB_RootClus32</link>,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Root&#32;directory&#32;cluster&#32;#&#32;(2)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06285"/>06285 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a86b761a0ed35d7f6e9774be44482ee5b">BPB_FSInfo32</link>,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;of&#32;FSINFO&#32;sector&#32;(VBR&#32;+&#32;1)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06286"/>06286 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a6fceac966c2f2b277e8f472c5a7de0c7">BPB_BkBootSec32</link>,&#32;6);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Offset&#32;of&#32;backup&#32;VBR&#32;(VBR&#32;+&#32;6)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06287"/>06287 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1aa670c7b495f5b347c442df67b188c58f">BS_DrvNum32</link>]&#32;=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;(for&#32;int13)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06288"/>06288 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a59c4b2f802ab4bc9319e5bd840e615b8">BS_BootSig32</link>]&#32;=&#32;0x29;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extended&#32;boot&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06289"/>06289 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a8241a49bce313184a58617ba1ad9e84c">BS_VolLab32</link>,&#32;<emphasis role="stringliteral">&quot;NO&#32;NAME&#32;&#32;&#32;&#32;&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;FAT32&#32;&#32;&#32;&quot;</emphasis>,&#32;19);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label,&#32;FAT&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06290"/>06290 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06291"/>06291 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a383a71bda500a0fb5a37f4edd785acbf">BS_VolID</link>,&#32;vsn);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;VSN&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06292"/>06292 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a60a2f6efeb6a4c7cb2da1e5def6ca43b">BPB_FATSz16</link>,&#32;(<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>)sz_fat);&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;size&#32;[sector]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06293"/>06293 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a0c51f7393341b839dfb241c2951f3ef4">BS_DrvNum</link>]&#32;=&#32;0x80;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Drive&#32;number&#32;(for&#32;int13)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06294"/>06294 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1a85a92e790602efef4da3a2f141611ce8">BS_BootSig</link>]&#32;=&#32;0x29;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Extended&#32;boot&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06295"/>06295 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memcpy(buf&#32;+&#32;<link linkend="_ff_8c_1a28498ba4b07ff90aaa9628e81fb89d32">BS_VolLab</link>,&#32;<emphasis role="stringliteral">&quot;NO&#32;NAME&#32;&#32;&#32;&#32;&quot;</emphasis>&#32;<emphasis role="stringliteral">&quot;FAT&#32;&#32;&#32;&#32;&#32;&quot;</emphasis>,&#32;19);&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;label,&#32;FAT&#32;signature&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06296"/>06296 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06297"/>06297 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Signature&#32;(offset&#32;is&#32;fixed&#32;here&#32;regardless&#32;of&#32;sector&#32;size)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06298"/>06298 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;to&#32;the&#32;VBR&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06299"/>06299 
<anchor xml:id="_ff_8c_source_1l06300"/>06300 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;FSINFO&#32;record&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06301"/>06301 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06302"/>06302 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol&#32;+&#32;6,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;backup&#32;VBR&#32;(VBR&#32;+&#32;6)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06303"/>06303 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);
<anchor xml:id="_ff_8c_source_1l06304"/>06304 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a318e58c1966aba52b90ab98dcb649883">FSI_LeadSig</link>,&#32;0x41615252);
<anchor xml:id="_ff_8c_source_1l06305"/>06305 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a3bac0e6ff5907873030db1d0a7c4ebef">FSI_StrucSig</link>,&#32;0x61417272);
<anchor xml:id="_ff_8c_source_1l06306"/>06306 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1ab711e50459aba01b11c6b46a7cc1410b">FSI_Free_Count</link>,&#32;n_clst&#32;-&#32;1);&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;free&#32;clusters&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06307"/>06307 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;<link linkend="_ff_8c_1a320700cedf300c9b418edf56e5e6b086">FSI_Nxt_Free</link>,&#32;2);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Last&#32;allocated&#32;cluster#&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06308"/>06308 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(buf&#32;+&#32;<link linkend="_ff_8c_1a74b810b3f3583c1eb54bd4305c0f261a">BS_55AA</link>,&#32;0xAA55);
<anchor xml:id="_ff_8c_source_1l06309"/>06309 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol&#32;+&#32;7,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;backup&#32;FSINFO&#32;(VBR&#32;+&#32;7)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06310"/>06310 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;b_vol&#32;+&#32;1,&#32;1);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;original&#32;FSINFO&#32;(VBR&#32;+&#32;1)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06311"/>06311 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06312"/>06312 
<anchor xml:id="_ff_8c_source_1l06313"/>06313 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;FAT&#32;area&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06314"/>06314 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;sz_buf&#32;*&#32;ss);
<anchor xml:id="_ff_8c_source_1l06315"/>06315 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;=&#32;b_fat;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT&#32;start&#32;sector&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06316"/>06316 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;i&#32;&lt;&#32;n_fat;&#32;i++)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;FATs&#32;each&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06317"/>06317 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06318"/>06318 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;0,&#32;0xFFFFFFF8);&#32;&#32;<emphasis role="comment">/*&#32;FAT[0]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06319"/>06319 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;4,&#32;0xFFFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;FAT[1]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06320"/>06320 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;8,&#32;0x0FFFFFFF);&#32;&#32;<emphasis role="comment">/*&#32;FAT[2]&#32;(root&#32;directory)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06321"/>06321 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06322"/>06322 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_dword(buf&#32;+&#32;0,&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1aab755aa1b4f81f4aabee4a5d4738cfb0">FS_FAT12</link>)&#32;?&#32;0xFFFFF8&#32;:&#32;0xFFFFFFF8);&#32;&#32;<emphasis role="comment">/*&#32;FAT[0]&#32;and&#32;FAT[1]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06323"/>06323 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06324"/>06324 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;=&#32;sz_fat;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;FAT&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06325"/>06325 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Fill&#32;FAT&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06326"/>06326 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;
<anchor xml:id="_ff_8c_source_1l06327"/>06327 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06328"/>06328 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;memset(buf,&#32;0,&#32;ss);&#32;<emphasis role="comment">/*&#32;Rest&#32;of&#32;FAT&#32;all&#32;are&#32;cleared&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06329"/>06329 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
<anchor xml:id="_ff_8c_source_1l06330"/>06330 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
<anchor xml:id="_ff_8c_source_1l06331"/>06331 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06332"/>06332 
<anchor xml:id="_ff_8c_source_1l06333"/>06333 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;root&#32;directory&#32;(fill&#32;with&#32;zero)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06334"/>06334 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nsect&#32;=&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;?&#32;pau&#32;:&#32;sz_dir;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;root&#32;directory&#32;sectors&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06335"/>06335 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06336"/>06336 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;(nsect&#32;&gt;&#32;sz_buf)&#32;?&#32;sz_buf&#32;:&#32;nsect;
<anchor xml:id="_ff_8c_source_1l06337"/>06337 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;sect,&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)n)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06338"/>06338 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sect&#32;+=&#32;n;&#32;nsect&#32;-=&#32;n;
<anchor xml:id="_ff_8c_source_1l06339"/>06339 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nsect);
<anchor xml:id="_ff_8c_source_1l06340"/>06340 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06341"/>06341 
<anchor xml:id="_ff_8c_source_1l06342"/>06342 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;FAT&#32;volume&#32;has&#32;been&#32;created&#32;here&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06343"/>06343 
<anchor xml:id="_ff_8c_source_1l06344"/>06344 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Determine&#32;system&#32;ID&#32;in&#32;the&#32;MBR&#32;partition&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06345"/>06345 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a4374b721b8019acc9761fdd8b829ccd0">FF_FS_EXFAT</link>&#32;&amp;&amp;&#32;fsty&#32;==&#32;<link linkend="_ff_8h_1a50bfa912e87473bc54333523983f39f6">FS_EXFAT</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06346"/>06346 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x07;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;exFAT&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06347"/>06347 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1ac63e0796095a789cefdbc3c3c676c9ce">FS_FAT32</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06348"/>06348 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x0C;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT32X&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06349"/>06349 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sz_vol&#32;&gt;=&#32;0x10000)&#32;{
<anchor xml:id="_ff_8c_source_1l06350"/>06350 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x06;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT12/16&#32;(large)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06351"/>06351 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsty&#32;==&#32;<link linkend="_ff_8h_1a7ef90a36d99edfc0138a2155a17a79b9">FS_FAT16</link>)&#32;{
<anchor xml:id="_ff_8c_source_1l06352"/>06352 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x04;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT16&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06353"/>06353 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06354"/>06354 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sys&#32;=&#32;0x01;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;FAT12&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06355"/>06355 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06356"/>06356 
<anchor xml:id="_ff_8c_source_1l06357"/>06357 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;partition&#32;information&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06358"/>06358 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a6f07d18b72c37af9fb5deda0e8a13131">FF_MULTI_PARTITION</link>&#32;&amp;&amp;&#32;ipart&#32;!=&#32;0)&#32;{&#32;<emphasis role="comment">/*&#32;Volume&#32;is&#32;in&#32;the&#32;existing&#32;partition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06359"/>06359 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ffconf_8h_1ab92e95c077afccc4d6f847cbf766e1cd">FF_LBA64</link>&#32;||&#32;!(fsopt&#32;&amp;&#32;0x80))&#32;{&#32;<emphasis role="comment">/*&#32;Is&#32;the&#32;partition&#32;in&#32;MBR?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06360"/>06360 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Update&#32;system&#32;ID&#32;in&#32;the&#32;partition&#32;table&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06361"/>06361 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1a0711b1d03b833e9d73b3be1a6397f461">disk_read</link>(pdrv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;&#32;<emphasis role="comment">/*&#32;Read&#32;the&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06362"/>06362 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;buf[<link linkend="_ff_8c_1ac3f187bf0ba891551f594af6b61f3188">MBR_Table</link>&#32;+&#32;(ipart&#32;-&#32;1)&#32;*&#32;<link linkend="_ff_8c_1af133060c47366e7e557d4085d931183f">SZ_PTE</link>&#32;+&#32;<link linkend="_ff_8c_1a71a2bd9498580394a97fe0b5246635d6">PTE_System</link>]&#32;=&#32;sys;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Set&#32;system&#32;ID&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06363"/>06363 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ac24448955ef914f54a499df1fb45689d">disk_write</link>(pdrv,&#32;buf,&#32;0,&#32;1)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;back&#32;to&#32;the&#32;MBR&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06364"/>06364 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06365"/>06365 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Volume&#32;as&#32;a&#32;new&#32;single&#32;partition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06366"/>06366 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!(fsopt&#32;&amp;&#32;<link linkend="_ff_8h_1a3b3d16ac135fe57669fc8a93dfa0c0a5">FM_SFD</link>))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;partition&#32;table&#32;if&#32;not&#32;in&#32;SFD&#32;format&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06367"/>06367 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;lba[0]&#32;=&#32;sz_vol;&#32;lba[1]&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06368"/>06368 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;res&#32;=&#32;create_partition(pdrv,&#32;lba,&#32;sys,&#32;buf);
<anchor xml:id="_ff_8c_source_1l06369"/>06369 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(res&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(res);
<anchor xml:id="_ff_8c_source_1l06370"/>06370 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06371"/>06371 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06372"/>06372 
<anchor xml:id="_ff_8c_source_1l06373"/>06373 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_fat_8c_1ab00fa450a811dbdabe3c655c1a36fab4">disk_ioctl</link>(pdrv,&#32;<link linkend="_diskio_8h_1a1b3c492f9aec325f0655941b75256f3c">CTRL_SYNC</link>,&#32;0)&#32;!=&#32;<link linkend="_diskio_8h_1aacdfef1dad6565f65c26d12fe0ea4b2ba2ea4b6ef3fffc17dd1d38ab5c2837737">RES_OK</link>)&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca97dee4a6b485dc8f91f37486092dfe34">FR_DISK_ERR</link>);
<anchor xml:id="_ff_8c_source_1l06374"/>06374 
<anchor xml:id="_ff_8c_source_1l06375"/>06375 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>);
<anchor xml:id="_ff_8c_source_1l06376"/>06376 }
<anchor xml:id="_ff_8c_source_1l06377"/>06377 
<anchor xml:id="_ff_8c_source_1l06378"/>06378 
<anchor xml:id="_ff_8c_source_1l06379"/>06379 
<anchor xml:id="_ff_8c_source_1l06380"/>06380 
<anchor xml:id="_ff_8c_source_1l06381"/>06381 <emphasis role="preprocessor">#if&#32;FF_MULTI_PARTITION</emphasis>
<anchor xml:id="_ff_8c_source_1l06382"/>06382 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06383"/>06383 <emphasis role="comment">/*&#32;Create&#32;Partition&#32;Table&#32;on&#32;the&#32;Physical&#32;Drive&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06384"/>06384 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06385"/>06385 
<anchor xml:id="_ff_8c_source_1l06386"/>06386 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a70461190a46edc96bb7baef1ab4dbd4d">f_fdisk</link>&#32;(
<anchor xml:id="_ff_8c_source_1l06387"/>06387 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;pdrv,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Physical&#32;drive&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06388"/>06388 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a1f3c30a83148a28340f009d4e583f087">LBA_t</link>&#32;ptbl[],&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;size&#32;table&#32;for&#32;each&#32;partitions&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06389"/>06389 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">void</emphasis>*&#32;work&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;working&#32;buffer&#32;(null:&#32;use&#32;heap&#32;memory)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06390"/>06390 )
<anchor xml:id="_ff_8c_source_1l06391"/>06391 {
<anchor xml:id="_ff_8c_source_1l06392"/>06392 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*buf&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>*)work;
<anchor xml:id="_ff_8c_source_1l06393"/>06393 &#32;&#32;&#32;&#32;<link linkend="_diskio_8h_1adba6790898ce4029c20a34b898ce73c1">DSTATUS</link>&#32;stat;
<anchor xml:id="_ff_8c_source_1l06394"/>06394 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;res;
<anchor xml:id="_ff_8c_source_1l06395"/>06395 
<anchor xml:id="_ff_8c_source_1l06396"/>06396 
<anchor xml:id="_ff_8c_source_1l06397"/>06397 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;the&#32;physical&#32;drive&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06398"/>06398 &#32;&#32;&#32;&#32;stat&#32;=&#32;<link linkend="_fat_8c_1a09cdaa6f36fa409bdf002727bff98eb1">disk_initialize</link>(pdrv);
<anchor xml:id="_ff_8c_source_1l06399"/>06399 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;&amp;&#32;<link linkend="_diskio_8h_1abd6503c70d862b979a3f7080a59e9acd">STA_NOINIT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac9894bed3e8632ede8d2712235fa8e45">FR_NOT_READY</link>;
<anchor xml:id="_ff_8c_source_1l06400"/>06400 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(stat&#32;&amp;&#32;<link linkend="_diskio_8h_1a9ec6dc5f6620a33fabe388d3a111ca8c">STA_PROTECT</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44cac3afbb423b1d4497229416812aff383b">FR_WRITE_PROTECTED</link>;
<anchor xml:id="_ff_8c_source_1l06401"/>06401 
<anchor xml:id="_ff_8c_source_1l06402"/>06402 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;==&#32;3</emphasis>
<anchor xml:id="_ff_8c_source_1l06403"/>06403 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!buf)&#32;buf&#32;=&#32;<link linkend="_ffsystem_8c_1ae63913186246b80cfce42dbab9e8bcab">ff_memalloc</link>(<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>);&#32;<emphasis role="comment">/*&#32;Use&#32;heap&#32;memory&#32;for&#32;working&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06404"/>06404 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06405"/>06405 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!buf)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44caf56a76a86602cbdeb2c4f3d00cfad21c">FR_NOT_ENOUGH_CORE</link>;
<anchor xml:id="_ff_8c_source_1l06406"/>06406 
<anchor xml:id="_ff_8c_source_1l06407"/>06407 &#32;&#32;&#32;&#32;res&#32;=&#32;create_partition(pdrv,&#32;ptbl,&#32;0x07,&#32;buf);&#32;&#32;<emphasis role="comment">/*&#32;Create&#32;partitions&#32;(system&#32;ID&#32;is&#32;temporary&#32;setting&#32;and&#32;determined&#32;by&#32;f_mkfs)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06408"/>06408 
<anchor xml:id="_ff_8c_source_1l06409"/>06409 &#32;&#32;&#32;&#32;<link linkend="_ff_8c_1aeeb83ea2531f2af57f2d9fa191ef4531">LEAVE_MKFS</link>(res);
<anchor xml:id="_ff_8c_source_1l06410"/>06410 }
<anchor xml:id="_ff_8c_source_1l06411"/>06411 
<anchor xml:id="_ff_8c_source_1l06412"/>06412 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_MULTI_PARTITION&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06413"/>06413 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;&amp;&amp;&#32;FF_USE_MKFS&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06414"/>06414 
<anchor xml:id="_ff_8c_source_1l06415"/>06415 
<anchor xml:id="_ff_8c_source_1l06416"/>06416 
<anchor xml:id="_ff_8c_source_1l06417"/>06417 
<anchor xml:id="_ff_8c_source_1l06418"/>06418 <emphasis role="preprocessor">#if&#32;FF_USE_STRFUNC</emphasis>
<anchor xml:id="_ff_8c_source_1l06419"/>06419 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;&amp;&amp;&#32;(FF_STRF_ENCODE&#32;&lt;&#32;0&#32;||&#32;FF_STRF_ENCODE&#32;&gt;&#32;3)</emphasis>
<anchor xml:id="_ff_8c_source_1l06420"/>06420 <emphasis role="preprocessor">#error&#32;Wrong&#32;FF_STRF_ENCODE&#32;setting</emphasis>
<anchor xml:id="_ff_8c_source_1l06421"/>06421 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06422"/>06422 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06423"/>06423 <emphasis role="comment">/*&#32;Get&#32;a&#32;String&#32;from&#32;the&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06424"/>06424 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06425"/>06425 
<anchor xml:id="_ff_8c_source_1l06426"/>06426 <link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;<link linkend="_ff_8h_1a4a47f14a554ff3a49fc122fe3e190f2f">f_gets</link>&#32;(
<anchor xml:id="_ff_8c_source_1l06427"/>06427 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;buff,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;buffer&#32;to&#32;store&#32;read&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06428"/>06428 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;len,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size&#32;of&#32;string&#32;buffer&#32;(items)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06429"/>06429 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06430"/>06430 )
<anchor xml:id="_ff_8c_source_1l06431"/>06431 {
<anchor xml:id="_ff_8c_source_1l06432"/>06432 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;nc&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06433"/>06433 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*p&#32;=&#32;buff;
<anchor xml:id="_ff_8c_source_1l06434"/>06434 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;s[4];
<anchor xml:id="_ff_8c_source_1l06435"/>06435 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;rc;
<anchor xml:id="_ff_8c_source_1l06436"/>06436 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dc;
<anchor xml:id="_ff_8c_source_1l06437"/>06437 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;&amp;&amp;&#32;FF_STRF_ENCODE&#32;&lt;=&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06438"/>06438 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;wc;
<anchor xml:id="_ff_8c_source_1l06439"/>06439 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06440"/>06440 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;&amp;&amp;&#32;FF_STRF_ENCODE&#32;==&#32;3</emphasis>
<anchor xml:id="_ff_8c_source_1l06441"/>06441 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;ct;
<anchor xml:id="_ff_8c_source_1l06442"/>06442 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06443"/>06443 
<anchor xml:id="_ff_8c_source_1l06444"/>06444 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;With&#32;code&#32;conversion&#32;(Unicode&#32;API)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06445"/>06445 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;room&#32;for&#32;the&#32;character&#32;and&#32;terminator&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06446"/>06446 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a95aeacb103bd1c4e03b3e154e450c534">FF_LFN_UNICODE</link>&#32;==&#32;1)&#32;len&#32;-=&#32;(<link linkend="_ffconf_8h_1a6ecc215308b4ead043b2e4e513ea203e">FF_STRF_ENCODE</link>&#32;==&#32;0)&#32;?&#32;1&#32;:&#32;2;
<anchor xml:id="_ff_8c_source_1l06447"/>06447 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a95aeacb103bd1c4e03b3e154e450c534">FF_LFN_UNICODE</link>&#32;==&#32;2)&#32;len&#32;-=&#32;(<link linkend="_ffconf_8h_1a6ecc215308b4ead043b2e4e513ea203e">FF_STRF_ENCODE</link>&#32;==&#32;0)&#32;?&#32;3&#32;:&#32;4;
<anchor xml:id="_ff_8c_source_1l06448"/>06448 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a95aeacb103bd1c4e03b3e154e450c534">FF_LFN_UNICODE</link>&#32;==&#32;3)&#32;len&#32;-=&#32;1;
<anchor xml:id="_ff_8c_source_1l06449"/>06449 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nc&#32;&lt;&#32;len)&#32;{
<anchor xml:id="_ff_8c_source_1l06450"/>06450 <emphasis role="preprocessor">#if&#32;FF_STRF_ENCODE&#32;==&#32;0&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Read&#32;a&#32;character&#32;in&#32;ANSI/OEM&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06451"/>06451 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;1,&#32;&amp;rc);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;code&#32;unit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06452"/>06452 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;1)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;EOF?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06453"/>06453 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;s[0];
<anchor xml:id="_ff_8c_source_1l06454"/>06454 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dbc_1st((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;DBC&#32;1st&#32;byte?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06455"/>06455 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;1,&#32;&amp;rc);&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;2nd&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06456"/>06456 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;1&#32;||&#32;!dbc_2nd(s[0]))&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06457"/>06457 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;wc&#32;&lt;&lt;&#32;8&#32;|&#32;s[0];
<anchor xml:id="_ff_8c_source_1l06458"/>06458 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06459"/>06459 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;<link linkend="_ffunicode_8c_1a52f09f31c84747cc135c90282509961a">ff_oem2uni</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;<emphasis role="comment">/*&#32;Convert&#32;ANSI/OEM&#32;into&#32;Unicode&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06460"/>06460 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;0)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Conversion&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06461"/>06461 <emphasis role="preprocessor">#elif&#32;FF_STRF_ENCODE&#32;==&#32;1&#32;||&#32;FF_STRF_ENCODE&#32;==&#32;2&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Read&#32;a&#32;character&#32;in&#32;UTF-16LE/BE&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06462"/>06462 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;2,&#32;&amp;rc);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;code&#32;unit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06463"/>06463 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;2)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;EOF?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06464"/>06464 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;(<link linkend="_ffconf_8h_1a6ecc215308b4ead043b2e4e513ea203e">FF_STRF_ENCODE</link>&#32;==&#32;1)&#32;?&#32;ld_word(s)&#32;:&#32;s[0]&#32;&lt;&lt;&#32;8&#32;|&#32;s[1];
<anchor xml:id="_ff_8c_source_1l06465"/>06465 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">IsSurrogateL</link>(dc))&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;<emphasis role="comment">/*&#32;Broken&#32;surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06466"/>06466 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1ad148073d4a74bdff0f86f2b18284b569">IsSurrogateH</link>(dc))&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;High&#32;surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06467"/>06467 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;2,&#32;&amp;rc);&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;low&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06468"/>06468 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;2)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;EOF?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06469"/>06469 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ffconf_8h_1a6ecc215308b4ead043b2e4e513ea203e">FF_STRF_ENCODE</link>&#32;==&#32;1)&#32;?&#32;ld_word(s)&#32;:&#32;s[0]&#32;&lt;&lt;&#32;8&#32;|&#32;s[1];
<anchor xml:id="_ff_8c_source_1l06470"/>06470 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">IsSurrogateL</link>(wc))&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Broken&#32;surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06471"/>06471 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;((dc&#32;&amp;&#32;0x3FF)&#32;+&#32;0x40)&#32;&lt;&lt;&#32;10&#32;|&#32;(wc&#32;&amp;&#32;0x3FF);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Merge&#32;surrogate&#32;pair&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06472"/>06472 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06473"/>06473 <emphasis role="preprocessor">#else&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Read&#32;a&#32;character&#32;in&#32;UTF-8&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06474"/>06474 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;1,&#32;&amp;rc);&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;code&#32;unit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06475"/>06475 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;1)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;EOF?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06476"/>06476 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;s[0];
<anchor xml:id="_ff_8c_source_1l06477"/>06477 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;&gt;=&#32;0x80)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Multi-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06478"/>06478 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ct&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06479"/>06479 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((dc&#32;&amp;&#32;0xE0)&#32;==&#32;0xC0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;2-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06480"/>06480 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;&amp;=&#32;0x1F;&#32;ct&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l06481"/>06481 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06482"/>06482 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((dc&#32;&amp;&#32;0xF0)&#32;==&#32;0xE0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;3-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06483"/>06483 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;&amp;=&#32;0x0F;&#32;ct&#32;=&#32;2;
<anchor xml:id="_ff_8c_source_1l06484"/>06484 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06485"/>06485 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((dc&#32;&amp;&#32;0xF8)&#32;==&#32;0xF0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;4-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06486"/>06486 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;&amp;=&#32;0x07;&#32;ct&#32;=&#32;3;
<anchor xml:id="_ff_8c_source_1l06487"/>06487 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06488"/>06488 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(ct&#32;==&#32;0)&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l06489"/>06489 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;ct,&#32;&amp;rc);&#32;<emphasis role="comment">/*&#32;Get&#32;trailing&#32;bytes&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06490"/>06490 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;ct)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06491"/>06491 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rc&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06492"/>06492 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Merge&#32;the&#32;byte&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06493"/>06493 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((s[rc]&#32;&amp;&#32;0xC0)&#32;!=&#32;0x80)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06494"/>06494 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;dc&#32;&lt;&lt;&#32;6&#32;|&#32;(s[rc]&#32;&amp;&#32;0x3F);
<anchor xml:id="_ff_8c_source_1l06495"/>06495 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(++rc&#32;&lt;&#32;ct);
<anchor xml:id="_ff_8c_source_1l06496"/>06496 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;ct&#32;||&#32;dc&#32;&lt;&#32;0x80&#32;||&#32;<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(dc)&#32;||&#32;dc&#32;&gt;=&#32;0x110000)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;encoding?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06497"/>06497 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06498"/>06498 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06499"/>06499 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;code&#32;point&#32;is&#32;avaialble&#32;in&#32;dc&#32;to&#32;be&#32;output&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06500"/>06500 
<anchor xml:id="_ff_8c_source_1l06501"/>06501 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a9870e2a5b84ce00fc47e0fd89b337495">FF_USE_STRFUNC</link>&#32;==&#32;2&#32;&amp;&amp;&#32;dc&#32;==&#32;<emphasis role="charliteral">&apos;\r&apos;</emphasis>)&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Strip&#32;\r&#32;off&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06502"/>06502 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;==&#32;1&#32;||&#32;FF_LFN_UNICODE&#32;==&#32;3&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Output&#32;it&#32;in&#32;UTF-16/32&#32;encoding&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06503"/>06503 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a95aeacb103bd1c4e03b3e154e450c534">FF_LFN_UNICODE</link>&#32;==&#32;1&#32;&amp;&amp;&#32;dc&#32;&gt;=&#32;0x10000)&#32;{&#32;<emphasis role="comment">/*&#32;Out&#32;of&#32;BMP&#32;at&#32;UTF-16?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06504"/>06504 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xD800&#32;|&#32;((dc&#32;&gt;&gt;&#32;10)&#32;-&#32;0x40));&#32;nc++;&#32;<emphasis role="comment">/*&#32;Make&#32;and&#32;output&#32;high&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06505"/>06505 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;0xDC00&#32;|&#32;(dc&#32;&amp;&#32;0x3FF);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;low&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06506"/>06506 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06507"/>06507 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)dc;&#32;nc++;
<anchor xml:id="_ff_8c_source_1l06508"/>06508 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;line?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06509"/>06509 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;2&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Output&#32;it&#32;in&#32;UTF-8&#32;encoding&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06510"/>06510 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;&lt;&#32;0x80)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Single&#32;byte?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06511"/>06511 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)dc;
<anchor xml:id="_ff_8c_source_1l06512"/>06512 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc++;
<anchor xml:id="_ff_8c_source_1l06513"/>06513 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;line?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06514"/>06514 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;&lt;&#32;0x800)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;2-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06515"/>06515 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xC0&#32;|&#32;(dc&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x1F));
<anchor xml:id="_ff_8c_source_1l06516"/>06516 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(dc&#32;&gt;&gt;&#32;0&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06517"/>06517 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l06518"/>06518 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;&lt;&#32;0x10000)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;3-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06519"/>06519 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xE0&#32;|&#32;(dc&#32;&gt;&gt;&#32;12&#32;&amp;&#32;0x0F));
<anchor xml:id="_ff_8c_source_1l06520"/>06520 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(dc&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06521"/>06521 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(dc&#32;&gt;&gt;&#32;0&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06522"/>06522 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc&#32;+=&#32;3;
<anchor xml:id="_ff_8c_source_1l06523"/>06523 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;4-byte&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06524"/>06524 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0xF0&#32;|&#32;(dc&#32;&gt;&gt;&#32;18&#32;&amp;&#32;0x07));
<anchor xml:id="_ff_8c_source_1l06525"/>06525 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(dc&#32;&gt;&gt;&#32;12&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06526"/>06526 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(dc&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06527"/>06527 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)(0x80&#32;|&#32;(dc&#32;&gt;&gt;&#32;0&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06528"/>06528 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc&#32;+=&#32;4;
<anchor xml:id="_ff_8c_source_1l06529"/>06529 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06530"/>06530 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06531"/>06531 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06532"/>06532 
<anchor xml:id="_ff_8c_source_1l06533"/>06533 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Byte-by-byte&#32;read&#32;without&#32;any&#32;conversion&#32;(ANSI/OEM&#32;API)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06534"/>06534 &#32;&#32;&#32;&#32;len&#32;-=&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;room&#32;for&#32;the&#32;terminator&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06535"/>06535 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(nc&#32;&lt;&#32;len)&#32;{
<anchor xml:id="_ff_8c_source_1l06536"/>06536 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ac4c3dcb6869ca252888eebabe39727b3">f_read</link>(fp,&#32;s,&#32;1,&#32;&amp;rc);&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06537"/>06537 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(rc&#32;!=&#32;1)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;EOF?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06538"/>06538 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dc&#32;=&#32;s[0];
<anchor xml:id="_ff_8c_source_1l06539"/>06539 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a9870e2a5b84ce00fc47e0fd89b337495">FF_USE_STRFUNC</link>&#32;==&#32;2&#32;&amp;&amp;&#32;dc&#32;==&#32;<emphasis role="charliteral">&apos;\r&apos;</emphasis>)&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l06540"/>06540 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*p++&#32;=&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)dc;&#32;nc++;
<anchor xml:id="_ff_8c_source_1l06541"/>06541 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>)&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06542"/>06542 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06543"/>06543 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06544"/>06544 
<anchor xml:id="_ff_8c_source_1l06545"/>06545 &#32;&#32;&#32;&#32;*p&#32;=&#32;0;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Terminate&#32;the&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06546"/>06546 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;nc&#32;?&#32;buff&#32;:&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;When&#32;no&#32;data&#32;read&#32;due&#32;to&#32;EOF&#32;or&#32;error,&#32;return&#32;with&#32;error.&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06547"/>06547 }
<anchor xml:id="_ff_8c_source_1l06548"/>06548 
<anchor xml:id="_ff_8c_source_1l06549"/>06549 
<anchor xml:id="_ff_8c_source_1l06550"/>06550 
<anchor xml:id="_ff_8c_source_1l06551"/>06551 
<anchor xml:id="_ff_8c_source_1l06552"/>06552 <emphasis role="preprocessor">#if&#32;!FF_FS_READONLY</emphasis>
<anchor xml:id="_ff_8c_source_1l06553"/>06553 <emphasis role="preprocessor">#include&#32;&lt;stdarg.h&gt;</emphasis>
<anchor xml:id="_ff_8c_source_1l06554"/>06554 <emphasis role="preprocessor">#define&#32;SZ_PUTC_BUF&#32;64</emphasis>
<anchor xml:id="_ff_8c_source_1l06555"/>06555 <emphasis role="preprocessor">#define&#32;SZ_NUM_BUF&#32;&#32;32</emphasis>
<anchor xml:id="_ff_8c_source_1l06556"/>06556 
<anchor xml:id="_ff_8c_source_1l06557"/>06557 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06558"/>06558 <emphasis role="comment">/*&#32;Put&#32;a&#32;Character&#32;to&#32;the&#32;File&#32;(with&#32;sub-functions)&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06559"/>06559 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06560"/>06560 
<anchor xml:id="_ff_8c_source_1l06561"/>06561 <emphasis role="comment">/*&#32;Output&#32;buffer&#32;and&#32;work&#32;area&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06562"/>06562 
<anchor xml:id="_ff_8c_source_1l06563"/>06563 <emphasis role="keyword">typedef</emphasis>&#32;<emphasis role="keyword">struct&#32;</emphasis>{
<anchor xml:id="_ff_8c_source_1l06564"/>06564 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>&#32;*fp;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Ptr&#32;to&#32;the&#32;writing&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06565"/>06565 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;idx,&#32;nchr;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;index&#32;of&#32;buf[]&#32;(-1:error),&#32;number&#32;of&#32;encoding&#32;units&#32;written&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06566"/>06566 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;==&#32;1</emphasis>
<anchor xml:id="_ff_8c_source_1l06567"/>06567 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;hs;
<anchor xml:id="_ff_8c_source_1l06568"/>06568 <emphasis role="preprocessor">#elif&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06569"/>06569 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;bs[4];
<anchor xml:id="_ff_8c_source_1l06570"/>06570 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;wi,&#32;ct;
<anchor xml:id="_ff_8c_source_1l06571"/>06571 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06572"/>06572 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;buf[SZ_PUTC_BUF];&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06573"/>06573 }&#32;putbuff;
<anchor xml:id="_ff_8c_source_1l06574"/>06574 
<anchor xml:id="_ff_8c_source_1l06575"/>06575 
<anchor xml:id="_ff_8c_source_1l06576"/>06576 <emphasis role="comment">/*&#32;Buffered&#32;file&#32;write&#32;with&#32;code&#32;conversion&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06577"/>06577 
<anchor xml:id="_ff_8c_source_1l06578"/>06578 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;putc_bfd&#32;(putbuff*&#32;pb,&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;c)
<anchor xml:id="_ff_8c_source_1l06579"/>06579 {
<anchor xml:id="_ff_8c_source_1l06580"/>06580 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;n;
<anchor xml:id="_ff_8c_source_1l06581"/>06581 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;i,&#32;nc;
<anchor xml:id="_ff_8c_source_1l06582"/>06582 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE</emphasis>
<anchor xml:id="_ff_8c_source_1l06583"/>06583 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>&#32;hs,&#32;wc;
<anchor xml:id="_ff_8c_source_1l06584"/>06584 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06585"/>06585 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;dc;
<anchor xml:id="_ff_8c_source_1l06586"/>06586 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;tp;
<anchor xml:id="_ff_8c_source_1l06587"/>06587 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06588"/>06588 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06589"/>06589 
<anchor xml:id="_ff_8c_source_1l06590"/>06590 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ffconf_8h_1a9870e2a5b84ce00fc47e0fd89b337495">FF_USE_STRFUNC</link>&#32;==&#32;2&#32;&amp;&amp;&#32;c&#32;==&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;LF&#32;-&gt;&#32;CRLF&#32;conversion&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06591"/>06591 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(pb,&#32;<emphasis role="charliteral">&apos;\r&apos;</emphasis>);
<anchor xml:id="_ff_8c_source_1l06592"/>06592 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06593"/>06593 
<anchor xml:id="_ff_8c_source_1l06594"/>06594 &#32;&#32;&#32;&#32;i&#32;=&#32;pb-&gt;idx;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;index&#32;of&#32;pb-&gt;buf[]&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06595"/>06595 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&lt;&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;In&#32;write&#32;error?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06596"/>06596 &#32;&#32;&#32;&#32;nc&#32;=&#32;pb-&gt;nchr;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;unit&#32;counter&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06597"/>06597 
<anchor xml:id="_ff_8c_source_1l06598"/>06598 <emphasis role="preprocessor">#if&#32;FF_USE_LFN&#32;&amp;&amp;&#32;FF_LFN_UNICODE</emphasis>
<anchor xml:id="_ff_8c_source_1l06599"/>06599 <emphasis role="preprocessor">#if&#32;FF_LFN_UNICODE&#32;==&#32;1&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-16&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06600"/>06600 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1ad148073d4a74bdff0f86f2b18284b569">IsSurrogateH</link>(c))&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;this&#32;a&#32;high-surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06601"/>06601 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;hs&#32;=&#32;c;&#32;<emphasis role="keywordflow">return</emphasis>;&#32;<emphasis role="comment">/*&#32;Save&#32;it&#32;for&#32;next&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06602"/>06602 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06603"/>06603 &#32;&#32;&#32;&#32;hs&#32;=&#32;pb-&gt;hs;&#32;pb-&gt;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06604"/>06604 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;there&#32;a&#32;leading&#32;high-surrogate?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06605"/>06605 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!<link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">IsSurrogateL</link>(c))&#32;hs&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Discard&#32;high-surrogate&#32;if&#32;not&#32;a&#32;surrogate&#32;pair&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06606"/>06606 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06607"/>06607 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a7a67adc6a71fa08dbbe481ad756849c4">IsSurrogateL</link>(c))&#32;<emphasis role="keywordflow">return</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Discard&#32;stray&#32;low-surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06608"/>06608 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06609"/>06609 &#32;&#32;&#32;&#32;wc&#32;=&#32;c;
<anchor xml:id="_ff_8c_source_1l06610"/>06610 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-8&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06611"/>06611 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l06612"/>06612 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(pb-&gt;ct&#32;==&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Out&#32;of&#32;multi-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06613"/>06613 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;bs[pb-&gt;wi&#32;=&#32;0]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Save&#32;1st&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06614"/>06614 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c&#32;&lt;&#32;0x80)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Single&#32;byte&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06615"/>06615 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c&#32;&amp;&#32;0xE0)&#32;==&#32;0xC0)&#32;pb-&gt;ct&#32;=&#32;1;&#32;&#32;&#32;<emphasis role="comment">/*&#32;2-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06616"/>06616 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c&#32;&amp;&#32;0xF0)&#32;==&#32;0xE0)&#32;pb-&gt;ct&#32;=&#32;2;&#32;&#32;&#32;<emphasis role="comment">/*&#32;3-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06617"/>06617 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c&#32;&amp;&#32;0xF8)&#32;==&#32;0xF0)&#32;pb-&gt;ct&#32;=&#32;3;&#32;&#32;&#32;<emphasis role="comment">/*&#32;4-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06618"/>06618 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;leading&#32;byte&#32;(discard&#32;it)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06619"/>06619 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;In&#32;the&#32;multi-byte&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06620"/>06620 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(((<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c&#32;&amp;&#32;0xC0)&#32;!=&#32;0x80)&#32;{&#32;<emphasis role="comment">/*&#32;Broken&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06621"/>06621 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;ct&#32;=&#32;0;&#32;<emphasis role="keywordflow">continue</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Discard&#32;the&#32;sequense&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06622"/>06622 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06623"/>06623 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;bs[++pb-&gt;wi]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c;&#32;<emphasis role="comment">/*&#32;Save&#32;the&#32;trailing&#32;byte&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06624"/>06624 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(--pb-&gt;ct&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;the&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06625"/>06625 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_ff_8c_source_1l06626"/>06626 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06627"/>06627 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06628"/>06628 &#32;&#32;&#32;&#32;tp&#32;=&#32;(<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*)pb-&gt;bs;
<anchor xml:id="_ff_8c_source_1l06629"/>06629 &#32;&#32;&#32;&#32;dc&#32;=&#32;tchar2uni(&amp;tp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;UTF-8&#32;==&gt;&#32;UTF-16&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06630"/>06630 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(dc&#32;==&#32;0xFFFFFFFF)&#32;<emphasis role="keywordflow">return</emphasis>;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Wrong&#32;code?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06631"/>06631 &#32;&#32;&#32;&#32;hs&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(dc&#32;&gt;&gt;&#32;16);
<anchor xml:id="_ff_8c_source_1l06632"/>06632 &#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)dc;
<anchor xml:id="_ff_8c_source_1l06633"/>06633 <emphasis role="preprocessor">#elif&#32;FF_LFN_UNICODE&#32;==&#32;3&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;UTF-32&#32;input&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06634"/>06634 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(<link linkend="_ff_8c_1a1678f40df73ed6cd30ed3e837b3558e7">IsSurrogate</link>(c)&#32;||&#32;c&#32;&gt;=&#32;0x110000)&#32;<emphasis role="keywordflow">return</emphasis>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Discard&#32;invalid&#32;code&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06635"/>06635 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(c&#32;&gt;=&#32;0x10000)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Out&#32;of&#32;BMP?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06636"/>06636 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)(0xD800&#32;|&#32;((c&#32;&gt;&gt;&#32;10)&#32;-&#32;0x40));&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;high&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06637"/>06637 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;0xDC00&#32;|&#32;(c&#32;&amp;&#32;0x3FF);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;low&#32;surrogate&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06638"/>06638 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06639"/>06639 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06640"/>06640 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;wc&#32;=&#32;(<link linkend="_ff_8h_1a0bb095da65fbe52192dd9e3e643c7568">WCHAR</link>)c;
<anchor xml:id="_ff_8c_source_1l06641"/>06641 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06642"/>06642 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06643"/>06643 &#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;code&#32;point&#32;in&#32;UTF-16&#32;is&#32;available&#32;in&#32;hs&#32;and&#32;wc&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06644"/>06644 
<anchor xml:id="_ff_8c_source_1l06645"/>06645 <emphasis role="preprocessor">#if&#32;FF_STRF_ENCODE&#32;==&#32;1&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Write&#32;a&#32;code&#32;point&#32;in&#32;UTF-16LE&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06646"/>06646 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06647"/>06647 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;st_word(&amp;pb-&gt;buf[i],&#32;hs);
<anchor xml:id="_ff_8c_source_1l06648"/>06648 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l06649"/>06649 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc++;
<anchor xml:id="_ff_8c_source_1l06650"/>06650 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06651"/>06651 &#32;&#32;&#32;&#32;st_word(&amp;pb-&gt;buf[i],&#32;wc);
<anchor xml:id="_ff_8c_source_1l06652"/>06652 &#32;&#32;&#32;&#32;i&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l06653"/>06653 <emphasis role="preprocessor">#elif&#32;FF_STRF_ENCODE&#32;==&#32;2&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Write&#32;a&#32;code&#32;point&#32;in&#32;UTF-16BE&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06654"/>06654 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Surrogate&#32;pair?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06655"/>06655 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(hs&#32;&gt;&gt;&#32;8);
<anchor xml:id="_ff_8c_source_1l06656"/>06656 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)hs;
<anchor xml:id="_ff_8c_source_1l06657"/>06657 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc++;
<anchor xml:id="_ff_8c_source_1l06658"/>06658 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06659"/>06659 &#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(wc&#32;&gt;&gt;&#32;8);
<anchor xml:id="_ff_8c_source_1l06660"/>06660 &#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc;
<anchor xml:id="_ff_8c_source_1l06661"/>06661 <emphasis role="preprocessor">#elif&#32;FF_STRF_ENCODE&#32;==&#32;3&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Write&#32;a&#32;code&#32;point&#32;in&#32;UTF-8&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06662"/>06662 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;4-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06663"/>06663 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc&#32;+=&#32;3;
<anchor xml:id="_ff_8c_source_1l06664"/>06664 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;hs&#32;=&#32;(hs&#32;&amp;&#32;0x3FF)&#32;+&#32;0x40;
<anchor xml:id="_ff_8c_source_1l06665"/>06665 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0xF0&#32;|&#32;hs&#32;&gt;&gt;&#32;8);
<anchor xml:id="_ff_8c_source_1l06666"/>06666 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0x80&#32;|&#32;(hs&#32;&gt;&gt;&#32;2&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06667"/>06667 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0x80&#32;|&#32;(hs&#32;&amp;&#32;3)&#32;&lt;&lt;&#32;4&#32;|&#32;(wc&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x0F));
<anchor xml:id="_ff_8c_source_1l06668"/>06668 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0x80&#32;|&#32;(wc&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06669"/>06669 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06670"/>06670 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&lt;&#32;0x80)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Single&#32;byte?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06671"/>06671 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc;
<anchor xml:id="_ff_8c_source_1l06672"/>06672 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06673"/>06673 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&lt;&#32;0x800)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;2-byte&#32;sequence?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06674"/>06674 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc&#32;+=&#32;1;
<anchor xml:id="_ff_8c_source_1l06675"/>06675 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0xC0&#32;|&#32;wc&#32;&gt;&gt;&#32;6);
<anchor xml:id="_ff_8c_source_1l06676"/>06676 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;3-byte&#32;sequence&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06677"/>06677 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;nc&#32;+=&#32;2;
<anchor xml:id="_ff_8c_source_1l06678"/>06678 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0xE0&#32;|&#32;wc&#32;&gt;&gt;&#32;12);
<anchor xml:id="_ff_8c_source_1l06679"/>06679 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0x80&#32;|&#32;(wc&#32;&gt;&gt;&#32;6&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06680"/>06680 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06681"/>06681 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(0x80&#32;|&#32;(wc&#32;&amp;&#32;0x3F));
<anchor xml:id="_ff_8c_source_1l06682"/>06682 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06683"/>06683 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06684"/>06684 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;Write&#32;a&#32;code&#32;point&#32;in&#32;ANSI/OEM&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06685"/>06685 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(hs&#32;!=&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_ff_8c_source_1l06686"/>06686 &#32;&#32;&#32;&#32;wc&#32;=&#32;<link linkend="_ffunicode_8c_1a72914966e82f8df3504a3659834f2abe">ff_uni2oem</link>(wc,&#32;<link linkend="_ff_8c_1a0532865fc94e93704941f95e9425ccb9">CODEPAGE</link>);&#32;&#32;<emphasis role="comment">/*&#32;UTF-16&#32;==&gt;&#32;ANSI/OEM&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06687"/>06687 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;==&#32;0)&#32;<emphasis role="keywordflow">return</emphasis>;
<anchor xml:id="_ff_8c_source_1l06688"/>06688 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(wc&#32;&gt;=&#32;0x100)&#32;{
<anchor xml:id="_ff_8c_source_1l06689"/>06689 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)(wc&#32;&gt;&gt;&#32;8);&#32;nc++;
<anchor xml:id="_ff_8c_source_1l06690"/>06690 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06691"/>06691 &#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)wc;
<anchor xml:id="_ff_8c_source_1l06692"/>06692 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06693"/>06693 
<anchor xml:id="_ff_8c_source_1l06694"/>06694 <emphasis role="preprocessor">#else&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</emphasis><emphasis role="comment">/*&#32;ANSI/OEM&#32;input&#32;(without&#32;re-encoding)&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06695"/>06695 &#32;&#32;&#32;&#32;pb-&gt;buf[i++]&#32;=&#32;(<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>)c;
<anchor xml:id="_ff_8c_source_1l06696"/>06696 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06697"/>06697 
<anchor xml:id="_ff_8c_source_1l06698"/>06698 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(i&#32;&gt;=&#32;(<emphasis role="keywordtype">int</emphasis>)(<emphasis role="keyword">sizeof</emphasis>&#32;pb-&gt;buf)&#32;-&#32;4)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;buffered&#32;characters&#32;to&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06699"/>06699 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<link linkend="_ff_8c_1ae6a4dfae8a9e308bdb2283a37ef680f2">f_write</link>(pb-&gt;fp,&#32;pb-&gt;buf,&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)i,&#32;&amp;n);
<anchor xml:id="_ff_8c_source_1l06700"/>06700 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;(n&#32;==&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)i)&#32;?&#32;0&#32;:&#32;-1;
<anchor xml:id="_ff_8c_source_1l06701"/>06701 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06702"/>06702 &#32;&#32;&#32;&#32;pb-&gt;idx&#32;=&#32;i;
<anchor xml:id="_ff_8c_source_1l06703"/>06703 &#32;&#32;&#32;&#32;pb-&gt;nchr&#32;=&#32;nc&#32;+&#32;1;
<anchor xml:id="_ff_8c_source_1l06704"/>06704 }
<anchor xml:id="_ff_8c_source_1l06705"/>06705 
<anchor xml:id="_ff_8c_source_1l06706"/>06706 
<anchor xml:id="_ff_8c_source_1l06707"/>06707 <emphasis role="comment">/*&#32;Flush&#32;remaining&#32;characters&#32;in&#32;the&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06708"/>06708 
<anchor xml:id="_ff_8c_source_1l06709"/>06709 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;putc_flush&#32;(putbuff*&#32;pb)
<anchor xml:id="_ff_8c_source_1l06710"/>06710 {
<anchor xml:id="_ff_8c_source_1l06711"/>06711 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;nw;
<anchor xml:id="_ff_8c_source_1l06712"/>06712 
<anchor xml:id="_ff_8c_source_1l06713"/>06713 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(&#32;&#32;&#32;pb-&gt;idx&#32;&gt;=&#32;0&#32;<emphasis role="comment">/*&#32;Flush&#32;buffered&#32;characters&#32;to&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06714"/>06714 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;<link linkend="_ff_8c_1ae6a4dfae8a9e308bdb2283a37ef680f2">f_write</link>(pb-&gt;fp,&#32;pb-&gt;buf,&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)pb-&gt;idx,&#32;&amp;nw)&#32;==&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>
<anchor xml:id="_ff_8c_source_1l06715"/>06715 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&amp;&amp;&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)pb-&gt;idx&#32;==&#32;nw)&#32;<emphasis role="keywordflow">return</emphasis>&#32;pb-&gt;nchr;
<anchor xml:id="_ff_8c_source_1l06716"/>06716 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;-1;
<anchor xml:id="_ff_8c_source_1l06717"/>06717 }
<anchor xml:id="_ff_8c_source_1l06718"/>06718 
<anchor xml:id="_ff_8c_source_1l06719"/>06719 
<anchor xml:id="_ff_8c_source_1l06720"/>06720 <emphasis role="comment">/*&#32;Initialize&#32;write&#32;buffer&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06721"/>06721 
<anchor xml:id="_ff_8c_source_1l06722"/>06722 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;putc_init&#32;(putbuff*&#32;pb,&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp)
<anchor xml:id="_ff_8c_source_1l06723"/>06723 {
<anchor xml:id="_ff_8c_source_1l06724"/>06724 &#32;&#32;&#32;&#32;memset(pb,&#32;0,&#32;<emphasis role="keyword">sizeof</emphasis>&#32;(putbuff));
<anchor xml:id="_ff_8c_source_1l06725"/>06725 &#32;&#32;&#32;&#32;pb-&gt;fp&#32;=&#32;fp;
<anchor xml:id="_ff_8c_source_1l06726"/>06726 }
<anchor xml:id="_ff_8c_source_1l06727"/>06727 
<anchor xml:id="_ff_8c_source_1l06728"/>06728 
<anchor xml:id="_ff_8c_source_1l06729"/>06729 
<anchor xml:id="_ff_8c_source_1l06730"/>06730 <emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_ff_8h_1ad1d73b8d01c2ef89eddf920b7fcc6beb">f_putc</link>&#32;(
<anchor xml:id="_ff_8c_source_1l06731"/>06731 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;c,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;character&#32;to&#32;be&#32;output&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06732"/>06732 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06733"/>06733 )
<anchor xml:id="_ff_8c_source_1l06734"/>06734 {
<anchor xml:id="_ff_8c_source_1l06735"/>06735 &#32;&#32;&#32;&#32;putbuff&#32;pb;
<anchor xml:id="_ff_8c_source_1l06736"/>06736 
<anchor xml:id="_ff_8c_source_1l06737"/>06737 
<anchor xml:id="_ff_8c_source_1l06738"/>06738 &#32;&#32;&#32;&#32;putc_init(&amp;pb,&#32;fp);
<anchor xml:id="_ff_8c_source_1l06739"/>06739 &#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;c);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;the&#32;character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06740"/>06740 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;putc_flush(&amp;pb);
<anchor xml:id="_ff_8c_source_1l06741"/>06741 }
<anchor xml:id="_ff_8c_source_1l06742"/>06742 
<anchor xml:id="_ff_8c_source_1l06743"/>06743 
<anchor xml:id="_ff_8c_source_1l06744"/>06744 
<anchor xml:id="_ff_8c_source_1l06745"/>06745 
<anchor xml:id="_ff_8c_source_1l06746"/>06746 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06747"/>06747 <emphasis role="comment">/*&#32;Put&#32;a&#32;String&#32;to&#32;the&#32;File&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06748"/>06748 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06749"/>06749 
<anchor xml:id="_ff_8c_source_1l06750"/>06750 <emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_ff_8h_1a699fc03ffa785ceab8812a7f204421f3">f_puts</link>&#32;(
<anchor xml:id="_ff_8c_source_1l06751"/>06751 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;str,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;string&#32;to&#32;be&#32;output&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06752"/>06752 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06753"/>06753 )
<anchor xml:id="_ff_8c_source_1l06754"/>06754 {
<anchor xml:id="_ff_8c_source_1l06755"/>06755 &#32;&#32;&#32;&#32;putbuff&#32;pb;
<anchor xml:id="_ff_8c_source_1l06756"/>06756 
<anchor xml:id="_ff_8c_source_1l06757"/>06757 
<anchor xml:id="_ff_8c_source_1l06758"/>06758 &#32;&#32;&#32;&#32;putc_init(&amp;pb,&#32;fp);
<anchor xml:id="_ff_8c_source_1l06759"/>06759 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(*str)&#32;putc_bfd(&amp;pb,&#32;*str++);&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;the&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06760"/>06760 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;putc_flush(&amp;pb);
<anchor xml:id="_ff_8c_source_1l06761"/>06761 }
<anchor xml:id="_ff_8c_source_1l06762"/>06762 
<anchor xml:id="_ff_8c_source_1l06763"/>06763 
<anchor xml:id="_ff_8c_source_1l06764"/>06764 
<anchor xml:id="_ff_8c_source_1l06765"/>06765 
<anchor xml:id="_ff_8c_source_1l06766"/>06766 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06767"/>06767 <emphasis role="comment">/*&#32;Put&#32;a&#32;Formatted&#32;String&#32;to&#32;the&#32;File&#32;(with&#32;sub-functions)&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06768"/>06768 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06769"/>06769 <emphasis role="preprocessor">#if&#32;FF_PRINT_FLOAT&#32;&amp;&amp;&#32;FF_INTDEF&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06770"/>06770 <emphasis role="preprocessor">#include&#32;&lt;math.h&gt;</emphasis>
<anchor xml:id="_ff_8c_source_1l06771"/>06771 
<anchor xml:id="_ff_8c_source_1l06772"/>06772 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;ilog10&#32;(<emphasis role="keywordtype">double</emphasis>&#32;n)&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Calculate&#32;log10(n)&#32;in&#32;integer&#32;output&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06773"/>06773 {
<anchor xml:id="_ff_8c_source_1l06774"/>06774 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;rv&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06775"/>06775 
<anchor xml:id="_ff_8c_source_1l06776"/>06776 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n&#32;&gt;=&#32;10)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decimate&#32;digit&#32;in&#32;right&#32;shift&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06777"/>06777 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&gt;=&#32;100000)&#32;{
<anchor xml:id="_ff_8c_source_1l06778"/>06778 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;/=&#32;100000;&#32;rv&#32;+=&#32;5;
<anchor xml:id="_ff_8c_source_1l06779"/>06779 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06780"/>06780 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;/=&#32;10;&#32;rv++;
<anchor xml:id="_ff_8c_source_1l06781"/>06781 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06782"/>06782 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06783"/>06783 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n&#32;&lt;&#32;1)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decimate&#32;digit&#32;in&#32;left&#32;shift&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06784"/>06784 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&lt;&#32;0.00001)&#32;{
<anchor xml:id="_ff_8c_source_1l06785"/>06785 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;*=&#32;100000;&#32;rv&#32;-=&#32;5;
<anchor xml:id="_ff_8c_source_1l06786"/>06786 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06787"/>06787 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;*=&#32;10;&#32;rv--;
<anchor xml:id="_ff_8c_source_1l06788"/>06788 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06789"/>06789 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06790"/>06790 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l06791"/>06791 }
<anchor xml:id="_ff_8c_source_1l06792"/>06792 
<anchor xml:id="_ff_8c_source_1l06793"/>06793 
<anchor xml:id="_ff_8c_source_1l06794"/>06794 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">double</emphasis>&#32;i10x&#32;(<emphasis role="keywordtype">int</emphasis>&#32;n)&#32;&#32;<emphasis role="comment">/*&#32;Calculate&#32;10^n&#32;in&#32;integer&#32;input&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06795"/>06795 {
<anchor xml:id="_ff_8c_source_1l06796"/>06796 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">double</emphasis>&#32;rv&#32;=&#32;1;
<anchor xml:id="_ff_8c_source_1l06797"/>06797 
<anchor xml:id="_ff_8c_source_1l06798"/>06798 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n&#32;&gt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Left&#32;shift&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06799"/>06799 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&gt;=&#32;5)&#32;{
<anchor xml:id="_ff_8c_source_1l06800"/>06800 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rv&#32;*=&#32;100000;&#32;n&#32;-=&#32;5;
<anchor xml:id="_ff_8c_source_1l06801"/>06801 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06802"/>06802 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rv&#32;*=&#32;10;&#32;n--;
<anchor xml:id="_ff_8c_source_1l06803"/>06803 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06804"/>06804 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06805"/>06805 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(n&#32;&lt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Right&#32;shift&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06806"/>06806 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(n&#32;&lt;=&#32;-5)&#32;{
<anchor xml:id="_ff_8c_source_1l06807"/>06807 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rv&#32;/=&#32;100000;&#32;n&#32;+=&#32;5;
<anchor xml:id="_ff_8c_source_1l06808"/>06808 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06809"/>06809 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rv&#32;/=&#32;10;&#32;n++;
<anchor xml:id="_ff_8c_source_1l06810"/>06810 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06811"/>06811 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06812"/>06812 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;rv;
<anchor xml:id="_ff_8c_source_1l06813"/>06813 }
<anchor xml:id="_ff_8c_source_1l06814"/>06814 
<anchor xml:id="_ff_8c_source_1l06815"/>06815 
<anchor xml:id="_ff_8c_source_1l06816"/>06816 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;ftoa&#32;(
<anchor xml:id="_ff_8c_source_1l06817"/>06817 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>*&#32;buf,&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;to&#32;output&#32;the&#32;floating&#32;point&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06818"/>06818 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">double</emphasis>&#32;val,&#32;<emphasis role="comment">/*&#32;Value&#32;to&#32;output&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06819"/>06819 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;prec,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Number&#32;of&#32;fractional&#32;digits&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06820"/>06820 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;fmt&#32;&#32;&#32;<emphasis role="comment">/*&#32;Notation&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06821"/>06821 )
<anchor xml:id="_ff_8c_source_1l06822"/>06822 {
<anchor xml:id="_ff_8c_source_1l06823"/>06823 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;d;
<anchor xml:id="_ff_8c_source_1l06824"/>06824 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;e&#32;=&#32;0,&#32;m&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06825"/>06825 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;sign&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06826"/>06826 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">double</emphasis>&#32;w;
<anchor xml:id="_ff_8c_source_1l06827"/>06827 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;*er&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06828"/>06828 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">char</emphasis>&#32;ds&#32;=&#32;<link linkend="_ffconf_8h_1a81c59406fe9df657bfb6d75e409da207">FF_PRINT_FLOAT</link>&#32;==&#32;2&#32;?&#32;<emphasis role="charliteral">&apos;,&apos;</emphasis>&#32;:&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06829"/>06829 
<anchor xml:id="_ff_8c_source_1l06830"/>06830 
<anchor xml:id="_ff_8c_source_1l06831"/>06831 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(isnan(val))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;a&#32;number?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06832"/>06832 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;er&#32;=&#32;<emphasis role="stringliteral">&quot;NaN&quot;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06833"/>06833 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06834"/>06834 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(prec&#32;&lt;&#32;0)&#32;prec&#32;=&#32;6;&#32;<emphasis role="comment">/*&#32;Default&#32;precision?&#32;(6&#32;fractional&#32;digits)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06835"/>06835 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(val&#32;&lt;&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Negative?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06836"/>06836 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;=&#32;0&#32;-&#32;val;&#32;sign&#32;=&#32;<emphasis role="charliteral">&apos;-&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06837"/>06837 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06838"/>06838 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;sign&#32;=&#32;<emphasis role="charliteral">&apos;+&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06839"/>06839 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06840"/>06840 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(isinf(val))&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Infinite?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06841"/>06841 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;er&#32;=&#32;<emphasis role="stringliteral">&quot;INF&quot;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06842"/>06842 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06843"/>06843 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;==&#32;<emphasis role="charliteral">&apos;f&apos;</emphasis>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Decimal&#32;notation?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06844"/>06844 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;+=&#32;i10x(0&#32;-&#32;prec)&#32;/&#32;2;&#32;&#32;<emphasis role="comment">/*&#32;Round&#32;(nearest)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06845"/>06845 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;m&#32;=&#32;ilog10(val);
<anchor xml:id="_ff_8c_source_1l06846"/>06846 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(m&#32;&lt;&#32;0)&#32;m&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06847"/>06847 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(m&#32;+&#32;prec&#32;+&#32;3&#32;&gt;=&#32;SZ_NUM_BUF)&#32;er&#32;=&#32;<emphasis role="stringliteral">&quot;OV&quot;</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06848"/>06848 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;E&#32;notation&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06849"/>06849 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(val&#32;!=&#32;0)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;a&#32;true&#32;zero?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06850"/>06850 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;+=&#32;i10x(ilog10(val)&#32;-&#32;prec)&#32;/&#32;2;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Round&#32;(nearest)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06851"/>06851 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;e&#32;=&#32;ilog10(val);
<anchor xml:id="_ff_8c_source_1l06852"/>06852 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(e&#32;&gt;&#32;99&#32;||&#32;prec&#32;+&#32;7&#32;&gt;=&#32;SZ_NUM_BUF)&#32;{&#32;<emphasis role="comment">/*&#32;Buffer&#32;overflow&#32;or&#32;E&#32;&gt;&#32;+99?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06853"/>06853 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;er&#32;=&#32;<emphasis role="stringliteral">&quot;OV&quot;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06854"/>06854 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06855"/>06855 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(e&#32;&lt;&#32;-99)&#32;e&#32;=&#32;-99;
<anchor xml:id="_ff_8c_source_1l06856"/>06856 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;val&#32;/=&#32;i10x(e);&#32;<emphasis role="comment">/*&#32;Normalize&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06857"/>06857 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06858"/>06858 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06859"/>06859 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06860"/>06860 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06861"/>06861 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!er)&#32;{&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;error&#32;condition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06862"/>06862 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sign&#32;==&#32;<emphasis role="charliteral">&apos;-&apos;</emphasis>)&#32;*buf++&#32;=&#32;sign;&#32;<emphasis role="comment">/*&#32;Add&#32;a&#32;-&#32;if&#32;negative&#32;value&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06863"/>06863 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;decimal&#32;number&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06864"/>06864 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(m&#32;==&#32;-1)&#32;*buf++&#32;=&#32;ds;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Insert&#32;a&#32;decimal&#32;separator&#32;when&#32;get&#32;into&#32;fractional&#32;part&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06865"/>06865 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;w&#32;=&#32;i10x(m);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Snip&#32;the&#32;highest&#32;digit&#32;d&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06866"/>06866 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;d&#32;=&#32;(int)(val&#32;/&#32;w);&#32;val&#32;-=&#32;d&#32;*&#32;w;
<anchor xml:id="_ff_8c_source_1l06867"/>06867 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(char)(<emphasis role="charliteral">&apos;0&apos;</emphasis>&#32;+&#32;d);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;the&#32;digit&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06868"/>06868 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(--m&#32;&gt;=&#32;-prec);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Output&#32;all&#32;digits&#32;specified&#32;by&#32;prec&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06869"/>06869 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fmt&#32;!=&#32;<emphasis role="charliteral">&apos;f&apos;</emphasis>)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;exponent&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06870"/>06870 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(char)fmt;
<anchor xml:id="_ff_8c_source_1l06871"/>06871 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(e&#32;&lt;&#32;0)&#32;{
<anchor xml:id="_ff_8c_source_1l06872"/>06872 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;e&#32;=&#32;0&#32;-&#32;e;&#32;*buf++&#32;=&#32;<emphasis role="charliteral">&apos;-&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06873"/>06873 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06874"/>06874 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;<emphasis role="charliteral">&apos;+&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06875"/>06875 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06876"/>06876 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(char)(<emphasis role="charliteral">&apos;0&apos;</emphasis>&#32;+&#32;e&#32;/&#32;10);
<anchor xml:id="_ff_8c_source_1l06877"/>06877 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;(char)(<emphasis role="charliteral">&apos;0&apos;</emphasis>&#32;+&#32;e&#32;%&#32;10);
<anchor xml:id="_ff_8c_source_1l06878"/>06878 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06879"/>06879 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06880"/>06880 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06881"/>06881 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(er)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Error&#32;condition&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06882"/>06882 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(sign)&#32;*buf++&#32;=&#32;sign;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Add&#32;sign&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06883"/>06883 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Put&#32;error&#32;symbol&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06884"/>06884 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*buf++&#32;=&#32;*er++;
<anchor xml:id="_ff_8c_source_1l06885"/>06885 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(*er);
<anchor xml:id="_ff_8c_source_1l06886"/>06886 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06887"/>06887 &#32;&#32;&#32;&#32;*buf&#32;=&#32;0;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Term&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06888"/>06888 }
<anchor xml:id="_ff_8c_source_1l06889"/>06889 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_PRINT_FLOAT&#32;&amp;&amp;&#32;FF_INTDEF&#32;==&#32;2&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l06890"/>06890 
<anchor xml:id="_ff_8c_source_1l06891"/>06891 
<anchor xml:id="_ff_8c_source_1l06892"/>06892 
<anchor xml:id="_ff_8c_source_1l06893"/>06893 <emphasis role="keywordtype">int</emphasis>&#32;<link linkend="_ff_8h_1a4ce26253177c167df849e76f69b5c66c">f_printf</link>&#32;(
<anchor xml:id="_ff_8c_source_1l06894"/>06894 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;file&#32;object&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06895"/>06895 &#32;&#32;&#32;&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*&#32;fmt,&#32;&#32;&#32;<emphasis role="comment">/*&#32;Pointer&#32;to&#32;the&#32;format&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06896"/>06896 &#32;&#32;&#32;&#32;...&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Optional&#32;arguments...&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06897"/>06897 )
<anchor xml:id="_ff_8c_source_1l06898"/>06898 {
<anchor xml:id="_ff_8c_source_1l06899"/>06899 &#32;&#32;&#32;&#32;va_list&#32;arp;
<anchor xml:id="_ff_8c_source_1l06900"/>06900 &#32;&#32;&#32;&#32;putbuff&#32;pb;
<anchor xml:id="_ff_8c_source_1l06901"/>06901 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i,&#32;j,&#32;w,&#32;f,&#32;r;
<anchor xml:id="_ff_8c_source_1l06902"/>06902 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;prec;
<anchor xml:id="_ff_8c_source_1l06903"/>06903 <emphasis role="preprocessor">#if&#32;FF_PRINT_LLI&#32;&amp;&amp;&#32;FF_INTDEF&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06904"/>06904 &#32;&#32;&#32;&#32;QWORD&#32;v;
<anchor xml:id="_ff_8c_source_1l06905"/>06905 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l06906"/>06906 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;v;
<anchor xml:id="_ff_8c_source_1l06907"/>06907 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06908"/>06908 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;*tp;
<anchor xml:id="_ff_8c_source_1l06909"/>06909 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;tc,&#32;pad;
<anchor xml:id="_ff_8c_source_1l06910"/>06910 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>&#32;nul&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06911"/>06911 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">char</emphasis>&#32;d,&#32;str[SZ_NUM_BUF];
<anchor xml:id="_ff_8c_source_1l06912"/>06912 
<anchor xml:id="_ff_8c_source_1l06913"/>06913 
<anchor xml:id="_ff_8c_source_1l06914"/>06914 &#32;&#32;&#32;&#32;putc_init(&amp;pb,&#32;fp);
<anchor xml:id="_ff_8c_source_1l06915"/>06915 
<anchor xml:id="_ff_8c_source_1l06916"/>06916 &#32;&#32;&#32;&#32;va_start(arp,&#32;fmt);
<anchor xml:id="_ff_8c_source_1l06917"/>06917 
<anchor xml:id="_ff_8c_source_1l06918"/>06918 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(;;)&#32;{
<anchor xml:id="_ff_8c_source_1l06919"/>06919 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06920"/>06920 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;format&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06921"/>06921 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;!=&#32;<emphasis role="charliteral">&apos;%&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;an&#32;escape&#32;character&#32;(pass-through)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06922"/>06922 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;tc);
<anchor xml:id="_ff_8c_source_1l06923"/>06923 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l06924"/>06924 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06925"/>06925 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;f&#32;=&#32;w&#32;=&#32;0;&#32;pad&#32;=&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>;&#32;prec&#32;=&#32;-1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Initialize&#32;parms&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06926"/>06926 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06927"/>06927 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flag:&#32;&apos;0&apos;&#32;padded&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06928"/>06928 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;pad&#32;=&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06929"/>06929 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;-&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Flag:&#32;Left&#32;aligned&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06930"/>06930 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;f&#32;=&#32;2;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06931"/>06931 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06932"/>06932 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;*&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Minimum&#32;width&#32;from&#32;an&#32;argument&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06933"/>06933 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;w&#32;=&#32;va_arg(arp,&#32;<emphasis role="keywordtype">int</emphasis>);
<anchor xml:id="_ff_8c_source_1l06934"/>06934 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06935"/>06935 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06936"/>06936 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<link linkend="_ff_8c_1a65dee564f69f2ec27f25b67a348018b9">IsDigit</link>(tc))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Minimum&#32;width&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06937"/>06937 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;w&#32;=&#32;w&#32;*&#32;10&#32;+&#32;tc&#32;-&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06938"/>06938 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06939"/>06939 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06940"/>06940 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06941"/>06941 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;.&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Precision&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06942"/>06942 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06943"/>06943 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;*&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Precision&#32;from&#32;an&#32;argument&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06944"/>06944 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;prec&#32;=&#32;va_arg(arp,&#32;<emphasis role="keywordtype">int</emphasis>);
<anchor xml:id="_ff_8c_source_1l06945"/>06945 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06946"/>06946 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{
<anchor xml:id="_ff_8c_source_1l06947"/>06947 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;prec&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l06948"/>06948 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(<link linkend="_ff_8c_1a65dee564f69f2ec27f25b67a348018b9">IsDigit</link>(tc))&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Precision&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06949"/>06949 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;prec&#32;=&#32;prec&#32;*&#32;10&#32;+&#32;tc&#32;-&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l06950"/>06950 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06951"/>06951 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06952"/>06952 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06953"/>06953 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06954"/>06954 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;l&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size:&#32;long&#32;int&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06955"/>06955 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;f&#32;|=&#32;4;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06956"/>06956 <emphasis role="preprocessor">#if&#32;FF_PRINT_LLI&#32;&amp;&amp;&#32;FF_INTDEF&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06957"/>06957 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;l&apos;</emphasis>)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Size:&#32;long&#32;long&#32;int&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06958"/>06958 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;f&#32;|=&#32;8;&#32;tc&#32;=&#32;*fmt++;
<anchor xml:id="_ff_8c_source_1l06959"/>06959 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06960"/>06960 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l06961"/>06961 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l06962"/>06962 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;0)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;End&#32;of&#32;format&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06963"/>06963 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">switch</emphasis>&#32;(tc)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Atgument&#32;type&#32;is...&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06964"/>06964 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;b&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unsigned&#32;binary&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06965"/>06965 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;r&#32;=&#32;2;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06966"/>06966 
<anchor xml:id="_ff_8c_source_1l06967"/>06967 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;o&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unsigned&#32;octal&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06968"/>06968 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;r&#32;=&#32;8;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06969"/>06969 
<anchor xml:id="_ff_8c_source_1l06970"/>06970 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;d&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Signed&#32;decimal&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06971"/>06971 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;u&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unsigned&#32;decimal&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06972"/>06972 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;r&#32;=&#32;10;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06973"/>06973 
<anchor xml:id="_ff_8c_source_1l06974"/>06974 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;x&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unsigned&#32;hexadecimal&#32;(lower&#32;case)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06975"/>06975 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;X&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unsigned&#32;hexadecimal&#32;(upper&#32;case)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06976"/>06976 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;r&#32;=&#32;16;&#32;<emphasis role="keywordflow">break</emphasis>;
<anchor xml:id="_ff_8c_source_1l06977"/>06977 
<anchor xml:id="_ff_8c_source_1l06978"/>06978 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;c&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Character&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06979"/>06979 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)va_arg(arp,&#32;<emphasis role="keywordtype">int</emphasis>));
<anchor xml:id="_ff_8c_source_1l06980"/>06980 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l06981"/>06981 
<anchor xml:id="_ff_8c_source_1l06982"/>06982 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;s&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;String&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06983"/>06983 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;tp&#32;=&#32;va_arg(arp,&#32;<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>*);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;a&#32;pointer&#32;argument&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06984"/>06984 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(!tp)&#32;tp&#32;=&#32;&amp;nul;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Null&#32;ptr&#32;generates&#32;a&#32;null&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06985"/>06985 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;0;&#32;tp[j];&#32;j++)&#32;;&#32;&#32;&#32;<emphasis role="comment">/*&#32;j&#32;=&#32;tcslen(tp)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06986"/>06986 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(prec&#32;&gt;=&#32;0&#32;&amp;&amp;&#32;j&#32;&gt;&#32;(<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>)prec)&#32;j&#32;=&#32;prec;&#32;&#32;<emphasis role="comment">/*&#32;Limited&#32;length&#32;of&#32;string&#32;body&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06987"/>06987 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(&#32;;&#32;!(f&#32;&amp;&#32;2)&#32;&amp;&amp;&#32;j&#32;&lt;&#32;w;&#32;j++)&#32;putc_bfd(&amp;pb,&#32;pad);&#32;<emphasis role="comment">/*&#32;Left&#32;pads&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06988"/>06988 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(*tp&#32;&amp;&amp;&#32;prec--)&#32;putc_bfd(&amp;pb,&#32;*tp++);&#32;<emphasis role="comment">/*&#32;Body&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06989"/>06989 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(j++&#32;&lt;&#32;w)&#32;putc_bfd(&amp;pb,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Right&#32;pads&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06990"/>06990 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l06991"/>06991 <emphasis role="preprocessor">#if&#32;FF_PRINT_FLOAT&#32;&amp;&amp;&#32;FF_INTDEF&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l06992"/>06992 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;f&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Floating&#32;point&#32;(decimal)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06993"/>06993 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;e&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Floating&#32;point&#32;(e)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06994"/>06994 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">case</emphasis>&#32;<emphasis role="charliteral">&apos;E&apos;</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Floating&#32;point&#32;(E)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06995"/>06995 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ftoa(str,&#32;va_arg(arp,&#32;<emphasis role="keywordtype">double</emphasis>),&#32;prec,&#32;tc);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;a&#32;floating&#32;point&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06996"/>06996 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;strlen(str);&#32;!(f&#32;&amp;&#32;2)&#32;&amp;&amp;&#32;j&#32;&lt;&#32;w;&#32;j++)&#32;putc_bfd(&amp;pb,&#32;pad);&#32;&#32;&#32;<emphasis role="comment">/*&#32;Left&#32;pads&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06997"/>06997 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;str[i];&#32;putc_bfd(&amp;pb,&#32;str[i++]))&#32;;&#32;&#32;<emphasis role="comment">/*&#32;Body&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06998"/>06998 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(j++&#32;&lt;&#32;w)&#32;putc_bfd(&amp;pb,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>);&#32;<emphasis role="comment">/*&#32;Right&#32;pads&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l06999"/>06999 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l07000"/>07000 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l07001"/>07001 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">default</emphasis>:&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Unknown&#32;type&#32;(pass-through)&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07002"/>07002 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;tc);&#32;<emphasis role="keywordflow">continue</emphasis>;
<anchor xml:id="_ff_8c_source_1l07003"/>07003 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07004"/>07004 
<anchor xml:id="_ff_8c_source_1l07005"/>07005 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;an&#32;integer&#32;argument&#32;and&#32;put&#32;it&#32;in&#32;numeral&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07006"/>07006 <emphasis role="preprocessor">#if&#32;FF_PRINT_LLI&#32;&amp;&amp;&#32;FF_INTDEF&#32;==&#32;2</emphasis>
<anchor xml:id="_ff_8c_source_1l07007"/>07007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(f&#32;&amp;&#32;8)&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;long&#32;long&#32;argument?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07008"/>07008 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;(QWORD)va_arg(arp,&#32;<emphasis role="keywordtype">long</emphasis>&#32;<emphasis role="keywordtype">long</emphasis>);
<anchor xml:id="_ff_8c_source_1l07009"/>07009 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>&#32;(f&#32;&amp;&#32;4)&#32;{&#32;<emphasis role="comment">/*&#32;long&#32;argument?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07010"/>07010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;d&apos;</emphasis>)&#32;?&#32;(QWORD)(<emphasis role="keywordtype">long</emphasis>&#32;long)va_arg(arp,&#32;<emphasis role="keywordtype">long</emphasis>)&#32;:&#32;(QWORD)va_arg(arp,&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">long</emphasis>);
<anchor xml:id="_ff_8c_source_1l07011"/>07011 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;int/short/char&#32;argument&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07012"/>07012 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;d&apos;</emphasis>)&#32;?&#32;(QWORD)(<emphasis role="keywordtype">long</emphasis>&#32;long)va_arg(arp,&#32;<emphasis role="keywordtype">int</emphasis>)&#32;:&#32;(QWORD)va_arg(arp,&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>);
<anchor xml:id="_ff_8c_source_1l07013"/>07013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07014"/>07014 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;d&apos;</emphasis>&#32;&amp;&amp;&#32;(v&#32;&amp;&#32;0x8000000000000000))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Negative&#32;value?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07015"/>07015 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;0&#32;-&#32;v;&#32;f&#32;|=&#32;1;
<anchor xml:id="_ff_8c_source_1l07016"/>07016 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07017"/>07017 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_ff_8c_source_1l07018"/>07018 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(f&#32;&amp;&#32;4)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;long&#32;argument?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07019"/>07019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)va_arg(arp,&#32;<emphasis role="keywordtype">long</emphasis>);
<anchor xml:id="_ff_8c_source_1l07020"/>07020 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;int/short/char&#32;argument&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07021"/>07021 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;d&apos;</emphasis>)&#32;?&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)(long)va_arg(arp,&#32;<emphasis role="keywordtype">int</emphasis>)&#32;:&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)va_arg(arp,&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>);
<anchor xml:id="_ff_8c_source_1l07022"/>07022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07023"/>07023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;d&apos;</emphasis>&#32;&amp;&amp;&#32;(v&#32;&amp;&#32;0x80000000))&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Negative&#32;value?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07024"/>07024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;0&#32;-&#32;v;&#32;f&#32;|=&#32;1;
<anchor xml:id="_ff_8c_source_1l07025"/>07025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07026"/>07026 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_ff_8c_source_1l07027"/>07027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;i&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l07028"/>07028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Make&#32;an&#32;integer&#32;number&#32;string&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07029"/>07029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;d&#32;=&#32;(char)(v&#32;%&#32;r);&#32;v&#32;/=&#32;r;
<anchor xml:id="_ff_8c_source_1l07030"/>07030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(d&#32;&gt;&#32;9)&#32;d&#32;+=&#32;(tc&#32;==&#32;<emphasis role="charliteral">&apos;x&apos;</emphasis>)&#32;?&#32;0x27&#32;:&#32;0x07;
<anchor xml:id="_ff_8c_source_1l07031"/>07031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;str[i++]&#32;=&#32;d&#32;+&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>;
<anchor xml:id="_ff_8c_source_1l07032"/>07032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(v&#32;&amp;&amp;&#32;i&#32;&lt;&#32;SZ_NUM_BUF);
<anchor xml:id="_ff_8c_source_1l07033"/>07033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(f&#32;&amp;&#32;1)&#32;str[i++]&#32;=&#32;<emphasis role="charliteral">&apos;-&apos;</emphasis>;&#32;&#32;<emphasis role="comment">/*&#32;Sign&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07034"/>07034 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Write&#32;it&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07035"/>07035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(j&#32;=&#32;i;&#32;!(f&#32;&amp;&#32;2)&#32;&amp;&amp;&#32;j&#32;&lt;&#32;w;&#32;j++)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Left&#32;pads&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07036"/>07036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;pad);
<anchor xml:id="_ff_8c_source_1l07037"/>07037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07038"/>07038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">do</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Body&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07039"/>07039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;(<link linkend="_ff_8h_1a03bdb8ce5895c7e261aadc2529637546">TCHAR</link>)str[--i]);
<anchor xml:id="_ff_8c_source_1l07040"/>07040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">while</emphasis>&#32;(i);
<anchor xml:id="_ff_8c_source_1l07041"/>07041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(j++&#32;&lt;&#32;w)&#32;{&#32;&#32;&#32;<emphasis role="comment">/*&#32;Right&#32;pads&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07042"/>07042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;putc_bfd(&amp;pb,&#32;<emphasis role="charliteral">&apos;&#32;&apos;</emphasis>);
<anchor xml:id="_ff_8c_source_1l07043"/>07043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07044"/>07044 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07045"/>07045 
<anchor xml:id="_ff_8c_source_1l07046"/>07046 &#32;&#32;&#32;&#32;va_end(arp);
<anchor xml:id="_ff_8c_source_1l07047"/>07047 
<anchor xml:id="_ff_8c_source_1l07048"/>07048 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;putc_flush(&amp;pb);
<anchor xml:id="_ff_8c_source_1l07049"/>07049 }
<anchor xml:id="_ff_8c_source_1l07050"/>07050 
<anchor xml:id="_ff_8c_source_1l07051"/>07051 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;!FF_FS_READONLY&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l07052"/>07052 <emphasis role="preprocessor">#endif&#32;</emphasis><emphasis role="comment">/*&#32;FF_USE_STRFUNC&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l07053"/>07053 
<anchor xml:id="_ff_8c_source_1l07054"/>07054 
<anchor xml:id="_ff_8c_source_1l07055"/>07055 
<anchor xml:id="_ff_8c_source_1l07056"/>07056 <emphasis role="preprocessor">#if&#32;FF_CODE_PAGE&#32;==&#32;0</emphasis>
<anchor xml:id="_ff_8c_source_1l07057"/>07057 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07058"/>07058 <emphasis role="comment">/*&#32;Set&#32;Active&#32;Codepage&#32;for&#32;the&#32;Path&#32;Name&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07059"/>07059 <emphasis role="comment">/*-----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07060"/>07060 
<anchor xml:id="_ff_8c_source_1l07061"/>07061 <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_ff_8h_1a529e8f17cae495f6536ff405622c996c">f_setcp</link>&#32;(
<anchor xml:id="_ff_8c_source_1l07062"/>07062 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;cp&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Value&#32;to&#32;be&#32;set&#32;as&#32;active&#32;code&#32;page&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07063"/>07063 )
<anchor xml:id="_ff_8c_source_1l07064"/>07064 {
<anchor xml:id="_ff_8c_source_1l07065"/>07065 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a197942eefa7db30960ae396d68339b97">WORD</link>&#32;&#32;&#32;&#32;&#32;&#32;&#32;validcp[22]&#32;=&#32;{&#32;&#32;437,&#32;&#32;&#32;720,&#32;&#32;&#32;737,&#32;&#32;&#32;771,&#32;&#32;&#32;775,&#32;&#32;&#32;850,&#32;&#32;&#32;852,&#32;&#32;&#32;855,&#32;&#32;&#32;857,&#32;&#32;&#32;860,&#32;&#32;&#32;861,&#32;&#32;&#32;862,&#32;&#32;&#32;863,&#32;&#32;&#32;864,&#32;&#32;&#32;865,&#32;&#32;&#32;866,&#32;&#32;&#32;869,&#32;&#32;&#32;932,&#32;&#32;&#32;936,&#32;&#32;&#32;949,&#32;&#32;&#32;950,&#32;0};
<anchor xml:id="_ff_8c_source_1l07066"/>07066 &#32;&#32;&#32;&#32;<emphasis role="keyword">static</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<link linkend="_ff_8h_1a4ae1dab0fb4b072a66584546209e7d58">BYTE</link>&#32;*<emphasis role="keyword">const</emphasis>&#32;tables[22]&#32;=&#32;{Ct437,&#32;Ct720,&#32;Ct737,&#32;Ct771,&#32;Ct775,&#32;Ct850,&#32;Ct852,&#32;Ct855,&#32;Ct857,&#32;Ct860,&#32;Ct861,&#32;Ct862,&#32;Ct863,&#32;Ct864,&#32;Ct865,&#32;Ct866,&#32;Ct869,&#32;Dc932,&#32;Dc936,&#32;Dc949,&#32;Dc950,&#32;0};
<anchor xml:id="_ff_8c_source_1l07067"/>07067 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a36cb3b01d81ffd844bbbfb54003e06ec">UINT</link>&#32;i;
<anchor xml:id="_ff_8c_source_1l07068"/>07068 
<anchor xml:id="_ff_8c_source_1l07069"/>07069 
<anchor xml:id="_ff_8c_source_1l07070"/>07070 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;(i&#32;=&#32;0;&#32;validcp[i]&#32;!=&#32;0&#32;&amp;&amp;&#32;validcp[i]&#32;!=&#32;cp;&#32;i++)&#32;;&#32;<emphasis role="comment">/*&#32;Find&#32;the&#32;code&#32;page&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07071"/>07071 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(validcp[i]&#32;!=&#32;cp)&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca3b89faeceab64db277d0fcdeaaa315d6">FR_INVALID_PARAMETER</link>;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Not&#32;found?&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07072"/>07072 
<anchor xml:id="_ff_8c_source_1l07073"/>07073 &#32;&#32;&#32;&#32;CodePage&#32;=&#32;cp;
<anchor xml:id="_ff_8c_source_1l07074"/>07074 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(cp&#32;&gt;=&#32;900)&#32;{&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;DBCS&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07075"/>07075 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ExCvt&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l07076"/>07076 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;DbcTbl&#32;=&#32;tables[i];
<anchor xml:id="_ff_8c_source_1l07077"/>07077 &#32;&#32;&#32;&#32;}&#32;<emphasis role="keywordflow">else</emphasis>&#32;{&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;SBCS&#32;*/</emphasis>
<anchor xml:id="_ff_8c_source_1l07078"/>07078 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;ExCvt&#32;=&#32;tables[i];
<anchor xml:id="_ff_8c_source_1l07079"/>07079 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;DbcTbl&#32;=&#32;0;
<anchor xml:id="_ff_8c_source_1l07080"/>07080 &#32;&#32;&#32;&#32;}
<anchor xml:id="_ff_8c_source_1l07081"/>07081 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_ff_8c_source_1l07082"/>07082 }
<anchor xml:id="_ff_8c_source_1l07083"/>07083 <emphasis role="preprocessor">#endif&#32;&#32;</emphasis><emphasis role="comment">/*&#32;FF_CODE_PAGE&#32;==&#32;0&#32;*/</emphasis><emphasis role="preprocessor"></emphasis>
<anchor xml:id="_ff_8c_source_1l07084"/>07084 
</programlisting></section>
