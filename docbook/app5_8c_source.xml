<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_app5_8c_source" xml:lang="en-US">
<title>app5.c</title>
<indexterm><primary>lib/pico-vfs-REGI-Local/vendor/ff15/documents/res/app5.c</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_app5_8c_source_1l00001"/>00001 <emphasis role="comment">/*----------------------------------------------------------------------/</emphasis>
<anchor xml:id="_app5_8c_source_1l00002"/>00002 <emphasis role="comment">/&#32;Test&#32;if&#32;the&#32;file&#32;is&#32;contiguous&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;/</emphasis>
<anchor xml:id="_app5_8c_source_1l00003"/>00003 <emphasis role="comment">/----------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00004"/>00004 
<anchor xml:id="_app5_8c_source_1l00005"/><link linkend="_app5_8c_1a9772009a10ab7b6825e887b38708628a">00005</link> <link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;<link linkend="_app5_8c_1a9772009a10ab7b6825e887b38708628a">test_contiguous_file</link>&#32;(
<anchor xml:id="_app5_8c_source_1l00006"/>00006 &#32;&#32;&#32;&#32;<link linkend="_struct_f_i_l">FIL</link>*&#32;fp,&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;[IN]&#32;&#32;Open&#32;file&#32;object&#32;to&#32;be&#32;checked&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00007"/>00007 &#32;&#32;&#32;&#32;<emphasis role="keywordtype">int</emphasis>*&#32;cont&#32;&#32;&#32;<emphasis role="comment">/*&#32;[OUT]&#32;1:Contiguous,&#32;0:Fragmented&#32;or&#32;zero-length&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00008"/>00008 )
<anchor xml:id="_app5_8c_source_1l00009"/>00009 {
<anchor xml:id="_app5_8c_source_1l00010"/>00010 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>&#32;clst,&#32;clsz,&#32;step;
<anchor xml:id="_app5_8c_source_1l00011"/>00011 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a3fc0992ad7436250b6b1a0592214b7f2">FSIZE_t</link>&#32;fsz;
<anchor xml:id="_app5_8c_source_1l00012"/>00012 &#32;&#32;&#32;&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44c">FRESULT</link>&#32;fr;
<anchor xml:id="_app5_8c_source_1l00013"/>00013 
<anchor xml:id="_app5_8c_source_1l00014"/>00014 
<anchor xml:id="_app5_8c_source_1l00015"/>00015 &#32;&#32;&#32;&#32;*cont&#32;=&#32;0;
<anchor xml:id="_app5_8c_source_1l00016"/>00016 &#32;&#32;&#32;&#32;fr&#32;=&#32;<link linkend="_ff_8h_1ae4caf47dd5cbc123b61d35542481b1be">f_rewind</link>(fp);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Validates&#32;and&#32;prepares&#32;the&#32;file&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00017"/>00017 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fr&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;fr;
<anchor xml:id="_app5_8c_source_1l00018"/>00018 
<anchor xml:id="_app5_8c_source_1l00019"/>00019 <emphasis role="preprocessor">#if&#32;FF_MAX_SS&#32;==&#32;FF_MIN_SS</emphasis>
<anchor xml:id="_app5_8c_source_1l00020"/>00020 &#32;&#32;&#32;&#32;clsz&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;<link linkend="_ffconf_8h_1a104c36ee46f9d6e76dadf37f3d9696cc">FF_MAX_SS</link>;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Cluster&#32;size&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00021"/>00021 <emphasis role="preprocessor">#else</emphasis>
<anchor xml:id="_app5_8c_source_1l00022"/>00022 &#32;&#32;&#32;&#32;clsz&#32;=&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;<link linkend="_struct_f_a_t_f_s_1ad7fa7a509f8d097a9ab182d6c47be568">csize</link>&#32;*&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1a867089659a2374d44ab917c60037fe5c">fs</link>-&gt;ssize;
<anchor xml:id="_app5_8c_source_1l00023"/>00023 <emphasis role="preprocessor">#endif</emphasis>
<anchor xml:id="_app5_8c_source_1l00024"/>00024 &#32;&#32;&#32;&#32;fsz&#32;=&#32;<link linkend="_ff_8h_1a26f33722c5bf1aa3cd6f0290a83eb2bc">f_size</link>(fp);
<anchor xml:id="_app5_8c_source_1l00025"/>00025 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsz&#32;&gt;&#32;0)&#32;{
<anchor xml:id="_app5_8c_source_1l00026"/>00026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1ad95b6e85106673b0d7a1855da4d264f4">obj</link>.<link linkend="_struct_f_f_o_b_j_i_d_1ad990393e2ddf16f73671ded4b751becb">sclust</link>&#32;-&#32;1;&#32;&#32;<emphasis role="comment">/*&#32;A&#32;cluster&#32;leading&#32;the&#32;first&#32;cluster&#32;for&#32;first&#32;test&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00027"/>00027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>&#32;(fsz)&#32;{
<anchor xml:id="_app5_8c_source_1l00028"/>00028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;step&#32;=&#32;(fsz&#32;&gt;=&#32;clsz)&#32;?&#32;clsz&#32;:&#32;(<link linkend="_ff_8h_1ad342ac907eb044443153a22f964bf0af">DWORD</link>)fsz;
<anchor xml:id="_app5_8c_source_1l00029"/>00029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fr&#32;=&#32;<link linkend="_ff_8c_1a7c4bcf81d9122f0b5376852ec6a8c3eb">f_lseek</link>(fp,&#32;<link linkend="_ff_8h_1a5e1daca7ce13cdc277e42185f7f9124f">f_tell</link>(fp)&#32;+&#32;step);&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Advances&#32;file&#32;pointer&#32;a&#32;cluster&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00030"/>00030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fr&#32;!=&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>)&#32;<emphasis role="keywordflow">return</emphasis>&#32;fr;
<anchor xml:id="_app5_8c_source_1l00031"/>00031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(clst&#32;+&#32;1&#32;!=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>)&#32;<emphasis role="keywordflow">break</emphasis>;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Is&#32;not&#32;the&#32;cluster&#32;next&#32;to&#32;previous&#32;one?&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00032"/>00032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;clst&#32;=&#32;fp-&gt;<link linkend="_struct_f_i_l_1aa41312aba551b9a6d1c9d3c8c7d2734b">clust</link>;&#32;fsz&#32;-=&#32;step;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Get&#32;current&#32;cluster&#32;for&#32;next&#32;test&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00033"/>00033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_app5_8c_source_1l00034"/>00034 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(fsz&#32;==&#32;0)&#32;*cont&#32;=&#32;1;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;All&#32;done&#32;without&#32;fail?&#32;*/</emphasis>
<anchor xml:id="_app5_8c_source_1l00035"/>00035 &#32;&#32;&#32;&#32;}
<anchor xml:id="_app5_8c_source_1l00036"/>00036 
<anchor xml:id="_app5_8c_source_1l00037"/>00037 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;<link linkend="_ff_8h_1a49d0171ecbd362cda5680a0d360db44ca62fce5cd9df008f8fc85f99706bda5f1">FR_OK</link>;
<anchor xml:id="_app5_8c_source_1l00038"/>00038 }
</programlisting></section>
