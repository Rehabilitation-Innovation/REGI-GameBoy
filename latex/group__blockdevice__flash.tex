\doxysubsection{blockdevice\+\_\+flash }
\hypertarget{group__blockdevice__flash}{}\label{group__blockdevice__flash}\index{blockdevice\_flash@{blockdevice\_flash}}


Raspberry Pi Pico on-\/board flash memory block device.  


\doxysubsubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{group__blockdevice_ga4bc2c146f975b5250be7f8f5f219f5e4}{blockdevice\+\_\+t}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{group__blockdevice__flash_gaa4f26759924c70f9a86436aa58f67cfc}{blockdevice\+\_\+flash\+\_\+create}} (uint32\+\_\+t start, size\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Create Raspberry Pi Pico On-\/board Flash block device. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__blockdevice__flash_ga8d9d318677d2c372535f4c775c5a22c9}{blockdevice\+\_\+flash\+\_\+free}} (\mbox{\hyperlink{group__blockdevice_ga4bc2c146f975b5250be7f8f5f219f5e4}{blockdevice\+\_\+t}} \texorpdfstring{$\ast$}{*}device)
\begin{DoxyCompactList}\small\item\em Release the flash memory device. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsubsection{Detailed Description}
Raspberry Pi Pico on-\/board flash memory block device. 



\label{doc-func-members}
\Hypertarget{group__blockdevice__flash_doc-func-members}
\doxysubsubsection{Function Documentation}
\Hypertarget{group__blockdevice__flash_gaa4f26759924c70f9a86436aa58f67cfc}\index{blockdevice\_flash@{blockdevice\_flash}!blockdevice\_flash\_create@{blockdevice\_flash\_create}}
\index{blockdevice\_flash\_create@{blockdevice\_flash\_create}!blockdevice\_flash@{blockdevice\_flash}}
\doxysubsubsubsection{\texorpdfstring{blockdevice\_flash\_create()}{blockdevice\_flash\_create()}}
{\footnotesize\ttfamily \label{group__blockdevice__flash_gaa4f26759924c70f9a86436aa58f67cfc} 
\mbox{\hyperlink{group__blockdevice_ga4bc2c146f975b5250be7f8f5f219f5e4}{blockdevice\+\_\+t}} \texorpdfstring{$\ast$}{*} blockdevice\+\_\+flash\+\_\+create (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{start}{, }\item[{size\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Create Raspberry Pi Pico On-\/board Flash block device. 

Create a block device object that uses the Raspberry Pi Pico onboard flash memory. The start position of the flash memory to be allocated to the block device is specified by start and the length by length. start and length must be aligned to a flash sector of 4096 bytes.


\begin{DoxyParams}{Parameters}
{\em start} & Specifies the starting position of the flash memory to be allocated to the block device in bytes. \\
\hline
{\em length} & Size in bytes to be allocated to the block device. If zero is specified, all remaining space is used. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Block device object. Returnes NULL in case of failure. 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em NULL} & Failed to create block device object. \\
\hline
\end{DoxyRetVals}


Definition at line \mbox{\hyperlink{flash_8c_source_l00125}{125}} of file \mbox{\hyperlink{flash_8c_source}{flash.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00126\ \ \ \ \ assert(start\ \%\ FLASH\_SECTOR\_SIZE\ ==\ 0);}
\DoxyCodeLine{00127\ \ \ \ \ assert(length\ \%\ FLASH\_SECTOR\_SIZE\ ==\ 0);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{group__blockdevice_ga4bc2c146f975b5250be7f8f5f219f5e4}{blockdevice\_t}}\ *device\ =\ calloc(1,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{group__blockdevice_ga4bc2c146f975b5250be7f8f5f219f5e4}{blockdevice\_t}}));}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ (device\ ==\ NULL)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}blockdevice\_flash\_create:\ Out\ of\ memory\(\backslash\)n"{}});}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \mbox{\hyperlink{structblockdevice__flash__config__t}{blockdevice\_flash\_config\_t}}\ *config\ =\ calloc(1,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structblockdevice__flash__config__t}{blockdevice\_flash\_config\_t}}));}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordflow}{if}\ (config\ ==\ NULL)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}blockdevice\_flash\_create:\ Out\ of\ memory\(\backslash\)n"{}});}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ free(device);}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00139\ \ \ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_ad37adc41062aa442c1f80852285e0b35}{init}}\ =\ init;}
\DoxyCodeLine{00142\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a49aee7ebd3ba09abcc167ba8b026e2a3}{deinit}}\ =\ deinit;}
\DoxyCodeLine{00143\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_ae4801dd67b1481ac013520098523988e}{read}}\ =\ read;}
\DoxyCodeLine{00144\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_aca297cb4c31042de2aeda00a9b8f8196}{erase}}\ =\ erase;}
\DoxyCodeLine{00145\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a07d24eb0a566f88aa45cf1d236006822}{program}}\ =\ program;}
\DoxyCodeLine{00146\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a0326c4dca54ff9e7966053c3aa96adcf}{trim}}\ =\ trim;}
\DoxyCodeLine{00147\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_aaff48a348ee1441de6d05ffad85875ee}{sync}}\ =\ sync;}
\DoxyCodeLine{00148\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_abba40bbe04d3a88d270634a788249477}{size}}\ =\ size;}
\DoxyCodeLine{00149\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a44ac5dc03dd62d3c48abbdbd0c9fed4d}{read\_size}}\ =\ 1;}
\DoxyCodeLine{00150\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_ab4bddfc59b1c4918514f359c4b509dd3}{erase\_size}}\ =\ FLASH\_SECTOR\_SIZE;\ \ \textcolor{comment}{//\ 4096\ byte}}
\DoxyCodeLine{00151\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a79e2a5807006883bcbf1f60a91bdaf98}{program\_size}}\ =\ FLASH\_PAGE\_SIZE;\ \ \textcolor{comment}{//\ 256\ byte}}
\DoxyCodeLine{00152\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_ac5845731ff9674fc82a752fbd270130d}{name}}\ =\ DEVICE\_NAME;}
\DoxyCodeLine{00153\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a9a2c51cef39211e0d1c42fc3e395caa0}{is\_initialized}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ config-\/>\mbox{\hyperlink{structblockdevice__flash__config__t_afe08d636949a8df67ac13538ce5c52b0}{start}}\ =\ start;}
\DoxyCodeLine{00156\ \ \ \ \ config-\/>\mbox{\hyperlink{structblockdevice__flash__config__t_a0476083842643a0772e611d8d56abade}{length}}\ =\ length\ >\ 0\ ?\ length\ :\ (\mbox{\hyperlink{regi__rev1_8h_a7ad5a8273ffcd10db868c3c3e03d5bf0}{PICO\_FLASH\_SIZE\_BYTES}}\ -\/\ start);}
\DoxyCodeLine{00157\ \ \ \ \ mutex\_init(\&config-\/>\mbox{\hyperlink{structblockdevice__flash__config__t_a20c0f3240342a6919c8c389d8d5b1dfa}{\_mutex}});}
\DoxyCodeLine{00158\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_a73a27f59d5175f4a31d4ab3cd2a7e3c0}{config}}\ =\ config;}
\DoxyCodeLine{00159\ \ \ \ \ device-\/>\mbox{\hyperlink{structblockdevice_ad37adc41062aa442c1f80852285e0b35}{init}}(device);}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{return}\ device;}
\DoxyCodeLine{00161\ \}}

\end{DoxyCode}
\Hypertarget{group__blockdevice__flash_ga8d9d318677d2c372535f4c775c5a22c9}\index{blockdevice\_flash@{blockdevice\_flash}!blockdevice\_flash\_free@{blockdevice\_flash\_free}}
\index{blockdevice\_flash\_free@{blockdevice\_flash\_free}!blockdevice\_flash@{blockdevice\_flash}}
\doxysubsubsubsection{\texorpdfstring{blockdevice\_flash\_free()}{blockdevice\_flash\_free()}}
{\footnotesize\ttfamily \label{group__blockdevice__flash_ga8d9d318677d2c372535f4c775c5a22c9} 
void blockdevice\+\_\+flash\+\_\+free (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__blockdevice_ga4bc2c146f975b5250be7f8f5f219f5e4}{blockdevice\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{device}{}\end{DoxyParamCaption})}



Release the flash memory device. 


\begin{DoxyParams}{Parameters}
{\em device} & Block device object. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{flash_8c_source_l00163}{163}} of file \mbox{\hyperlink{flash_8c_source}{flash.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00164\ \ \ \ \ free(device-\/>\mbox{\hyperlink{structblockdevice_a73a27f59d5175f4a31d4ab3cd2a7e3c0}{config}});}
\DoxyCodeLine{00165\ \ \ \ \ free(device);}
\DoxyCodeLine{00166\ \}}

\end{DoxyCode}
